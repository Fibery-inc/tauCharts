/*!
 * /*
 * taucharts@2.7.0 (2019-03-08)
 * Copyright 2019 Targetprocess, Inc.
 * Licensed under Apache License 2.0
 * * /
 * 
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("d3-selection"),require("d3-array"),require("d3-scale"),require("topojson-client"),require("d3-transition"),require("d3-format"),require("d3-time-format"),require("d3-brush"),require("d3-color"),require("d3-axis"),require("d3-geo"),require("d3-quadtree"),require("d3-shape"),require("d3-time")):"function"==typeof define&&define.amd?define(["d3-selection","d3-array","d3-scale","topojson-client","d3-transition","d3-format","d3-time-format","d3-brush","d3-color","d3-axis","d3-geo","d3-quadtree","d3-shape","d3-time"],t):"object"==typeof exports?exports.Taucharts=t(require("d3-selection"),require("d3-array"),require("d3-scale"),require("topojson-client"),require("d3-transition"),require("d3-format"),require("d3-time-format"),require("d3-brush"),require("d3-color"),require("d3-axis"),require("d3-geo"),require("d3-quadtree"),require("d3-shape"),require("d3-time")):e.Taucharts=t(e.d3,e.d3,e.d3,e.topojson,e.d3,e.d3,e.d3,e.d3,e.d3,e.d3,e.d3,e.d3,e.d3,e.d3)}(window,function(e,t,i,r,n,a,s,o,l,c,d,u,h,f){return function(e){var t={};function i(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(r,n,function(t){return e[t]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=21)}([function(t,i){t.exports=e},function(e,t,i){"use strict";i.r(t);var r={};i.r(r),i.d(r,"translate",function(){return E}),i.d(r,"rotate",function(){return S}),i.d(r,"getOrientation",function(){return T}),i.d(r,"parseTransformTranslate",function(){return M}),i.d(r,"isIntersect",function(){return C}),i.d(r,"getDeepTransformTranslate",function(){return k}),i.d(r,"raiseElements",function(){return A});var n={};i.r(n),i.d(n,"traverseJSON",function(){return Se}),i.d(n,"traverseSpec",function(){return Te}),i.d(n,"clone",function(){return De}),i.d(n,"isDate",function(){return $e}),i.d(n,"isObject",function(){return ze}),i.d(n,"niceZeroBased",function(){return Be}),i.d(n,"niceTimeDomain",function(){return Ie}),i.d(n,"generateHash",function(){return He}),i.d(n,"generateRatioFunction",function(){return We}),i.d(n,"isSpecRectCoordsOnly",function(){return Ue}),i.d(n,"throttleLastEvent",function(){return Xe}),i.d(n,"splitEvenly",function(){return Ge}),i.d(n,"extRGBColor",function(){return qe}),i.d(n,"extCSSClass",function(){return Ye}),i.d(n,"toRadian",function(){return Ke}),i.d(n,"normalizeAngle",function(){return Je}),i.d(n,"range",function(){return Qe}),i.d(n,"hasXOverflow",function(){return Ze}),i.d(n,"hasYOverflow",function(){return et}),i.d(n,"flatten",function(){return tt}),i.d(n,"unique",function(){return it}),i.d(n,"groupBy",function(){return rt}),i.d(n,"union",function(){return nt}),i.d(n,"intersection",function(){return at}),i.d(n,"defaults",function(){return st}),i.d(n,"omit",function(){return ot}),i.d(n,"memoize",function(){return lt}),i.d(n,"createMultiSorter",function(){return ct}),i.d(n,"pick",function(){return dt}),i.d(n,"escape",function(){return ut}),i.d(n,"template",function(){return ht}),i.d(n,"escapeHtml",function(){return ft}),i.d(n,"xml",function(){return bt}),i.d(n,"take",function(){return yt}),i.d(n,"isChartElement",function(){return xt}),i.d(n,"isFacetUnit",function(){return _t});var a={};i.r(a),i.d(a,"appendTo",function(){return St}),i.d(a,"getScrollbarSize",function(){return Tt}),i.d(a,"setScrollPadding",function(){return Mt}),i.d(a,"getStyle",function(){return Ct}),i.d(a,"getStyleAsNum",function(){return kt}),i.d(a,"getContainerSize",function(){return At}),i.d(a,"getAxisTickLabelSize",function(){return Pt}),i.d(a,"getLabelSize",function(){return Ot}),i.d(a,"getCharSize",function(){return Nt}),i.d(a,"selectOrAppend",function(){return Lt}),i.d(a,"selectImmediate",function(){return Rt}),i.d(a,"selectAllImmediate",function(){return Ft}),i.d(a,"sortChildren",function(){return Dt}),i.d(a,"classes",function(){return $t}),i.d(a,"dispatchMouseEvent",function(){return zt});var s=i(0),o=i(2),l=i(3),c={},d={};function u(e){var t=d[e];return t||(t=function(){for(var t,i,r=this,n=0,a=[];r=r.handler;){if("function"==typeof(i=r.callbacks[e])){if(!t)for(t=[this],n=0;n<arguments.length;n++)t.push(arguments[n]);a.unshift({fn:i,context:r.context,args:t})}if("function"==typeof(i=r.callbacks["*"])){if(!t)for(t=[this],n=0;n<arguments.length;n++)t.push(arguments[n]);a.unshift({fn:i,context:r.context,args:[{sender:this,type:e,args:t}]})}}a.forEach(e=>e.fn.apply(e.context,e.args))},d[e]=t),t}class h{constructor(){this.handler=null,this.emit_destroy=u("destroy")}addHandler(e,t){t=t||this,this.handler={callbacks:e,context:t,handler:this.handler}}on(e,t,i){var r={};return r[e]=t,this.addHandler(r,i),r}fire(e,t){u.call(this,e).call(this,t)}removeHandler(e,t){var i,r=this;for(t=t||this;i=r,r=r.handler;)if(r.callbacks===e&&r.context===t)return r.callbacks=c,void(i.handler=r.handler)}destroy(){this.emit_destroy(),this.handler=null}}class f extends h{constructor(e){super(),this.screenModel=null,this._elementNameSpace=e.namespace||"default",this._elementScalesHub={}}regScale(e,t){return this._elementScalesHub[e]=t,this}getScale(e){return this._elementScalesHub[e]||null}fireNameSpaceEvent(e,t){var i=this._elementNameSpace;this.fire(`${e}.${i}`,t)}subscribe(e,t=(e=>e),i=(e=>e)){var r=this,n={};[{event:"mouseover",limit:0},{event:"mouseout",limit:0},{event:"click",limit:0},{event:"mousemove",limit:"requestAnimationFrame"}].forEach(a=>{var o=a.event,l=a.limit;e.on(o,Xe(n,o,function(e){var n={data:t.call(this,e),event:i.call(this,s.event,e)};r.fire(o,n),r.fireNameSpaceEvent(o,n)},l))})}allocateRect(){return{left:0,top:0,width:0,height:0}}defineGrammarModel(e){return{}}getGrammarRules(){return[]}getAdjustScalesRules(){return[]}createScreenModel(e){return null}getClosestElement(e,t){return null}addInteraction(){}draw(){this.config.options.container=this.config.options.slot(this.config.uid),this.drawFrames(this.config.frames)}data(){return this.config.frames.reduce((e,t)=>e.concat(t.part()),[])}node(){return this}}const p=e=>({day:{cast:function(t){var i=new Date(t);return new Date(i[e.setHours](0,0,0,0))},next:function(t){var i=new Date(t),r=new Date(i[e.setDate](i[e.getDate]()+1));return this.cast(r)}},week:{cast:function(t){var i=new Date(t);return i=new Date(i[e.setHours](0,0,0,0)),new Date(i[e.setDate](i[e.getDate]()-i[e.getDay]()))},next:function(t){var i=new Date(t),r=new Date(i[e.setDate](i[e.getDate]()+7));return this.cast(r)}},month:{cast:function(t){var i=new Date(t);return i=new Date(i[e.setHours](0,0,0,0)),i=new Date(i[e.setDate](1))},next:function(t){var i=new Date(t),r=new Date(i[e.setMonth](i[e.getMonth]()+1));return this.cast(r)}},quarter:{cast:function(t){var i=new Date(t);i=new Date(i[e.setHours](0,0,0,0));var r=(i=new Date(i[e.setDate](1)))[e.getMonth](),n=r-r%3;return new Date(i[e.setMonth](n))},next:function(t){var i=new Date(t),r=new Date(i[e.setMonth](i[e.getMonth]()+3));return this.cast(r)}},year:{cast(t){var i=new Date(t);return i=new Date(i[e.setHours](0,0,0,0)),i=new Date(i[e.setDate](1)),i=new Date(i[e.setMonth](0))},next:function(t){var i=new Date(t),r=new Date(i[e.setFullYear](i[e.getFullYear]()+1));return this.cast(r)}}}),g=p({setHours:"setHours",setDate:"setDate",getDate:"getDate",setMonth:"setMonth",getDay:"getDay",getMonth:"getMonth",setFullYear:"setFullYear",getFullYear:"getFullYear"});var m=p({setHours:"setUTCHours",setDate:"setUTCDate",getDate:"getUTCDate",setMonth:"setUTCMonth",getDay:"getUTCDay",getMonth:"getUTCMonth",setFullYear:"setUTCFullYear",getFullYear:"getUTCFullYear"}),b={add(e,t,{utc:i}={utc:!1}){return(i?m:g)[e.toLowerCase()]=t,this},get:(e,{utc:t}={utc:!1})=>(t?m:g)[(e||"").toLowerCase()]||null,generate:(e,t,i,{utc:r}={utc:!1})=>{var n=[],a=b.get(i,{utc:r});if(a){var s=a.cast(new Date(t)),o=a.cast(new Date(e));for(n.push(o);(o=a.next(new Date(o)))<=s;)n.push(o)}return n}};class y extends Error{constructor(e,t,i){super(),this.name="TauChartError",this.message=e,this.errorCode=t,this.errorArgs=i}}const v={STACKED_FIELD_NOT_NUMBER:"STACKED_FIELD_NOT_NUMBER",NO_DATA:"NO_DATA",NOT_SUPPORTED_TYPE_CHART:"NOT_SUPPORTED_TYPE_CHART",UNKNOWN_UNIT_TYPE:"UNKNOWN_UNIT_TYPE",INVALID_LOG_DOMAIN:"INVALID_LOG_DOMAIN"},x={},_={get:e=>x[e],reg(e,t){return x[e]=t,this}},w="taucharts_synthetic_record";function E(e,t){return`translate(${e},${t})`}function S(e){return`rotate(${e})`}function T(e){return["bottom","top"].indexOf(e.toLowerCase())>=0?"h":"v"}function M(e){var t={x:0,y:0},i=e.indexOf("translate(");if(i>=0){var r=e.indexOf(")",i+10),n=e.substring(i+10,r).trim().replace(","," ").replace(/\s+/," ").split(" ");t.x=parseFloat(n[0]),n.length>1&&(t.y=parseFloat(n[1]))}return t}function C(e,t,i,r,n,a,s,o){var l,c,d,u,h,f;return f=((d=s-n)*(t-a)-(u=o-a)*(e-n))/(-d*(c=r-t)+(l=i-e)*u),(h=(-c*(e-n)+l*(t-a))/(-d*c+l*u))>=0&&h<=1&&f>=0&&f<=1}function k(e){for(var t,i,r={x:0,y:0},n=e;n&&"SVG"!==n.nodeName.toUpperCase();)(i=n.getAttribute("transform"))&&(t=M(i),r.x+=t.x,r.y+=t.y),n=n.parentNode;return r}function A(e,t,i){const r=e.selectAll(t).filter(i);if(r.empty())return;const n=s.select(r.node().parentNode).selectAll(t).filter(e=>!i(e)).nodes(),a=n[n.length-1];if(a){const e=Array.prototype.indexOf.call(a.parentNode.childNodes,a),t=a.nextSibling;r.each(function(){Array.prototype.indexOf.call(this.parentNode.childNodes,this)>e||this.parentNode.insertBefore(this,t)})}}_.reg("identity",()=>({})).reg("flip",e=>{var t=e.scaleY,i=e.scaleX;const r=i.domain(),n=i.discrete?r[0]:Math.max(0,Math.min(...r)),a=i.value(n)+-.5*i.stepSize(n);return{flip:!0,scaleX:t,scaleY:i,xi:e=>t.value(e[t.dim]),yi:e=>i.value(e[i.dim]),y0:()=>a}}).reg("obsoleteVerticalStackOrder",()=>({obsoleteVerticalStackOrder:!0})).reg("positioningByColor",e=>{return(e.scaleX.discrete?e=>{const t=e.data().reduce((t,i)=>{const r=i[e.scaleX.dim],n=i[e.scaleColor.dim];return t.hasOwnProperty(r)||(t[r]=[]),t[r].indexOf(n)<0&&t[r].push(n),t},{});var i=e.scaleX,r=e.scaleColor,n=r.discrete?r.domain():r.originalSeries().sort((e,t)=>e-t),a=n.length||1;const s=n.reduce((e,t,i)=>(e[t]=i,e),{});return Object.keys(t).forEach(e=>t[e].sort((e,t)=>s[e]-s[t])),{xi:r=>{const n=r[e.scaleX.dim],s=t[n]||[r[e.scaleColor.dim]],o=s.length,l=s.indexOf(r[e.scaleColor.dim]);var c=(e=>i.stepSize(e[i.dim])*(a/(1+a)))(r)/(a+1);return e.xi(r)-(o+1)*c/2+(1+l)*c}}}:()=>({}))(e)}).reg("groupOrderByAvg",e=>{const t=e.data(),i=t=>t.map(e.yi).reduce((e,t)=>e+t,0)/t.length,r=t.reduce((t,i)=>{var r=e.group(i);return t[r]=t[r]||[],t[r].push(i),t},{}),n=Object.keys(r).map(e=>[e,i(r[e])]).sort((e,t)=>e[1]-t[1]).map(e=>e[0]);return{order:e=>{const t=n.indexOf(e);return t<0?Number.MAX_VALUE:t}}}).reg("stack",e=>{const t=e.data(),i=e.scaleX,r=e.scaleY;if(r.discrete||r.domain().some(e=>"number"!=typeof e))throw new y(`Stacked field [${r.dim}] should be a number`,v.STACKED_FIELD_NOT_NUMBER,{field:r.dim});const n=e=>t=>{const n=t[i.dim],a=t[r.dim],s=a>=0?e.positive:e.negative,o=s[n]||0,l=o+a;return s[n]=l,{nextStack:l,prevStack:o}},a=n({positive:{},negative:{}}),s=n({positive:{},negative:{}}),o=t=>lt(t,e.id);var l=Number.MAX_VALUE,c=Number.MIN_VALUE;const d=e=>(l=e<l?e:l,c=e>c?e:c,r.value(e)),u=o(e=>d(a(e).nextStack)),h=o(e=>d(s(e).prevStack)),f=t=>e.group(t)+"/"+(t[r.dim]>=0?1:-1),p=rt(t,f),g=Object.keys(p).sort(e.flip||!e.flip&&e.obsoleteVerticalStackOrder?(t,i)=>e.order(t)-e.order(i):(t,i)=>e.order(i)-e.order(t)).reduce((e,t)=>e.concat(p[t]),[]);return g.forEach(e=>{u(e),h(e)}),r.fixup(e=>{const t={};return(!e.hasOwnProperty("max")||e.max<c)&&(t.max=c),(!e.hasOwnProperty("min")||e.min>l)&&(t.min=l),t}),{group:f,data:()=>g,yi:u,y0:h}}).reg("size_distribute_evenly",(e,{minLimit:t,maxLimit:i,defMin:r,defMax:n})=>{const a=e.data(),s=(e,t)=>e-t,o=e.scaleX.discrete?e.scaleX.stepSize()/2:Number.MAX_VALUE,l=a.map(t=>e.xi(t)).sort(s);var c=l[0],d=l.slice(1).map(e=>{var t=e-c;return c=e,t}).filter(e=>e>0).sort(s).concat(Number.MAX_VALUE)[0];const u=Math.min(d,o),h="number"==typeof t?t:r,f={minSize:h,maxSize:"number"==typeof i?i:Math.max(h,Math.min(n,u))};return e.scaleSize.fixup(e=>{const t={};return e.fixed?e.maxSize>f.maxSize&&(t.maxSize=f.maxSize):(t.fixed=!0,t.minSize=f.minSize,t.maxSize=f.maxSize),t}),{}}).reg("adjustStaticSizeScale",(e,{minLimit:t,maxLimit:i,defMin:r,defMax:n})=>{var a={minSize:"number"==typeof t?t:r,maxSize:"number"==typeof i?i:n};return e.scaleSize.fixup(e=>{var t={};return e.fixed||(t.fixed=!0,t.minSize=a.minSize,t.maxSize=a.maxSize),t}),{}}).reg("adjustSigmaSizeScale",(e,{minLimit:t,maxLimit:i,defMin:r,defMax:n})=>{const a=(e,t)=>e-t,s=e.data().map(t=>e.xi(t)).sort(a);var o=s[0];const l=s.slice(1).map(e=>{const t=e-o;return o=e,t}).filter(e=>e>0).sort(a).concat(Number.MAX_VALUE)[0],c=e.scaleX.discrete?e.scaleX.stepSize()/2:Number.MAX_VALUE,d=Math.min(l,c),u="number"==typeof t?t:r,h="number"==typeof i?i:n,f={minSize:u,maxSize:Math.max(u,Math.min(h,(e=>{var t=(u+h)/2,i=h,r=u;return Math.round(t+(i-t)/(1+Math.exp(-(e-r)/.5)))})(d)))};return e.scaleSize.fixup(e=>{const t={};return e.fixed?e.maxSize>f.maxSize&&(t.maxSize=f.maxSize):(t.fixed=!0,t.minSize=f.minSize,t.maxSize=f.maxSize),t}),{}}).reg("avoidScalesOverflow",(e,{sizeDirection:t})=>{const i=(e,i)=>!e||e.discrete||"logarithmic"===e.scaleType||t.indexOf(i)<0,r=i(e.scaleX,"x"),n=i(e.scaleY,"y");if(r&&n)return{};var a,s;e.scaleSize.fixup(e=>(a=e.minSize,s=e.maxSize,e));var o=e.data().reduce((t,i)=>{var o,l,c=e.size(i),d=(c>=a?c:a+c*(s-a))/2;return r||(o=e.xi(i),t.left=Math.min(t.left,o-d),t.right=Math.max(t.right,o+d)),n||(l=e.yi(i),t.top=Math.min(t.top,l-d),t.bottom=Math.max(t.bottom,l+d)),t},{top:Number.MAX_VALUE,right:-Number.MAX_VALUE,bottom:-Number.MAX_VALUE,left:Number.MAX_VALUE});const l=(t,i,r,n)=>{var a=t.domain(),s=Math.abs(t.value(a[1])-t.value(a[0])),o=(a[1]-a[0])/s;if(0===s)return 1;var l=Math.max(0,-i),c=Math.max(0,r-s),d=e.flip?c:l,u=e.flip?l:c,h=Number(a[0])-(n?u:d)*o,f=Number(a[1])+(n?d:u)*o;return t.fixup(e=>{var t={};if(e.fixedBorders){let[n,a]=e.fixedBorders.slice();(n>i||a<r)&&(t.min=Math.min(e.min,h),t.max=Math.max(e.max,f),n=Math.min(i,n),a=Math.max(r,a)),t.fixedBorders=[n,a]}else t.fixed=!0,t.min=h,t.max=f,t.nice=!1,t.fixedBorders=[i,r];return t}),s/(d+s+u)};var c=r?1:l(e.scaleX,o.left,o.right,!1),d=n?1:l(e.scaleY,o.top,o.bottom,!0),u=Math.min(a*c,a*d),h=Math.min(s*c,s*d);return e.scaleSize.fixup(()=>({minSize:u,maxSize:h})),{}}).reg("fillGaps",(e,{isStack:t,xPeriod:i,utc:r})=>{const n=rt(e.data(),e.group),a=Object.keys(n).sort((t,i)=>e.order(t)-e.order(i)).reduce((e,t)=>e.concat([n[t]]),[]),s=e.scaleX.dim,o=e.scaleY.dim,l=e.scaleColor.dim,c=e.scaleSplit.dim,d=e=>e[o]>=0?1:-1,u=(t,i,r)=>{const n=rt(i,e=>e[s]),a=i[0];return t.reduce((t,i)=>t.concat(n[i]||((t,i,r)=>{const n=[t,e.id(i),r].join(" ");return{[s]:t,[o]:1e-10*r,[c]:i[c],[l]:i[l],[w]:!0,[`${w}id`]:n}})(i,a,r)),[])},h=(e,t)=>e-t,f=()=>it(a.reduce((e,t)=>e.concat(t.map(e=>e[s])),[])).sort(h),p=i?(()=>{const t=f(),n=Math.max(...t.map(e=>Number(e))),a=e.scaleX.domain(),s=b.generate(a[0],a[1],i,{utc:r}).filter(e=>e>=a[0]&&e<=a[1]);let o=0;const l=[],c=b.get(i,{utc:r});return s.forEach(e=>{const i=Number(e);if(!(i>=n)){for(let e=o;e<t.length;e++)if(Number(c.cast(t[e]))===i)return void o++;l.push(e)}}),t.concat(l).sort(h)})():f(),g=a.map(t=>t.sort((t,i)=>e.xi(t)-e.xi(i))).reduce(t?(e,t)=>{const i=rt(t,e=>String(d(e)));return Object.keys(i).reduce((e,t)=>e.concat(u(p,i[t],t)),e)}:(e,t)=>{rt(t,e=>String(d(e)));const i=Math.max(...t.map(e=>e[s]));return e.concat(u(p.filter(e=>e<=i),t,0))},[]);return{data:()=>g,size:t=>t[w]?e.scaleSize(0):e.size(t),id:t=>t[w]?t[`${w}id`]:e.id(t)}});var P=i(5);const O="tau-chart__";function N(e){return e}const L=1e-6;function R(e){return`translate(${e+.5},0)`}function F(e){return`translate(0,${e+.5})`}const D={top:1,right:2,bottom:3,left:4};function $(e){const t=D[e.scaleGuide.scaleOrient],i=e.scale,r=e.scaleGuide,n=r.label,{ticksCount:a,tickFormat:s,tickSize:o,tickPadding:l,gridOnly:c}=st(e,{tickSize:6,tickPadding:3,gridOnly:!1}),d="linear"===i.scaleType,u="ordinal"===i.scaleType||"period"===i.scaleType,h=t===D.top||t===D.bottom,f=t===D.top||t===D.left?-1:1,p=h?"x":"y",g=h?"y":"x",m=h?R:F,b=h?1:-1;return y=>{var v;if(i.ticks){v=i.ticks(a);let e=Math.floor(1.25*a);for(;v.length>e&&e>2&&v.length>2;)v=i.ticks(--e)}else v=i.domain();r.hideTicks&&(v=c?v.filter(e=>0==e):[]);const x=null==s?i.tickFormat?i.tickFormat(a):N:s,_=Math.max(o,0)+l,w=i.range(),E=w[0]+.5,T=w[w.length-1]+.5;let C=(i.bandwidth?function(e){var t=Math.max(0,e.bandwidth()-1)/2;return e.round()&&(t=Math.round(t)),function(i){return e(i)+t}}:N)(i);if(r.facetAxis){let e=C;C=(t=>e(t)-i.stepSize(t)/2)}const k=y.selection?y:null,A=k?k.selection():y,P=function(e){let t=e.node();for(;t&&"svg"!==t.tagName;)t=t.parentNode;return t}(A).getBoundingClientRect();function R(e){const i=Je(r.rotate);if(e.attr("transform",S(i)),Math.abs(i/90)%2>0){let r=i<180?1:-1,n=h?.5:-2,a=t===D.top||t===D.left?-1:1,s=n*(t===D.top||t===D.bottom?a<0?0:.71:.32);e.attr("x",9*r).attr("y",0).attr("dx",h?null:`${s}em`).attr("dy",`${s}em`)}}function F(e,t=0){const n=e=>Math.max(i.stepSize(e),r.tickFormatWordWrapLimit,t);r.tickFormatWordWrap?ue(e,n,r.tickFormatWordWrapLines,r.tickFontHeight,!h):de(e,n)}function $(e){!function(e,t){const i=t?-10:20,r=t?0:1,n=t?1:-1;var a=[];e.each(function(){var e=le.select(this),t=e.attr("transform").replace("translate(","").replace(" ",",").split(",")[r],i=n*parseFloat(t),s=e.select("text"),o=s.node().getBBox().width,l=o/2,c=i-l,d=i+l;a.push({c:i,s:c,e:d,l:0,textRef:s,tickRef:e})});var s=a.sort((e,t)=>e.c-t.c);((e,t)=>e.map((e,i,r)=>t(r[i-1]||{e:-1/0,s:-1/0,l:0},e,r[i+1]||{e:1/0,s:1/0,l:0})))(s,(e,r,n)=>{var a=e.e>r.s,s=n.s<r.e;if(a||s){r.l=((e,t)=>{var i={"[T][1]":-1,"[T][-1]":0,"[T][0]":1,"[F][0]":-1},r=`[${t.toString().toUpperCase().charAt(0)}][${e}]`;return i.hasOwnProperty(r)?i[r]:0})(e.l,a);var o=r.textRef.size(),l=r.textRef.text();o>1&&(l=l.replace(/([\.]*$)/gi,"")+"...");var c=11*r.l,d=t?parseFloat(r.textRef.attr("y"))+c:0;let n=t?0:c,s=t?c:0;var u=function(e){var t=0;if(!e)return t;var i=e.indexOf("rotate(");if(i>=0){var r=e.indexOf(")",i+7),n=e.substring(i+7,r);t=parseFloat(n.trim())}return t}(r.textRef.attr("transform"));r.textRef.text((e,t)=>0===t?l:"").attr("transform","translate("+n+","+s+") rotate("+u+")");var h={x1:0,x2:0,y1:d+(t?-1:5),y2:i};t||(h.transform="rotate(-90)"),Lt(r.tickRef,"line.label-ref").call(xe(h))}else r.tickRef.selectAll("line.label-ref").remove();return r})}(e,h)}A.attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",t===D.right?"start":t===D.left?"end":"middle"),c||function(){const e=r.hideTicks||r.hide?[]:[null];yt(A.selectAll(".domain").data(e)).then(e=>(k&&e.exit().transition(k).attr("opacity",0).remove(),e.merge(e.enter().insert("path",".tick").attr("class","domain").attr("opacity",1).attr("stroke","#000")))).then(e=>k?e.transition(k):e).then(e=>{e.attr("d",t===D.left||t==D.right?`M${f*o},${E}H0.5V${T}H${f*o}`:`M${E},${f*o}V0.5H${T}V${f*o}`)})}();const z=yt(A.selectAll(".tick").data(v,e=>String(i(e))).order()).then(e=>{const t=e.exit(),i=e.enter().append("g").attr("class","tick");return{tickExit:t,tickEnter:i,tick:e.merge(i)}}).then(e=>{if(d){const t=i.ticks(),r=i.domain(),n=v.length-1,a=t.length>1&&r[0]*r[1]<0&&-r[0]>(t[1]-t[0])/2&&r[1]>(t[n]-t[n-1])/2;e.tick.classed("zero-tick",e=>0==e&&a)}return e}).result();!function(e){yt(e).then(({tickEnter:e,tickExit:t,tick:i})=>k?(e.attr("opacity",L).attr("transform",function(e){const t=C(e);return m(t)}),{tick:i.transition(k),tickExit:t.transition(k).attr("opacity",L).attr("transform",function(e){const t=C(e);return isFinite(t)?m(t):this.getAttribute("transform")})}):{tick:i,tickExit:t}).then(({tick:e,tickExit:t})=>{t.remove(),e.attr("opacity",1).attr("transform",e=>m(C(e)))})}(z),r.facetAxis||function(e){const t=f*o,r=u?e=>b*i.stepSize(e)/2:null;yt(e).then(({tick:e,tickEnter:i})=>{const n=e.select("line"),a=i.append("line").attr("stroke","#000").attr(`${g}2`,t);return u&&a.attr(`${p}1`,r).attr(`${p}2`,r),n.merge(a)}).then(e=>k?e.transition(k):e).then(e=>{e.attr(`${g}2`,t),u&&e.attr(`${p}1`,r).attr(`${p}2`,r)})}(z),u&&c&&u&&v&&v.length&&yt(A.selectAll(".extra-tick-line").data([null])).then(e=>e.merge(e.enter().insert("line",".tick").attr("class","extra-tick-line").attr("stroke","#000"))).then(e=>k?e.transition(k):e).then(e=>{e.attr(`${p}1`,E).attr(`${p}2`,E).attr(`${g}1`,0).attr(`${g}2`,f*o)}),c||(function(n){const a=r.textAnchor,s=f*_,o=t===D.top?"0em":t===D.bottom?"0.71em":"0.32em";function l(t){if(r.facetAxis)return t.attr("dx",18-e.position[0]).attr("dy",16)}yt(n).then(({tick:e,tickEnter:t})=>{const i=e.select("text"),r=t.append("text").attr("fill","#000").attr(g,s).attr("dy",o);return R(r),l(r),i.merge(r)}).then(e=>{if(e.text(x).attr("text-anchor",a),!1===h&&!0===r.facetAxis){const t=M(A.node().parentNode.getAttribute("transform"));F(e,P.width-Math.abs(t.x))}else F(e);return h&&"time"===i.scaleType&&function(e){if(v.length<2)return;var t=0,i=-1;const r=e.nodes();r.forEach((e,r)=>{const n=e.textContent||"";var a=n.length;a>t&&(t=a,i=r)});const n=C(v[1])-C(v[0]);var a=!1;if(i>=0){var s=r[i].getBoundingClientRect();a=n-s.width<8}A.classed(`${O}time-axis-overflow`,a)}(e),!h||"time"!==i.scaleType&&"linear"!==i.scaleType||function(e){if(0===v.length)return;const t=v[0],i=v[v.length-1],r=A.append("line").attr("x1",C(t)).attr("x2",C(t)).attr("y1",0).attr("y2",1),n=A.append("line").attr("x1",C(i)).attr("x2",C(i)).attr("y1",0).attr("y2",1),a={left:r.node().getBoundingClientRect().left-P.left,right:P.right-n.node().getBoundingClientRect().right};r.remove(),n.remove();const s=(e,t,i)=>{const r=e.getBoundingClientRect(),n=t>0?"right":"left",s=(C(i),a[n]),o=Math.ceil(r.width/2-s+1);e.setAttribute("dx",String(o>0?-t*o:0))},o=e.filter(e=>e===t).node(),l=e.filter(e=>e===i).node();e.attr("dx",null),s(o,-1,t),s(l,1,i)}(e),e}).then(e=>k?e.transition(k):e).then(e=>{e.attr(g,s),R(e),l(e),u&&r.avoidCollisions&&!r.facetAxis&&(k?k.on("end.fixTickTextCollision",()=>$(n.tick)):$(n.tick))})}(z),n.hide||function(){const e=n,t=Lt(A,"text.label").attr("class",$t("label",e.cssClass)).attr("transform",S(e.rotate)).attr("text-anchor",e.textAnchor);yt(t).then(e=>k?e.transition(k):e).then(t=>{const i=b*e.padding,r=Math.abs(T-E),n=h?r:0;t.attr("x",n).attr("y",i).attr("text-anchor","end")});const i=e.text.split(" → ");for(var r=i.length-1;r>0;r--)i.splice(r,0," → ");t.selectAll("tspan").data(i).enter().append("tspan").attr("class",(e,t)=>t%2?`label-token-delimiter label-token-delimiter-${t}`:`label-token label-token-${t}`).text(e=>e).exit().remove()}())}}function z(e){return $({scale:e.scale,scaleGuide:e.scaleGuide,ticksCount:e.ticksCount,tickSize:e.tickSize,gridOnly:!0,position:e.position})}function B(e,...t){return 2===t.length?t[0]*(1-e)+t[1]*e:3===t.length?t[0]*(1-e)*(1-e)+2*t[1]*(1-e)*e+t[2]*e*e:t[0]*(1-e)*(1-e)*(1-e)+3*t[1]*(1-e)*(1-e)*e+3*t[2]*(1-e)*e*e+t[3]*e*e*e}function I(e,...t){var i=t.map(e=>e.x),r=t.map(e=>e.y);return{x:B(e,...i),y:B(e,...r)}}function j(e,t,i,r,n){var a=I(e,t,i),s=I(e,t,i,r),o=I(e,i,r,n),l=I(e,r,n);return[t,a,s,I(e,s,o),o,l,n]}function V(e,t,i="polyline"){var r;return n=>0===n?e:1===n?t:(r||(r=("cubic"===i?function(e,t){for(var i=2;i<e.length-1;i+=3)e[i-1].isCubicControl=!0,e[i].isCubicControl=!0;for(i=2;i<t.length-1;i+=3)t[i-1].isCubicControl=!0,t[i].isCubicControl=!0;var r,n;for(e=e.filter(e=>!e.isInterpolated),i=e.length-2;i>=0;i--)n=e[i+1],(r=e[i]).isCubicControl||n.isCubicControl||(e.splice(i+1,0,I(1/3,n,r),I(2/3,n,r)),e[i+1].isCubicControl=!0,e[i+2].isCubicControl=!0);var a=e.filter((e,t)=>t%3==0),s=t.filter((e,t)=>t%3==0),o=a.map(e=>e.id),l=s.map(e=>e.id),c=o.reduce((t,i)=>(t[i]=e.findIndex(e=>e.id===i),t),{}),d=l.reduce((e,i)=>(e[i]=t.findIndex(e=>e.id===i),e),{}),u=o.filter(e=>l.indexOf(e)>=0),h=a.filter(e=>!e.positionIsBeingChanged),f=s.filter(e=>!e.positionIsBeingChanged),p=Z(h,f),g=Z(f,h),m=[];u.forEach((i,r)=>{var n=c[i],a=d[i];if(0===r&&(n>0||a>0)&&m.push(H({polylineFrom:e.slice(0,n+1),polylineTo:t.slice(0,a+1),toOppositeScale:0===a?p:g,isCubic:!0})),r>0){var s=c[u[r-1]],o=d[u[r-1]];n-s>3||a-o>3?m.push(W({polylineFrom:e.slice(s,n+1),polylineTo:t.slice(o,a+1),isCubic:!0})):m.push(function({polylineFrom:e,polylineTo:t}){return i=>K(e.slice(1,3),t.slice(1,3),i)}({polylineFrom:e.slice(s,n+1),polylineTo:t.slice(o,a+1)}))}m.push(U({pointFrom:e[n],pointTo:t[a]})),r===u.length-1&&(e.length-n-1>0||t.length-a-1>0)&&m.push(H({polylineFrom:e.slice(n),polylineTo:t.slice(a),toOppositeScale:t.length-a==1?p:g,isCubic:!0}))}),0===m.length&&(t.length>0&&0===u.length||e.length>0&&0===u.length)&&m.push(X({polylineFrom:e.slice(0),polylineTo:t.slice(0),isCubic:!0}));return e=>{var t=[];return m.forEach(i=>{var r=i(e);G(t,r)}),t}}:function(e,t){var i=(e=e.filter(e=>!e.isInterpolated)).map(e=>e.id),r=t.map(e=>e.id),n=i.filter(e=>r.indexOf(e)>=0),a=e.filter(e=>!e.positionIsBeingChanged),s=t.filter(e=>!e.positionIsBeingChanged),o=Z(a,s),l=Z(s,a),c=[];n.forEach((a,s)=>{var d=i.indexOf(a),u=r.indexOf(a);if(0===s&&(d>0||u>0)&&c.push(H({isCubic:!1,polylineFrom:e.slice(0,d+1),polylineTo:t.slice(0,u+1),toOppositeScale:0===u?o:l})),s>0){var h=i.indexOf(n[s-1]),f=r.indexOf(n[s-1]);(d-h>1||u-f>1)&&c.push(W({isCubic:!1,polylineFrom:e.slice(h,d+1),polylineTo:t.slice(f,u+1)}))}c.push(U({pointFrom:e[d],pointTo:t[u]})),s===n.length-1&&(e.length-d-1>0||t.length-u-1>0)&&c.push(H({isCubic:!1,polylineFrom:e.slice(d),polylineTo:t.slice(u),toOppositeScale:t.length-u==1?o:l}))}),0===c.length&&(t.length>0&&0===n.length||e.length>0&&0===n.length)&&c.push(X({isCubic:!1,polylineFrom:e.slice(0),polylineTo:t.slice(0)}));return e=>{var t=[];return c.forEach(i=>{var r=i(e);G(t,r)}),t}})(e,t)),r(n))}function H({polylineFrom:e,polylineTo:t,isCubic:i,toOppositeScale:r}){var n=e.length>t.length?e:t,a=1===t.length,s=e[0].id!==t[0].id,o=Boolean(s!==a);return e=>{var t=(i?Q:J)({t:e,polyline:n,decreasing:a,rightToLeft:o});a===o?t.shift():t.pop();var s=K(t.map(r),t,a?1-e:e);return s.forEach(e=>e.positionIsBeingChanged=!0),s}}function W({polylineFrom:e,polylineTo:t,isCubic:i}){var r=e.length,n=t.length;if(n!==r){var a=n<r,s=a?e:t,o=(i?function({smallerPolyline:e,biggerPolyline:t,decreasing:i}){var r=(e.length-1)/3,n=(t.length-1)/3,a=Math.floor(n/r)+1,s=n%r,o=Qe(r).map(e=>a+Number(e<s)),l=[e[0]],c=3;return o.forEach(r=>{if(r>2){var n=function(e,t){for(var i,r,n=[t[0]],a=0;a<e.length;a++)i=0===a?e[0]:e[a]/(1-e[a-1]),r=te(i,t),G(n,r.slice(1,4)),t=r.slice(3);return G(n,t.slice(1)),n}(Qe(1,r-1).map(e=>e/(r-1)),e.slice(c-3,c+1));Qe(r-2).forEach(e=>n[3*(e+1)].id=t[l.length-1+3*e].id),i&&n.forEach((e,t)=>{t>0&&t<n.length-1&&(e.isInterpolated=!0)}),G(l,n.slice(1))}else{var a=Object.assign({},e[c-2]),s=Object.assign({},e[c-1]),o=Object.assign({},e[c]);i||(o.id=t[l.length+2].id),l.push(a,s,o)}c+=3}),l}:function({smallerPolyline:e,biggerPolyline:t,decreasing:i}){var r=e.length-1,n=t.length-1,a=Math.floor(n/r)+1,s=n%r,o=Qe(r).map(e=>a+Number(e<s)),l=[e[0]],c=1;return o.forEach(r=>{Qe(1,r).forEach(n=>{var a;n===r-1?(a=Object.assign({},e[c]),i||(a.id=t[l.length].id)):((a=Y(e[c-1],e[c],n/(r-1))).id=t[l.length].id,i&&(a.isInterpolated=!0)),l.push(a)}),c++}),l})({smallerPolyline:a?t:e,biggerPolyline:s,decreasing:a}),l=s.slice(1,s.length-1),c=o.slice(1,o.length-1);return e=>{var t=K(c,l,a?1-e:e);return t.forEach(e=>e.positionIsBeingChanged=!0),t}}var d=e.slice(1,e.length-1),u=t.slice(1,t.length-1);return e=>{var t=K(d,u,e);return t.forEach(e=>e.positionIsBeingChanged=!0),t}}function U({pointFrom:e,pointTo:t}){return i=>[Y(e,t,i)]}function X({polylineFrom:e,polylineTo:t,isCubic:i}){var r=0===t.length,n=r,a=r?e:t;return e=>{var t=(i?Q:J)({t:e,polyline:a,decreasing:r,rightToLeft:n});return t.forEach((e,t)=>{t>0&&(e.positionIsBeingChanged=!0)}),t}}function G(e,t){return Array.prototype.push.apply(e,t)}function q(e,t,i){return void 0===t?e:"number"==typeof t?e+i*(t-e):t}function Y(e,t,i){if(e===t)return t;var r={};return Object.keys(e).forEach(n=>r[n]=q(e[n],t[n],i)),void 0!==t.id&&(r.id=t.id),r}function K(e,t,i){return e.map((e,r)=>Y(e,t[r],i))}function J({t:e,polyline:t,decreasing:i,rightToLeft:r}){var n=Boolean(i)!==Boolean(r),a=function(e,t){var i=0;if(e>0){for(var r,n,a,s,o=[0],l=0,c=1;c<t.length;c++)a=t[c-1].x,s=t[c-1].y,r=t[c].x,n=t[c].y,l+=Math.sqrt((r-a)*(r-a)+(n-s)*(n-s)),o.push(l);var d=e*l;for(c=1;c<o.length;c++)if(d<=o[c]){i=Math.min(1,(c-1+(d-o[c-1])/(o[c]-o[c-1]))/(t.length-1));break}}var u=Math.floor((t.length-1)*i)+1,h=t.length-u,f=u,p=t.slice(0,u);if(i<1){var g=i*(t.length-1)%1,m=Y(t[u-1],t[u],g);G(p,Qe(h).map(e=>Object.assign({},m,{id:t[f+e].id,isInterpolated:!0})))}return p}(i?1-e:e,n?t.slice(0).reverse():t);return n&&a.reverse(),a}function Q({t:e,polyline:t,decreasing:i,rightToLeft:r}){var n=Boolean(i)!==Boolean(r),a=function(e,t){var i=(t.length-1)/3+1,r=0;if(e>0){for(var n,a,s,o,l,c,d,u,h=[0],f=0,p=1;p<i;p++)s=t[3*p-3].x,o=t[3*p-3].y,l=t[3*p-2].x,c=t[3*p-2].y,d=t[3*p-1].x,u=t[3*p-1].y,n=t[3*p].x,a=t[3*p].y,f+=(ee(s,o,l,c)+ee(l,c,d,u)+ee(d,u,n,a)+ee(n,a,s,o))/2,h.push(f);var g=e*f;for(p=1;p<h.length;p++)if(g<=h[p]){r=Math.min(1,(p-1+(g-h[p-1])/(h[p]-h[p-1]))/(i-1));break}}var m=Math.floor((i-1)*r)+1,b=i-m,y=3*m,v=t.slice(0,3*(m-1)+1);if(r<1){var x=te(r*(i-1)%1,t.slice(3*(m-1),3*m+1)).slice(1,4);x.forEach(e=>e.isInterpolated=!0),x[2].id=t[y].id,G(v,x),Qe(1,b).forEach(e=>{G(v,[{x:x[2].x,y:x[2].y,isCubicControl:!0,isInterpolated:!0},{x:x[2].x,y:x[2].y,isCubicControl:!0,isInterpolated:!0},Object.assign({},x[2],{id:t[y+3*e].id,isInterpolated:!0})])})}return v}(i?1-e:e,n?t.slice(0).reverse():t);return n&&a.reverse(),a}function Z(e,t){var i,r,n,a,s=[],o=[],l=0,c=e.length,d=t.length;for(i=0;i<c;i++)for(n=e[i],r=l;r<d;r++)if(a=t[r],n.id===a.id){l=r+1,s.push(n),o.push(a);break}if(s.length<1||o.length<1)return e=>e;var u=Object.keys(s[0]).filter(e=>"number"==typeof s[0][e]).filter(e=>"id"!==e),h={},f=(e,t,i,r)=>n=>r+(n-t)*(r-i)/(t-e);return u.forEach(e=>{for(var t,i,r=s[0][e],n=o[0][e],a=s.length-1;a>0;a--)if((t=s[a][e])!==r)return i=o[a][e],void(h[e]=f(r,t,n,i));h[e]=((e,t)=>i=>i-e+t)(r,n)}),e=>{var t=Object.assign({},e);return u.forEach(i=>{t[i]=h[i](e[i])}),t}}function ee(e,t,i,r){return Math.sqrt((i-e)*(i-e)+(r-t)*(r-t))}function te(e,[t,i,r,n]){var a=j(e,t,i,r,n);return[a[1],a[2],a[4],a[5]].forEach(e=>e.isCubicControl=!0),Object.keys(n).forEach(i=>{"x"!==i&&"y"!==i&&"id"!==i&&(a[3][i]=q(t[i],n[i],e))}),a}function ie(e,t){if(e.length<2)return e.slice(0);if(2===e.length)return[e[0],{x:re(e[0].x,e[1].x,1/3),y:re(e[0].y,e[1].y,1/3)},{x:re(e[0].x,e[1].x,2/3),y:re(e[0].y,e[1].y,2/3)},e[1]];var i,r,n,a,s,o,l,c,d,u,h,f,p,g,m=new Array(3*(e.length-1)+1);const b=m.length-1;for(var y=0;y<e.length;y++)m[3*y]=e[y],y>0&&(m[3*y-2]=I(1/3,e[y-1],e[y]),m[3*y-1]=I(2/3,e[y-1],e[y]));for(var v=m.slice(0),x=0;x<3;x++){for(m[1]={x:re(m[0].x,m[3].x,1/3),y:re(m[0].y,re(m[3].y,m[2].y,1.5),2/3)},m[b-1]={x:re(m[b].x,m[b-3].x,1/3),y:re(m[b].y,re(m[b-3].y,m[b-2].y,1.5),2/3)},t&&((m[1].y-m[0].y)*(m[3].y-m[2].y)<0&&(m[1]={x:m[1].x,y:m[0].y}),(m[b-1].y-m[b].y)*(m[b-3].y-m[b-2].y)<0&&(m[b-1]={x:m[b-1].x,y:m[b].y})),y=6;y<v.length;y+=3)i=v[y-5],r=v[y-3],n=v[y-1],(r.x-i.x)*(n.x-r.x)*1e12<1?(a=re(i.x,r.x,.5),o=re(r.x,n.x,.5),s=re(i.y,r.y,.5),l=re(r.y,n.y,.5)):(u=(r.x-i.x)/(n.x-i.x),c=(r.x-i.x*(1-u)*(1-u)-n.x*u*u)/(2*(1-u)*u),d=(r.y-i.y*(1-u)*(1-u)-n.y*u*u)/(2*(1-u)*u),a=re(i.x,c,u),o=re(c,n.x,u),s=re(i.y,d,u),l=re(d,n.y,u),t&&(f=r.x-a,p=o-r.x,h=(l-r.y)/p,(r.y-i.y)*(n.y-r.y)<=0?h=0:(r.y>i.y==l>n.y&&(p=re(p*(g=(n.y-r.y)/(l-r.y)),p,1/(1+Math.abs(g))),h=(n.y-r.y)/p),r.y>i.y==s<i.y&&(f=re(f*(g=(r.y-i.y)/(r.y-s)),f,1/(1+Math.abs(g))),h=(r.y-i.y)/f)),a=r.x-f,o=r.x+p,s=r.y-h*f,l=r.y+h*p)),m[y-4]={x:a,y:s},m[y-2]={x:o,y:l};v=m.slice(0)}return v}function re(e,t,i){return e+i*(t-e)}var ne={linear:e=>e,step:function(e){for(var t,i,r,n,a=[],s=void 0!==e[0].id,o=void 0!==e[0].size,l=1;l<e.length;l++)t=e[l-1],i=e[l],r={x:(t.x+i.x)/2,y:t.y},n={x:(t.x+i.x)/2,y:i.y},s&&(r.id=`${t.id}-${i.id}-1`,n.id=`${t.id}-${i.id}-2`),o&&(r.size=t.size,n.size=i.size),1===l&&a.push(t),a.push(r,n,i);return a},"step-before":function(e){for(var t,i,r,n=[],a=void 0!==e[0].id,s=void 0!==e[0].size,o=1;o<e.length;o++)t=e[o-1],i=e[o],r={x:t.x,y:i.y},a&&(r.id=`${t.id}-${i.id}`),s&&(r.size=i.size),1===o&&n.push(t),n.push(r,i);return n},"step-after":function(e){for(var t,i,r,n=[],a=void 0!==e[0].id,s=void 0!==e[0].size,o=1;o<e.length;o++)t=e[o-1],r={x:(i=e[o]).x,y:t.y},a&&(r.id=`${t.id}-${i.id}`),s&&(r.size=t.size),1===o&&n.push(t),n.push(r,i);return n}},ae={smooth:function(e){return ie(e,!1)},"smooth-keep-extremum":function(e){return ie(e,!0)}};function se(e){return ne[e]||ae[e]}function oe(e){return void 0!==ae[e]?"cubic":"polyline"}const le={...s,...P};var ce=()=>lt(e=>e.node().getComputedTextLength(),e=>e.node().textContent.length),de=(e,t,i)=>{i=i||ce(),e.each(function(){var e=le.select(this.parentNode).data()[0],r=t(e),n=le.select(this),a=n.text().split(/\s+/),s=!1,o=a.reduce((e,t,a)=>{if(s)return e;var o=a>0?[e,t].join(" "):t,l=i(n.text(o));if(l<r)e=o;else{var c=Math.floor(r/l*o.length);e=o.substr(0,c-4)+"...",s=!0}return e},"");n.text(o)})},ue=(e,t,i,r,n,a)=>{a=a||ce();var s=(e,t,i,r,n,a,s)=>{var o=s*i+a;return e.append("tspan").attr("x",r).attr("y",n).attr("dy",o+"em").text(t)};e.each(function(){var e=le.select(this.parentNode).data()[0],o=t(e),l=le.select(this),c=l.text().split(/\s+/),d=l.attr("x"),u=l.attr("y"),h=parseFloat(l.attr("dy"));l.text(null);var f=s(l,null,1.1,d,u,h,0),p=!1,g=c.length-1,m=c.reduce((e,t,r)=>{if(p)return e;var n=e.length===i||r===g,s=e[e.length-1],l=""!==s?s+" "+t:t,c=a(f.text(l)),d=c>o;if(d&&n){var u=Math.floor(o/c*l.length);e[e.length-1]=l.substr(0,u-4)+"...",p=!0}return d&&!n&&e.push(t),d||(e[e.length-1]=l),e},[""]).filter(e=>e.length>0);u=n?-1*(m.length-1)*Math.floor(.5*r):u,m.forEach((e,t)=>s(l,e,1.1,d,u,h,t)),f.remove()})};var he=(e,t,i)=>(t>0&&!document.hidden&&((e=e.transition(i).duration(t)).attr=fe),e.onTransitionEnd=function(e){return me(this,e),this},e),fe=function(e,t){var i,r=le.transition.prototype.attr.apply(this,arguments);if(0===arguments.length)throw new Error("Unexpected `transition().attr()` arguments.");1===arguments.length?i=e:arguments.length>1&&(i={[e]:t});var n="__transitionAttrs__",a="__lastTransitions__",s=ge();this.each(function(){var e={};for(var t in i)"function"==typeof i[t]?e[t]=i[t].apply(this,arguments):e[t]=i[t];this[n]=Object.assign(this[n]||{},e),this[n][a]||Object.defineProperty(this[n],a,{value:{}}),Object.keys(e).forEach(e=>this[n][a][e]=s)});var o=function(){this[n]&&(Object.keys(i).filter(e=>this[n][a][e]===s).forEach(e=>delete this[n][e]),0===Object.keys(this[n]).length&&delete this[n])};return this.on(`interrupt.${s}`,()=>this.each(o)),this.on(`end.${s}`,()=>this.each(o)),r},pe=0,ge=function(){return++pe},me=(e,t)=>{if(le.transition.prototype.isPrototypeOf(e)&&!e.empty()){var i=()=>t.call(null,e);return e.on("interrupt.d3_on_transition_end",i),e.on("end.d3_on_transition_end",i),e}t.call(null,e)},be=(e,t,i,r)=>{const n=r||(e=>e),a=function(){n(this)};return function(r){var n=r;return t&&(n=n.call(xe(st(t,i)))),n=(n=he(n,e)).call(xe(i)),e>0?n.on("end.d3_animationInterceptor",()=>n.each(a)):n.each(a),n}},ye=(e,t)=>{var i=e.node();return e.selectAll(t).filter(function(){return this.parentNode===i})},ve=(e,t,i,r,n="linear")=>{const a="__pathPoints__";return function(e){this[a]||(this[a]=i.map(()=>[]));const s=i.map((t,i)=>{const s=it(e,r).map(t),o=(se(n)||se("linear"))(s),l=this[a][i];return{pointsFrom:l,pointsTo:o,interpolate:V(l,o,oe(n))}});return e=>{if(0===e){let e=s.map(e=>e.pointsFrom);return t(...e)}if(1===e){let e=s.map(e=>e.pointsTo);return this[a]=e,t(...e)}const i=s.map(t=>t.interpolate(e));return this[a]=i,t(...i)}}},xe=e=>t=>(Object.keys(e).forEach(i=>t.attr(i,e[i])),t),_e=e=>t=>(Object.keys(e).forEach(i=>t.classed(i,e[i])),t);class we extends f{constructor(e){super(e),this.config=e,this.config.guide=st(this.config.guide||{},{animationSpeed:0,enableColorToBarPosition:!1}),this.config.guide.size=this.config.guide.size||{};var t=this.config.stack,i=this.config.guide.enableColorToBarPosition,r=[e.flip&&_.get("flip"),t&&_.get("stack"),i&&_.get("positioningByColor")];this.decorators=(this.config.transformRules||r).concat(e.transformModel||[]),this.adjusters=(this.config.adjustRules||[]).concat(e.adjustScales||[])}defineGrammarModel(e){const t=this.config;this.regScale("x",e("pos",t.x,[0,t.options.width])).regScale("y",e("pos",t.y,[t.options.height,0])).regScale("y",e("pos",t.y,e=>["ordinal","period"].indexOf(e.type)>=0?[0,t.options.height]:[t.options.height,0])).regScale("size",e("size",t.size,{})).regScale("color",e("color",t.color,{})).regScale("split",e("split",t.split,{})).regScale("label",e("label",t.label,{})).regScale("identity",e("identity",t.identity,{}));const i=this.getScale("x"),r=this.getScale("y"),n=this.getScale("size"),a=this.getScale("label"),s=this.getScale("color"),o=this.getScale("split"),l=this.getScale("identity"),c=r.domain(),d=r.discrete?c[0]:Math.max(0,Math.min(...c)),u=r.value(d)+.5*r.stepSize(d),h=s.domain(),f={data:()=>this.data(),flip:!1,scaleX:i,scaleY:r,scaleSize:n,scaleLabel:a,scaleColor:s,scaleSplit:o,scaleIdentity:l,color:e=>s.value(e[s.dim]),label:e=>a.value(e[a.dim]),group:e=>`${e[s.dim]}(@taucharts@)${e[o.dim]}`,order:e=>{const t=e.split("(@taucharts@)")[0],i=h.indexOf(t);return i<0?Number.MAX_VALUE:i},size:e=>n.value(e[n.dim]),id:e=>l.value(e[l.dim],e),xi:e=>i.value(e[i.dim]),yi:e=>r.value(e[r.dim]),y0:()=>u};return f.data().forEach(e=>f.id(e)),f}getGrammarRules(){return this.decorators.filter(e=>e)}getAdjustScalesRules(){return(this.adjusters||[]).filter(e=>e)}createScreenModel(e){const t=e.flip,i=(e,t,i)=>e?t:i;return{flip:t,id:e.id,x:i(t,e.yi,e.xi),y:i(t,e.xi,e.yi),x0:i(t,e.y0,e.xi),y0:i(t,e.xi,e.y0),size:e.size,group:e.group,order:e.order,label:e.label,color:t=>e.scaleColor.toColor(e.color(t)),class:t=>e.scaleColor.toClass(e.color(t)),model:e,toFibers:()=>{const t=rt(e.data(),e.group);return Object.keys(t).sort((t,i)=>e.order(t)-e.order(i)).reduce((e,i)=>e.concat([t[i]]),[])}}}drawFrames(){var e=this,t=this.config.options,i=t=>((e,t)=>{var i=Math.pow(10,t);return Math.round(i*e)/i})(e.screenModel.size(t)/2,4),r=be,n=function(t,i,n){var a=e.config.guide.animationSpeed,o=t.selectAll(`.${i}`).data(e=>[e],e.screenModel.id);o.exit().call(r(a,null,{width:0},e=>s.select(e).remove())),o.call(r(a,null,n)),o.enter().append("rect").style("stroke-width",0).call(r(a,{width:0},n))},a=this.config.flip,o=a?"y":"x",l=a?"x":"y",c=a?"x0":"y0",d=a?"height":"width",u=a?"width":"height",h=function(t){n(t,"lvl-top",{[d]:e=>i(e),[u]:1,[o]:t=>e.screenModel[o](t)-i(t)/2,[l]:t=>e.screenModel[l](t),fill:t=>e.screenModel.color(t),class:t=>`lvl-top ${e.screenModel.class(t)}`}),n(t,"lvl-btm",{[d]:e=>i(e),[u]:1,[o]:t=>e.screenModel[o](t)-i(t)/2,[l]:t=>e.screenModel[c](t),fill:t=>e.screenModel.color(t),class:t=>`lvl-btm ${e.screenModel.class(t)}`}),n(t,"lvl-link",{[d]:.5,[u]:t=>Math.abs(e.screenModel[l](t)-e.screenModel[c](t)),[o]:t=>e.screenModel[o](t)-.25,[l]:t=>Math.min(e.screenModel[l](t),e.screenModel[c](t)),fill:t=>e.screenModel.color(t),class:t=>`lvl-link ${e.screenModel.class(t)}`})},f=function(t){t.attr("class",`frame-id-${e.config.uid}`).call(function(t){var i=t.selectAll(".generic").data(e=>e,e.screenModel.id);i.exit().remove(),i.call(h),i.enter().append("g").attr("class","generic").call(h)})},p=rt(this.data(),e.screenModel.group),g=Object.keys(p).sort((t,i)=>e.screenModel.order(t)-e.screenModel.order(i)).reduce((e,t)=>e.concat([p[t]]),[]),m=t.container.selectAll(`.frame-id-${e.config.uid}`).data(g);m.exit().remove(),m.call(f),m.enter().append("g").call(f)}}const Ee={...o,...l};function Se(e,t,i,r){var n=r(i(e),e);return(n[t]||[]).forEach(e=>Se(e,t,i,r)),n}function Te(e,t,i,r=0){t(e,r)&&(e.units||[]).map(e=>Te(e,t,i,r+1)),i(e,r)}var Me=function(){var e=[];function t(e){for(var t in e)this[t]=e[t]}function i(){this.copiedObjects=[];var e=this;this.recursiveDeepCopy=function(t){return e.deepCopy(t)},this.depth=0}function r(e,t){var r=new i;return t&&(r.maxDepth=t),r.deepCopy(e)}return t.prototype={constructor:t,canCopy:function(e){return!1},create:function(e){},populate:function(e,t,i){}},i.prototype={constructor:i,maxDepth:256,cacheResult:function(e,t){this.copiedObjects.push([e,t])},getCachedResult:function(e){for(var t=this.copiedObjects,i=t.length,r=0;r<i;r++)if(t[r][0]===e)return t[r][1]},deepCopy:function(t){if(null===t)return null;if("object"!=typeof t)return t;var i=this.getCachedResult(t);if(i)return i;for(var r=0;r<e.length;r++){var n=e[r];if(n.canCopy(t))return this.applyDeepCopier(n,t)}throw new Error("no DeepCopier is able to copy "+t)},applyDeepCopier:function(e,t){var i=e.create(t);if(this.cacheResult(t,i),this.depth++,this.depth>this.maxDepth)throw new Error("Exceeded max recursion depth in deep copy.");return e.populate(this.recursiveDeepCopy,t,i),this.depth--,i}},r.DeepCopier=t,r.deepCopiers=e,r.register=function(i){i instanceof t||(i=new t(i)),e.unshift(i)},r.register({canCopy:function(){return!0},create:function(e){return e instanceof e.constructor?"object"==typeof(t=e.constructor.prototype)?JSON.parse(JSON.stringify(t)):t:{};var t},populate:function(e,t,i){for(var r in t)t.hasOwnProperty(r)&&(i[r]=e(t[r]));return i}}),r.register({canCopy:function(e){return e instanceof Array},create:function(e){return new e.constructor},populate:function(e,t,i){for(var r=0;r<t.length;r++)i.push(e(t[r]));return i}}),r.register({canCopy:function(e){return e instanceof Date},create:function(e){return new Date(e)}}),r}(),Ce=e=>/^(#|rgb\(|rgba\()/.test(e),ke=/(.)^/;let Ae={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},Pe={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},Oe=/\\|'|\r|\n|\u2028|\u2029/g,Ne="(?:"+Object.keys(Ae).join("|")+")",Le=RegExp(Ne),Re=RegExp(Ne,"g"),Fe={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};function De(e){return Me(e)}function $e(e){return e instanceof Date&&!isNaN(Number(e))}function ze(e){return null!=e&&"object"==typeof e}function Be(e){var t=parseFloat(Math.min(...e).toFixed(15)),i=parseFloat(Math.max(...e).toFixed(15));if(t===i){i-=(i>=0?-1:1)*(i||1)/10}for(var r=[t=Math.min(0,t),i=Math.max(0,i)],n=r[1]-r[0],a=Math.pow(10,Math.floor(Math.log(n/10)/Math.LN10)),s=10/n*a,o=[[.15,10],[.35,5],[.75,2],[1,1],[2,1]],l=-1;s>o[++l][0];);a*=o[l][1],r[0]=Math.floor(r[0]/a)*a,r[1]=Math.ceil(r[1]/a)*a;var c=t-r[0],d=r[1]-i,u=a/2;if(t<0){var h=c>=u?-c:0;r[0]=r[0]-h}if(i>0){var f=d>=u?-d:0;r[1]=r[1]+f}return[parseFloat(r[0].toFixed(15)),parseFloat(r[1].toFixed(15))]}function Ie(e,t,{utc:i}={utc:!1}){var[r,n]=Ee.extent(e),a=+n-+r,s=i?Ee.scaleUtc:Ee.scaleTime;if(0===a){return r=new Date(r.getTime()-864e5),n=new Date(n.getTime()+864e5),s().domain([r,n]).nice(t).domain()}var o=s().domain([r,n]).nice(t);if(t)return o.domain();var[l,c]=s().domain([r,n]).nice(t).domain(),d=o.ticks(),u=d.length-1;return(+r-+l)/(+d[1]-+l)<.5&&(r=l),(+c-+n)/(+c-+d[u-1])<.5&&(n=c),[r,n]}var je=0,Ve={};function He(e){var t=btoa(encodeURIComponent(e)).replace(/=/g,"_");return Ve.hasOwnProperty(t)||(Ve[t]=`H${++je}`),Ve[t]}function We(e,t,i){var r=0,n=null,a=lt((e,t)=>it(e.map(e=>t.reduce((t,i)=>t.concat((e=>$e(e)?e.getTime():e)(e[i])),[])),e=>JSON.stringify(e)).reduce((e,t)=>{var i=t[0];return e[i]=e[i]||0,e[i]+=1,e},{}),(e,t)=>{let i=n===e?r:++r;return n=e,`${t.join("")}-${i}`});return(r,n,s)=>{var o=s.length,l=i.getSpec(),c=l.sources["/"].data,d=l.unit.units[0].guide||{};d.padding=d.padding||{l:0,r:0,t:0,b:0};var u=0;"x"===e?u=d.padding.l+d.padding.r:"y"===e&&(u=d.padding.t+d.padding.b);var h=(n-o*u)/(e=>{var t=a(c,e);return Object.keys(t).reduce((e,i)=>e+t[i],0)})(t);return(((e,t)=>a(c,e)[t])(t,r)*h+u)/n}}function Ue(e){var t=!0;try{Te(e,e=>{if(0===e.type.indexOf("COORDS.")&&"COORDS.RECT"!==e.type)throw new Error("Not applicable")},e=>e)}catch(e){"Not applicable"===e.message&&(t=!1)}return t}function Xe(e,t,i,r=0){if("requestAnimationFrame"===r){var n=!1;return function(...r){n||(requestAnimationFrame(()=>{n=!1}),i.apply(this,r),n=!0),e.e=t,e.ts=Date.now()}}return function(...n){var a={e:t,ts:Date.now()};(e.e&&e.e===a.e?a.ts-e.ts:r)>=r&&i.apply(this,n),e.e=a.e,e.ts=a.ts}}function Ge(e,t){var i=e[0],r=e[1],n=(r-i)/(t-1),a=t>=2?Qe(t-2).map(e=>i+n*(e+1)):[];return[i,...a,r]}function qe(e){return Ce(e)?e:""}function Ye(e){return Ce(e)?"":e}function Ke(e){return e/180*Math.PI}function Je(e){return Math.abs(e)>=360&&(e%=360),e<0&&(e=360+e),e}function Qe(e,t){1===arguments.length&&(t=e,e=0);const i=[];for(let r=e;r<t;r++)i.push(r);return i}function Ze(e,t,i,r){return e+t*(90===i?-1:1)-r>100}function et(e,t,i,r){return e+t*(-90===i?-1:1)-r>20}function tt(e){return Array.isArray(e)?[].concat(...e.map(e=>tt(e))):e}function it(e,t){for(var i={},r=[],n=e.length,a=t||(e=>String(e)),s=0;s<n;++s){var o=e[s],l=a(o);i.hasOwnProperty(l)||(i[l]=!0,r.push(o))}return r}function rt(e,t){return e.reduce((e,i)=>{var r=t(i);return e[r]=e[r]||[],e[r].push(i),e},{})}function nt(e,t){return it(e.concat(t))}function at(e,t){return e.filter(e=>-1!==t.indexOf(e))}function st(e,...t){var i=t.length;if(0===i||!e)return e;for(var r=0;r<i;r++)for(var n=t[r],a=ze(n)?Object.keys(n):[],s=a.length,o=0;o<s;o++){var l=a[o];void 0===e[l]&&(e[l]=n[l])}return e}function ot(e,...t){let i=Object.assign({},e);return t.forEach(e=>{delete i[e]}),i}function lt(e,t){const i=function(r){const n=i.cache,a=String(t?t.apply(this,arguments):r);return n.hasOwnProperty(a)||(n[a]=e.apply(this,arguments)),n[a]};return i.cache={},i}function ct(...e){return(t,i)=>{var r=0;return e.every(e=>0===(r=e(t,i))),r}}function dt(e,...t){return null==e?{}:t.reduce((t,i)=>{let r=e[i];return r&&(t[i]=r),t},{})}function ut(e){return e=null==e?"":String(e),Le.test(e)?e.replace(Re,e=>Ae[e]):e}function ht(e,t,i){!t&&i&&(t=i),t=st({},t,Fe);var r=RegExp([(t.escape||ke).source,(t.interpolate||ke).source,(t.evaluate||ke).source].join("|")+"|$","g"),n=0,a="__p+='";e.replace(r,function(t,i,r,s,o){return a+=e.slice(n,o).replace(Oe,e=>"\\"+Pe[e]),n=o+t.length,i?a+="'+\n((__t=("+i+"))==null?'':utils.escape(__t))+\n'":r?a+="'+\n((__t=("+r+"))==null?'':__t)+\n'":s&&(a+="';\n"+s+"\n__p+='"),t}),a+="';\n",t.variable||(a="with(obj||{}){\n"+a+"}\n"),a="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+a+"return __p;\n";try{var s=new Function(t.variable||"obj",a)}catch(e){throw e.source=a,e}var o=function(e){return s.call(this,e)},l=t.variable||"obj";return o.source="function("+l+"){\n"+a+"}",o}function ft(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}const pt="  ",gt=32,mt=["img","input","br","embed","link","meta","area","base","basefont","bgsound","col","command","frame","hr","image","isindex","keygen","menuitem","nextid","param","source","track","wbr","circle","ellipse","line","path","polygon","rect"].reduce((e,t)=>(e[t]=!0,e),{});function bt(e){var t=2,i=arguments[1];("object"!=typeof arguments[1]||Array.isArray(arguments[1]))&&(t=1,i={});const r=tt(Array.prototype.slice.call(arguments,t)),n=1===r.length&&"<"!==r[0].trim()[0],a=mt[e];if(a&&r.length>0)throw new Error(`Tag "${e}" is void but content is assigned to it`);const s=`<${e}`;var o=Object.keys(i).map(function(e){return` ${e}="${i[e]}"`}).join("");o.length>gt&&(o=Object.keys(i).map(function(e){return`\n${pt}${e}="${i[e]}"`}).join(""));const l=n?r[0]:"\n"+r.map(e=>{return String(e).split("\n").map(e=>`${pt}${e}`).join("\n")}).join("\n")+"\n";return`${s}${o}${a?"/>":`>${l}</${e}>`}`}function yt(e){var t=e;const i={then:e=>(t=e(t),i),result:()=>t};return i}const vt=[we];function xt(e){return vt.some(t=>e instanceof t)}function _t(e){return(e.units||[]).some(e=>e.hasOwnProperty("units"))}var wt=document.createElement("div"),Et=new WeakMap;function St(e,t){var i;return e instanceof Node?i=e:(wt.insertAdjacentHTML("afterbegin",e),i=wt.childNodes[0]),t.appendChild(i),i}function Tt(e){if(Et.has(e))return Et.get(e);var t=e.style.overflow;e.style.overflow="scroll";var i={width:e.offsetWidth-e.clientWidth,height:e.offsetHeight-e.clientHeight};return e.style.overflow=t,Et.set(e,i),i}function Mt(e,t){var i="horizontal"===(t=t||"both")||"both"===t,r="vertical"===t||"both"===t,n=Tt(e),a=r?`${n.width}px`:"0",s=i?`${n.height}px`:"0";e.style.overflow="hidden",e.style.padding=`0 ${a} ${s} 0`;var o=e.scrollWidth>e.clientWidth,l=e.scrollHeight>e.clientHeight,c=r&&!l?`${n.width}px`:"0",d=i&&!o?`${n.height}px`:"0";return e.style.padding=`0 ${c} ${d} 0`,e.style.overflow="",e.style.overflowX=o?"scroll":"hidden",e.style.overflowY=l?"scroll":"hidden",n}function Ct(e,t){return window.getComputedStyle(e).getPropertyValue(t)}function kt(e,t){return parseInt(Ct(e,t)||"0",10)}function At(e){var t=kt(e,"padding-left"),i=kt(e,"padding-right"),r=kt(e,"padding-bottom"),n=kt(e,"padding-top"),a=kt(e,"border-top-width")+kt(e,"border-left-width")+kt(e,"border-right-width")+kt(e,"border-bottom-width"),s=e.getBoundingClientRect();return{width:s.width-t-i-2*a,height:s.height-r-n-2*a}}function Pt(e){var t=document.createElement("div");t.style.position="absolute",t.style.visibility="hidden",t.style.width="100px",t.style.height="100px",t.style.border="1px solid green",t.style.top="0",document.body.appendChild(t),t.innerHTML='<svg class="tau-chart__svg">\n                <g class="tau-chart__cell cell">\n                <g class="x axis">\n                <g class="tick"><text></text></g>\n                </g>\n                </g>\n                </svg>';var i=t.querySelector(".x.axis .tick text");i.textContent=e;var r={width:0,height:0},n=i.getBoundingClientRect();r.width=n.right-n.left,r.height=n.bottom-n.top;var a=0!==e.length?r.width/e.length:0;return r.width=r.width+1.5*a,document.body.removeChild(t),r}function Ot(e,{fontSize:t,fontFamily:i,fontWeight:r}){var n="string"==typeof t?t:`${t}px`,a=e.map(function(e){for(var t=0,a=0;t<=e.length-1;t++){a+=Nt(e.charAt(t),{fontSize:n,fontFamily:i,fontWeight:r}).width}return a}).sort(function(e,t){return t-e})[0],s=e.length,o=parseInt(n);return{width:a,height:o*s+.39*o*s}}const Nt=lt((e,{fontSize:t,fontFamily:i,fontWeight:r})=>{var n=document.createElement("div");n.style.position="absolute",n.style.visibility="hidden",n.style.border="0px",n.style.top="0",n.style.fontSize=t,n.style.fontFamily=i,n.style.fontWeight=r,document.body.appendChild(n),n.innerHTML=" "===e?"&nbsp;":e;var a={width:0,height:0},s=n.getBoundingClientRect();return a.width=s.right-s.left,a.height=s.bottom-s.top,document.body.removeChild(n),a},(e,t)=>`${e}_${JSON.stringify(t)}`);function Lt(e,t){var i={".":(e,t)=>t.classed(e,!0),"#":(e,t)=>t.attr("id",e)},r=Object.keys(i).join("");if(t.indexOf(" ")>=0)throw new Error("Selector should not contain whitespaces.");if(r.indexOf(t[0])>=0)throw new Error("Selector must have tag at the beginning.");var n,a=e instanceof Element,o=a?s.select(e):e,l=e=>a?e.node():e,c=o.selectAll(t).filter(function(){return this.parentNode===o.node()}).filter((e,t)=>0===t);if(!c.empty())return l(c);for(var d,u=-1,h=null,f=1,p=t.length;f<=p;f++)(f==p||r.indexOf(t[f])>=0)&&(d=t.substring(u+1,f),u<0?n=o.append(d):i[h].call(null,d,n),h=t[f],u=f);return l(n)}function Rt(e,t){return Ft(e,t)[0]||null}function Ft(e,t){for(var i=[],r=Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,n=e.firstElementChild;Boolean(n);n=n.nextElementSibling)r.call(n,t)&&i.push(n);return i}function Dt(e,t){if(e.childElementCount>0){const n=Array.prototype.filter.call(e.childNodes,e=>e.nodeType===Node.ELEMENT_NODE),a=n.slice().sort(t),s=n.reduce((e,t,i)=>(e.set(t,i),e),new Map);var i,r;const o=a.reduce((e,t,n)=>{const o=s.get(t),l=n-o;return l!==r&&(i&&e.push(i),r=l,i={from:o,to:n,elements:[]}),i.elements.push(t),n===a.length-1&&e.push(i),e},[]),l=o.slice().sort((e,t)=>e.from-t.from),c=l.reduce((e,t,i)=>(e.set(t,i),e),new Map),d=e=>{const t=o.map((e,t)=>({elements:e.elements,from:c.get(e),to:t})).sort(ct((e,t)=>e.elements.length-t.elements.length,e?(e,t)=>t.to-e.to:(e,t)=>e.to-t.to));for(var i,r,n,a=0;a<t.length;a++){if((r=t[a]).from>r.to)for(i=a+1;i<t.length;i++)(n=t[i]).from>=r.to&&n.from<r.from&&n.from++;if(r.from<r.to)for(i=a+1;i<t.length;i++)(n=t[i]).from>r.from&&n.from<=r.to&&n.from--}return t.filter(e=>e.from!==e.to)},u=d(!0),h=d(!1),f=u.length<h.length?u:h,p=l.map(e=>e.elements);f.forEach(t=>{const i=p.splice(t.from,1)[0],r=p[t.to],n=r?r[0]:null;var a;1===t.elements.length?a=i[0]:(a=document.createDocumentFragment(),i.forEach(e=>{a.appendChild(e)})),e.insertBefore(a,n),p.splice(t.to,0,i)})}}function $t(...e){var t=[];return e.filter(e=>Boolean(e)).forEach(e=>{"string"==typeof e?t.push(e):"object"==typeof e&&t.push.apply(t,Object.keys(e).filter(t=>Boolean(e[t])))}),it(t).join(" ").trim().replace(/\s{2,}/g," ")}function zt(e,t,...i){const r=document.createEvent("MouseEvents"),n=[!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null],a=i.concat(n.slice(i.length));r.initMouseEvent(t,...a),e.dispatchEvent(r)}var Bt=e=>$e(e)?e.getTime():e,It={cross(e,t,i){var r=e(),n=it(r.map(e=>e[t]),Bt),a=it(r.map(e=>e[i]),Bt),s=0===n.length?[null]:n;return(0===a.length?[null]:a).reduce((e,r)=>e.concat(s.map(e=>{var n={};return t&&(n[t]=Bt(e)),i&&(n[i]=Bt(r)),n})),[])},cross_period(e,t,i,r,n,a){var s=e(),o=!!a&&a.utcTime,l=it(s.map(e=>e[t]),Bt),c=it(s.map(e=>e[i]),Bt),d=0===l.length?[null]:l,u=0===c.length?[null]:c;return r&&(d=b.generate(Math.min(...l),Math.max(...l),r,{utc:o})),n&&(u=b.generate(Math.min(...c),Math.max(...c),n,{utc:o})),u.reduce((e,r)=>e.concat(d.map(e=>{var n={};return t&&(n[t]=Bt(e)),i&&(n[i]=Bt(r)),n})),[])},groupBy:(e,t)=>it(e().map(e=>e[t]),Bt).map(e=>({[t]:Bt(e)})),none:()=>[null]};class jt{constructor({key:e,pipe:t,source:i,units:r},n,a={}){this.key=e,this.pipe=t||[],this.source=i,this.units=r,this._frame={key:e,source:i,pipe:this.pipe},this._data=n,this._pipeReducer=((e,t)=>a[t.type](e,t.args))}hash(){return He([this._frame.pipe,this._frame.key,this._frame.source].map(e=>JSON.stringify(e)).join(""))}full(){return this._data}part(e=(e=>e)){return this._frame.pipe.map(e).reduce(this._pipeReducer,this._data)}}var Vt=e=>$e(e)?e.getTime():e;const Ht=function(e){Object.keys(e).forEach(t=>this[t]=e[t])},Wt=(e,t,i)=>e.map(e=>"string"==typeof e?i.get(e):e).filter(e=>e).reduce((e,t)=>((e,t={})=>Object.assign(new Ht(e),t))(e,t(e,{})),t);class Ut extends h{constructor(e,t,i,r){super(),st(e.scales,{size_null:{type:"size",source:"?"},split_null:{type:"value",source:"?"},label_null:{type:"value",source:"?"},color_null:{type:"color",source:"?"},identity_null:{type:"identity",source:"?"},"size:default":{type:"size",source:"?"},"color:default":{type:"color",source:"?"},"split:default":{type:"value",source:"?"},"label:default":{type:"value",source:"?"},"identity:default":{type:"identity",source:"?"}}),e.settings=e.settings||{},this.config=e,this.sources=e.sources,this.scales=e.scales,this.unitSet=i,this.grammarRules=r,this.scalesHub=t,this.transformations=Object.assign(e.transformations||{},{where(e,t){var i=Object.keys(t||{}).map(e=>i=>Vt(i[e])===t[e]);return e.filter(e=>i.every(t=>t(e)))}})}static traverseSpec(e,t,i,r=null,n=null){var a=[],s=(e,t,i,r,n)=>{a.push(()=>{t(e,r,n)}),e.frames&&e.frames.forEach(r=>{(r.units||[]).map(n=>s(n,t,i,e,r))}),a.push(()=>i(e,r,n))};return s(e.unit,t,i,r,n),a}unfoldStructure(){return this.root=this._expandUnitsStructure(this.config.unit),this.config}getDrawScenarioQueue(e){const t=this.grammarRules;var i=this._flattenDrawScenario(e,(e,i,r)=>{const n=!1===i.expression.inherit?null:r,a=this._createFrameScalesFactoryMethod(n),s=this.unitSet.create(i.type,Object.assign({},i,{options:e.allocateRect(r.key)})),o=new Ht(s.defineGrammarModel(a)),l=Wt(s.getGrammarRules(),o,t);return Wt(s.getAdjustScalesRules(),l,t),s.node().screenModel=s.createScreenModel(l),s}),r=this._flattenDrawScenario(e,(e,i,r)=>{const n=!1===i.expression.inherit?null:r,a=this._createFrameScalesFactoryMethod(n),s=this.unitSet.create(i.type,Object.assign({},i,{options:e.allocateRect(r.key)})),o=new Ht(s.defineGrammarModel(a)),l=Wt(s.getGrammarRules(),o,t);return s.node().screenModel=s.createScreenModel(l),s.parentUnit=e,s.addInteraction(),s});return i.concat(()=>{Object.keys(this.scales).forEach(e=>this.scalesHub.createScaleInfo(this.scales[e]).commit())}).concat(r)}_flattenDrawScenario(e,t){var i={},r=[],n=[e],a=Ut.traverseSpec({unit:this.root},(e,a,s)=>{e.uid=(()=>{var t=He((a?`${a.uid}/`:"")+JSON.stringify(Object.keys(e).filter(t=>"string"==typeof e[t]).reduce((t,i)=>(t[i]=e[i],t),{}))+`-${JSON.stringify(s.pipe)}`);return i.hasOwnProperty(t)?t+=`-${++i[t]}`:i[t]=0,t})(),e.guide=De(e.guide);var o=t((()=>n[0])(),e,s);r.push(o),0===e.type.indexOf("COORDS.")&&(e=>n.unshift(e))(o)},e=>{0===e.type.indexOf("COORDS.")&&(()=>n.shift())()},null,this._datify({source:this.root.expression.source,pipe:[]}));return a.push(()=>r),a}_expandUnitsStructure(e,t=[]){var i=this;if(!1===e.expression.operator)e.frames=e.frames.map(e=>i._datify(e));else{var r=this._parseExpression(e.expression,t,e.guide);e.transformation=e.transformation||[],e.frames=r.exec().map(n=>{var a=(r.inherit?t:[]).concat([{type:"where",args:n}]).concat(e.transformation);return i._datify({key:n,pipe:a,source:r.source,units:e.units?e.units.map(e=>{var t=De(e);return t.guide=e.guide,t}):[]})})}return e.frames.forEach(e=>e.units.forEach(t=>this._expandUnitsStructure(t,e.pipe))),e}_createFrameScalesFactoryMethod(e){var t=this;return(i,r,n)=>{var a=r||`${i}:default`;return t.scalesHub.createScaleInfo(t.scales[a],e).create("function"==typeof n?n(t.scales[a]):n)}}_datify(e){return new jt(e,this.sources[e.source].data,this.transformations)}_parseExpression(e,t,i){var r=e.operator||"none",n=e.source,a=!1!==e.inherit,s=e.params,o={source:n,pipe:a?t:[]},l=()=>this._datify(o).part(),c=It[r];if(!c)throw new Error(`${r} operator is not supported`);return{source:n,inherit:a,func:c,args:s,exec:()=>c(l,...s||[],i)}}}var Xt=i(10);Xt.Tooltip.defaults.baseClass=O+"tooltip";const Gt=["top","bottom"];class qt extends Xt.Tooltip{_pickPlace(e){if(!this.options.auto)return this.options.place;const t=0|this.options.winBound,i=(r=t,{top:(n=function(){const e=window,t=document.documentElement,i=(e.pageYOffset||t.scrollTop)-t.clientTop,r=(e.pageXOffset||t.scrollLeft)-t.clientTop,n=e.innerWidth||t.clientWidth,a=e.innerHeight||t.clientHeight;return{top:i,right:r+n,bottom:i+a,left:r,width:n,height:a}}()).top+r,right:n.right-r,bottom:n.bottom-r,left:n.left+r,width:n.width-2*r,height:n.height-2*r});var r,n,a=this.options.place.split("-"),s=this.spacing;if(-1!==Gt.indexOf(a[0]))switch(e.top-this.height-s<=i.top?a[0]="bottom":e.bottom+this.height+s>=i.bottom&&(a[0]="top"),a[1]){case"left":e.right-this.width<=i.left&&(a[1]="right");break;case"right":e.left+this.width>=i.right&&(a[1]="left");break;default:e.left+e.width/2+this.width/2>=i.right?a[1]="left":e.right-e.width/2-this.width/2<=i.left&&(a[1]="right")}else switch(e.left-this.width-s<=i.left?a[0]="right":e.right+this.width+s>=i.right&&(a[0]="left"),a[1]){case"top":e.bottom-this.height<=i.top&&(a[1]="bottom");break;case"bottom":e.top+this.height>=i.bottom&&(a[1]="top");break;default:e.top+e.height/2+this.height/2>=i.bottom?a[1]="top":e.bottom-e.height/2-this.height/2<=i.top&&(a[1]="bottom")}return a.join("-")}}class Yt{constructor(e,t){this.chart=t,this.handlers=new Map,this.plugins=e.map(this.initPlugin,this)}initPlugin(e){e.init&&e.init(this.chart);const t=[];this.handlers.set(e,t);const i=(i,r)=>{t.push(this.chart.on(i,r,e))};return e.destroy&&i("destroy",e.destroy.bind(e)),Object.keys(e).forEach(t=>{if(0===t.indexOf("on")){const r=t.substr(2).toLowerCase();i(r,e[t].bind(e))}}),e}destroyPlugin(e){e.destroy&&e.destroy(),this.handlers.get(e).forEach(t=>{this.chart.removeHandler(t,e)})}destroy(){this.plugins.forEach(e=>this.destroyPlugin(e))}}var Kt={},Jt={},Qt={reg(e,t,i){return i?(Jt[e]=i,Kt[e]=function(e,t){this.___tauchartsseed___=new t(this.init(e))},Kt[e].prototype=Object.assign({init:e=>e,defineGrammarModel(e){return this.node().defineGrammarModel(e)},getGrammarRules(e){return this.node().getGrammarRules(e)},getAdjustScalesRules(e){return this.node().getAdjustScalesRules(e)},createScreenModel(e){return this.node().createScreenModel(e)},addInteraction(){this.node().addInteraction()},node(){return this.___tauchartsseed___},draw(){this.node().draw()}},t)):Kt[e]=t,this},get(e){if(!Kt.hasOwnProperty(e))throw new y("Unknown unit type: "+e,v.UNKNOWN_UNIT_TYPE);return Kt[e]},create(e,t){var i,r=this.get(e);Jt[e]?i=new r(t,this.get(Jt[e])):i=new r(t);return i}},Zt={},ei={};const ti={reg:(e,t,i=(e=>e))=>(Zt[e]=t,ei[e]=i,ti),get:e=>Zt[e],instance:(e={})=>({create:function(t,i,r){return new(ti.get(t))(i,(0,ei[t])(r,e))}})};class ii{constructor(e,t,i){this.registry=e,this.sources=t,this.scales=i}createScaleInfo(e,t=null){var i=e.dim,r=e.source,n=(this.sources[r].dims[i]||{}).type,a=this.sources[r].data,s=t||new jt({source:r},a);return e.dimType=n,this.registry.create(e.type,s,e)}createScaleInfoByName(e,t=null){return this.createScaleInfo(this.scales[e],t)}}var ri={isYFunctionOfX:(e,t,i)=>{var r=!0,n=null;try{e.reduce((e,r)=>{var a=(e,t)=>{var i=r[t],n=ze(i)?JSON.stringify(i):i;return e.push(n),e},s=t.reduce(a,[]).join("/"),o=i.reduce(a,[]).join("/");if(e.hasOwnProperty(s)){var l=e[s];if(l!==o)throw n={type:"RelationIsNotAFunction",keyX:t.join("/"),keyY:i.join("/"),valX:s,errY:[l,o]},new Error("RelationIsNotAFunction")}else e[s]=o;return e},{})}catch(e){if("RelationIsNotAFunction"!==e.message)throw e;r=!1}return{result:r,error:n}},excludeNullValues:(e,t)=>{var i=Object.keys(e).reduce((t,i)=>{var r=e[i];return r.hasOwnProperty("hasNull")&&!r.hasNull||"measure"!==r.type&&"period"!==r.scale||t.push(i),t},[]);return e=>{var r=!i.some(t=>!e.hasOwnProperty(t)||null===e[t]);return r||t(e),r}},autoAssignScales:function(e){var t={category:"ordinal",order:"ordinal",measure:"linear"},i={};return Object.keys(e).forEach(r=>{var n=e[r],a=(n.type||"category").toLowerCase();i[r]=Object.assign({},n,{type:a,scale:n.scale||t[a],value:n.value})}),i},autoDetectDimTypes:function(e){var t={type:"category",scale:"ordinal"};return e.reduce((e,i)=>(Object.keys(i).forEach(r=>{var n=i.hasOwnProperty(r)?i[r]:null;if(e[r]=e[r]||{type:null,hasNull:!1},null===n)e[r].hasNull=!0;else{var a=((e,t)=>{var i=t;return $e(e)?(i.type="measure",i.scale="time"):ze(e)?(i.type="order",i.scale="ordinal"):Number.isFinite(e)&&(i.type="measure",i.scale="linear"),i})(n,De(t)),s=a.type,o=a.scale,l=null!==e[r].type&&e[r].type!==s;e[r].type=l?t.type:s,e[r].scale=l?t.scale:o}}),e),{})},sortByDim:function(e,t,i){var r=e,n=["period","time"].indexOf(i.scale)>=0?e=>new Date(e):e=>e;const a=e.reduce((e,t,i)=>(e.set(t,i),e),new Map);if("measure"===i.type||"period"===i.scale)r=e.slice().sort(ct((e,i)=>n(e[t])-n(i[t]),(e,t)=>a.get(e)-a.get(t)));else if(i.order){var s=i.order.reduce((e,t,i)=>(e[t]=i,e),{}),o=i.order.length,l=`(___${t}___)`;r=e.map(e=>{var i=s[e[t]];return i=i>=0?i:o,e[l]=i,e}).sort(ct((e,t)=>e[l]-t[l],(e,t)=>a.get(e)-a.get(t))).map(e=>(delete e[l],e))}return r}},ni=function(e,t){var i=document.createElement("div");return i.classList.add(O+e),t&&t.appendChild(i),i},ai=function(){var e=ni("layout"),t=ni("layout__header",e),i=ni("layout__container",e),r=ni("layout__sidebar",i),n=ni("layout__content",i),a=ni("layout__content__wrap",n),s=ni("layout__sidebar-right",i);return{layout:e,header:t,content:a,contentContainer:n,leftSidebar:r,rightSidebar:ni("layout__sidebar-right__wrap",s),rightSidebarContainer:s,footer:ni("layout__footer",e)}};class si{constructor(e){this.spec=e,this.dist={sources:{"?":{dims:{},data:[{}]},"/":{dims:{},data:[]}},scales:{x_null:{type:"ordinal",source:"?"},y_null:{type:"ordinal",source:"?"},size_null:{type:"size",source:"?"},color_null:{type:"color",source:"?"},split_null:{type:"value",source:"?"},"pos:default":{type:"ordinal",source:"?"},"size:default":{type:"size",source:"?"},"label:default":{type:"value",source:"?"},"color:default":{type:"color",source:"?"},"split:default":{type:"value",source:"?"}},settings:e.settings}}convert(){var e=this.spec,t=this.dist;return this.ruleAssignSourceDims(e,t),this.ruleAssignStructure(e,t),this.ruleAssignSourceData(e,t),this.ruleApplyDefaults(t),t}ruleApplyDefaults(e){var t=e.settings||{},i=(e,t,r)=>{t(e,r),(e.units||[]).map(r=>i(r,t,e))};i(e.unit,(e,i)=>{if(e.namespace="chart",e.guide=st(e.guide||{},{animationSpeed:t.animationSpeed||0,utcTime:t.utcTime||!1}),i&&!e.hasOwnProperty("units")){e=st(e,{x:i.x,y:i.y});var r=De(i.guide)||{};e.guide.x=st(e.guide.x||{},r.x),e.guide.y=st(e.guide.y||{},r.y),e.expression.inherit=i.expression.inherit}return!i||e.guide&&e.guide.hasOwnProperty("obsoleteVerticalStackOrder")||(e.guide=Object.assign(e.guide||{},{obsoleteVerticalStackOrder:(i.guide||{}).obsoleteVerticalStackOrder})),e},null)}ruleAssignSourceData(e,t){var i=e.spec.dimensions||{},r=t.sources["/"].dims,n=(e,t)=>{let i=e[t];return ze(i)&&!$e(i)&&Object.keys(i).forEach(r=>e[t+"."+r]=i[r]),e};t.sources["/"].data=e.data.map(e=>{var t=Object.keys(e).reduce(n,e);return Object.keys(r).reduce((e,t)=>(e.hasOwnProperty(t)||(e[t]=null),null!==e[t]&&i[t]&&["period","time"].indexOf(i[t].scale)>=0&&(e[t]=new Date(e[t])),e),t)})}ruleAssignSourceDims(e,t){var i=e.spec.dimensions;t.sources["/"].dims=Object.keys(i).reduce((e,t)=>(e[t]={type:i[t].type},e),{})}ruleAssignStructure(e,t){var i=e=>{var r=De(ot(e,"unit"));return this.ruleCreateScales(e,r,t.settings),r.expression=this.ruleInferExpression(e),e.unit&&(r.units=e.unit.map(i)),r},r=i(e.spec.unit);r.expression.inherit=!1,t.unit=r}ruleCreateScales(e,t,i){var r=e.guide||{};["identity","color","size","label","x","y","split"].forEach(n=>{e.hasOwnProperty(n)&&(t[n]=this.scalesPool(n,e[n],r[n]||{},i))})}ruleInferDim(e,t){var i=e,r=this.spec.spec.dimensions;if(!r.hasOwnProperty(i))return i;t.hasOwnProperty("tickLabel")?i=`${e}.${t.tickLabel}`:r[e].value&&(i=`${e}.${r[e].value}`);var n=this.dist.sources["/"].dims;return n.hasOwnProperty(i)||(n[i]={type:n[e].type},delete n[e]),i}scalesPool(e,t,i,r){var n=`${e}_${t}`;if(this.dist.scales.hasOwnProperty(n))return n;var a=this.spec.spec.dimensions,s={};if("color"===e&&null!==t&&(s={type:"color",source:"/",dim:this.ruleInferDim(t,i)},i.hasOwnProperty("brewer")&&(s.brewer=i.brewer),a[t]&&a[t].hasOwnProperty("order")&&(s.order=a[t].order),i.hasOwnProperty("min")&&(s.min=i.min),i.hasOwnProperty("max")&&(s.max=i.max),i.hasOwnProperty("nice")&&(s.nice=i.nice)),"size"===e&&null!==t&&(s={type:"size",source:"/",dim:this.ruleInferDim(t,i)},i.hasOwnProperty("func")&&(s.func=i.func),i.hasOwnProperty("min")&&(s.min=i.min),i.hasOwnProperty("max")&&(s.max=i.max),i.hasOwnProperty("minSize")&&(s.minSize=i.minSize),i.hasOwnProperty("maxSize")&&(s.maxSize=i.maxSize)),"label"===e&&null!==t&&(s={type:"value",source:"/",dim:this.ruleInferDim(t,i)}),"split"===e&&null!==t&&(s={type:"value",source:"/",dim:this.ruleInferDim(t,i)}),"identity"===e&&null!==t&&(s={type:"identity",source:"/",dim:this.ruleInferDim(t,i)}),a.hasOwnProperty(t)&&("x"===e||"y"===e)){if(s={type:a[t].scale,source:"/",dim:this.ruleInferDim(t,i)},a[t].hasOwnProperty("order")&&(s.order=a[t].order),i.hasOwnProperty("min")&&(s.min=i.min),i.hasOwnProperty("max")&&(s.max=i.max),i.hasOwnProperty("autoScale")?s.autoScale=i.autoScale:s.autoScale=!0,i.hasOwnProperty("nice")?s.nice=i.nice:s.nice=s.autoScale,i.hasOwnProperty("niceInterval")?s.niceInterval=i.niceInterval:s.niceInterval=null,i.hasOwnProperty("tickPeriod")&&(s.period=i.tickPeriod,s.type="period"),i.hasOwnProperty("tickPeriod")&&i.hasOwnProperty("timeInterval"))throw new Error('Use "tickPeriod" for period scale, "timeInterval" for time scale, but not both');if(i.hasOwnProperty("timeInterval")){s.period=i.timeInterval,s.type="time";let e=b.get(s.period,{utc:r.utcTime});i.hasOwnProperty("min")&&(s.min=e.cast(new Date(i.min))),i.hasOwnProperty("max")&&(s.max=e.cast(new Date(i.max)))}s.fitToFrameByDims=i.fitToFrameByDims,s.ratio=i.ratio}return this.dist.scales[n]=s,n}getScaleConfig(e,t){var i=`${e}_${t}`;return this.dist.scales[i]}ruleInferExpression(e){var t={operator:"none",params:[]},i=e.guide||{},r=i.x||{},n=i.y||{},a=this.getScaleConfig("x",e.x),s=this.getScaleConfig("y",e.y);return 0===e.type.indexOf("ELEMENT.")?e.color&&(t={operator:"groupBy",params:[this.ruleInferDim(e.color,i.color||{})]}):"COORDS.RECT"===e.type&&1===e.unit.length&&"COORDS.RECT"===e.unit[0].type&&(t=a.period||s.period?{operator:"cross_period",params:[this.ruleInferDim(e.x,r),this.ruleInferDim(e.y,n),a.period,s.period]}:{operator:"cross",params:[this.ruleInferDim(e.x,r),this.ruleInferDim(e.y,n)]}),Object.assign({inherit:!0,source:"/"},t)}}const oi={...i(6),...i(7)},li=oi.format(".4s"),ci=oi.format(".2r"),di=oi.format(".1e"),ui=(()=>{const e=/\.0+([^\d].*)?$/,t=/(\.\d+?)0+([^\d].*)?$/;return i=>i.replace(e,"$1").replace(t,"$1$2")})();var hi={_identity:(e,t)=>String(null==e?t:e),"x-num-auto":function(e){if(isNaN(e))return"NaN";var t=Math.abs(e);return ui(t<1?0===t?"0":t<1e-6?di(e):ci(e):li(e))},percent:function(e){return parseFloat((100*e).toFixed(2)).toString()+"%"},day:oi.timeFormat("%d-%b-%Y"),"day-utc":oi.utcFormat("%d-%b-%Y"),"day-short":oi.timeFormat("%d-%b"),"day-short-utc":oi.utcFormat("%d-%b"),week:oi.timeFormat("%d-%b-%Y"),"week-utc":oi.utcFormat("%d-%b-%Y"),"week-short":oi.timeFormat("%d-%b"),"week-short-utc":oi.utcFormat("%d-%b"),month:e=>{var t=0===new Date(e).getMonth()?"%B, %Y":"%B";return oi.timeFormat(t)(e)},"month-utc":e=>{var t=0===new Date(e).getUTCMonth()?"%B, %Y":"%B";return oi.utcFormat(t)(e)},"month-short":e=>{var t=0===new Date(e).getMonth()?"%b '%y":"%b";return oi.timeFormat(t)(e)},"month-short-utc":e=>{var t=0===new Date(e).getUTCMonth()?"%b '%y":"%b";return oi.utcFormat(t)(e)},"month-year":oi.timeFormat("%B, %Y"),"month-year-utc":oi.utcFormat("%B, %Y"),quarter:e=>{var t=new Date(e),i=t.getMonth();return"Q"+((i-i%3)/3+1)+" "+t.getFullYear()},"quarter-utc":e=>{var t=new Date(e),i=t.getUTCMonth();return"Q"+((i-i%3)/3+1)+" "+t.getUTCFullYear()},year:oi.timeFormat("%Y"),"year-utc":oi.utcFormat("%Y"),"x-time-auto":null},fi={get:(e,t)=>{var i=hi._identity,r=hi.hasOwnProperty(e),n=r?hi[e]:i;return r&&(n=hi[e]),!r&&e&&(n=(t=>{return($e(t)?oi.timeFormat(e):oi.format(e))(t)})),r||e||(n=i),null!==n?e=>n(e,t||""):null},add:(e,t)=>{hi[e]=t}},pi=e=>e.reduce((e,t)=>e+t,0);var gi=(e,t)=>{var i=t.guide||{},r={x:["label"],y:["label"],size:["label"],color:["label"],padding:[]};return Object.keys(r).forEach(t=>{let n=r[t];!function(e,t,i,r){var n=e.hasOwnProperty(i)?e[i]:{};n=n||{},r.forEach(e=>{Object.assign(t.guide[i][e],n[e])})}(i,e,t,n)}),Object.assign(e.guide,Object.keys(i).reduce((e,t)=>(r.hasOwnProperty(t)||(e[t]=i[t]),e),{})),e},mi=function(e,t,i){return e[t]=st(e[t]||{},{label:""}),e[t].label=ze(e[t].label)?e[t].label:{text:e[t].label},e[t].label=st(e[t].label,i||{},{padding:32,rotate:0,textAnchor:"middle",cssClass:"label",dock:null}),e[t]},bi=function(e,t,i){return e[t]=st(e[t],i||{},{padding:0,density:30,rotate:0,tickPeriod:null,tickFormat:null,autoScale:!0}),e[t].tickFormat=e[t].tickFormat||e[t].tickPeriod,e[t].nice=e[t].hasOwnProperty("nice")?e[t].nice:e[t].autoScale,e[t]},yi=e=>{var t=e.units||[],i=!e.hasOwnProperty("units"),r=!t.some(e=>e.hasOwnProperty("units"));return{type:e.type,isLeaf:i,isLeafParent:!i&&r}},vi=function(e,t,i,r){if(0===e.length)return{width:0,height:0};if(null===t){var n=i("TauChart Library");return n.width=.625*r,n}e.every(e=>"number"==typeof e)&&(e=l.scaleLinear().domain(e).ticks());var a=e.reduce((e,i)=>{let r=t(i).toString().length;return!e.computed||r>e.computed?{value:i,computed:r}:e},{}).value;return i(t(a))},xi=(e,t)=>{var i=e.dimType,r=e.scaleType,n=[i,r,"*"].join(":"),a=[i,r].join(":");return t[n]||t[a]||t[i]||null},_i=(e,t,i)=>e.hasOwnProperty(`${t}:${i}`)?e[`${t}:${i}`]:e[`${t}`],wi=(e,t)=>{return["day","week","month"].indexOf(e)>=0&&(e+=`-short${t?"-utc":""}`),e},Ei=({width:e,height:t},i)=>{var r=Math.abs(Ke(i));return{width:Math.max(Math.cos(r)*e,t),height:Math.max(Math.sin(r)*e,t)}},Si=(e,t="x")=>{var i=Je(e),r="x"===t?[[0,45,"middle"],[45,135,"start"],[135,225,"middle"],[225,315,"end"],[315,360,"middle"]]:[[0,90,"end"],[90,135,"middle"],[135,225,"start"],[225,315,"middle"],[315,360,"end"]],n=r.findIndex(e=>i>=e[0]&&i<e[1]);return r[n][2]},Ti=(e,t,i)=>{let r=Math.ceil(e.width/t);return{height:Math.min(r,i)*e.height,width:t}};function Mi(e,t,i,r,n,a){var s=i.values,o=r.values,l=i.isEmpty||e.x.hideTicks,c=r.isEmpty||e.y.hideTicks,d=vi(s,fi.get(e.x.tickFormat,e.x.tickFormatNullAlias),t.getAxisTickLabelSize,t.xAxisTickLabelLimit),u=vi(o,fi.get(e.y.tickFormat,e.y.tickFormatNullAlias),t.getAxisTickLabelSize,t.yAxisTickLabelLimit),h=d,f=u;d.width>t.xAxisTickLabelLimit&&(e.x.tickFormatWordWrap=!0,e.x.tickFormatWordWrapLines=t.xTickWordWrapLinesLimit,h=Ti(d,t.xAxisTickLabelLimit,t.xTickWordWrapLinesLimit)),u.width>t.yAxisTickLabelLimit&&(e.y.tickFormatWordWrap=!0,e.y.tickFormatWordWrapLines=t.yTickWordWrapLinesLimit,f=Ti(u,t.yAxisTickLabelLimit,t.yTickWordWrapLinesLimit)),a&&(e.y.tickFormatWordWrap=!1,e.y.tickFormatWordWrapLines=1,(f=Ti(u,2*t.yAxisTickLabelLimit,1)).width=20);var p=l?0:1,g=c?0:1,m=e.x.label,b=e.y.label,y=m.text&&!m.hide?1:0,v=b.text&&!b.hide?1:0,x=Ei(h,e.x.rotate),_=Ei(f,e.y.rotate);n?(m.padding=(-t.xAxisPadding-t.xFontLabelHeight)/2+t.xFontLabelHeight,m.paddingNoTicks=m.padding,b.padding=(-t.yAxisPadding-t.yFontLabelHeight)/2,b.paddingNoTicks=b.padding,y=0,v=0):(m.padding=pi([p*(t.xTickWidth+x.height),y*(t.distToXAxisLabel+t.xFontLabelHeight)]),m.paddingNoTicks=y*(t.distToXAxisLabel+t.xFontLabelHeight),b.padding=pi([g*(t.yTickWidth+_.width),v*t.distToYAxisLabel]),b.paddingNoTicks=v*t.distToYAxisLabel),a&&(b.padding=0,b.paddingNoTicks=0);const w=t.xFontLabelDescenderLineHeight;return e.padding=Object.assign(e.padding,{b:e.x.hide?0:pi([e.x.padding,p*(t.xTickWidth+x.height),y*(t.distToXAxisLabel+t.xFontLabelHeight+w)]),l:e.y.hide?0:pi([e.y.padding,a?0:g*(t.yTickWidth+_.width),v*(t.distToYAxisLabel+t.yFontLabelHeight)])}),e.paddingNoTicks=Object.assign({},e.paddingNoTicks,{b:e.x.hide?0:pi([e.x.padding,y*(t.distToXAxisLabel+t.xFontLabelHeight+w)]),l:e.y.hide?0:pi([e.y.padding,v*(t.distToYAxisLabel+t.yFontLabelHeight)])}),e.x=Object.assign(e.x,{density:x.width+2*_i(t,"xDensityPadding",i.dimType),tickFontHeight:d.height,$minimalDomain:s.length,$maxTickTextW:h.width,$maxTickTextH:h.height,tickFormatWordWrapLimit:t.xAxisTickLabelLimit}),e.y=Object.assign(e.y,{density:_.height+2*_i(t,"yDensityPadding",r.dimType),tickFontHeight:u.height,$minimalDomain:o.length,$maxTickTextW:f.width,$maxTickTextH:f.height,tickFormatWordWrapLimit:t.yAxisTickLabelLimit}),e}var Ci=function({unit:e,meta:t,settings:i,allowXVertical:r,allowYVertical:n,inlineLabels:a}){var s=t.dimension(e.x),o=t.dimension(e.y),l=t.scaleMeta(e.x,e.guide.x),c=t.scaleMeta(e.y,e.guide.y),d=l.isEmpty,u=c.isEmpty;e.guide.x.tickFormat=wi(e.guide.x.tickFormat||xi(s,i.defaultFormats),i.utcTime),e.guide.y.tickFormat=wi(e.guide.y.tickFormat||xi(o,i.defaultFormats),i.utcTime);var h=!!r&&!("measure"===s.dimType),f=!!n&&!("measure"===o.dimType);if(e.guide.x.padding=d?0:i.xAxisPadding,e.guide.x.paddingNoTicks=e.guide.x.padding,e.guide.y.padding=u?0:i.yAxisPadding,e.guide.y.paddingNoTicks=e.guide.y.padding,e.guide.x.rotate=h?-90:0,e.guide.x.textAnchor=Si(e.guide.x.rotate,"x"),e.guide.y.rotate=f?-90:0,e.guide.y.textAnchor=Si(e.guide.y.rotate,"y"),e.guide=Mi(e.guide,i,l,c,a,_t(e)),a){let t=e.guide.x.label,i=e.guide.y.label;t.cssClass+=" inline",t.dock="right",t.textAnchor="end",i.cssClass+=" inline",i.dock="right",i.textAnchor="end"}return e},ki={NONE:(e,t,i)=>{var r=De(e);return Ai(De(r.unit),r.unit,(e,t)=>(t.guide.x.tickFontHeight=i.getAxisTickLabelSize("X").height,t.guide.y.tickFontHeight=i.getAxisTickLabelSize("Y").height,t.guide.x.tickFormatWordWrapLimit=i.xAxisTickLabelLimit,t.guide.y.tickFormatWordWrapLimit=i.yAxisTickLabelLimit,t)),r},"BUILD-LABELS":(e,t)=>{var i=De(e),r=[],n=[],a=null,s=null;Se(i.unit,"units",yi,(e,i)=>{if(e.isLeaf)return i;!a&&i.x&&(a=i),!s&&i.y&&(s=i),i.guide=i.guide||{},i.guide.x=i.guide.x||{label:{text:""}},i.guide.y=i.guide.y||{label:{text:""}},i.guide.x.label=ze(i.guide.x.label)?i.guide.x.label:{text:i.guide.x.label&&i.guide.x.label.text?i.guide.x.label.text:""},i.guide.y.label=ze(i.guide.y.label)?i.guide.y.label:{text:i.guide.y.label&&i.guide.y.label.text?i.guide.y.label.text:""},i.x&&(i.guide.x.label.text=i.guide.x.label.text||t.dimension(i.x).dimName),i.y&&(i.guide.y.label.text=i.guide.y.label.text||t.dimension(i.y).dimName);var o=i.guide.x.label.text;o&&(r.push(o),i.guide.x.tickFormatNullAlias=i.guide.x.hasOwnProperty("tickFormatNullAlias")?i.guide.x.tickFormatNullAlias:"No "+o,i.guide.x.label.text="",i.guide.x.label._original_text=o);var l=i.guide.y.label.text;return l&&(n.push(l),i.guide.y.tickFormatNullAlias=i.guide.y.hasOwnProperty("tickFormatNullAlias")?i.guide.y.tickFormatNullAlias:"No "+l,i.guide.y.label.text="",i.guide.y.label._original_text=l),i});return a&&(a.guide.x.label.text=a.guide.x.label.hide?"":r.join(" → ")),s&&(s.guide.y.label.text=s.guide.y.label.hide?"":n.join(" → ")),i},"BUILD-GUIDE":(e,t,i)=>{var r=De(e);return Ai(De(r.unit),r.unit,(e,r)=>{if(e.isLeaf)return r;var n=!e.isLeaf&&!e.isLeafParent,a=t.scaleMeta(r.x,r.guide.x),s=t.scaleMeta(r.y,r.guide.y),o=!n&&Boolean(a.dimType)&&"measure"!==a.dimType;return r.guide.x.rotate=r.guide.x.rotate||(o?-90:0),r.guide.x.textAnchor=Si(r.guide.x.rotate),r.guide.x.tickFormat=r.guide.x.tickFormat||xi(a,i.defaultFormats),r.guide.y.tickFormat=r.guide.y.tickFormat||xi(s,i.defaultFormats),r.guide.x.padding=n?0:i.xAxisPadding,r.guide.x.paddingNoTicks=r.guide.x.padding,r.guide.y.padding=n?0:i.yAxisPadding,r.guide.y.paddingNoTicks=r.guide.y.padding,r.guide=Mi(r.guide,st({distToXAxisLabel:a.isEmpty?i.xTickWidth:i.distToXAxisLabel,distToYAxisLabel:s.isEmpty?i.yTickWidth:i.distToYAxisLabel},i),a,s,null,_t(r)),r.guide.x=Object.assign(r.guide.x,{cssClass:n?r.guide.x.cssClass+" facet-axis":r.guide.x.cssClass,avoidCollisions:!!n||r.guide.x.avoidCollisions}),r.guide.y=Object.assign(r.guide.y,{cssClass:n?r.guide.y.cssClass+" facet-axis":r.guide.y.cssClass,avoidCollisions:!n&&r.guide.y.avoidCollisions}),r.guide=Object.assign(r.guide,{showGridLines:r.guide.hasOwnProperty("showGridLines")?r.guide.showGridLines:e.isLeafParent?"xy":""}),r}),r},"BUILD-COMPACT":(e,t,i)=>{var r=De(e);return Ai(De(r.unit),r.unit,(e,r)=>e.isLeaf?r:(r.guide.hasOwnProperty("showGridLines")||(r.guide.showGridLines=e.isLeafParent?"xy":""),e.isLeafParent?Ci({unit:r,meta:t,settings:st({xTickWordWrapLinesLimit:1,yTickWordWrapLinesLimit:1},i),allowXVertical:!0,allowYVertical:!1,inlineLabels:!0}):(r.guide.x.cssClass+=" facet-axis compact",r.guide.x.avoidCollisions=!0,r.guide.y.cssClass+=" facet-axis compact",r.guide.y.avoidCollisions=!0,Ci({unit:r,meta:t,settings:st({xAxisPadding:0,yAxisPadding:0,distToXAxisLabel:0,distToYAxisLabel:0,xTickWordWrapLinesLimit:1,yTickWordWrapLinesLimit:1},i),allowXVertical:!1,allowYVertical:!0,inlineLabels:!1})))),r},AUTO:(e,t,i)=>["BUILD-LABELS","BUILD-GUIDE"].reduce((e,r)=>ki[r](e,t,i),e),COMPACT:(e,t,i)=>["BUILD-LABELS","BUILD-COMPACT"].reduce((e,r)=>ki[r](e,t,i),e)},Ai=(e,t,i)=>{var r=(e=>(e.options=e.options||{},e.guide=e.guide||{},e.guide.padding=st(e.guide.padding||{},{l:0,b:0,r:0,t:0}),e.guide.x=mi(e.guide,"x"),e.guide.x=bi(e.guide,"x",{cssClass:"x axis",scaleOrient:"bottom",textAnchor:"middle"}),e.guide.y=mi(e.guide,"y",{rotate:-90}),e.guide.y=bi(e.guide,"y",{cssClass:"y axis",scaleOrient:"left",textAnchor:"end"}),e.guide.size=mi(e.guide,"size"),e.guide.color=mi(e.guide,"color"),e))(t);r=i(yi(r),r);var n=ot(r=gi(r,e),"units");return(r.units||[]).forEach(e=>Ai(De(e),((e,t)=>(e.guide=e.guide||{},e.guide.padding=e.guide.padding||{l:0,t:0,r:0,b:0},e.hasOwnProperty("units")||((e=st(e,t)).guide=st(e.guide,De(t.guide)),e.guide.x=st(e.guide.x,De(t.guide.x)),e.guide.y=st(e.guide.y,De(t.guide.y))),e))(e,n),i)),r},Pi={get:(e,t,i,r)=>{var n={dimension:e=>{var t=i.scales[e],r=i.sources[t.source].dims[t.dim]||{};return{dimName:t.dim,dimType:r.type,scaleType:t.type}},scaleMeta:e=>{var t=r("pos",e).domain(),n=i.scales[e],a=i.sources[n.source].dims[n.dim]||{};return{dimName:n.dim,dimType:a.type,scaleType:n.type,values:t,isEmpty:null==a.type}}},a=(ki[e]||ki.NONE)({unit:De(i.unit)},n,t);return i.unit=a.unit,i}};class Oi{constructor(e){this.spec=e,this.isApplicable=Ue(e.unit)}transform(e){var t=this.spec;if(!this.isApplicable)return t;var i=t.settings.size,r=t.settings.specEngine.find(e=>i.width<=e.width||i.height<=e.height);return Pi.get(r.name,t.settings,t,(t,i)=>e.getScaleInfo(i||`${t}:default`))}}class Ni{static optimizeXAxisLabel(e,t){const{xAxisTickLabelLimit:i}=t,r=e=>{if(!e.guide.x.hide&&!e.guide.x.hideTicks&&0!==e.guide.x.rotate){e.guide.x.rotate=0,e.guide.x.textAnchor="middle";var t=0-Math.min(i,e.guide.x.$maxTickTextW)+e.guide.x.$maxTickTextH;n(e,t)}(e.units||[]).filter(e=>"COORDS.RECT"===e.type).forEach(e=>r(e))},n=(t,i)=>{e!==t&&"extract-axes"===t.guide.autoLayout?(e.guide.x.padding+=i,e.guide.padding.b+=i):(t.guide.x.label.padding+=t.guide.x.label.padding>0?i:0,t.guide.padding.b+=t.guide.padding.b>0?i:0)};r(e)}static hideAxisTicks(e,t,i){const r=e=>{const t="x"===i?"b":"l",n=e.guide;if(!n[i].hide&&!n[i].hideTicks){_t(e)&&"y"===i||(n[i].hideTicks=!0);var a=n[i].label.text&&!n[i].label.hide;n.padding[t]=n.paddingNoTicks?n.paddingNoTicks[t]:0,n[i].padding=n[i].paddingNoTicks||0,n[i].label.padding=a?n[i].label.paddingNoTicks:0}(e.units||[]).filter(e=>"COORDS.RECT"===e.type).forEach(e=>r(e))};r(e)}static facetsLabelsAtTop(e,t){const i=e=>{const t=e.units||[];if(_t(e)){const i=e.guide;i.y.facetAxis=!0,i.y.rotate=0,i.y.textAnchor="start",t.forEach(e=>{e.guide.padding.t=20})}t.filter(e=>"COORDS.RECT"===e.type).forEach(e=>i(e))};i(e)}}var Li=e=>e.$maxTickTextW,Ri=e=>0==e.rotate?e.$maxTickTextW:e.$maxTickTextH,Fi=e=>e.density,Di=e=>{var t=[],i=[],r=e=>{if("COORDS.RECT"===e.type&&e.units&&e.units[0]&&"COORDS.RECT"===e.units[0].type){var n=e.x.replace(/^x_/,""),a=e.y.replace(/^y_/,"");"null"!==n&&t.push(n),"null"!==a&&i.push(a),e.units.forEach(r)}};r(e.unit);var n={},a={},s=e=>{"COORDS.RECT"===e.type&&e.frames.forEach(e=>{e.key&&(Object.keys(e.key).forEach(r=>{t.indexOf(r)>=0&&(n.hasOwnProperty(r)||(n[r]=[]),n[r].indexOf(e.key[r])<0&&n[r].push(e.key[r])),i.indexOf(r)>=0&&(a.hasOwnProperty(r)||(a[r]=[]),a[r].indexOf(e.key[r])<0&&a[r].push(e.key[r]))}),e.units&&e.units.forEach(s))})};return s(e.unit),{xFacetCount:Object.keys(n).reduce((e,t)=>e*n[t].length,1),yFacetCount:Object.keys(a).reduce((e,t)=>e*a[t].length,1)}},$i={"entire-view"(e,t,i,r){var n=i.unit.guide,{xFacetCount:a,yFacetCount:s}=Di(i);s>0&&Ni.facetsLabelsAtTop(i.unit,i.settings);var o=n.paddingNoTicks?n.padding.l-n.paddingNoTicks.l:0,l=n.paddingNoTicks?n.padding.b-n.paddingNoTicks.b:0,c=n.paddingNoTicks&&e.height-l<i.settings.minChartHeight||s*i.settings.minFacetHeight+l>e.height||a*i.settings.minFacetWidth+o>e.width,d=n.paddingNoTicks&&e.width-o<i.settings.minChartWidth||s*i.settings.minFacetHeight+l>e.height||a*i.settings.minFacetWidth+o>e.width;c&&Ni.hideAxisTicks(i.unit,i.settings,"x"),d&&Ni.hideAxisTicks(i.unit,i.settings,"y");var u=e.width;if(t("x",i.unit,Li)<=e.width)r(i.unit,i.settings);else{var h=t("x",i.unit,Ri);if(h>e.width){var f=Math.max(e.width,t("x",i.unit,Fi));u=Math.min(h,f)}}var p=Math.max(e.height,t("y",i.unit,Fi));return!c&&u>e.width&&Ni.hideAxisTicks(i.unit,i.settings,"x"),!d&&p>e.height&&Ni.hideAxisTicks(i.unit,i.settings,"y"),{newW:e.width,newH:e.height}},minimal:(e,t,i)=>({newW:t("x",i.unit,Fi),newH:t("y",i.unit,Fi)}),normal(e,t,i,r){const{yFacetCount:n}=Di(i);n>0&&Ni.facetsLabelsAtTop(i.unit,i.settings);var a=i.unit.guide;a.paddingNoTicks&&(e.width-a.padding.l+a.paddingNoTicks.l<i.settings.minChartWidth&&Ni.hideAxisTicks(i.unit,i.settings,"y"),e.height-a.padding.b+a.paddingNoTicks.b<i.settings.minChartHeight&&Ni.hideAxisTicks(i.unit,i.settings,"x"));var s=e.width;if(t("x",i.unit,Li)<=e.width)r(i.unit,i.settings);else{var o=t("x",i.unit,Ri);if(o>e.width){var l=Math.max(e.width,t("x",i.unit,Fi));s=Math.min(o,l)}}return{newW:s,newH:Math.max(e.height,t("y",i.unit,Fi))}},"fit-width"(e,t,i,r){var n=i.unit.guide,a=n.paddingNoTicks?n.padding.l-n.paddingNoTicks.l:0;return(n.paddingNoTicks&&e.width-a<i.settings.minChartWidth||Di(i).xFacetCount*i.settings.minFacetWidth+a>e.width)&&Ni.hideAxisTicks(i.unit,i.settings,"y"),t("x",i.unit,Li)<=e.width&&r(i.unit,i.settings),{newW:e.width,newH:t("y",i.unit,Fi)}},"fit-height"(e,t,i){var r=i.unit.guide,n=r.paddingNoTicks?r.padding.b-r.paddingNoTicks.b:0;return(r.paddingNoTicks&&e.height-n<i.settings.minChartHeight||Di(i).yFacetCount*i.settings.minFacetHeight+n>e.height)&&Ni.hideAxisTicks(i.unit,i.settings,"x"),{newW:t("x",i.unit,Fi),newH:e.height}}};class zi{constructor(e){this.spec=e,this.isApplicable=Ue(e.unit)}transform(e){var t=this.spec;if(!this.isApplicable)return t;var i=t.settings.fitModel;if(!i)return t;var r=t.scales,n=(e,t)=>{return e.discrete?t*e.domain().length:4*t},a=(t,i,s,o=null)=>{var l="x"===t?i.x:i.y,c="x"===t?i.y:i.x,d=i.guide,u=s("x"===t?d.x:d.y);const h=i.units[0];var f="x"===t?d.padding.l+d.padding.r:d.padding.b+d.padding.t;if("ELEMENT.INTERVAL"===h.type&&"y"===t===Boolean(h.flip)&&h.label&&!e.getScaleInfo(h.label,o).isEmpty()){const t=2*(d.label&&d.label.fontSize?d.label.fontSize:10),r=e.getScaleInfo(l,o);let a;if(r.discrete&&(null==h.guide.enableColorToBarPosition?!h.stack:h.guide.enableColorToBarPosition)){const t=h.color;if(t){const i=e.getScaleInfo(t,o);if(i.discrete){i.domain();a=i}}}const s=e=>{const i=e.part(),n=it(i.map(e=>e[r.dim])).length;let s=1;if(a){const e=i.reduce((e,t)=>{const i=t[r.dim],n=t[a.dim];return e[i]=e[i]||{},e[i][n]||(e[i][n]=!0),e},{}),t=Object.keys(e).map(t=>Object.keys(e[t]).length);s=Math.max(...t)}return n*s*t},c=i.frames.reduce((e,t)=>e+s(t),0),p=n(r,u);return f+Math.max(c,p)}if("COORDS.RECT"!==h.type){var p=e.getScaleInfo(l,o);return f+n(p,u)}var g=((e,t)=>e.reduce((e,i)=>{var r=(i.key||{})[t];return e[r]=e[r]||[],e[r].push(i),e},{}))(i.frames,r[c].dim),m=Object.keys(g).map(e=>g[e].map(e=>a(t,e.units[0],s,e)).reduce((e,t)=>e+t,0));return f+Math.max(...m)},s=t.settings.size,o=s.width,l=s.height,c=$i[i];if(c){let e=c(s,a,t,Ni.optimizeXAxisLabel);o=e.newW,l=e.newH}return t.settings.size=((i,r,n)=>{var a=t.settings.getScrollbarSize(e.getLayout().contentContainer),s=r.width>i.width&&r.width<=i.width*n?i.width:r.width,o=r.height>i.height&&r.height<=i.height*n?i.height:r.height,l=i.width-s,c=i.height-o>=0?0:a.width;return{height:o-(l>=0?0:a.height),width:s-c}})(s,{width:o,height:l},t.settings.avoidScrollAtRatio),t}}class Bi{constructor(e){this.spec=e,this.isApplicable=e.settings.autoRatio&&Ue(e.unit)}transform(e){var t=this.spec;if(!this.isApplicable)return t;try{this.ruleApplyRatio(t,e)}catch(e){if("Not applicable"!==e.message)throw e}return t}ruleApplyRatio(e,t){var i=e=>"COORDS.RECT"===e.type||"RECT"===e.type,r=(e,t,i,n=0)=>{t(e,n)&&(e.units||[]).map(e=>r(e,t,i,n+1)),i(e,n)},n=[],a=[];r(e.unit,(e,t)=>{if(t>1||!i(e))throw new Error("Not applicable");return n.push(e.x),a.push(e.y),1===(e.units||[]).map(e=>{if(!i(e)&&!(e=>0===e.type.indexOf("ELEMENT."))(e))throw new Error("Not applicable");return e}).filter(i).length},()=>0);var s=t=>e.scales[t],o=e=>"/"===e.source&&!e.ratio&&!e.fitToFrameByDims,l=e=>"ordinal"===e.type||"period"===e.type&&!e.period,c=n.map(s).filter(o),d=a.map(s).filter(o);if([c.length,d.length].some(e=>2===e)){let e=e=>e.dim,i=(t,i,r)=>{t.fitToFrameByDims=r.slice(0,i).map(e)},r=(r,n)=>{2===n.filter(l).length&&(n.forEach(i),n[0].ratio=We(r,n.map(e),t))};r("x",c),r("y",d)}}}class Ii{constructor(e){this.spec=e,this.isApplicable="EXTRACT"===e.settings.layoutEngine&&Ue(e.unit)}transform(){var e=this.spec;if(!this.isApplicable)return e;try{this.ruleExtractAxes(e)}catch(e){if("Not applicable"!==e.message)throw e;console.log("[TauCharts]: can't extract axes for the given chart specification")}return e}ruleExtractAxes(e){var t=e=>"COORDS.RECT"===e.type||"RECT"===e.type,i=e=>e?10:0,r={l:0,r:10,t:10,b:0},n={l:0,b:0},a=[],s=[];Te(e.unit,(e,i)=>{if(i>1||!t(e))throw new Error("Not applicable");e.guide=e.guide||{};var o=e.guide,l=o.padding||{l:0,r:0,t:0,b:0},c=o.paddingNoTicks||{l:0,b:0};return r.l+=l.l,r.r+=l.r,r.t+=l.t,r.b+=l.b,n.l+=c.l,n.b+=c.b,a.push(Object.assign({},r)),s.push(Object.assign({},n)),1===(e.units||[]).map(e=>{if(!t(e)&&!(e=>0===e.type.indexOf("ELEMENT."))(e))throw new Error("Not applicable");return e}).filter(t).length},e=>{var t=a.pop(),o=s.pop(),l=e.guide||{};l.x=l.x||{},l.x.padding=l.x.padding||0,l.x.paddingNoTicks=l.x.paddingNoTicks||0,l.y=l.y||{},l.y.padding=l.y.padding||0,l.y.paddingNoTicks=l.y.paddingNoTicks||0,l.padding={l:i(e.y),r:i(1),t:i(1),b:i(e.x)},l.paddingNoTicks={l:0,b:0},l.autoLayout="extract-axes",l.x.padding+=r.b-t.b,l.y.padding+=r.l-t.l,l.x.paddingNoTicks+=n.b-o.b,l.y.paddingNoTicks+=n.l-o.l}),e.unit.guide.padding=r,e.unit.guide.paddingNoTicks=n}}class ji{constructor({src:e=null,timeout:t=Number.MAX_SAFE_INTEGER,syncInterval:i=Number.MAX_SAFE_INTEGER,callbacks:r={}}={}){this.setTimeoutDuration(t),this.setSyncInterval(i),this.setCallbacks(r),this._running=!1,this._queue=[],this._result=e,this._syncDuration=0,this._asyncDuration=0,this._requestedFrameId=null,this._visibilityChangeHandler=(()=>{if(!this._running||!this._requestedFrameId)return;const e=this._getCancelFrameFunction(),t=this._getRequestFrameFunction();e(this._requestedFrameId),this._requestedFrameId=t(this._requestedFrameCallback)}),this._tasksCount=0,this._finishedTasksCount=0}setTimeoutDuration(e){ji.checkType(e,"number","timeout"),this._timeout=e}setSyncInterval(e){ji.checkType(e,"number","syncInterval"),this._syncInterval=e}setCallbacks(e){ji.checkType(e,"object","callbacks"),this._callbacks=Object.assign(this._callbacks||{},e)}addTask(e){return this._queue.push(e),this._tasksCount++,this}run(){if(this._running)throw new Error("Task Runner is already running");this._running=!0,ji.runnersInProgress++,document.addEventListener("visibilitychange",this._visibilityChangeHandler),this._loopTasks()}isRunning(){return this._running}_loopTasks(){for(var e,t,i,r,n=0,a=this._syncInterval/ji.runnersInProgress;this._running&&!(i=this._asyncDuration>this._timeout)&&!(r=n>a)&&(e=this._queue.shift());){if(null===(t=this._runTask(e)))return;this._syncDuration+=t,this._asyncDuration+=t,n+=t}i&&this._queue.length>0&&(this.stop(),this._callbacks.timeout&&this._callbacks.timeout.call(null,this._asyncDuration,this)),!i&&r&&this._queue.length>0&&this._requestFrame(),0===this._queue.length&&(this.stop(),this._callbacks.done&&this._callbacks.done.call(null,this._result,this))}_runTask(e){var t=performance.now();if(this._callbacks.error)try{this._result=e.call(null,this._result,this)}catch(e){return this.stop(),this._callbacks.error.call(null,e,this),null}else this._result=e.call(null,this._result,this);var i=performance.now()-t;return this._finishedTasksCount++,this._callbacks.progress&&this._callbacks.progress.call(null,this._finishedTasksCount/this._tasksCount,this),i}_requestFrame(){const e=performance.now(),t=()=>{this._requestedFrameId=null;const t=performance.now();this._asyncDuration+=t-e,this._loopTasks()},i=this._getRequestFrameFunction();this._requestedFrameCallback=t,this._requestedFrameId=i(t)}_getRequestFrameFunction(){return document.hidden?e=>(this._requestedFrameType="idle",window.requestIdleCallback(e,{timeout:17})):e=>(this._requestedFrameType="animation",requestAnimationFrame(e))}_getCancelFrameFunction(){switch(this._requestedFrameType){case"animation":return e=>cancelAnimationFrame(e);case"idle":return e=>window.cancelIdleCallback(e)}}stop(){if(!this._running)throw new Error("Task Runner is already stopped");if(this._running=!1,ji.runnersInProgress--,document.removeEventListener("visibilitychange",this._visibilityChangeHandler),this._requestedFrameId){this._getCancelFrameFunction()(this._requestedFrameId),this._requestedFrameId=null}}static checkType(e,t,i){if(typeof e!==t)throw new Error(`Task Runner "${i}" property is not "${t}"`)}}ji.runnersInProgress=0;var Vi=ji;const Hi={...s};var Wi=Lt,Ui=Rt;class Xi extends h{on(e,t,i){return super.on(e,t,i)}constructor(e){super(),this._nodes=[],this._svg=null,this._filtersStore={filters:{},tick:0},this._layout=ai(),this.transformers=[Bi,Oi],this.onUnitsStructureExpandedTransformers=[Ii,zi],this._chartDataModel=(e=>e),this._reportProgress=null,this._taskRunner=null,this._renderingPhase=null,this.applyConfig(e)}updateConfig(e){this.applyConfig(e),this.refresh()}applyConfig(e){this._filtersStore.filters={},e=this.setupConfigSettings(e),this.configGPL=this.createGPLConfig(e),this._originData=Object.assign({},this.configGPL.sources),this._liveSpec=this.configGPL,this._emptyContainer=e.emptyContainer||"",this.setupPlugins(e)}createGPLConfig(e){let t;return this.isGPLConfig(e)?t=e:(e=this.setupConfig(e),t=new si(e).convert()),t=Xi.setupPeriodData(t)}isGPLConfig(e){return 2===["sources","scales"].filter(t=>e.hasOwnProperty(t)).length}setupPlugins(e){const t=e.plugins||[];this._plugins&&this._plugins.destroy(),this._plugins=new Yt(t,this)}setupConfigSettings(e){return this._dataRefs=this._dataRefs||(()=>{let e=0;return{references:new WeakMap,refCounter:()=>++e}})(),e.settings=Xi.setupSettings(st(e.settings||{},this._dataRefs)),e}destroy(){this.destroyNodes(),Hi.select(this._svg).remove(),Hi.select(this._layout.layout).remove(),this._cancelRendering(),super.destroy()}setupChartSourceModel(e){this._chartDataModel=e}setupConfig(e){if(!e.spec||!e.spec.unit)throw new Error("Provide spec for plot");var t=st(e,{spec:{},data:[],plugins:[],settings:{}});t.spec.dimensions=Xi.setupMetaInfo(t.spec.dimensions,t.data);var i=t.settings.log;return t.settings.excludeNull&&this.addFilter({tag:"default",src:"/",predicate:ri.excludeNullValues(t.spec.dimensions,e=>i([e,"point was excluded, because it has undefined values."],"WARN"))}),t}static setupPeriodData(e){var t=Xi.__api__.tickPeriod,i=e.settings.log;return Object.keys(e.scales).map(t=>e.scales[t]).filter(e=>"period"===e.type).forEach(r=>{t.get(r.period,{utc:e.settings.utcTime})||(i([`Unknown period "${r.period}".`,"Docs: https://api.taucharts.com/plugins/customticks.html#how-to-add-custom-tick-period"],"WARN"),r.period=null)}),e}static setupMetaInfo(e,t){var i=e||ri.autoDetectDimTypes(t);return ri.autoAssignScales(i)}static setupSettings(e){var t=Xi.globalSettings,i=st(e||{},Object.keys(t).reduce((e,i)=>(e[i]="function"==typeof t[i]?t[i]:De(t[i]),e),{}));return Array.isArray(i.specEngine)||(i.specEngine=[{width:Number.MAX_VALUE,name:i.specEngine}]),i}insertToLeftSidebar(e){return St(e,this._layout.leftSidebar)}insertToRightSidebar(e){return St(e,this._layout.rightSidebar)}insertToFooter(e){return St(e,this._layout.footer)}insertToHeader(e){return St(e,this._layout.header)}addBalloon(e){return new qt("",e||{})}destroyNodes(){this._nodes.forEach(e=>e.destroy()),this._nodes=[],this._renderedItems=[]}onUnitDraw(e){this._nodes.push(e),this.fire("unitdraw",e),["click","mouseover","mouseout"].forEach(t=>e.on(t,(e,i)=>{this.fire(`element${t}`,{element:e,data:i.data,event:i.event})}))}onUnitsStructureExpanded(e){this.onUnitsStructureExpandedTransformers.forEach(t=>new t(e).transform(this)),this.fire("unitsstructureexpanded",e)}_getClosestElementPerUnit(e,t){return this._renderedItems.filter(e=>e.getClosestElement).map(i=>{var r=i.getClosestElement(e,t);return{unit:i.node(),closest:r}})}disablePointerEvents(){this._layout.layout.style.pointerEvents="none"}enablePointerEvents(){this._layout.layout.style.pointerEvents=""}_handlePointerEvent(e){const t=this._svg.getBoundingClientRect(),i=e.clientX-t.left,r=e.clientY-t.top,n="click"===e.type?"data-click":"data-hover";var a=null,s=null,o=null;const l=this._getClosestElementPerUnit(i,r),c=l.filter(e=>e.closest).sort((e,t)=>e.closest.distance===t.closest.distance?e.closest.secondaryDistance-t.closest.secondaryDistance:e.closest.distance-t.closest.distance);if(c.length>0){const e=c.findIndex(e=>e.closest.distance!==c[0].closest.distance||e.closest.secondaryDistance!==c[0].closest.secondaryDistance),t=e<0?c:c.slice(0,e);if(1===t.length)a=t[0].closest.data,s=t[0].closest.node,o=t[0].unit;else{const e=t.reduce((e,t)=>e+t.closest.x,0)/t.length,n=t.reduce((e,t)=>e+t.closest.y,0)/t.length,l=Math.atan2(n-r,e-i)+Math.PI,c=Math.round((t.length-1)*l/2/Math.PI),{closest:d}=t[c];a=d.data,s=d.node,o=t[c].unit}}l.forEach(t=>t.unit.fire(n,{event:e,data:a,node:s,unit:o}))}_initPointerEvents(){this._liveSpec.settings.syncPointerEvents||(this._pointerAnimationFrameId=null);const e=Hi.select(this._svg),t=this._liveSpec.settings.syncPointerEvents?e=>()=>e(s.event):e=>()=>{var t=s.event;this._pointerAnimationFrameId&&"mousemove"!==t.type&&this._cancelPointerAnimationFrame(),this._pointerAnimationFrameId||(this._pointerAnimationFrameId=requestAnimationFrame(()=>{this._pointerAnimationFrameId=null,e(t)}))},i=e=>this._handlePointerEvent(e);e.on("mousemove",t(i)),e.on("click",t(i)),e.on("mouseleave",t(e=>{"none"!==window.getComputedStyle(this._svg).pointerEvents&&this.select(()=>!0).forEach(t=>t.fire("data-hover",{event:e,data:null,node:null,unit:null}))}))}_cancelPointerAnimationFrame(){cancelAnimationFrame(this._pointerAnimationFrameId),this._pointerAnimationFrameId=null}_setupTaskRunner(e){return this._resetTaskRunner(),this._taskRunner=new Vi({timeout:e.settings.renderingTimeout||Number.MAX_SAFE_INTEGER,syncInterval:e.settings.asyncRendering?e.settings.syncRenderingInterval:Number.MAX_SAFE_INTEGER,callbacks:{done:()=>{this._completeRendering(),this._renderingPhase=null},timeout:(e,t)=>{this._displayTimeoutWarning({timeout:e,proceed:()=>{this.disablePointerEvents(),t.setTimeoutDuration(Number.MAX_SAFE_INTEGER),t.run()},cancel:()=>{this._cancelRendering()}}),this.enablePointerEvents(),this.fire("renderingtimeout",e)},progress:e=>{var t={spec:0,draw:1}[this._renderingPhase]/2+e/2;this._reportProgress(t)},error:e.settings.handleRenderingErrors?t=>{this._cancelRendering(),this._displayRenderingError(t),this.fire("renderingerror",t),e.settings.log(["An error occured during chart rendering.",'Set "handleRenderingErrors: false" in chart settings to debug.',`Error message: ${t.message}`].join(" "),"ERROR")}:null}}),this._taskRunner}_resetTaskRunner(){this._taskRunner&&this._taskRunner.isRunning()&&(this._taskRunner.stop(),this._taskRunner=null)}renderTo(e,t){this._resetProgressLayout(),this.disablePointerEvents(),this._insertLayout(e,t);const i=this._createLiveSpec();if(!i)return this._svg=null,this._layout.content.innerHTML=this._emptyContainer,void this.enablePointerEvents();var r=this._createGPL(i),n=this._setupTaskRunner(i);this._scheduleDrawScenario(n,r),this._scheduleDrawing(n,r),n.run()}_insertLayout(e,t){this._target=e,this._defaultSize=Object.assign({},t);var i=Hi.select(e).node();if(null===i)throw new Error("Target element not found");this._layout.layout.parentNode!==i&&i.appendChild(this._layout.layout);var r=this._layout.content,n=Tt(this._layout.contentContainer);this._layout.contentContainer.style.padding=`0 ${n.width}px ${n.height}px 0`,Mt(this._layout.rightSidebarContainer,"vertical");var a=Object.assign({},t)||{};if(!a.width||!a.height){let{scrollLeft:e,scrollTop:t}=r.parentElement;r.style.display="none",a=st(a,At(r.parentNode)),r.style.display="",r.parentElement.scrollLeft=e,r.parentElement.scrollTop=t,a.height||(a.height=At(this._layout.layout).height)}this.configGPL.settings.size=a}_createLiveSpec(){return this._liveSpec=De(ot(this.configGPL,"plugins")),this._liveSpec.sources=this.getDataSources(),this._liveSpec.settings=this.configGPL.settings,this._experimentalSetupAnimationSpeed(this._liveSpec),this.isEmptySources(this._liveSpec.sources)?null:(this._liveSpec=this.transformers.reduce((e,t)=>new t(e).transform(this),this._liveSpec),this.destroyNodes(),this.fire("specready",this._liveSpec),this._liveSpec)}_experimentalSetupAnimationSpeed(e){e.settings.initialAnimationSpeed=e.settings.initialAnimationSpeed||e.settings.animationSpeed;const t=e.settings.experimentalShouldAnimate(e)?e.settings.initialAnimationSpeed:0;e.settings.animationSpeed=t;const i=e=>{e.guide=e.guide||{},e.guide.animationSpeed=t,e.units&&e.units.forEach(i)};i(e.unit)}_createGPL(e){var t=new Ut(e,this.getScaleFactory(),Qt,_),i=t.unfoldStructure();return this.onUnitsStructureExpanded(i),t}_scheduleDrawScenario(e,t){const i=Hi.select(this._layout.content),r=t.config.settings.size;e.addTask(()=>this._renderingPhase="spec"),t.getDrawScenarioQueue({allocateRect:()=>({slot:e=>i.selectAll(`.uid_${e}`),frameId:"root",left:0,top:0,width:r.width,containerWidth:r.width,height:r.height,containerHeight:r.height})}).forEach(t=>e.addTask(t))}_scheduleDrawing(e,t){const i=t.config.settings.size;e.addTask(e=>{this._renderingPhase="draw",this._renderRoot({scenario:e,newSize:i}),this._cancelPointerAnimationFrame(),this._scheduleRenderScenario(e)})}_resetProgressLayout(){this._createProgressBar(),this._clearRenderingError(),this._clearTimeoutWarning()}_renderRoot({scenario:e,newSize:t}){const i=Hi.select(this._layout.content);var r=e[0].config.uid,n=Wi(i,"svg").attr("width",Math.floor(t.width)).attr("height",Math.floor(t.height));n.attr("class")||n.attr("class",`${O}svg`),this._svg=n.node(),this._initPointerEvents(),this.fire("beforerender",this._svg);var a=n.selectAll("g.frame-root").data([r],e=>e);a.enter().append("g").classed(`${O}cell cell frame-root uid_${r}`,!0).merge(a).call(e=>{e.classed("tau-active",!0),he(e,this.configGPL.settings.animationSpeed,"frameRootToggle").attr("opacity",1)}),a.exit().call(e=>{e.classed("tau-active",!1),he(e,this.configGPL.settings.animationSpeed,"frameRootToggle").attr("opacity",1e-6).remove()})}_scheduleRenderScenario(e){e.forEach(e=>{this._taskRunner.addTask(()=>{e.draw(),this.onUnitDraw(e.node()),this._renderedItems.push(e)})})}_completeRendering(){Mt(this._layout.contentContainer),this._layout.rightSidebar.style.maxHeight=`${this._liveSpec.settings.size.height}px`,this.enablePointerEvents(),this._svg&&this.fire("render",this._svg),Mt(this._layout.rightSidebarContainer,"vertical")}_cancelRendering(){this.enablePointerEvents(),this._resetTaskRunner(),this._cancelPointerAnimationFrame()}_createProgressBar(){var e=Hi.select(this._layout.header),t=Wi(e,`div.${O}progress`);t.select(`div.${O}progress__value`).remove();var i=t.append("div").classed(`${O}progress__value`,!0).style("width",0);this._reportProgress=function(e){requestAnimationFrame(()=>{t.classed(`${O}progress_active`,e<1),i.style("width",`${100*e}%`)})}}_displayRenderingError(e){this._layout.layout.classList.add(`${O}layout_rendering-error`)}_clearRenderingError(){this._layout.layout.classList.remove(`${O}layout_rendering-error`)}getScaleFactory(e=null){return new ii(ti.instance(this._liveSpec.settings),e||this._liveSpec.sources,this._liveSpec.scales)}getScaleInfo(e,t=null){return this.getScaleFactory().createScaleInfoByName(e,t)}getSourceFiltersIterator(e){var t=tt(Object.keys(this._filtersStore.filters).map(e=>this._filtersStore.filters[e])).filter(t=>!e(t)).map(e=>e.predicate);return e=>t.reduce((t,i)=>t&&i(e),!0)}getDataSources(e={}){var t=this._chartDataModel(this._originData);return Object.keys(t).filter(e=>"?"!==e).reduce((i,r)=>{var n=t[r],a=this.getSourceFiltersIterator((t=>i=>e.excludeFilter&&-1!==e.excludeFilter.indexOf(i.tag)||i.src!==t)(r));return i[r]={dims:n.dims,data:n.data.filter(a)},i},{"?":t["?"]})}isEmptySources(e){return!Object.keys(e).filter(e=>"?"!==e).filter(t=>e[t].data.length>0).length}getChartModelData(e={},t="/"){return this.getDataSources(e)[t].data}getDataDims(e="/"){return this._originData[e].dims}getData(e="/"){return this._originData[e].data}setData(e,t="/"){this._originData[t].data=e,this.refresh()}getSVG(){return this._svg}addFilter(e){e.src=e.src||"/";var t=e.tag,i=this._filtersStore.filters[t]=this._filtersStore.filters[t]||[],r=this._filtersStore.tick++;return e.id=r,i.push(e),r}removeFilter(e){return Object.keys(this._filtersStore.filters).map(t=>{this._filtersStore.filters[t]=this._filtersStore.filters[t].filter(t=>t.id!==e)}),this}refresh(){this._target&&this.renderTo(this._target,this._defaultSize)}resize(e={}){this.renderTo(this._target,e)}select(e){return this._nodes.filter(e)}traverseSpec(e,t){var i=(e,t,r,n)=>{t(e,r,n),e.frames?e.frames.forEach(r=>{(r.units||[]).map(n=>i(n,t,e,r))}):(e.units||[]).map(r=>i(r,t,e,null))};i(e.unit,t,null,null)}getSpec(){return this._liveSpec}getLayout(){return this._layout}_displayTimeoutWarning({proceed:e,cancel:t,timeout:i}){var r=Math.round(100/3/1.5),n=function(e){return Math.round(100/3/1.5*e)};this._layout.content.style.height="100%",this._layout.content.insertAdjacentHTML("beforeend",`\n            <div class="${O}rendering-timeout-warning">\n            <svg\n                viewBox="0 0 200 100">\n                <text\n                    text-anchor="middle"\n                    font-size="${r}">\n                    <tspan x="100" y="${n(1)}">Rendering took more than ${Math.round(i)/1e3}s</tspan>\n                    <tspan x="100" y="${n(2)}">Would you like to continue?</tspan>\n                </text>\n                <text\n                    class="${O}rendering-timeout-continue-btn"\n                    text-anchor="end"\n                    font-size="${r}"\n                    cursor="pointer"\n                    text-decoration="underline"\n                    x="${100-r/3}"\n                    y="${n(3)}">\n                    Continue\n                </text>\n                <text\n                    class="${O}rendering-timeout-cancel-btn"\n                    text-anchor="start"\n                    font-size="${r}"\n                    cursor="pointer"\n                    text-decoration="underline"\n                    x="${100+r/3}"\n                    y="${n(3)}">\n                    Cancel\n                </text>\n            </svg>\n            </div>\n        `),this._layout.content.querySelector(`.${O}rendering-timeout-continue-btn`).addEventListener("click",()=>{this._clearTimeoutWarning(),e.call(this)}),this._layout.content.querySelector(`.${O}rendering-timeout-cancel-btn`).addEventListener("click",()=>{this._clearTimeoutWarning(),t.call(this)})}_clearTimeoutWarning(){var e=Ui(this._layout.content,`.${O}rendering-timeout-warning`);e&&(this._layout.content.removeChild(e),this._layout.content.style.height="")}}var Gi={},qi={},Yi=e=>{let t=`Chart type ${e} is not supported.`;throw console.log(t),console.log(`Use one of ${Object.keys(Gi).join(", ")}.`),new y(t,v.NOT_SUPPORTED_TYPE_CHART)},Ki={validate:(e,t)=>(qi.hasOwnProperty(e)||Yi(e),qi[e].reduce((e,i)=>e.concat(i(t)||[]),[])),get(e){var t=Gi[e];return"function"!=typeof t&&Yi(e),t},add:(e,t,i=[])=>(Gi[e]=t,qi[e]=i,Ki),getAllRegisteredTypes:()=>Gi};class Ji extends Xi{constructor(e){super(e),e.autoResize&&Ji.winAware.push(this)}applyConfig(e){var t=Ki.validate(e.type,e);if(t.length>0)throw new Error(t[0]);var i=Ki.get(e.type);(e=st(e,{autoResize:!0})).settings=Xi.setupSettings(e.settings),e.dimensions=Xi.setupMetaInfo(e.dimensions,e.data),super.applyConfig(i(e))}destroy(){var e=Ji.winAware.indexOf(this);-1!==e&&Ji.winAware.splice(e,1),super.destroy()}}Ji.winAware=[],Ji.resizeOnWindowEvent=function(){let e;function t(){e=0;for(let e=0,t=Ji.winAware.length;e<t;e++)Ji.winAware[e].resize()}return function(){!e&&Ji.winAware.length&&(e=window.requestAnimationFrame(t))}}(),window.addEventListener("resize",Ji.resizeOnWindowEvent);var Qi=Lt;const Zi=e=>{const t=e<=20?1:.75;return Math.max(2,Math.round(e*t))};const er={...i(11),...i(8),...s};var tr=i(12);var ir=i(4),rr=function(){var e,t=[],i=[],r=1,n=1,a={},s=!1,o=function(e){var r=t.length,n=0,a=t[e].x-i[e].x,s=i[e].y-t[e].y,o=Math.sqrt(a*a+s*s);o>0&&(n+=.2*o),s/=o,n+=(a/=o)>0&&s>0?0:a<0&&s>0?3:a<0&&s<0?6:9;for(var l,c,u,h,f=t[e].x,p=t[e].y-t[e].height+2,g=t[e].x+t[e].width,m=t[e].y+2,b=0;b<r;b++)b!=e&&(d(i[e].x,t[e].x,i[b].x,t[b].x,i[e].y,t[e].y,i[b].y,t[b].y)&&(n+=1),l=t[b].x,u=t[b].y-t[b].height+2,c=t[b].x+t[b].width,h=t[b].y+2,n+=30*(Math.max(0,Math.min(c,g)-Math.max(l,f))*Math.max(0,Math.min(h,m)-Math.max(u,p)))),l=i[b].x-i[b].r,u=i[b].y-i[b].r,c=i[b].x+i[b].r,h=i[b].y+i[b].r,n+=30*(Math.max(0,Math.min(c,g)-Math.max(l,f))*Math.max(0,Math.min(h,m)-Math.max(u,p)));return n},l=function(a){var l,c=Math.floor(Math.random()*t.length),d=t[c].x,u=t[c].y;l=s?e(c,t,i):o(c),t[c].x+=5*(Math.random()-.5),t[c].y+=5*(Math.random()-.5),t[c].x>r&&(t[c].x=d),t[c].x<0&&(t[c].x=d),t[c].y>n&&(t[c].y=u),t[c].y<0&&(t[c].y=u);var h=(s?e(c,t,i):o(c))-l;Math.random()<Math.exp(-h/a)?1:(t[c].x=d,t[c].y=u,1)},c=function(a){var l,c=Math.floor(Math.random()*t.length),d=t[c].x,u=t[c].y;l=s?e(c,t,i):o(c);var h=.5*(Math.random()-.5),f=Math.sin(h),p=Math.cos(h);t[c].x-=i[c].x,t[c].y-=i[c].y;var g=t[c].x*p-t[c].y*f,m=t[c].x*f+t[c].y*p;t[c].x=g+i[c].x,t[c].y=m+i[c].y,t[c].x>r&&(t[c].x=d),t[c].x<0&&(t[c].x=d),t[c].y>n&&(t[c].y=u),t[c].y<0&&(t[c].y=u);var b=(s?e(c,t,i):o(c))-l;Math.random()<Math.exp(-b/a)?1:(t[c].x=d,t[c].y=u,1)},d=function(e,t,i,r,n,a,s,o){var l,c,d;return c=((t-e)*(n-s)-(a-n)*(e-i))/(d=(o-s)*(t-e)-(r-i)*(a-n)),!((l=((r-i)*(n-s)-(o-s)*(e-i))/d)<0||l>1||c<0||c>1)},u=function(e,t,i){return e-t/i};return a.start=function(e){for(var i=t.length,r=1,n=0;n<e;n++){for(var a=0;a<i;a++)Math.random()<.5?l(r):c(r);r=u(r,1,e)}},a.width=function(e){return arguments.length?(r=e,a):r},a.height=function(e){return arguments.length?(n=e,a):n},a.label=function(e){return arguments.length?(t=e,a):t},a.anchor=function(e){return arguments.length?(i=e,a):i},a.alt_energy=function(t){return arguments.length?(e=t,s=!0,a):o},a.alt_schedule=function(){return arguments.length?a:u},a};const nr={...o,...tr,...s},ar=5.5,sr=10,or=.5;var lr=["land","continents","georegions","countries","regions","subunits","states","counties"];var cr=e=>()=>e;class dr{constructor(e){this.model=e.model,this.x=e.x||cr(0),this.y=e.y||cr(0),this.dx=e.dx||cr(0),this.dy=e.dy||cr(0),this.w=e.w||cr(0),this.h=e.h||cr(0),this.hide=e.hide||cr(!1),this.label=e.label||cr(""),this.color=e.color||cr(""),this.angle=e.angle||cr(0),this.labelLinesAndSeparator=e.labelLinesAndSeparator||cr({lines:[],linesWidths:[],separator:""})}static seed(e,{fontColor:t,flip:i,formatter:r,labelRectSize:n,paddingKoeff:a=.5,lineBreakAvailable:s,lineBreakSeparator:o}){var l=i?e.yi:e.xi,c=i?e.xi:e.yi,d=t=>r(e.label(t)),u=e=>{const t=s?d(e).split(o):[d(e)];return{lines:t,linesWidths:t.map(e=>n([e]).width),separator:o}};return new dr({model:e,x:e=>l(e),y:e=>c(e),dy:e=>n(u(e).lines).height*a,w:e=>n(u(e).lines).width,h:e=>n(u(e).lines).height,label:d,labelLinesAndSeparator:u,color:()=>t,angle:()=>0})}static compose(e,t={}){return Object.keys(t).reduce((e,i)=>(e[i]=t[i],e),new dr(e))}}var ur={};class hr{static regRule(e,t){return ur[e]=t,this}static getRule(e){return ur[e]}}const fr=({lines:e,linesWidths:t,separator:i},r)=>e.map(function(e,i){const n=((e,t,i)=>i<t?Math.max(1,Math.floor(i*e.length/t))-1:e.length)(e,t[i],r);return n<e.length?((e,t)=>0===t?"":e.slice(0,t).replace(/\.+$/g,"")+"…")(e,n):e}).join(i);var pr=(e,t)=>{var i=5-(e.labelLinesAndSeparator(t).lines.length-1);return i<1?1:i},gr=(e,t)=>e.discrete||!e.discrete&&t[e.dim]>=0,mr=(e,t)=>!e.discrete&&t[e.dim]<0,br=(e,t)=>e.w(t)/2+Math.floor(e.model.size(t)/pr(e,t)),yr=(e,t)=>e.h(t)/2+Math.floor(e.model.size(t)/pr(e,t)),vr=e=>t=>({dx:i=>{var r=t.model.scaleY;if("+"===e[2]&&!gr(r,i))return t.dx(i);if("-"===e[2]&&!mr(r,i))return t.dx(i);var n=e[1],a=e[0]===e[0].toUpperCase()?1:0;return t.dx(i)+n*a*t.model.size(i)/2+n*br(t,i)}}),xr=e=>t=>({dy:i=>{var r=t.model.scaleY;if("+"===e[2]&&!gr(r,i))return t.dy(i);if("-"===e[2]&&!mr(r,i))return t.dy(i);var n=e[1],a=e[0]===e[0].toUpperCase()?1:0;return t.dy(i)+n*a*t.model.size(i)/2+n*yr(t,i)}});hr.regRule("l",vr(["l",-1,null])).regRule("L",vr(["L",-1,null])).regRule("l+",vr(["l",-1,"+"])).regRule("l-",vr(["l",-1,"-"])).regRule("L+",vr(["L",-1,"+"])).regRule("L-",vr(["L",-1,"-"])).regRule("r",vr(["r",1,null])).regRule("R",vr(["R",1,null])).regRule("r+",vr(["r",1,"+"])).regRule("r-",vr(["r",1,"-"])).regRule("R+",vr(["R",1,"+"])).regRule("R-",vr(["R",1,"-"])).regRule("t",xr(["t",-1,null])).regRule("T",xr(["T",-1,null])).regRule("t+",xr(["t",-1,"+"])).regRule("t-",xr(["t",-1,"-"])).regRule("T+",xr(["T",-1,"+"])).regRule("T-",xr(["T",-1,"-"])).regRule("b",xr(["b",1,null])).regRule("B",xr(["B",1,null])).regRule("b+",xr(["b",1,"+"])).regRule("b-",xr(["b",1,"-"])).regRule("B+",xr(["B",1,"+"])).regRule("B-",xr(["B",1,"-"])).regRule("rotate-on-size-overflow",(e,{data:t,lineBreakAvailable:i})=>{var r={};if(t.reduce((t,i)=>t+((t=>e.model.size(t)<e.w(t))(i)?1:0),0)/t.length>.5){var n=i?-.5:.5;r={angle:()=>-90,w:t=>e.h(t),h:t=>e.w(t),dx:t=>e.h(t)*n-2,dy:()=>0}}return r}).regRule("hide-by-label-height-vertical",e=>({hide:t=>{let i,r;return 0===e.angle(t)?(r=e.h(t),i=Math.abs(e.model.y0(t)-e.model.yi(t))):(r=e.w(t),i=e.model.size(t)),r>i||e.hide(t)}})).regRule("cut-label-vertical",e=>({h:t=>{const i=e.h(t);if(Math.abs(e.angle(t))>0){const r=Math.abs(e.model.y0(t)-e.model.yi(t));return r<i?r:i}return i},w:t=>{const i=e.w(t);if(0===e.angle(t)){const r=e.model.size(t);return r<i?r:i}return i},label:t=>{let i;return i=0===e.angle(t)?e.model.size(t):Math.abs(e.model.y0(t)-e.model.yi(t)),fr(e.labelLinesAndSeparator(t),i)},dy:t=>{const i=e.dy(t);if(0!==e.angle(t)){const r=e.h(t),n=Math.abs(e.model.y0(t)-e.model.yi(t));return n<r?n*i/r:i}return i}})).regRule("cut-outer-label-vertical",e=>({h:(t,i)=>{const r=e.h(t);if(Math.abs(e.angle(t))>0){const n=e.model.y0(t)<e.model.yi(t)?i.maxHeight-e.model.yi(t):e.model.yi(t);return n<r?n:r}return r},w:t=>{const i=e.w(t);if(0===e.angle(t)){const r=e.model.size(t);return r<i?r:i}return i},label:(t,i)=>{let r;return r=0===e.angle(t)?e.model.size(t):e.model.y0(t)<e.model.yi(t)?i.maxHeight-e.model.yi(t):e.model.yi(t),fr(e.labelLinesAndSeparator(t),r)},dy:(t,i)=>{const r=e.dy(t);if(0!==e.angle(t)){const n=e.h(t),a=e.model.y0(t)<e.model.yi(t)?i.maxHeight-e.model.yi(t):e.model.yi(t);return a<n?a*r/n:r}return r}})).regRule("from-beginning",e=>{var t=t=>e.model.y0(t);return e.model.flip?{x:t}:{y:t}}).regRule("to-end",e=>{var t=t=>e.model.yi(t);return e.model.flip?{x:t}:{y:t}}).regRule("towards",e=>{var t=e.model.flip?br:yr,i=i=>((e,t)=>e.model.yi(t)-e.model.y0(t)>=0?1:-1)(e,i)*t(e,i);return e.model.flip?{dx:i}:{dy:i}}).regRule("inside-start-then-outside-end-horizontal",(e,t)=>{var i=[hr.getRule("from-beginning"),hr.getRule("towards"),hr.getRule("cut-label-horizontal")].reduce((e,i)=>dr.compose(e,i(e,t)),e),r=[hr.getRule("to-end"),hr.getRule("towards"),hr.getRule("cut-outer-label-horizontal")].reduce((e,i)=>dr.compose(e,i(e,t)),e);return Object.assign({},i,["x","dx","hide","label"].reduce((e,t)=>(e[t]=(e=>((e=>i.label(e).length>=r.label(e).length)(e)?i:r)[t](e)),e),{}))}).regRule("inside-start-then-outside-end-vertical",(e,t)=>{var i=[hr.getRule("from-beginning"),hr.getRule("towards"),hr.getRule("cut-label-vertical")].reduce((e,i)=>dr.compose(e,i(e,t)),e),r=[hr.getRule("to-end"),hr.getRule("towards"),hr.getRule("cut-outer-label-vertical")].reduce((e,i)=>dr.compose(e,i(e,t)),e);return Object.assign({},i,["y","dy","hide","label"].reduce((e,t)=>(e[t]=(e=>((e=>i.label(e).length>=r.label(e).length)(e)?i:r)[t](e)),e),{}))}).regRule("outside-then-inside-horizontal",(e,t)=>{var i=["r+","l-","cut-outer-label-horizontal"].map(hr.getRule).reduce((e,i)=>dr.compose(e,i(e,t)),e),r=["r-","l+","hide-by-label-height-horizontal","cut-label-horizontal"].map(hr.getRule).reduce((e,i)=>dr.compose(e,i(e,t)),e);return Object.assign({},i,["x","dx","hide","label"].reduce((e,t)=>(e[t]=(e=>((e=>r.label(e).length>i.label(e).length)(e)?r:i)[t](e)),e),{}))}).regRule("outside-then-inside-vertical",(e,t)=>{var i=["t+","b-","cut-outer-label-vertical"].map(hr.getRule).reduce((e,i)=>dr.compose(e,i(e,t)),e),r=["t-","b+","hide-by-label-height-vertical","cut-label-vertical"].map(hr.getRule).reduce((e,i)=>dr.compose(e,i(e,t)),e);return Object.assign({},i,["y","dy","hide","label"].reduce((e,n)=>(e[n]=(e=>((e=>{var r=i.y(e,t)+i.dy(e,t);return r<=0||r>=t.maxHeight})(e)?r:i)[n](e,t)),e),{}))}).regRule("hide-by-label-height-horizontal",e=>({hide:t=>e.model.size(t)<e.h(t)||e.hide(t)})).regRule("cut-label-horizontal",e=>({dx:t=>{const i=e.w(t),r=Math.abs(e.model.y0(t)-e.model.yi(t)),n=e.dx(t);return r<i?r*n/i:n},w:t=>{const i=e.w(t),r=Math.abs(e.model.y0(t)-e.model.yi(t));return r<i?r:i},label:t=>{const i=Math.abs(e.model.y0(t)-e.model.yi(t));return fr(e.labelLinesAndSeparator(t),i)}})).regRule("cut-outer-label-horizontal",(e,t)=>({dx:i=>{const r=e.w(i),n=e.model.y0(i)<e.model.yi(i)?t.maxWidth-e.model.yi(i):e.model.yi(i),a=e.dx(i);return n<r?n*a/r:a},w:i=>{const r=e.w(i),n=e.model.y0(i)<e.model.yi(i)?t.maxWidth-e.model.yi(i):e.model.yi(i);return n<r?n:r},label:i=>{const r=e.model.y0(i)<e.model.yi(i)?t.maxWidth-e.model.yi(i):e.model.yi(i);return fr(e.labelLinesAndSeparator(i),r)}})).regRule("keep-within-diameter-or-top",e=>({dy:t=>e.model.size(t)/e.w(t)<1?e.dy(t)-e.h(t)/2-e.model.size(t)/2:e.dy(t)})).regRule("keep-in-box",(e,{maxWidth:t,maxHeight:i})=>({dx:i=>{var r=e.dx(i),n=e.x(i)+r,a=e.w(i),s=0-(n-a/2);if(s>0)return r+s;var o=n+a/2-t;return o>0?r-o:r},dy:t=>{var r=e.dy(t),n=e.y(t)+r,a=e.h(t);if(0-(n-a/2)>0)return 0;var s=n+a/2-i;return s>0?r-s:r}})).regRule("multiline-label-left-align",e=>({dy:t=>{const i=e.dy(t);return-90===e.angle(t)?i+e.h(t)/2:i}})).regRule("multiline-label-vertical-center-align",e=>({dy:t=>e.dy(t)-e.h(t)/2})).regRule("multiline-hide-on-container-overflow",(e,{maxWidth:t,maxHeight:i})=>({hide:r=>{var n=e.angle(r),a=e.x(r)+e.dx(r),s=e.y(r)+e.dy(r);return!(!Ze(a,e.w(r),n,t)&&!et(s,e.h(r),n,i))||e.hide(r)}}));class _r{constructor(e){this.minError=Number.MAX_VALUE,this.items=e.items,this.revision=this.items.map(e=>({i:e.i,x:e.x,y:e.y})),this.penalties=e.penalties,this.transactor=e.transactor,this.cooling_schedule=e.cooling_schedule||((e,t,i)=>e-t/i)}energy(e){return this.penalties.reduce((t,i)=>t+i(e),0)}move(e){const t=Math.floor(Math.random()*this.items.length),i=this.transactor(this.items[t]),r=this.energy(t);this.items[t]=i.modify();const n=this.energy(t),a=n-r,s=a<0?1:Math.exp(-a/e);Math.random()>=s?this.items[t]=i.revert():n<this.minError&&(this.minError=n,this.revision=this.items.map(e=>({i:e.i,x:e.x,y:e.y})))}start(e){var t=1;const i=this.items.length;e:for(let r=0;r<e;r++){for(let e=0;e<i;e++)if(this.move(t),this.minError<=10)break e;t=this.cooling_schedule(t,1,e)}return this.revision}}var wr=(e,t,i,r,n,a,s,o)=>C(e,n,t,a,i,s,r,o);const Er={};class Sr{static reg(e,t){return Er[e]=t,this}static get(e){return Er[e]}}Sr.reg("auto:avoid-label-label-overlap",(e,t,i=1)=>t=>{var r=e[t].x,n=e[t].y-e[t].h+2,a=e[t].x+e[t].w,s=e[t].y+2;return e.reduce((e,o,l)=>{var c=Number(l!==t),d=o.x,u=o.y-o.h+2,h=o.x+o.w,f=o.y+2;return e+c*(Math.max(0,Math.min(h,a)-Math.max(d,r))*Math.max(0,Math.min(f,s)-Math.max(u,n))*i)},0)}).reg("auto:avoid-label-anchor-overlap",(e,t,i=1)=>t=>{var r=e[t],n=r.x-r.w/2,a=r.x+r.w/2,s=r.y-r.h/2+2,o=r.y+r.h/2+2;return e.reduce((e,t)=>{var r=t.x0-t.size/2,l=t.x0+t.size/2,c=t.y0-t.size/2,d=t.y0+t.size/2;return e+Math.max(0,Math.min(l,a)-Math.max(r,n))*Math.max(0,Math.min(d,o)-Math.max(c,s))*i},0)}).reg("auto:avoid-label-edges-overlap",(e,t,i=1)=>r=>{var n=e[r],a=n.x-n.w/2,s=n.x+n.w/2,o=n.y-n.h/2,l=n.y+n.h/2;return t.reduce((e,t)=>{var r=wr(a,s,t.x0,t.x1,o,l,t.y0,t.y1),n=wr(a,s,t.x0,t.x1,l,o,t.y0,t.y1);return e+(Number(r)+Number(n))*i},0)});var Tr=(e,t,i,r,n,a,s,o)=>C(e,n,t,a,i,s,r,o);class Mr{constructor(e,t,i,{width:r,height:n,container:a}){this.container=a,this.model=e,this.flip=t,this.w=r,this.h=n,this.guide=st(i||{},{fontFamily:"Helvetica Neue, Segoe UI, Open Sans, Ubuntu, sans-serif",fontWeight:"normal",fontSize:10,fontColor:"#000",hideEqualLabels:!1,lineBreak:!1,lineBreakSeparator:"",position:[],tickFormat:null,tickFormatNullAlias:""})}draw(e){var t=this,i=this.model,r=this.guide,n=r.lineBreak,a=r.lineBreakSeparator,o=dr.seed(i,{fontColor:r.fontColor,flip:t.flip,formatter:fi.get(r.tickFormat,r.tickFormatNullAlias),labelRectSize:e=>Ot(e,r),lineBreakAvailable:n,lineBreakSeparator:a,paddingKoeff:n?0:.5}),l={lineBreakAvailable:n,maxWidth:t.w,maxHeight:t.h,data:e.reduce((e,t)=>e.concat(t),[])},c=this.applyFixedPositionRules(r,l,o,n,this.flip),d=e.reduce((e,t)=>{var i=t.map(e=>({data:e,x:c.x(e)+c.dx(e),y:c.y(e)+c.dy(e),w:c.w(e),h:c.h(e,l),hide:c.hide(e),extr:null,size:c.model.size(e),angle:c.angle(e),label:c.label(e),labelLinesAndSeparator:c.labelLinesAndSeparator(e),color:c.color(e)}));return e.text=e.text.concat(i),e.edges=e.edges.concat(((e,t)=>{for(var i=e.length-1,r=[],n=0;n<=i;n++){var a=0===n?n:n-1,s=n,o=n===i?n:n+1;r.push(t(e[a],e[s],e[o]))}return r})(i,(e,t,i)=>(t.y===Math.max(t.y,e.y,i.y)?t.extr="min":t.y===Math.min(t.y,e.y,i.y)?t.extr="max":t.extr="norm",{x0:e.x,x1:t.x,y0:e.y,y1:t.y}))),e},{text:[],edges:[]});d.text=d.text.filter(e=>e.label).map((e,t)=>Object.assign(e,{i:t}));var u=n?["auto:hide-on-label-label-overlap","auto:adjust-on-multiline-label-overflow"]:this.guide.position,h=u.filter(e=>0===e.indexOf("auto:avoid"));d=d.text.length>0&&h.length>0?this.autoPosition(d,h):d;var f=u.reduce((e,t)=>Object.assign(e,{[t]:!0}),{});d.text=d.text=f["auto:adjust-on-label-overflow"]?this.adjustOnOverflow(d.text,l):d.text,d.text=d.text=f["auto:adjust-on-multiline-label-overflow"]?this.adjustOnMultilineOverflow(d.text,l):d.text,d.text=f["auto:hide-on-label-edges-overlap"]?this.hideOnLabelEdgesOverlap(d.text,d.edges):d.text,d.text=f["auto:hide-on-label-label-overlap"]?this.hideOnLabelLabelOverlap(d.text):d.text,d.text=f["auto:hide-on-label-anchor-overlap"]?this.hideOnLabelAnchorOverlap(d.text):d.text;var p=d.text,g=e=>(t,i)=>p[i][e],m=g("x"),b=g("y"),y=g("angle"),v=g("color"),x=g("label"),_=function(e){if(e.style("fill",v).style("font-size",`${t.guide.fontSize}px`).style("display",(e,t)=>p[t].hide?"none":null).attr("class","i-role-label").attr("text-anchor","middle").attr("transform",(e,t)=>`translate(${m(e,t)},${b(e,t)}) rotate(${y(e,t)})`),n){e.each(function(e,t){var i=s.select(this),r=y(e,t);i.text(null),x(e,t).split(a).forEach(function(e,t){i.append("tspan").attr("text-anchor",0!==r?"start":"middle").attr("x",0).attr("y",0).attr("dy",1.2*(t+1)+"em").text(e)})})}else e.text(x)};r.hideEqualLabels&&p.filter(e=>!e.hide).filter((e,t,i)=>t<i.length-1&&e.label===i[t+1].label).forEach(e=>e.hide=!0);var w=this.container.selectAll(".i-role-label").data(p.map(e=>e.data));return w.exit().remove(),w.call(_),w.enter().append("text").call(_),w}applyFixedPositionRules(e,t,i,r,n){var a=e.position.filter(e=>-1===e.indexOf("auto:"));return r&&(n&&a.push("multiline-label-vertical-center-align"),a.push("multiline-label-left-align","multiline-hide-on-container-overflow")),a.map(hr.getRule).reduce((e,i)=>dr.compose(e,i(e,t)),i)}autoPosition(e,t){const i=(e,t)=>{const i=4+(e.size+e.w)/2,r=2+(e.size+e.h)/2;return{x:i*Math.cos(t),y:r*Math.sin(t)}};var r=e.edges,n=e.text.map(e=>{const t={max:-Math.PI/2,min:Math.PI/2,norm:Math.random()*Math.PI*2},r=i(e,t[e.extr]);return{i:e.i,x0:e.x,y0:e.y,x:e.x+r.x,y:e.y+r.y,w:e.w,h:e.h,size:e.size,hide:e.hide,extr:e.extr}}).filter(e=>!e.hide);const a=new _r({items:n,transactor:e=>{const t=e.x,r=e.y;return{modify:()=>{const t={max:-Math.PI,min:Math.PI,norm:2*Math.PI}[e.extr],r=t/4+Math.random()*(2*t)/4,n=i(e,r);return e.x=e.x0+n.x,e.y=e.y0+n.y,e},revert:()=>(e.x=t,e.y=r,e)}},penalties:t.map(e=>Sr.get(e)).filter(e=>e).map(e=>e(n,r))}).start(5);return e.text=a.reduce((e,t)=>{var i=e[t.i];return i.x=t.x,i.y=t.y,e},e.text),e}hideOnLabelEdgesOverlap(e,t){const i=(e,t)=>{const i=this.getLabelRect(e);return t.reduce((e,t)=>{var r=Tr(i.x0,i.x1,t.x0,t.x1,i.y0,i.y1,t.y0,t.y1),n=Tr(i.x0,i.x1,t.x0,t.x1,i.y1,i.y0,t.y0,t.y1);return e+2*(Number(r)+Number(n))},0)};return e.filter(e=>!e.hide).forEach(e=>{i(e,t)>0&&(e.hide=!0)}),e}hideOnLabelLabelOverlap(e){var t={min:0,max:1,norm:2},i={"min/min":(e,t)=>t.y-e.y,"max/max":(e,t)=>e.y-t.y,"min/max":()=>-1,"min/norm":()=>-1,"max/norm":()=>-1,"norm/norm":(e,t)=>e.y-t.y},r=(e,r)=>{var n=this.getLabelRect(e),a=this.getLabelRect(r),s=Number(!e.hide&&!r.hide);if(s*Math.max(0,Math.min(a.x1,n.x1)-Math.max(n.x0,a.x0))*(s*Math.max(0,Math.min(a.y1,n.y1)-Math.max(n.y0,a.y0)))>0){let n=[e,r];n.sort((e,i)=>t[e.extr]-t[i.extr]),(i[`${n[0].extr}/${n[1].extr}`](n[0],n[1])<0?n[0]:n[1]).hide=!0}};return e.filter(e=>!e.hide).sort((e,i)=>t[e.extr]-t[i.extr]).forEach(t=>{e.forEach(e=>{t.i!==e.i&&r(t,e)})}),e}getLabelRect(e,t=0){return{x0:e.x-e.w/2-t,x1:e.x+e.w/2+t,y0:e.y-e.h/2-t,y1:e.y+e.h/2+t}}getPointRect(e,t=0){return{x0:e.x-e.size/2-t,x1:e.x+e.size/2+t,y0:e.y-e.size/2-t,y1:e.y+e.size/2+t}}hideOnLabelAnchorOverlap(e){var t=(e,t)=>{const i=this.getLabelRect(e,2),r=this.getPointRect(t,2);return Math.max(0,Math.min(r.x1,i.x1)-Math.max(r.x0,i.x0))*Math.max(0,Math.min(r.y1,i.y1)-Math.max(r.y0,i.y0))>.001};return e.filter(e=>!e.hide).forEach(i=>{const r=e.length;for(let n=0;n<r;n++){const r=e[n];if(i.i!==r.i&&t(i,r)){i.hide=!0;break}}}),e}adjustOnOverflow(e,{maxWidth:t,maxHeight:i}){return e.map(e=>(e.hide||(e.x=Math.min(Math.max(e.x,e.w/2),t-e.w/2),e.y=Math.max(Math.min(e.y,i-e.h/2),e.h/2)),e))}adjustOnMultilineOverflow(e,{maxWidth:t}){return e.map(e=>(e.hide||0!==e.angle||(e.x=Math.min(Math.max(e.x,e.w/2),t-e.w/2)),e))}}const Cr={...i(13),...s},kr={init(e){const t=Object.assign({},e);t.guide=st(t.guide||{},{animationSpeed:0,avoidScalesOverflow:!0,enableColorToBarPosition:!1,maxHighlightDistance:32}),t.guide.size=t.guide.size||{},t.guide.label=st(t.guide.label||{},{position:["auto:avoid-label-label-overlap","auto:avoid-label-anchor-overlap","auto:adjust-on-label-overflow","auto:hide-on-label-label-overlap","auto:hide-on-label-anchor-overlap"]});const i=t.guide.avoidScalesOverflow,r=t.guide.enableColorToBarPosition;return t.transformRules=[e=>{const t=[e.scaleX,e.scaleY].sort((e,t)=>{var i=e.discrete?1:0;return(t.discrete?1:0)*t.domain().length-i*e.domain().length})[0];return e.scaleY===t?_.get("flip")(e):_.get("identity")(e)},t.stack&&_.get("stack"),r&&_.get("positioningByColor")].filter(e=>e),t.adjustRules=[t.stack&&_.get("adjustYScale"),(e,i)=>{const r=e.scaleSize.isEmptyScale(),n=st(t.guide.size,{defMinSize:10,defMaxSize:r?10:40,enableDistributeEvenly:!r}),a=Object.assign({},i,{defMin:n.defMinSize,defMax:n.defMaxSize,minLimit:n.minSize,maxLimit:n.maxSize});return(n.enableDistributeEvenly?_.get("adjustSigmaSizeScale"):_.get("adjustStaticSizeScale"))(e,a)},i&&((e,t)=>{const i=Object.assign({},t,{sizeDirection:"xy"});return _.get("avoidScalesOverflow")(e,i)})].filter(e=>e),t},addInteraction(){const e=this.node();e.on("highlight",(e,t)=>this.highlight(t)),e.on("data-hover",(e,t)=>this.highlight(((e,t)=>i=>i===e||t)(t.data,null)))},draw(){const e=this.node(),t=e.config,i=t.options;i.container=i.slot(t.uid);const r=e=>he(e,t.guide.animationSpeed),n=`${O}dot dot i-role-element i-role-datum`,a=e.screenModel,s={fill:e=>a.color(e),class:e=>`${n} ${a.class(e)}`},o={r:e=>Math.round(1e4*a.size(e)/2)/1e4,cx:e=>a.x(e),cy:e=>a.y(e)},l=[],c=a.toFibers();var d;this._getGroupOrder=(d=c.reduce((e,t,i)=>(e.set(t,i),e),new Map),e=>d.get(e));const u=i.container.selectAll(".frame").data(c,e=>a.group(e[0]));u.enter().append("g").attr("opacity",0).merge(u).call(function(t){t.attr("class","frame").call(function(t){var i=t.selectAll("circle").data(e=>e,a.id),n=i.enter().append("circle").call(xe(o)).merge(i).call(xe(s));r(n).call(xe(o)),r(i.exit()).attr("r",0).remove(),l.push(...n.nodes()),e.subscribe(n)}),r(t).attr("opacity",1)});this._boundsInfo=this._getBoundsInfo(l),r(u.exit()).attr("opacity",0).remove().selectAll("circle").attr("r",0),e.subscribe(new Mr(a.model,a.flip,t.guide.label,i).draw(c))},_getBoundsInfo(e){if(0===e.length)return null;const t=this.node().screenModel,i=e.map(e=>{const i=Cr.select(e).data()[0];return{node:e,data:i,x:t.x(i),y:t.y(i),r:t.size(i)/2}}).filter(e=>!isNaN(e.x)&&!isNaN(e.y)),r=i.reduce((e,{x:t,y:i})=>(e.left=Math.min(t,e.left),e.right=Math.max(t,e.right),e.top=Math.min(i,e.top),e.bottom=Math.max(i,e.bottom),e),{left:Number.MAX_VALUE,right:Number.MIN_VALUE,top:Number.MAX_VALUE,bottom:Number.MIN_VALUE}),n=i.reduce((e,t)=>{const i=`${t.x},${t.y}`;return e[i]||(e[i]=[]),e[i].push(t),e},{});return{bounds:r,tree:Cr.quadtree().x(e=>e[0].x).y(e=>e[0].y).addAll(Object.keys(n).map(e=>n[e]))}},getClosestElement(e,t){if(!this._boundsInfo)return null;const{bounds:i,tree:r}=this._boundsInfo,n=k(this.node().config.options.container.node()),a=e-n.x,s=t-n.y,{maxHighlightDistance:o}=this.node().config.guide;if(a<i.left-o||a>i.right+o||s<i.top-o||s>i.bottom+o)return null;const l=(r.find(a,s)||[]).map(e=>{const t=Math.sqrt(Math.pow(a-e.x,2)+Math.pow(s-e.y,2));if(t>o)return null;const i=t<e.r?e.r-t:t;return{node:e.node,data:e.data,x:e.x,y:e.y,distance:t,secondaryDistance:i}}).filter(e=>e).sort((e,t)=>e.secondaryDistance-t.secondaryDistance),c=l.findIndex(e=>e.distance!==l[0].distance||e.secondaryDistance!==l[0].secondaryDistance),d=c<0?l:l.slice(0,c);if(1===d.length)return d[0];const u=d.reduce((e,t)=>e+t.x,0)/d.length,h=d.reduce((e,t)=>e+t.y,0)/d.length,f=Math.atan2(h-s,u-a)+Math.PI;return d[Math.round((d.length-1)*f/2/Math.PI)]},highlight(e){const t=this.node().config.options.container,i={"tau-chart__highlighted":t=>!0===e(t),"tau-chart__dimmed":t=>!1===e(t)};t.selectAll(".dot").call(_e(i)),t.selectAll(".i-role-label").call(_e(i)),this._sortElements(e)},_sortElements(e){const t=this.node().config.options.container,i=new Map,r=new Map;t.selectAll(".frame").each(function(t){i.set(this,t.some(e)),r.set(this,t)});const n=ct((e,t)=>i.get(e)-i.get(t),(e,t)=>this._getGroupOrder(r.get(e))-this._getGroupOrder(r.get(t)));Dt(t.node(),(e,t)=>"g"===e.tagName&&"g"===t.tagName?n(e,t):e.tagName.localeCompare(t.tagName)),A(t,".dot",e)}};var Ar=i(9);const Pr="taucharts_synthetic_record";function Or(e){return!0!==e[Pr]}function Nr(e){return t=>{const i=e.stack,r=t.scaleX.period,n="linear"===t.scaleY.scaleType,a=!e.guide.x||null==e.guide.x.fillGaps;return!a&&e.guide.x.fillGaps||a&&(i||r&&n)?_.get("fillGaps")(t,{isStack:i,xPeriod:r,utc:e.guide.utcTime}):{}}}function Lr(e){if(0===e.length)return"";if(1===e.length)return Fr(e[0]);for(var t=[],i=1;i<e.length;i++)t.push(Dr(e[i-1],e[i]));return t.join(" ")}function Rr(e){if(0===e.length)return"";if(1===e.length)return Fr(e[0]);for(var t=[],i=3;i<e.length;i+=3)t.push($r(e[i-3],e[i-2],e[i-1],e[i]));return t.join(" ")}function Fr(e){var t=e.size/2;return[`M${e.x},${e.y-t}`,`A${t},${t} 0 0 1`,`${e.x},${e.y+t}`,`A${t},${t} 0 0 1`,`${e.x},${e.y-t}`,"Z"].join(" ")}function Dr(e,t){var i=Wr(e,t);return i?[`M${i.left[0].x},${i.left[0].y}`,`L${i.left[1].x},${i.left[1].y}`,`A${t.size/2},${t.size/2} 0 ${Number(e.size<t.size)} 1`,`${i.right[1].x},${i.right[1].y}`,`L${i.right[0].x},${i.right[0].y}`,`A${e.size/2},${e.size/2} 0 ${Number(e.size>t.size)} 1`,`${i.left[0].x},${i.left[0].y}`,"Z"].join(" "):Fr(e.size>t.size?e:t)}function $r(e,t,i,r){var n=function(e,t,i,r){var n=Ir(e,r);if(0===n||n+e.size/2<=r.size/2||n+r.size/2<=e.size/2)return null;var a=n=>{var a=n?[r,i,t,e]:[e,t,i,r],s=Vr(1/12*2,...a),o=Vr(.5,...s.slice(0,4)),l=o[3],c=o[6],d=Wr(a[0],l),u=Wr(l,c),h=[d.left[0],I(.5,d.left[1],u.left[0]),u.left[1]],f=[d.right[0],I(.5,d.right[1],u.right[0]),u.right[1]],p=Hr(...h)[1],g=Hr(...f)[1],m=I(4,d.left[0],p),b=I(4,d.right[0],g);return{left:n?[b,f[0]]:[h[0],m],right:n?[m,h[0]]:[f[0],b]}},s=a(!1),o=a(!0);return{left:[...s.left,...o.left],right:[...s.right,...o.right]}}(e,t,i,r);if(!n)return Dr(e,r);var a=Br(zr(e,n.right[0]),zr(e,n.left[0])),s=Br(zr(r,n.right[1]),zr(r,n.left[1]));return[`M${n.left[0].x},${n.left[0].y}`,`C${n.left[1].x},${n.left[1].y}`,`${n.left[2].x},${n.left[2].y}`,`${n.left[3].x},${n.left[3].y}`,`A${r.size/2},${r.size/2} 0 ${Number(a>Math.PI)} 1`,`${n.right[3].x},${n.right[3].y}`,`C${n.right[2].x},${n.right[2].y}`,`${n.right[1].x},${n.right[1].y}`,`${n.right[0].x},${n.right[0].y}`,`A${e.size/2},${e.size/2} 0 ${Number(s>Math.PI)} 1`,`${n.left[0].x},${n.left[0].y}`,"Z"].join(" ")}function zr(e,t){return Math.atan2(t.y-e.y,t.x-e.x)}function Br(e,t){return t<e&&(t+=2*Math.PI),t-e}function Ir(...e){for(var t=0,i=1;i<e.length;i++)t+=Math.sqrt((e[i].x-e[i-1].x)*(e[i].x-e[i-1].x)+(e[i].y-e[i-1].y)*(e[i].y-e[i-1].y));return t}function jr(e,t,i){return{x:e.x+t*Math.cos(i),y:e.y+t*Math.sin(i)}}function Vr(e,t,i,r,n){var a=j(e,t,i,r,n),s=1/(1+Ir(a[3],a[4],a[5],a[6],a[3])/Ir(a[0],a[1],a[2],a[3],a[0]));return a[3].size=t.size*(1-s)+n.size*s,a}function Hr(e,t,i){var r=I(Ir(e,t)/Ir(e,t,i),e,i);return[e,I(2,r,t),i]}function Wr(e,t){var i=Ir(e,t);if(0===i||i+e.size/2<=t.size/2||i+t.size/2<=e.size/2)return null;var r=zr(e,t),n=Math.asin((e.size-t.size)/i/2),a=r-Math.PI/2+n,s=r+Math.PI/2-n;return{left:[jr(e,e.size/2,a),jr(t,t.size/2,a)],right:[jr(e,e.size/2,s),jr(t,t.size/2,s)]}}const Ur={circle:{element:"circle",getInitialAttrs:function(e,t){const i=e.config.guide,r=e.screenModel;return{r:"hover"===i.showAnchors?0:e=>r.size(e)/2,cx:e=>t.x(e),cy:e=>t.y(e)}},getHighlightAttrs:function(e,t,i){e.config.guide;const r=e.screenModel,n="hover"===e.config.guide.showAnchors;return{r:n?e=>i(e)?Math.max(4,r.size(e)/2):0:e=>{var t=r.size(e)/2;return i(e)&&(t=Math.max(4,Math.ceil(1.25*t))),t}}}},"vertical-stick":{element:"path",getInitialAttrs:function(e,t){const i=e.config.guide,r=e.screenModel;return{"shape-rendering":"crispEdges",d:e=>{const n=t.x(e),a=t.y(e),s=t.x0(e),o=t.y0(e),l="hover"===i.showAnchors?0:r.size(e)/2;return Lr([{x:n,y:a,size:l},{x:s,y:o,size:l}])}}},getHighlightAttrs:function(e,t,i){e.config.guide;const r=e.screenModel,n="hover"===e.config.guide.showAnchors;return{d:e=>{const a=t.x(e),s=t.y(e),o=t.x0(e),l=t.y0(e),c=n?i(e)?Math.max(4,r.size(e)/2):0:i(e)?Math.max(4,Math.ceil(r.size(e)/2*1.25)):r.size(e)/2;return Lr([{x:a,y:s,size:c},{x:o,y:l,size:c}])}}}}};function Xr(e,t,i){const r=i.sort((e,t)=>e.distance===t.distance?e.secondaryDistance-t.secondaryDistance:e.distance-t.distance),n=r.findIndex(e=>e.distance!==r[0].distance||e.secondaryDistance!==r[0].secondaryDistance),a=n<0?r:r.slice(0,n);if(1===a.length)return a[0];const s=a.reduce((e,t)=>e+t.x,0)/a.length,o=a.reduce((e,t)=>e+t.y,0)/a.length,l=Math.atan2(o-t,s-e)+Math.PI;return a[Math.round((a.length-1)*l/2/Math.PI)]}const Gr=`${O}dot-line dot-line i-role-dot i-role-datum ${O}dot`,qr={init(e){const t=e;return t.guide=st(t.guide||{},{animationSpeed:0,cssClass:"",maxHighlightDistance:32,widthCssClass:"",color:{},label:{}}),t.guide.label=st(t.guide.label,{fontSize:11,hideEqualLabels:!0,position:["auto:avoid-label-label-overlap","auto:avoid-label-anchor-overlap","auto:avoid-label-edges-overlap","auto:adjust-on-label-overflow","auto:hide-on-label-label-overlap","auto:hide-on-label-edges-overlap"]}),t.guide.color=st(t.guide.color||{},{fill:null}),["never","hover","always"].indexOf(t.guide.showAnchors)<0&&(t.guide.showAnchors="hover"),t.transformRules=[],t.adjustRules=[],t},baseModel(e){var t={gog:e.model,x:e.x,y:e.y,x0:e.x0,y0:e.y0,size:e.size,group:e.group,order:e.order,color:e.color,class:e.class,groupAttributes:{},pathAttributesUpdateInit:{},pathAttributesUpdateDone:{},pathAttributesEnterInit:{},pathAttributesEnterDone:{},pathElement:null,dotAttributes:{r:e=>Math.round(1e4*t.size(e)/2)/1e4,cx:e=>t.x(e),cy:e=>t.y(e),fill:e=>t.color(e),class:e=>`${Gr} ${t.class(e)}`},dotAttributesDefault:{r:0,cy:e=>t.y0(e)}};return t},addInteraction(){const e=this.node(),t=this.node().config;e.on("highlight",(e,t)=>this.highlight(t)),e.on("highlight-data-points",(e,t)=>this.highlightDataPoints(t)),"never"!==t.guide.showAnchors&&e.on("data-hover",(e,t)=>this.highlightDataPoints(((e,t)=>i=>i===e||t)(t.data,null)))},draw(){const e=this.node(),t=e.config,i=t.guide,r=t.options;r.container=r.slot(t.uid);const n=e.screenModel,a=this.buildModel(n);this.domElementModel=a;const o=be,l=function(r){r.call(xe(a.groupAttributes));const l=r.selectAll((e=>e.split(/\s+/g).map(e=>`.${e}`).join(""))(Gr)).data(e=>e.length<=1?e:[],n.id);l.exit().call(o(i.animationSpeed,null,{r:0},e=>s.select(e).remove())),l.call(o(i.animationSpeed,null,a.dotAttributes));const c=l.enter().append("circle").call(o(i.animationSpeed,a.dotAttributesDefault,a.dotAttributes)).merge(l);e.subscribe(c);const d=r.selectAll(`${a.pathElement}:not(.i-data-anchor)`).data(e=>e.length>1?[e]:[],h);d.exit().remove(),d.call(o(i.animationSpeed,a.pathAttributesUpdateInit,a.pathAttributesUpdateDone,a.afterPathUpdate));d.enter().append(a.pathElement).call(o(i.animationSpeed,a.pathAttributesEnterInit,a.pathAttributesEnterDone,a.afterPathUpdate)).merge(d).call(e=>{t.guide.animationSpeed>0&&!document.hidden?(e.attr(a.pathTween.attr,function(e){return a.pathTween.fn.call(this,e)(0)}),he(e,t.guide.animationSpeed,"pathTransition").attrTween(a.pathTween.attr,a.pathTween.fn)):e.attr(a.pathTween.attr,function(e){return a.pathTween.fn.call(this,e)(1)})});if(e.subscribe(c),"never"!==i.showAnchors){const t=function(e,t,i){const r=t.anchorShape,n=e.config.guide,a=e.screenModel,s={...Ur[r].getInitialAttrs(e,t),opacity:"hover"===n.showAnchors?0:1,fill:e=>a.color(e),class:"i-data-anchor"},o=i.selectAll(".i-data-anchor").data(e=>e.filter(Or),a.id);return o.exit().remove(),o.call(be(n.animationSpeed,null,s)),o.enter().append(Ur[t.anchorShape].element).call(be(n.animationSpeed,{r:0},s)).merge(o)}(e,a,r);e.subscribe(t)}},c=n.toFibers(),d=c.map(e=>e.filter(Or)),u=r.container.selectAll(".frame"),h=(()=>{const e=u.empty()?[]:u.data(),t=new Map;u.each(function(e){t.set(e,Number(this.getAttribute("data-id")))});const i=e.reduce((e,t)=>(e.set(t,t.map(n.id)),e),new Map),r=new Map;var a=Math.max(0,...Array.from(t.values()));return e=>{if(r.has(e))return r.get(e);const s=e.map(e=>n.id(e)),o=(Array.from(i.entries()).find(([,e])=>s.some(t=>e.some(e=>e===t)))||[null])[0];var l;return l=o?t.get(o):++a,r.set(e,l),l}})();this._getDataSetId=h;const f=u.data(c,h);f.exit().remove(),f.call(l),f.enter().append("g").attr("data-id",h).call(l),f.order(),this._boundsInfo=this._getBoundsInfo(r.container.selectAll(".i-data-anchor").nodes()),e.subscribe(new Mr(n.model,t.flip,t.guide.label,r).draw(d))},_getBoundsInfo(e){if(0===e.length)return null;const t=this.node().screenModel,{flip:i}=this.node().config,r=e.map(e=>{const i=s.select(e).data()[0];return{node:e,data:i,x:t.x(i),y:t.y(i)}}).filter(e=>!isNaN(e.x)&&!isNaN(e.y)),n=r.reduce((e,{x:t,y:i})=>(e.left=Math.min(t,e.left),e.right=Math.max(t,e.right),e.top=Math.min(i,e.top),e.bottom=Math.max(i,e.bottom),e),{left:Number.MAX_VALUE,right:Number.MIN_VALUE,top:Number.MAX_VALUE,bottom:Number.MIN_VALUE}),a=it(r.map(i?e=>e.y:e=>e.x)).sort((e,t)=>e-t),o=a.reduce((e,t)=>(e[t]=[],e),{});r.forEach(e=>{const t=a.find(i?t=>e.y===t:t=>e.x===t);o[t].push(e)});const l=e=>{if(1===e.length)return o[e[0]];const t=Math.ceil(e.length/2);return{middle:(e[t-1]+e[t])/2,lower:l(e.slice(0,t)),greater:l(e.slice(t))}};return{bounds:n,tree:l(a)}},getClosestElement(e,t){if(!this._boundsInfo)return null;const{bounds:i,tree:r}=this._boundsInfo,n=this.node().config.options.container,{flip:a}=this.node().config,s=k(n.node()),{maxHighlightDistance:o}=this.node().config.guide;if(e<i.left+s.x-o||e>i.right+s.x+o||t<i.top+s.y-o||t>i.bottom+s.y+o)return null;const l=a?t-s.y:e-s.x,c=function e(t){return Array.isArray(t)?t:e(l>t.middle?t.greater:t.lower)}(r).map(i=>{const r=i.x+s.x,n=i.y+s.y,o=Math.abs(a?t-n:e-r),l=Math.abs(a?e-r:t-n);return{node:i.node,data:i.data,distance:o,secondaryDistance:l,x:r,y:n}});return Xr(e,t,c)},highlight(e){const t=this.node().config.options.container,i="tau-chart__highlighted",r="tau-chart__dimmed",n=t.selectAll(".i-role-path"),a=n.data().filter(t=>t.filter(Or).some(e)),s=a.length>0;n.call(_e({[i]:e=>s&&a.indexOf(e)>=0,[r]:e=>s&&a.indexOf(e)<0}));const o={[i]:t=>!0===e(t),[r]:t=>!1===e(t)};t.selectAll(".i-role-dot").call(_e(o)),t.selectAll(".i-role-label").call(_e(o)),this._sortElements(e)},highlightDataPoints(e){const t=this.node(),i=function(e,t,i){const r=t.anchorShape,n=e.screenModel,a="hover"===e.config.guide.showAnchors;return e.config.options.container.selectAll(".i-data-anchor").call(xe(Ur[r].getHighlightAttrs(e,t,i))).attr("opacity",a?e=>i(e)?1:0:()=>1).attr("fill",e=>n.color(e)).attr("class",e=>$t("i-data-anchor",n.class(e))).classed(`${O}highlighted`,i)}(t,this.domElementModel,e),r=t.config.options.container,n=t.config.flip,a=i.filter(e);var s=r.select(".cursor-line");if(a.empty())s.remove();else{s.empty()&&(s=r.append("line"));const e=t.screenModel.model,i=e.xi(a.data()[0]),o=e.xi(a.data()[0]),l=e.scaleY.domain(),c=e.scaleY(l[0]),d=e.scaleY(l[1]);s.attr("class","cursor-line").attr("x1",n?c:i).attr("y1",n?i:c).attr("x2",n?d:o).attr("y2",n?o:d)}this._sortElements(e)},_sortElements(e){const t=this.node().config.options.container,i=new Map,r=new Map,n=this._getDataSetId;t.selectAll(".i-role-path").each(function(t){i.set(this,n(t)),r.set(this,t.filter(Or).some(e))});const a=ct((e,t)=>r.get(e)-r.get(t),(e,t)=>i.get(e)-i.get(t)),s={line:0,g:1,text:2};Dt(t.node(),(e,t)=>"g"===e.tagName&&"g"===t.tagName?a(e,t):s[e.tagName]-s[t.tagName])}};var Yr=[1,2,3,4,5],Kr=Yr.map(e=>O+"line-opacity-"+e),Jr=Yr.map(e=>O+"line-width-"+e);function Qr(e){return Kr[e-1]||Kr[4]}function Zr(e,t){if(e.length<2)return"";return String.prototype.concat.apply("",e.concat(t.slice().reverse()).map((e,t)=>`${0===t?"":" "}${e.x},${e.y}`))}function en(e,t){if(e.length<2)return"";const i=e=>{const t=e.map((e,t)=>{return`${(t-1)%3==0?"C":""}${e.x},${e.y} `});return String.prototype.concat.apply("",t)};return`M${i(e)}L${i(t.slice().reverse())}Z`}const tn={...Ar,...s},rn={draw:qr.draw,highlight:qr.highlight,highlightDataPoints:qr.highlightDataPoints,addInteraction:qr.addInteraction,_sortElements:qr._sortElements,init(e){const t=qr.init(e),i=t.stack;return t.transformRules=[t.flip&&_.get("flip"),t.guide.obsoleteVerticalStackOrder&&_.get("obsoleteVerticalStackOrder"),!i&&_.get("groupOrderByAvg"),Nr(t),i&&_.get("stack")],t.adjustRules=[(e,i)=>{const r=e.scaleSize.isEmptyScale(),n=st(t.guide.size||{},{defMinSize:2,defMaxSize:r?6:40}),a=Object.assign({},i,{defMin:n.defMinSize,defMax:n.defMaxSize,minLimit:n.minSize,maxLimit:n.maxSize});return _.get("adjustStaticSizeScale")(e,a)}],t},buildModel(e){const t=qr.baseModel(e),i=this.node().config.guide,r=Qr(e.model.scaleColor.domain().length),n=`${O}area area i-role-path ${r} ${i.cssClass} `;t.groupAttributes={class:e=>`${n} ${t.class(e[0])} frame`};const a={fill:e=>t.color(e[0]),stroke:e=>{var i=t.color(e[0]);return i.length>0&&(i=tn.rgb(i).darker(1)),i}};t.pathAttributesEnterInit=a,t.pathAttributesUpdateDone=a;const s="polyline"===oe(i.interpolate);return t.pathElement=s?"polygon":"path",t.anchorShape="vertical-stick",t.pathTween={attr:s?"points":"d",fn:ve(0,s?Zr:en,[i=>({id:e.id(i),x:t.x(i),y:t.y(i)}),i=>({id:e.id(i),x:t.x0(i),y:t.y0(i)})],e.id,i.interpolate)},t},_getBoundsInfo(e){if(0===e.length)return null;const t=this.node().screenModel,{flip:i}=this.node().config,r=e.map(e=>{const i=tn.select(e).data()[0];return{node:e,data:i,x:t.x(i),y:t.y(i),y0:t.y0(i),group:t.group(i)}}),n=r.reduce((e,{x:t,y:i,y0:r})=>(e.left=Math.min(t,e.left),e.right=Math.max(t,e.right),e.top=Math.min(i,r,e.top),e.bottom=Math.max(i,r,e.bottom),e),{left:Number.MAX_VALUE,right:Number.MIN_VALUE,top:Number.MAX_VALUE,bottom:Number.MIN_VALUE}),a=it(r.map(i?e=>e.y:e=>e.x)).sort((e,t)=>e-t),s=a.reduce((e,t)=>(e[t]=[],e),{});if(r.forEach(e=>{const t=a.find(i?t=>e.y===t:t=>e.x===t);s[t].push(e)}),(()=>{const e=Object.keys(r.reduce((e,t)=>(e[t.group]=!0,e),{})),t=e.reduce((e,t,i)=>(e[t]=i,e),{});a.forEach(i=>{const r=s[i];if(r.sort((e,i)=>t[e.group]-t[i.group]),r.length<e.length)for(var n=0;n<e.length;n++){let t,a,s=!1;if(n===r.length?(t=a=0===n?0:r[n-1].y,s=!0):r[n].group!==e[n]&&(t=a=r[n].y0,s=!0),s){let s={x:i,y:t,y0:a,data:null,node:null,group:e[n]};r.splice(n,0,s)}}})})(),1===a.length){return{bounds:n,tree:{start:a[0],end:a[0],isLeaf:!0,items:{start:s[a[0]],end:s[a[0]]}}}}const o=e=>{if(2===e.length){let[t,i]=e;return{start:t,end:i,isLeaf:!0,items:{start:s[t],end:s[i]}}}const t=e.length%2==0?e.length/2:(e.length-1)/2;e[t];return{start:e[0],end:e[e.length-1],isLeaf:!1,left:o(e.slice(0,t+1)),right:o(e.slice(t))}};return{bounds:n,tree:o(a)}},getClosestElement(e,t){if(!this._boundsInfo)return null;const{bounds:i,tree:r}=this._boundsInfo,n=this.node().config.options.container,{flip:a}=this.node().config,s=k(n.node()),{maxHighlightDistance:o}=this.node().config.guide;if(e<i.left+s.x-o||e>i.right+s.x+o||t<i.top+s.y-o||t>i.bottom+s.y+o)return null;const l=a?t-s.y:e-s.x,c=function e(t){if(t.isLeaf)return t;const i=t.left.end;return e(l<i?t.left:t.right)}(r);var d=c.end===c.start?0:(l-c.start)/(c.end-c.start);d<0&&(d=0),d>1&&(d=1);const u=(()=>{const e=c.items.start.reduce((e,t)=>(e[t.group]={start:t,end:null,y:null,y0:null},e),{});return c.items.end.forEach(t=>{void 0!==e[t.group]?e[t.group].end=t:delete e[t.group]}),Object.keys(e).forEach(t=>{const i=e[t];i.end?(i.y=i.start.y+d*(i.end.y-i.start.y),i.y0=i.start.y0+d*(i.end.y0-i.start.y0)):delete e[t]}),Object.keys(e).map(t=>e[t]).map(e=>({y:e.y,y0:e.y0,el:d<.5?e.start:e.end})).filter(e=>null!=e.el.data)})(),h=t-s.y,f=u.filter(e=>h>=e.y&&h<=e.y0),p=(f.length>0?f:u).map(e=>e.el).map(i=>{const r=i.x+s.x,n=i.y+s.y,o=Math.abs(a?t-n:e-r),l=Math.abs(a?e-r:t-n);return{node:i.node,data:i.data,distance:o,secondaryDistance:l,x:r,y:n}});return Xr(e,t,p)}},nn={draw:qr.draw,getClosestElement:qr.getClosestElement,highlight:qr.highlight,highlightDataPoints:qr.highlightDataPoints,addInteraction:qr.addInteraction,_getBoundsInfo:qr._getBoundsInfo,_sortElements:qr._sortElements,init(e){const t=qr.init(e);return t.transformRules=[t.flip&&_.get("flip")],t.adjustRules=[(e,i)=>{const r=e.scaleSize.isEmptyScale(),n=st(t.guide.size||{},{defMinSize:2,defMaxSize:r?6:40}),a=Object.assign({},i,{defMin:n.defMinSize,defMax:n.defMaxSize,minLimit:n.minSize,maxLimit:n.maxSize});return _.get("adjustStaticSizeScale")(e,a)}],t},buildModel(e){const t=qr.baseModel(e),i=this.node().config.guide,r=Qr(e.model.scaleColor.domain().length),n=`${O}area area i-role-path ${r} ${i.cssClass} `;t.groupAttributes={class:e=>`${n} ${t.class(e[0])} frame`};const a={fill:e=>t.color(e[0]),stroke:e=>t.color(e[0])};return t.pathAttributesEnterInit=a,t.pathAttributesUpdateDone=a,t.pathElement="polygon",t.anchorShape="circle",t.pathTween={attr:"points",fn:ve(0,((e,t)=>i=>i.map(i=>[e(i),t(i)].join(",")).join(" "))(e=>e.x,e=>e.y),[i=>({id:e.id(i),x:t.x(i),y:t.y(i)})],e.id)},t}};function an(e){if(e.length<2)return"";for(var t="",i=0;i<e.length;i++)t+=`${0===i?"M":" L"}${e[i].x},${e[i].y}`;return t}function sn(e){if(e.length<4)return"";for(var t=`M${e[0].x},${e[0].y}`,i=3;i<e.length;i+=3)t+=` C${e[i-2].x},${e[i-2].y} ${e[i-1].x},${e[i-1].y} ${e[i].x},${e[i].y}`;return t}const on={draw:qr.draw,getClosestElement:qr.getClosestElement,highlight:qr.highlight,highlightDataPoints:qr.highlightDataPoints,addInteraction:qr.addInteraction,_getBoundsInfo:qr._getBoundsInfo,_sortElements:qr._sortElements,init(e){const t=qr.init(e),i=t.stack;t.guide=st(t.guide||{},{avoidScalesOverflow:!0,interpolate:"linear"}),t.transformRules=[t.flip&&_.get("flip"),!i&&_.get("groupOrderByAvg"),Nr(t),i&&_.get("stack")];const r=t.guide.avoidScalesOverflow,n=e=>e.scaleSize.isEmptyScale();return t.adjustRules=[(e,i)=>{const r=st(t.guide.size||{},{defMinSize:2,defMaxSize:n(e)?6:40}),a=Object.assign({},i,{defMin:r.defMinSize,defMax:r.defMaxSize,minLimit:r.minSize,maxLimit:r.maxSize});return _.get("adjustStaticSizeScale")(e,a)},r&&((e,t)=>{if(n(e))return()=>({});const i=Object.assign({},t,{sizeDirection:"xy"});return _.get("avoidScalesOverflow")(e,i)})].filter(e=>e),t},buildModel(e){const t=this.node().config,i=t.guide,r=t.options,n=!e.model.scaleSize.dim,a=n?i.widthCssClass||(s=r.width,o=0,s>=160&&s<320?o=1:s>=320&&s<480?o=2:s>=480&&s<640?o=3:s>=640&&(o=4),Jr[o]):"";var s,o;const l=Qr(e.model.scaleColor.domain().length),c=n?"line":"area",d=`${O}${c} ${c} i-role-path ${a} ${l} ${i.cssClass} `,u=n?{stroke:e=>f.color(e[0]),class:"i-role-datum"}:{fill:e=>f.color(e[0])},h="cubic"===oe(i.interpolate)?n?sn:Rr:n?an:Lr,f=qr.baseModel(e),p=n?t=>({id:e.id(t),x:f.x(t),y:f.y(t)}):t=>({id:e.id(t),x:f.x(t),y:f.y(t),size:f.size(t)});return f.groupAttributes={class:e=>`${d} ${f.class(e[0])} frame`},f.pathElement="path",f.anchorShape="circle",f.pathAttributesEnterInit=u,f.pathAttributesUpdateDone=u,f.pathTween={attr:"d",fn:ve(0,h,[p],e.id,i.interpolate)},f}},ln=e=>s.select(e).data()[0],cn={init(e){const t=Object.assign({},e);t.guide=t.guide||{},t.guide=st(t.guide,{animationSpeed:0,avoidScalesOverflow:!0,maxHighlightDistance:32,prettify:!0,sortByBarHeight:!0,enableColorToBarPosition:null!=t.guide.enableColorToBarPosition?t.guide.enableColorToBarPosition:!t.stack}),t.guide.size=st(t.guide.size||{},{enableDistributeEvenly:!0}),t.guide.label=st(t.guide.label||{},{position:t.flip?t.stack?["r-","l+","hide-by-label-height-horizontal","cut-label-horizontal"]:["outside-then-inside-horizontal","auto:hide-on-label-label-overlap"]:t.stack?["rotate-on-size-overflow","t-","b+","hide-by-label-height-vertical","cut-label-vertical","auto:hide-on-label-label-overlap"]:["rotate-on-size-overflow","outside-then-inside-vertical","auto:hide-on-label-label-overlap"]});const i=t.guide.avoidScalesOverflow,r=t.guide.enableColorToBarPosition,n=t.guide.size.enableDistributeEvenly;return t.transformRules=[t.flip&&_.get("flip"),t.guide.obsoleteVerticalStackOrder&&_.get("obsoleteVerticalStackOrder"),t.stack&&_.get("stack"),r&&_.get("positioningByColor")].filter(e=>e),t.adjustRules=[n&&((e,i)=>{const r=st(t.guide.size||{},{defMinSize:t.guide.prettify?3:0,defMaxSize:t.guide.prettify?40:Number.MAX_VALUE}),n=Object.assign({},i,{defMin:r.defMinSize,defMax:r.defMaxSize,minLimit:r.minSize,maxLimit:r.maxSize});return _.get("size_distribute_evenly")(e,n)}),i&&n&&((e,t)=>{const i=Object.assign({},t,{sizeDirection:"x"});return _.get("avoidScalesOverflow")(e,i)}),t.stack&&_.get("adjustYScale")].filter(e=>e),t},addInteraction(){const e=this.node();e.on("highlight",(e,t)=>this.highlight(t)),e.on("data-hover",(e,t)=>this.highlight(((e,t)=>i=>i===e||t)(t.data,null)))},draw(){const e=this.node(),t=e.config,i=t.options;i.container=i.slot(t.uid);const r=t.guide.prettify,n=`i-role-element i-role-datum bar ${O}bar`,a=e.screenModel,o=this.buildModel(a,{prettify:r,minBarH:1,minBarW:1,baseCssClass:n}),l=be,c=t.flip?"y":"x",d=t.flip?"x":"y",u=t.flip?"width":"height",h=t.flip?"height":"width",f=a.toFibers(),p=f.reduce((e,t)=>e.concat(t),[]),g=o.class,m=ot(o,"class"),b=i.container.selectAll(".bar").data(p,a.id);b.exit().classed("tau-removing",!0).call(l(t.guide.animationSpeed,null,{[c]:function(){var e=s.select(this);return e.attr(c)-0+(e.attr(h)-0)/2},[d]:function(){return this.getAttribute("data-zero")},[h]:0,[u]:0},e=>{var t=s.select(e);t.classed("tau-removing")&&t.remove()})),b.call(l(t.guide.animationSpeed,null,m));const y=b.enter().append("rect").call(l(t.guide.animationSpeed,{[d]:a[`${d}0`],[u]:0},m)).merge(b).attr("class",g).attr("data-zero",a[`${d}0`]);e.subscribe(new Mr(a.model,a.model.flip,t.guide.label,i).draw(f));const v=(()=>{const e=p.reduce((e,t,i)=>(e.set(t,i+1),e),new Map);return(t,i)=>{return(e.get(ln(t))||-1)-(e.get(ln(i))||-1)}})();this._barsSorter=t.guide.sortByBarHeight?t.flip?(e,t)=>{const i=ln(e),r=ln(t),n=o.width(i),a=o.width(r);if(n===a){const n=o.y(i),a=o.y(r);return n===a?v(e,t):n-a}return a-n}:(e,t)=>{const i=ln(e),r=ln(t),n=o.height(i),a=o.height(r);if(n===a){const n=o.x(i),a=o.x(r);return n===a?v(e,t):n-a}return a-n}:v;const x={rect:0,text:1};this._typeSorter=((e,t)=>x[e.tagName]-x[t.tagName]),this._sortElements(this._typeSorter,this._barsSorter),e.subscribe(y),this._boundsInfo=this._getBoundsInfo(y.nodes())},buildModel(e,{prettify:t,minBarH:i,minBarW:r,baseCssClass:n}){const a=i=>{var n=e.size(i);return t&&(n=Math.max(r,n)),n};var s;const o=t=>t[e.model.scaleY.dim];if(e.flip){let r=t=>Math.abs(e.x(t)-e.x0(t));s={y:t=>e.y(t)-.5*a(t),x:n=>{const a=Math.min(e.x0(n),e.x(n));if(t){const e=r(n),t=o(n);var s=0;return 0===t&&(s=0),t>0&&(s=e),t<0&&(s=0-i),e<i?a+s:a}return a},height:e=>a(e),width:e=>{const n=r(e);return t?0===o(e)?n:Math.max(i,n):n}}}else{let r=t=>Math.abs(e.y(t)-e.y0(t));s={x:t=>e.x(t)-.5*a(t),y:n=>{var a=Math.min(e.y0(n),e.y(n));if(t){a=r(n)<i&&o(n)>0?a-i:a}return a},width:e=>a(e),height:e=>{var n=r(e);return t&&(n=0===o(e)?n:Math.max(i,n)),n}}}return Object.assign(s,{class:t=>`${n} ${e.class(t)}`,fill:t=>e.color(t)})},_sortElements(...e){Dt(this.node().config.options.container.node(),ct(...e))},_getBoundsInfo(e){if(0===e.length)return null;const t=this.node().screenModel,{flip:i}=this.node().config,r=e.map(e=>{const i=s.select(e).data()[0],r=t.x(i),n=t.x0(i),a=t.y(i),o=t.y0(i),l=Math.abs(r-n),c=Math.abs(a-o),d=(r+n)/2,u=(a+o)/2;return{node:e,data:i,cx:d,cy:u,box:{top:u-c/2,right:d+l/2,bottom:u+c/2,left:d-l/2},invert:a>o}}),n=r.reduce((e,{box:t})=>(e.left=Math.min(t.left,e.left),e.right=Math.max(t.right,e.right),e.top=Math.min(t.top,e.top),e.bottom=Math.max(t.bottom,e.bottom),e),{left:Number.MAX_VALUE,right:Number.MIN_VALUE,top:Number.MAX_VALUE,bottom:Number.MIN_VALUE}),a=it(r.map(i?e=>e.cy:e=>e.cx)).sort((e,t)=>e-t),o=a.reduce((e,t)=>(e[t]=[],e),{});r.forEach(e=>{const t=a.find(i?t=>e.cy===t:t=>e.cx===t);o[t].push(e)});const l=e=>{if(1===e.length)return o[e];const t=Math.ceil(e.length/2);return{middle:(e[t-1]+e[t])/2,lower:l(e.slice(0,t)),greater:l(e.slice(t))}};return{bounds:n,tree:l(a)}},getClosestElement(e,t){if(!this._boundsInfo)return null;const{bounds:i,tree:r}=this._boundsInfo,n=this.node().config.options.container,{flip:a}=this.node().config,s=k(n.node()),o=e-s.x,l=t-s.y,{maxHighlightDistance:c}=this.node().config.guide;if(o<i.left-c||o>i.right+c||l<i.top-c||l>i.bottom+c)return null;const d=a?l:o,u=a?o:l;return function e(t){return Array.isArray(t)?t:e(d>t.middle?t.greater:t.lower)}(r).map(e=>{const t=a?e.box.left:e.box.top,i=a?e.box.right:e.box.bottom,r=((e,t,i)=>e>=t&&e<=i)(u,t,i);if(!r&&Math.abs(u-t)>c&&Math.abs(u-i)>c)return null;const n=Math.abs(u-(e.invert!==a?i:t));return Object.assign(e,{distToValue:n,cursorInside:r})}).filter(e=>e).sort((e,t)=>e.cursorInside!==t.cursorInside?t.cursorInside-e.cursorInside:Math.abs(e.distToValue)-Math.abs(t.distToValue)).map(e=>{const t=e.cx,i=e.cy,r=Math.abs(a?l-i:o-t),n=Math.abs(a?o-t:l-i);return{node:e.node,data:e.data,distance:r,secondaryDistance:n,x:t,y:i}})[0]||null},highlight(e){const t=this.node().config.options.container,i={"tau-chart__highlighted":t=>!0===e(t),"tau-chart__dimmed":t=>!1===e(t)};t.selectAll(".bar").call(_e(i)),t.selectAll(".i-role-label").call(_e(i)),this._sortElements((t,i)=>e(ln(t))-e(ln(i)),this._typeSorter,this._barsSorter)}};var dn=i(14);var un=e=>"date"===e?e=>new Date(e).getTime():e=>e,hn=(e,t)=>He([e,t].map(e=>JSON.stringify).join(""));class fn{constructor(e,t){var i;if(this._fields={},Array.isArray(t.fitToFrameByDims)&&t.fitToFrameByDims.length){let r=e=>{var i={};return"where"===e.type&&e.args?(i.type=e.type,i.args=t.fitToFrameByDims.reduce((t,i)=>(e.args.hasOwnProperty(i)&&(t[i]=e.args[i]),t),{})):i=e,i};i=e.part(r)}else i=e.full();var r=this.getVarSet(i,t);t.order&&(r=nt(at(t.order,r),r)),this.vars=r;const n=r.map(e=>e);this.scaleConfig=t,this.scaleConfig.nice=this.scaleConfig.hasOwnProperty("nice")?this.scaleConfig.nice:this.scaleConfig.autoScale,this.addField("dim",this.scaleConfig.dim).addField("scaleDim",this.scaleConfig.dim).addField("scaleType",this.scaleConfig.type).addField("source",this.scaleConfig.source).addField("domain",()=>this.vars).addField("isInteger",n.every(Number.isInteger)).addField("originalSeries",()=>n).addField("isContains",e=>this.isInDomain(e)).addField("isEmptyScale",()=>this.isEmpty()).addField("fixup",e=>{var t=this.scaleConfig;t.__fixup__=t.__fixup__||{},t.__fixup__=Object.assign(t.__fixup__,e(Object.assign({},t,t.__fixup__)))}).addField("commit",()=>{this.scaleConfig=Object.assign(this.scaleConfig,this.scaleConfig.__fixup__),delete this.scaleConfig.__fixup__})}isInDomain(e){return this.domain().indexOf(e)>=0}addField(e,t){return this._fields[e]=t,this[e]=t,this}getField(e){return this._fields[e]}isEmpty(){return!Boolean(this._fields.dim)}toBaseScale(e,t=null){var i=Object.keys(this._fields).reduce((e,t)=>(e[t]=this._fields[t],e),e);return i.getHash=(()=>hn(this.vars,t)),i.value=i,i}getVarSet(e,t){return it(t.hasOwnProperty("series")?t.series:e.map(e=>e[t.dim]),un(t.dimType))}}const pn={...o,...l};let gn={sqrt:e=>Math.sqrt(e),linear:e=>e};const mn={...o,...l};var bn=i(15);const yn={...o,...l,...bn};function vn(e){return yn[`time${e[0].toUpperCase()}${e.slice(1)}`]}const xn={second:{duration:1e3,interval:yn.timeSecond,utc:yn.utcSecond},minute:{duration:6e4,interval:yn.timeMinute,utc:yn.utcMinute},hour:{duration:36e5,interval:yn.timeHour,utc:yn.utcHour},day:{duration:864e5,interval:yn.timeDay,utc:yn.utcDay},week:{duration:6048e5,interval:yn.timeWeek,utc:yn.utcWeek},month:{duration:2592e6,interval:yn.timeMonth,utc:yn.utcMonth},year:{duration:31536e6,interval:yn.timeYear,utc:yn.utcYear}},_n=(()=>{const e=(e,t)=>{return{time:e,step:t,duration:t*e.duration}};return[e(xn.second,1),e(xn.second,5),e(xn.second,15),e(xn.second,30),e(xn.minute,1),e(xn.minute,5),e(xn.minute,15),e(xn.minute,30),e(xn.hour,1),e(xn.hour,3),e(xn.hour,6),e(xn.hour,12),e(xn.day,1),e(xn.day,2),e(xn.week,1),e(xn.month,1),e(xn.month,3),e(xn.year,1)]})();const wn={...o,...l};const En={...o,...l};function Sn(e){return Math.log(e)/Math.LN10}function Tn(e){if(e[0]*e[1]<=0)throw new y("Logarithmic scale domain cannot cross zero.",v.INVALID_LOG_DOMAIN)}const Mn={...o,...l};var Cn=e=>e||null,kn=(e,t=null)=>Array.isArray(e)?0===e.length?[t]:e:[e],An=(e,t)=>({type:e,x:t.x,y:t.y,identity:t.identity,size:t.size,color:t.color,split:t.split,label:t.label,guide:{color:t.colorGuide,obsoleteVerticalStackOrder:t.obsoleteVerticalStackOrder,size:t.sizeGuide},flip:t.flip,stack:t.stack});const Pn={SUCCESS:"SUCCESS",WARNING:"WARNING",FAIL:"FAIL"};var On={[Pn.SUCCESS]:e=>e,[Pn.FAIL]:(e,t)=>{throw new Error((t.messages||[]).join("\n")||["This configuration is not supported,","See https://api.taucharts.com/basic/facet.html#easy-approach-for-creating-facet-chart"].join(" "))},[Pn.WARNING]:(e,t,i)=>{var r=t.axis,n=t.indexMeasureAxis[0],a=e[n],s=e.filter(e=>e!==a);s.push(a);var o=i[n][r]||{},l=i[i.length-1][r]||{};return i[i.length-1][r]=o,i[n][r]=l,s}};function Nn(e,t,i){return t.reduce(function(t,r,n){var a=e[r];return a?t.status!=Pn.FAIL&&("measure"===a.type&&(t.countMeasureAxis++,t.indexMeasureAxis.push(n)),"measure"!==a.type&&1===t.countMeasureAxis?t.status=Pn.WARNING:t.countMeasureAxis>1&&(t.status=Pn.FAIL,t.messages.push(`There is more than one measure dimension for "${i}" axis`))):(t.status=Pn.FAIL,r?t.messages.push(`"${r}" dimension is undefined for "${i}" axis`):t.messages.push(`"${i}" axis should be specified`)),t},{status:Pn.SUCCESS,countMeasureAxis:0,indexMeasureAxis:[],messages:[],axis:i})}function Ln(e){var t=kn(e.x),i=kn(e.y),r=Math.max(t.length,i.length),n=kn(e.guide||{},{});let a=r-n.length;for(let e=0;e<a;e++)n.push({});n=n.slice(0,r);var s=Nn(e.dimensions,t,"x"),o=Nn(e.dimensions,i,"y");t=On[s.status](t,s,n),i=On[o.status](i,o,n);const l=["identity","color","size","label","split"].reduce((t,i)=>{const r=e[i],n=function(e,t,i){return null==t?t:String(t)}(e.dimensions,r);return null!=n&&(t[i]=n),t},{});return Object.assign({},e,{x:t,y:i,guide:n},l)}function Rn(e,t){for(var i=t.x,r=t.y,n=t.guide,a=Math.max(i.length,r.length),s={type:"COORDS.RECT",unit:[]},o=[].concat(i),l=[].concat(r),c=[].concat(n),d=a;d>0;d--){var u=o.pop(),h=l.pop(),f=c.pop()||{};d===a?(s.x=u,s.y=h,s.unit.push(An(e,{x:Cn(u),y:Cn(h),identity:t.identity,split:t.split,color:t.color,label:t.label,size:t.size,flip:t.flip,stack:t.stack,colorGuide:f.color,obsoleteVerticalStackOrder:f.obsoleteVerticalStackOrder,sizeGuide:f.size})),s.guide=st(f,{x:{label:u},y:{label:h}})):s={type:"COORDS.RECT",x:Cn(u),y:Cn(h),unit:[s],guide:st(f,{x:{label:u},y:{label:h}})}}return t.spec={dimensions:t.dimensions,unit:s},t}const Fn=e=>{var t=Ln(e);return Rn("ELEMENT.INTERVAL",t=(e=>{var t=(e.flip?e.y:e.x).indexOf(e.color)>=0,i=e.guide[e.guide.length-1];return t&&!i.hasOwnProperty("enableColorToBarPosition")&&(i.enableColorToBarPosition=!1),e})(t))},Dn=e=>{var t=Ln(e),i=t.data,r=t.settings.log,n=(0,{horizontal:e=>({prop:e.x[e.x.length-1],flip:!1}),vertical:e=>({prop:e.y[e.y.length-1],flip:!0}),auto:e=>{var t,n=e.x,a=e.y,s=n[n.length-1],o=n.slice(0,n.length-1),l=a[a.length-1],c=a.slice(0,a.length-1),d=e.color,u=o.concat(c).concat([d]).filter(e=>null!==e),h=-1,f=[[[s].concat(u),l],[[l].concat(u),s]],p=null;return f.some((e,t)=>{var n=e[0],a=e[1],s=ri.isYFunctionOfX(i,n,[a]);return s.result?h=t:r(["Attempt to find a functional relation between",e[0]+" and "+e[1]+" is failed.","There are several "+s.error.keyY+" values (e.g. "+s.error.errY.join(",")+")","for ("+s.error.keyX+" = "+s.error.valX+")."].join(" ")),s.result})?(t=f[h][0][0],p=0!==h):(r("All attempts are failed. Gonna transform AREA to general PATH."),t=null),{prop:t,flip:p}}}["boolean"!=typeof t.flip?"auto":t.flip?"vertical":"horizontal"])(t);return null!==n.prop&&(t.data=ri.sortByDim(i,n.prop,t.dimensions[n.prop]),t.flip=n.flip),Rn("ELEMENT.AREA",t)};class $n{constructor(e){this.unitRef=e}value(){return this.unitRef}clone(){return JSON.parse(JSON.stringify(this.unitRef))}traverse(e){var t=(e,i,r)=>{i(e,r),(e.units||[]).map(r=>t(r,i,e))};return t(this.unitRef,e,null),this}reduce(e,t){var i=t;return this.traverse((t,r)=>i=e(i,t,r)),i}addFrame(e){return this.unitRef.frames=this.unitRef.frames||[],e.key.__layerid__=["L",(new Date).getTime(),this.unitRef.frames.length].join(""),e.source=e.hasOwnProperty("source")?e.source:this.unitRef.expression.source,e.pipe=e.pipe||[],this.unitRef.frames.push(e),this}addTransformation(e,t){return this.unitRef.transformation=this.unitRef.transformation||[],this.unitRef.transformation.push({type:e,args:t}),this}isCoordinates(){return 0===(this.unitRef.type||"").toUpperCase().indexOf("COORDS.")}isElementOf(e){if(this.isCoordinates())return!1;var t=(this.unitRef.type||"").split("/");return 1===t.length&&t.unshift("RECT"),t[0].toUpperCase()===e.toUpperCase()}}class zn{constructor(e){this.specRef=e}value(){return this.specRef}unit(e){return e&&(this.specRef.unit=e),new $n(this.specRef.unit)}addTransformation(e,t){return this.specRef.transformations=this.specRef.transformations||{},this.specRef.transformations[e]=t,this}getSettings(e){return this.specRef.settings[e]}setSettings(e,t){return this.specRef.settings=this.specRef.settings||{},this.specRef.settings[e]=t,this}getScale(e){return this.specRef.scales[e]}addScale(e,t){return this.specRef.scales[e]=t,this}regSource(e,t){return this.specRef.sources[e]=t,this}getSourceData(e){return(this.specRef.sources[e]||{data:[]}).data}getSourceDim(e,t){return(this.specRef.sources[e]||{dims:{}}).dims[t]||{}}}var Bn={};class In{static unit(e){return new $n(e)}static spec(e){return new zn(e)}static cloneObject(e){return JSON.parse(JSON.stringify(e))}static depthFirstSearch(e,t){if(t(e))return e;for(var i=e.hasOwnProperty("frames")?e.frames:[{units:e.units}],r=0;r<i.length;r++)for(var n=i[r].units||[],a=0;a<n.length;a++){var s=In.depthFirstSearch(n[a],t);if(s)return s}}static traverseSpec(e,t){const i=(e,t,r)=>{t(e,r),(e.units||[]).map(r=>i(r,t,e))};i(e.unit,t,null)}static extractFieldsFormatInfo(e){var t=e.scales,i=function(e){return!t[e].dim},r=function(e,i,r){var n=i.guide||{},a=t[i[r]],s=n[r]||{};e[a.dim]=e[a.dim]||{label:[],format:[],nullAlias:[],tickLabel:[]};var o=s.label,l=s.label||{};e[a.dim].label.push("string"==typeof o?o:l._original_text||l.text);var c=s.tickFormat||s.tickPeriod;e[a.dim].format.push(c),e[a.dim].nullAlias.push(s.tickFormatNullAlias),e[a.dim].tickLabel.push(s.tickLabel)},n=[];In.traverseSpec(e,function(e){n.push(e)});var a=n.reduce(function(e,t){return"COORDS.RECT"===t.type&&t.hasOwnProperty("x")&&!i(t.x)&&r(e,t,"x"),"COORDS.RECT"===t.type&&t.hasOwnProperty("y")&&!i(t.y)&&r(e,t,"y"),t.hasOwnProperty("color")&&!i(t.color)&&r(e,t,"color"),t.hasOwnProperty("size")&&!i(t.size)&&r(e,t,"size"),t.hasOwnProperty("label")&&!i(t.label)&&r(e,t,"label"),e},{}),s=function(e,t){return e.filter(e=>e)[0]||t};return Object.keys(a).reduce(function(t,i){t[i]={},t[i].label=s(a[i].label,i);const r=s(a[i].format,null);t[i].nullAlias=s(a[i].nullAlias,`No ${t[i].label}`),t[i].tickLabel=s(a[i].tickLabel,null);const n="x-time-auto"===r?e.settings.utcTime?"day-utc":"day":r;var o=t[i].nullAlias,l=n?fi.get(n,o):e=>null==e?o:String(e);if(t[i].format=l,t[i].tickLabel){var c=i.replace("."+t[i].tickLabel,"");t[c]={label:t[i].label,nullAlias:t[i].nullAlias,tickLabel:t[i].tickLabel,format:function(e){return l(e&&e[t[c].tickLabel])},isComplexField:!0},t[i].parentField=c}return t},{})}static getFieldFormatters(e,t){const i=In.extractFieldsFormatInfo(e);Object.keys(i).forEach(e=>{i[e].parentField&&delete i[e]});return Object.keys(t).forEach(e=>{const r=(e=>{let t={};return"function"==typeof e||"string"==typeof e?t={format:e}:ze(e)&&(t=dt(e,"label","format","nullAlias")),t})(t[e]);i[e]=Object.assign({label:e,nullAlias:"No "+e},i[e]||{},dt(r,"label","nullAlias")),r.hasOwnProperty("format")?i[e].format="function"==typeof r.format?r.format:fi.get(r.format,i[e].nullAlias):i[e].format=i[e].hasOwnProperty("format")?i[e].format:fi.get(null,i[e].nullAlias)}),Object.keys(i).reduce((e,t)=>{const r=i[t];return e[t]={label:r.label,format:r.format},e},{})}static tokens(){return{reg:function(e,t){return Bn[e]=t,this},get:function(e){return Bn[e]||e}}}static getParentUnit(e,t){var i=null;const r=(e,n)=>e.uid===t.uid?(i=n,!0):(e.frames?e.frames.some(t=>(t.units||[]).some(t=>r(t,e))):(e.units||[]).some(t=>r(t,e)),!1);return r(e.unit,null),i}}i(16);i.d(t,"api",function(){return Hn}),i.d(t,"version",function(){return Un}),i.d(t,"GPL",function(){return Ut}),i.d(t,"Plot",function(){return Xi}),i.d(t,"Chart",function(){return Ji});var jn={},Vn={},Hn={errorCodes:v,unitsRegistry:Qt,scalesRegistry:ti,grammarRegistry:_,tickFormat:fi,isChartElement:xt,utils:n,svgUtils:r,domUtils:a,tickPeriod:b,colorBrewers:{add:function(e,t){jn.hasOwnProperty(e)||(jn[e]=t)},get:function(e){return jn[e]}},d3_animationInterceptor:be,pluginsSDK:In,plugins:{add:function(e,t){if(Vn.hasOwnProperty(e))throw new Error("Plugin is already registered.");Vn[e]=t},get:function(e){return Vn[e]||(t=>{throw new Error(`"${e}" plugin is not defined`)})}},chartTypesRegistry:Ki,globalSettings:{animationSpeed:750,renderingTimeout:1e4,asyncRendering:!0,syncRenderingInterval:50,syncPointerEvents:!1,handleRenderingErrors:!1,experimentalShouldAnimate:e=>{const t=(e,t)=>{var i=document.createElementNS("http://www.w3.org/2000/svg",e);return Object.keys(t).forEach(e=>i.setAttribute(e,String(t[e]))),i},i=document.createElement("div");i.style.position="absolute",i.style.visibility="hidden",document.body.appendChild(i);const r=t("svg",{width:100,height:100});i.appendChild(r);const n=performance.now();var a,s,o;for(a=0;a<10;a++)for(s=0;s<10;s++)o=t("circle",{fill:"black",r:5,cx:10*a,cy:10*s}),r.appendChild(o);const l=performance.now()-n;return document.body.removeChild(i),e.sources["/"].data.length*l<500},defaultNiceColor:!0,defaultColorBrewer:["#fde725","#fbe723","#f8e621","#f6e620","#f4e61e","#f1e51d","#efe51c","#ece51b","#eae51a","#e7e419","#e5e419","#e2e418","#dfe318","#dde318","#dae319","#d8e219","#d5e21a","#d2e21b","#d0e11c","#cde11d","#cae11f","#c8e020","#c5e021","#c2df23","#c0df25","#bddf26","#bade28","#b8de29","#b5de2b","#b2dd2d","#b0dd2f","#addc30","#aadc32","#a8db34","#a5db36","#a2da37","#a0da39","#9dd93b","#9bd93c","#98d83e","#95d840","#93d741","#90d743","#8ed645","#8bd646","#89d548","#86d549","#84d44b","#81d34d","#7fd34e","#7cd250","#7ad151","#77d153","#75d054","#73d056","#70cf57","#6ece58","#6ccd5a","#69cd5b","#67cc5c","#65cb5e","#63cb5f","#60ca60","#5ec962","#5cc863","#5ac864","#58c765","#56c667","#54c568","#52c569","#50c46a","#4ec36b","#4cc26c","#4ac16d","#48c16e","#46c06f","#44bf70","#42be71","#40bd72","#3fbc73","#3dbc74","#3bbb75","#3aba76","#38b977","#37b878","#35b779","#34b679","#32b67a","#31b57b","#2fb47c","#2eb37c","#2db27d","#2cb17e","#2ab07f","#29af7f","#28ae80","#27ad81","#26ad81","#25ac82","#25ab82","#24aa83","#23a983","#22a884","#22a785","#21a685","#21a585","#20a486","#20a386","#1fa287","#1fa187","#1fa188","#1fa088","#1f9f88","#1f9e89","#1e9d89","#1e9c89","#1e9b8a","#1f9a8a","#1f998a","#1f988b","#1f978b","#1f968b","#1f958b","#1f948c","#20938c","#20928c","#20928c","#21918c","#21908d","#218f8d","#218e8d","#228d8d","#228c8d","#228b8d","#238a8d","#23898e","#23888e","#24878e","#24868e","#25858e","#25848e","#25838e","#26828e","#26828e","#26818e","#27808e","#277f8e","#277e8e","#287d8e","#287c8e","#297b8e","#297a8e","#29798e","#2a788e","#2a778e","#2a768e","#2b758e","#2b748e","#2c738e","#2c728e","#2c718e","#2d718e","#2d708e","#2e6f8e","#2e6e8e","#2e6d8e","#2f6c8e","#2f6b8e","#306a8e","#30698e","#31688e","#31678e","#31668e","#32658e","#32648e","#33638d","#33628d","#34618d","#34608d","#355f8d","#355e8d","#365d8d","#365c8d","#375b8d","#375a8c","#38598c","#38588c","#39568c","#39558c","#3a548c","#3a538b","#3b528b","#3b518b","#3c508b","#3c4f8a","#3d4e8a","#3d4d8a","#3e4c8a","#3e4a89","#3e4989","#3f4889","#3f4788","#404688","#404588","#414487","#414287","#424186","#424086","#423f85","#433e85","#433d84","#443b84","#443a83","#443983","#453882","#453781","#453581","#463480","#46337f","#46327e","#46307e","#472f7d","#472e7c","#472d7b","#472c7a","#472a7a","#482979","#482878","#482677","#482576","#482475","#482374","#482173","#482071","#481f70","#481d6f","#481c6e","#481b6d","#481a6c","#48186a","#481769","#481668","#481467","#471365","#471164","#471063","#470e61","#470d60","#460b5e","#460a5d","#46085c","#46075a","#450559","#450457","#440256","#440154"],defaultClassBrewer:Qe(20).map(e=>"color20-"+(1+e)),log:(e,t)=>{t=t||"INFO",Array.isArray(e)||(e=[e]),console[t.toLowerCase()].apply(console,e)},facetLabelDelimiter:" → ",excludeNull:!0,minChartWidth:300,minChartHeight:200,minFacetWidth:150,minFacetHeight:100,specEngine:[{name:"COMPACT",width:600,height:400},{name:"AUTO",width:Number.MAX_VALUE,height:Number.MAX_VALUE}],fitModel:"normal",layoutEngine:"EXTRACT",autoRatio:!0,defaultSourceMap:["https://raw.githubusercontent.com","TargetProcess/tauCharts/master/src/addons","world-countries.json"].join("/"),getAxisTickLabelSize:lt(Pt,e=>String(String(e).length)),getScrollbarSize:Tt,avoidScrollAtRatio:1.5,xAxisTickLabelLimit:150,yAxisTickLabelLimit:150,xTickWordWrapLinesLimit:2,yTickWordWrapLinesLimit:2,xTickWidth:9,yTickWidth:9,distToXAxisLabel:10,distToYAxisLabel:10,xAxisPadding:20,yAxisPadding:20,xFontLabelDescenderLineHeight:4,xFontLabelHeight:10,yFontLabelHeight:10,xDensityPadding:2,yDensityPadding:2,"xDensityPadding:measure":8,"yDensityPadding:measure":8,utcTime:!1,defaultFormats:{measure:"x-num-auto","measure:time":"x-time-auto"}}};Xi.__api__=Hn,Xi.globalSettings=Hn.globalSettings,Hn.unitsRegistry.reg("COORDS.RECT",class extends f{constructor(e){super(e),this.config=e,this.config.guide=st(this.config.guide||{},{showGridLines:"xy",padding:{l:50,r:0,t:0,b:50}}),this.config.guide.x=this.config.guide.x||{},this.config.guide.x=st(this.config.guide.x,{cssClass:"x axis",textAnchor:"middle",padding:10,hide:!1,scaleOrient:"bottom",rotate:0,density:20,label:{},tickFormatWordWrapLimit:100}),"string"==typeof this.config.guide.x.label&&(this.config.guide.x.label={text:this.config.guide.x.label}),this.config.guide.x.label=st(this.config.guide.x.label,{text:"X",rotate:0,padding:40,textAnchor:"middle"}),this.config.guide.y=this.config.guide.y||{},this.config.guide.y=st(this.config.guide.y,{cssClass:"y axis",textAnchor:"start",padding:10,hide:!1,scaleOrient:"left",rotate:0,density:20,label:{},tickFormatWordWrapLimit:100}),"string"==typeof this.config.guide.y.label&&(this.config.guide.y.label={text:this.config.guide.y.label}),this.config.guide.y.label=st(this.config.guide.y.label,{text:"Y",rotate:-90,padding:20,textAnchor:"middle"});var t=this.config,i=t.guide;if("extract-axes"===i.autoLayout){var r=t.options.containerHeight-(t.options.top+t.options.height);i.x.hide=i.x.hide||Math.floor(r)>0,i.y.hide=i.y.hide||Math.floor(t.options.left)>0}var n=this.config.options,a=this.config.guide.padding;this.L=n.left+a.l,this.T=n.top+a.t,this.W=n.width-(a.l+a.r),this.H=n.height-(a.t+a.b)}defineGrammarModel(e){const t=this.W,i=this.H;return this.xScale=e("pos",this.config.x,[0,t]),this.yScale=e("pos",this.config.y,e=>["ordinal","period"].indexOf(e.type)>=0?[0,i]:[i,0]),this.regScale("x",this.xScale).regScale("y",this.yScale),{scaleX:this.xScale,scaleY:this.yScale,xi:()=>t/2,yi:()=>i/2,sizeX:()=>t,sizeY:()=>i}}getGrammarRules(){return[e=>{var t=e.scaleX,i=e.scaleY;return{xi:i=>i?t(i[t.dim]):e.xi(i),yi:t=>t?i(t[i.dim]):e.yi(t),sizeX:i=>i?t.stepSize(i[t.dim]):e.sizeX(i),sizeY:t=>t?i.stepSize(t[i.dim]):e.sizeY(t)}}]}createScreenModel(e){return e}allocateRect(e){var t=this.screenModel;return{slot:e=>this.config.options.container.selectAll(`.uid_${e}`),left:t.xi(e)-t.sizeX(e)/2,top:t.yi(e)-t.sizeY(e)/2,width:t.sizeX(e),height:t.sizeY(e),containerWidth:this.W,containerHeight:this.H}}drawFrames(e){var t=Object.assign({},this.config),i=t.options,r=this.W,n=this.H;if(t.x=this.xScale,t.y=this.yScale,t.x.scaleObj=this.xScale,t.y.scaleObj=this.yScale,t.x.guide=t.guide.x,t.y.guide=t.guide.y,t.x.guide.label.size=r,t.y.guide.label.size=n,(i.container.attr("transform")?he(i.container,this.config.guide.animationSpeed,"cartesianContainerTransform"):i.container).attr("transform",E(this.L,this.T)),t.x.guide.hide)this._removeDimAxis(i.container,t.x);else{var a="top"===t.x.guide.scaleOrient?[0,0-t.guide.x.padding]:[0,n+t.guide.x.padding];this._drawDimAxis(i.container,t.x,a,r)}if(t.y.guide.hide)this._removeDimAxis(i.container,t.y);else{var s="right"===t.y.guide.scaleOrient?[r+t.guide.y.padding,0]:[0-t.guide.y.padding,0];this._drawDimAxis(i.container,t.y,s,n)}var o=e.reduce((e,t)=>e.concat((t.units||[]).map(e=>e.uid)),[]),l=this._drawGrid(i.container,t,r,n,i),c=ye(l,".cell").data(o,e=>e);c.enter().append("g").attr("class",e=>`${O}cell cell uid_${e}`).merge(c).classed("tau-active",!0),he(c,this.config.guide.animationSpeed).attr("opacity",1),he(c.exit().classed("tau-active",!1),this.config.guide.animationSpeed).attr("opacity",1e-6).remove()}_drawDimAxis(e,t,i,r){var n=fi.get(t.guide.tickFormat,t.guide.tickFormatNullAlias),a=$({scale:t.scaleObj,scaleGuide:t.guide,ticksCount:n?Zi(r/t.guide.density):null,tickFormat:n||null,position:i}),s=this.config.guide.animationSpeed;Qi(e,this._getAxisSelector(t)).classed("tau-active",!0).classed(t.guide.cssClass,!0).call(e=>{var t=he(e,s,"axisTransition"),r=e.attr("transform");E(...i)!==r&&(r?t:e).attr("transform",E(...i)),t.call(a),t.attr("opacity",1)})}_removeDimAxis(e,t){var i=ye(e,this._getAxisSelector(t)).classed("tau-active",!1);he(i,this.config.guide.animationSpeed,"axisTransition").attr("opacity",1e-6).remove()}_getAxisSelector(e){return`g.${"h"===T(e.guide.scaleOrient)?"x":"y"}.axis`}_drawGrid(e,t,i,r){return Qi(e,"g.grid").attr("transform",E(0,0)).call(e=>{var n=e,a=this.config.guide.animationSpeed,s=(t.guide.showGridLines||"").toLowerCase();if(s.length>0){var o=Qi(n,"g.grid-lines");if(s.indexOf("x")>-1){let e=t.x,n=fi.get(e.guide.tickFormat);var l=z({scale:e.scaleObj,scaleGuide:e.guide,tickSize:r,ticksCount:n?Zi(i/e.guide.density):null}),c=Qi(o,"g.grid-lines-x");he(c,a).call(l)}if(s.indexOf("y")>-1){let e=t.y,n=fi.get(e.guide.tickFormat);var d=z({scale:e.scaleObj,scaleGuide:e.guide,tickSize:-i,ticksCount:n?Zi(r/e.guide.density):null}),u=Qi(o,"g.grid-lines-y");he(u,a).call(d)}}})}}).reg("COORDS.MAP",class extends f{constructor(e){super(e),this.config=e,this.config.guide=st(this.config.guide||{},{defaultFill:"rgba(128,128,128,0.25)",padding:{l:0,r:0,t:0,b:0},showNames:!0}),this.contourToFill=null,this.on("highlight-area",(e,t)=>this._highlightArea(t)),this.on("highlight-point",(e,t)=>this._highlightPoint(t)),this.on("highlight",(e,t)=>this._highlightPoint(t))}defineGrammarModel(e){var t=this.config,i=t.options,r=t.guide.padding,n=i.width-(r.l+r.r),a=i.height-(r.t+r.b);return this.latScale=e("pos",t.latitude,[0,a]),this.lonScale=e("pos",t.longitude,[n,0]),this.sizeScale=e("size",t.size),this.colorScale=e("color",t.color),this.codeScale=e("value",t.code),this.fillScale=e("fill",t.fill),this.W=n,this.H=a,this.regScale("latitude",this.latScale).regScale("longitude",this.lonScale).regScale("size",this.sizeScale).regScale("color",this.colorScale).regScale("code",this.codeScale).regScale("fill",this.fillScale),{}}drawFrames(e){var t=this.config.guide;"string"==typeof t.sourcemap?function(e,t){const i=new XMLHttpRequest;i.onload=(()=>{if(i.status>=200&&i.status<300){const e=i.responseText;try{t(null,JSON.parse(e))}catch(e){t(e,null)}}else t(new Error(`${i.status}: ${i.statusText}`),null)}),i.onerror=(e=>{t(e.error,null)}),i.open("GET",e,!0),i.send(null)}(t.sourcemap,(t,i)=>{if(t)throw t;this._drawMap(e,i)}):this._drawMap(e,t.sourcemap)}_calcLabels(e,t,i){var r=this.W,n=this.H,a={};return t.forEach(t=>{var s=(ir.feature(e,e.objects[t]).features||[]).map(e=>{var n=e.properties||{},a=i.centroid(e),s=i.bounds(e),o=a[0],l=a[1],c=s[1][0]-s[0][0],d=n.name||"",u=n.abbr||d,h=c<d.length*ar?u:d,f=c<2.5*ar,p=f?r-o-3*ar:0;return{id:`${t}-${e.id}`,sx:o,sy:l,x:o+p,y:l,width:h.length*ar,height:10,name:h,r:p,isRef:f}}).filter(e=>!Number.isNaN(e.x)&&!Number.isNaN(e.y)),o=s.map(e=>({x:e.sx,y:e.sy,r:e.r}));rr().label(s).anchor(o).width(r).height(n).start(sr),s.filter(e=>!e.isRef).map(e=>(e.x=e.sx,e.y=e.sy,e)).reduce((e,t)=>(e[t.id]=t,e),a);var l=s.filter(e=>e.isRef);l.length<6&&l.reduce((e,t)=>(e[t.id]=t,e),a)}),a}_drawMap(e,t){var i,r,n=this,a=this.config.guide,o=this.config.options,l=this.config.options.container,c=this.latScale,d=this.lonScale,u=this.sizeScale,h=this.colorScale,f=this.codeScale,p=this.fillScale,g=this.W,m=this.H,b=lr.filter(e=>(t.objects||{}).hasOwnProperty(e));if(0===b.length)throw new Error("Invalid map: should contain some contours");if(p.dim){if(!f.georole)throw console.log("Specify [georole] for code scale"),new Error("[georole] is missing");if(-1===b.indexOf(f.georole))throw console.log(`There is no contour for georole "${f.georole}"`),console.log(`Available contours are: ${b.join(" | ")}`),new Error("Invalid [georole]");i=f.georole}else i=b[b.length-1];if(this.contourToFill=i,c.dim&&d.dim){var y=nr.extent(c.domain()),v=nr.extent(d.domain());r=[(v[1]+v[0])/2,(y[1]+y[0])/2]}var x=this._createProjection(t,b[0],r),_=nr.geoPath().projection(x),w=l.selectAll(".map-container").data([`${g}${m}${r}${b.join("-")}`],e=>e);w.exit().remove();const E=w.enter().append("g").call(function(e){var i=e;i.attr("class","map-container");var r={},s=b.reduceRight((e,t)=>e.concat(t),[]);if(a.showNames&&(r=n._calcLabels(t,s,_)),s.forEach((e,n)=>{var a=t=>r[`${e}-${t.id}`];i.selectAll(`.map-contour-${e}`).data(ir.feature(t,t.objects[e]).features||[]).enter().append("g").call(function(t){var i=t;i.attr("class",`map-contour-${e} map-contour-level map-contour-level-${n}`).attr("fill","none"),i.append("title").text(e=>(e.properties||{}).name),i.append("path").attr("d",_),i.append("text").attr("class",`place-label-${e}`).attr("transform",e=>{var t=a(e);return t?`translate(${[t.x,t.y]})`:""}).text(e=>{var t=a(e);return t?t.name:""}),i.append("line").attr("class",`place-label-link-${e}`).attr("stroke","gray").attr("stroke-width",.25).attr("x1",e=>{var t=a(e);return t&&t.isRef?t.sx:0}).attr("y1",e=>{var t=a(e);return t&&t.isRef?t.sy:0}).attr("x2",e=>{var t=a(e);return t&&t.isRef?t.x-.6*t.name.length*ar:0}).attr("y2",e=>{var t=a(e);return t&&t.isRef?t.y-3.5:0})})}),t.objects.hasOwnProperty("places")){var o=ir.feature(t,t.objects.places),l=o.features.map(e=>{var t=x(e.geometry.coordinates);return{x:t[0]+3.5,y:t[1]+3.5,width:e.properties.name.length*ar,height:12,name:e.properties.name}}),c=o.features.map(e=>{var t=x(e.geometry.coordinates);return{x:t[0],y:t[1],r:2.5}});rr().label(l).anchor(c).width(g).height(m).start(100),i.selectAll(".place").data(c).enter().append("circle").attr("class","place").attr("transform",e=>`translate(${e.x},${e.y})`).attr("r",e=>`${e.r}px`),i.selectAll(".place-label").data(l).enter().append("text").attr("class","place-label").attr("transform",e=>`translate(${e.x},${e.y})`).text(e=>e.name)}}).merge(w);this.groupByCode=e.reduce((e,t)=>t.part().reduce((e,t)=>(e[(t[f.dim]||"").toLowerCase()]=t,e),e),{});var S=this._resolveFeature.bind(this);if(E.selectAll(`.map-contour-${i}`).data(ir.feature(t,t.objects[i]).features).call(function(e){e.classed("map-contour",!0).attr("fill",e=>{var t=S(e);return null===t?a.defaultFill:p(t[p.dim])})}).on("mouseover",e=>this.fire("area-mouseover",{data:S(e),event:s.event})).on("mouseout",e=>this.fire("area-mouseout",{data:S(e),event:s.event})).on("click",e=>this.fire("area-click",{data:S(e),event:s.event})),!c.dim||!d.dim)return[];var T=function(e){return e.attr("r",e=>u(e[u.dim])).attr("transform",({data:e})=>`translate(${x([e[d.dim],e[c.dim]])})`).attr("class",({data:e})=>h(e[h.dim])).attr("opacity",or).on("mouseover",({data:e})=>n.fire("point-mouseover",{data:e,event:s.event})).on("mouseout",({data:e})=>n.fire("point-mouseout",{data:e,event:s.event})).on("click",({data:e})=>n.fire("point-click",{data:e,event:s.event}))},M=E.selectAll(".frame").data(e.map(e=>({tags:e.key||{},hash:e.hash(),data:e.part()})),e=>e.hash);return M.exit().remove(),M.enter().append("g").merge(M).call(function(e){e.attr("class",e=>`frame frame-${e.hash}`).call(function(e){var t=e.selectAll("circle").data(e=>e.data.map(e=>({data:e,uid:o.uid})));t.exit().remove(),t.call(T),t.enter().append("circle").call(T)})}),[]}_resolveFeature(e){var t,i=this.groupByCode,r=e.properties,n=["c1","c2","c3","abbr","name"].filter(e=>r.hasOwnProperty(e)&&r[e]&&i.hasOwnProperty(r[e].toLowerCase()));if(0===n.length)t=null;else if(n.length>0){let e=r[n[0]].toLowerCase();t=i[e]}return t}_highlightArea(e){var t=this.config.options.container,i=this.contourToFill;t.selectAll(`.map-contour-${i}`).classed("map-contour-highlighted",t=>e(this._resolveFeature(t)))}_highlightPoint(e){this.config.options.container.selectAll("circle").classed("map-point-highlighted",({data:t})=>e(t)).attr("opacity",({data:t})=>e(t)?or:.1)}_createProjection(e,t,i){var r=this.W,n=this.H,a=this.config.guide,s=100,o=[r/2,n/2],l=i||e.center,c=a.projection||e.projection||"mercator",d=this._createD3Projection(c,l,s,o),u=nr.geoPath().projection(d).bounds(ir.feature(e,e.objects[t])),h=s*r/(u[1][0]-u[0][0]),f=s*n/(u[1][1]-u[0][1]);return s=h<f?h:f,o=[r-(u[0][0]+u[1][0])/2,n-(u[0][1]+u[1][1])/2],this._createD3Projection(c,l,s,o)}_createD3Projection(e,t,i,r){var n="geo"+e.substring(0,1).toUpperCase()+e.substring(1),a=nr[n];if(!a)throw console.log(`Unknown projection "${e}"`),console.log("See available projection types here: https://github.com/mbostock/d3/wiki/Geo-Projections"),new Error(`Invalid map: unknown projection "${e}"`);var s=a();return[{method:"scale",args:i},{method:"center",args:t},{method:"translate",args:r}].filter(e=>e.args).reduce((e,t)=>(e[t.method]&&(e=e[t.method](t.args)),e),s)}}).reg("COORDS.PARALLEL",class extends f{constructor(e){super(e),this.config=e,this.config.guide=st(this.config.guide||{},{padding:{l:50,r:50,t:50,b:50},enableBrushing:!1}),this.columnsBrushes={},this.columnsSelections={},this.on("force-brush",(e,t)=>this._forceBrushing(t));var t=this.config.options,i=this.config.guide.padding;this.L=t.left+i.l,this.T=t.top+i.t,this.W=t.width-(i.l+i.r),this.H=t.height-(i.t+i.b)}defineGrammarModel(e){var t=this.config,i=this.W,r=this.H;this.columnsScalesMap=t.columns.reduce((t,i)=>(t[i]=e("pos",i,[0,r]),t),{});var n=i/(t.columns.length-1),a=t.columns.reduce((e,t,i)=>(e[t]=i*n,e),{});return this.xBase=(e=>a[e]),this.regScale("columns",this.columnsScalesMap),{}}allocateRect(){return{slot:e=>this.config.options.container.selectAll(`.uid_${e}`),left:0,top:0,width:this.W,height:this.H,containerWidth:this.W,containerHeight:this.H}}drawFrames(e){var t=Object.assign({},this.config),i=t.options,r=this._fnDrawGrid(i.container,t,i.frameId,Object.keys(this.columnsScalesMap).reduce((e,t)=>e.concat([this.columnsScalesMap[t].getHash()]),[]).join("_")),n=r.selectAll(`.parent-frame-${i.frameId}`).data(e,e=>e.hash());n.exit().remove(),n.enter().append("g").attr("class",e=>`${O}cell cell parent-frame-${i.frameId} frame-${e.hash()}`).merge(n).each(function(e){var t,r,n,a;t=i.frameId,r=er.select(this),n=e,(a=r.selectAll(`.layer_${t}`).data(n.units,e=>e.uid)).exit().remove(),a.enter().append("g").attr("class",e=>`layer_${t} uid_${e.uid}`)});var a=this._fnDrawColumns(r,t);t.guide.enableBrushing&&this._enableBrushing(a)}_fnDrawGrid(e,t,i,r){var n=e.selectAll(`.grid_${i}`).data([r],e=>e);return n.exit().remove(),n.enter().append("g").attr("class",`grid grid_${i}`).attr("transform",E(this.L,this.T)).merge(n)}_fnDrawColumns(e,t){var i=t.guide.columns||{},r=this.xBase,n=this.columnsScalesMap,a=er.axisLeft(),s=e.selectAll(".column").data(t.columns,e=>e);return s.exit().remove(),s.enter().append("g").attr("class","column").attr("transform",e=>E(r(e),0)).call(function(e){e.append("g").attr("class","y axis").each(function(e){var t=n[e].dim,r=a.scale(n[e]),s=i[t]||{},o=fi.get(s.tickFormat,s.tickFormatNullAlias);null!==o&&r.tickFormat(o),er.select(this).call(r)}).append("text").attr("class","label").attr("text-anchor","middle").attr("y",-9).text(e=>((i[e]||{}).label||{}).text||n[e].dim)}).merge(s)}_enableBrushing(e){var t=this.columnsSelections,i=this.columnsScalesMap,r=this.columnsBrushes,n=!0,a=e=>e,o=e=>e,l=()=>{var e=Object.keys(r).find(e=>r[e]===s.event.target);if(t[e]=s.event.selection,n){var a=Object.keys(r).filter(e=>t[e]).map(e=>{var r=[];if(i[e].discrete){let n=t[e];r=i[e].domain().filter(t=>{var r=i[e](t);return n[0]<=r&&n[1]>=r})}else{let n=t[e].map(i[e].invert);r=[n[0],n[1]]}return{dim:i[e].dim,func:i[e].discrete?"inset":"between",args:r}});this.fire("brush",a)}};return e.selectAll(".brush").remove(),e.append("g").attr("class","brush").each(function(e){var t=i[e].range();r[e]=er.brushY().extent([[0,t[0]],[16,t[1]]]).on("start",a).on("brush",l).on("end",o),er.select(this).classed(`brush-${He(e)}`,!0).call(r[e]),n=!1,r[e].move(er.select(this),t),n=!0}).selectAll("rect").attr("transform","translate(-8,0)").attr("width",16),e}_forceBrushing(e={}){var t=this.columnsBrushes,i=this.columnsScalesMap;this.columnsSelections,Object.keys(e).filter(r=>t[r]&&i[r]&&e[r]).forEach(r=>{var n=e[r],a=[];if(i[r].discrete){var s=n.map(i[r]).filter(e=>e>=0),o=i[r].stepSize()/2;a=[Math.min(...s)-o,Math.max(...s)+o]}else a=[n[0],n[1]];var l=He(r);t[r](er.select(`.brush-${l}`)),t[r].move(er.select(`.brush-${l}`),a.map(i[r]))})}}).reg("ELEMENT.GENERIC.CARTESIAN",we).reg("ELEMENT.POINT",kr,"ELEMENT.GENERIC.CARTESIAN").reg("ELEMENT.LINE",on,"ELEMENT.GENERIC.CARTESIAN").reg("ELEMENT.PATH",nn,"ELEMENT.GENERIC.CARTESIAN").reg("ELEMENT.AREA",rn,"ELEMENT.GENERIC.CARTESIAN").reg("ELEMENT.INTERVAL",cn,"ELEMENT.GENERIC.CARTESIAN").reg("ELEMENT.INTERVAL.STACKED",cn,"ELEMENT.GENERIC.CARTESIAN").reg("ELEMENT.INTERVAL.STACKED",cn,"ELEMENT.GENERIC.CARTESIAN").reg("PARALLEL/ELEMENT.LINE",class extends f{constructor(e){super(e),this.config=e,this.config.guide=st(this.config.guide||{},{}),this.on("highlight",(e,t)=>this.highlight(t))}defineGrammarModel(e){var t=this.config,i=t.options;this.color=e("color",t.color,{}),this.scalesMap=t.columns.reduce((t,r)=>(t[r]=e("pos",r,[0,i.height]),t),{});var r=i.width/(t.columns.length-1),n=t.columns.reduce((e,t,i)=>(e[t]=i*r,e),{});return this.xBase=(e=>n[e]),this.regScale("columns",this.scalesMap).regScale("color",this.color),{}}drawFrames(e){var t=this.config,i=this.config.options,r=this.scalesMap,n=this.xBase,a=this.color,s=dn.line(),o=function(e){e.attr("d",e=>s(t.columns.map(t=>[n(t),r[t](e[r[t].dim])])))},l=function(e){e.attr("stroke",e=>a.toColor(a(e[a.dim]))),e.attr("class",e=>`${O}__line line ${a.toClass(a(e[a.dim]))} foreground`)},c=function(e){var t=e.selectAll(".background").data(e=>e.part());t.exit().remove(),t.call(o),t.enter().append("path").attr("class","background line").call(o);var i=e.selectAll(".foreground").data(e=>e.part());i.exit().remove(),i.call(function(e){o(e),l(e)}),i.enter().append("path").call(function(e){o(e),l(e)})},d=i.container.selectAll(".lines-frame").data(e,e=>e.hash());d.exit().remove(),d.call(c),d.enter().append("g").attr("class","lines-frame").call(c),this.subscribe(i.container.selectAll(".lines-frame .foreground"))}highlight(e){this.config.options.container.selectAll(".lines-frame .foreground").style("visibility",t=>e(t)?"":"hidden")}}),Hn.scalesRegistry.reg("identity",class extends fn{constructor(e,t){super(e,t),this._references=t.references,this._refCounter=t.refCounter,this.addField("scaleType","identity")}create(){var e=this._references,t=this._refCounter;return this.toBaseScale((i,r)=>{if(null==i){var n=e.get(r);null==n&&(n=t(),e.set(r,n))}else n=i;return n})}},(e,t)=>st(e,{references:t.references,refCounter:t.refCounter})).reg("color",class extends fn{constructor(e,t){super(e,t);var i="measure"!==t.dimType,r=this.scaleConfig.brewer||(i?Qe(20).map(e=>"color20-"+(1+e)):["#eee","#000"]),n=this.scaleConfig;if(!i){var a=pn.extent(this.vars),s=e=>Number.isFinite(e)||$e(e),o=s(n.min)?n.min:a[0],l=s(n.max)?n.max:a[1],c=[o,a[0]].filter(s),d=[l,a[1]].filter(s);if(a=[c.sort((e,t)=>e-t)[0],d.sort((e,t)=>t-e)[0]],n.nice&&a[0]<0&&a[1]>0){let e=Math.max(...a.map(Math.abs));a=[-e,e]}this.vars=a}this.addField("scaleType","color").addField("discrete",i).addField("brewer",r).addField("toColor",qe).addField("toClass",Ye)}create(){var e=this.discrete,t=this.vars,i=this.getField("brewer"),r=e?this.createDiscreteScale(t,i):this.createContinuesScale(t,i);return this.toBaseScale(r)}createDiscreteScale(e,t){var i,r=(e,t)=>{var i=e.map(e=>String(e).toString());return pn.scaleOrdinal().range(t).domain(i)},n=e=>t=>e(String(t).toString());if(Array.isArray(t))i=n(r(e,t));else if("function"==typeof t)i=(i=>t(i,n(r(e,Qe(20).map(e=>"color20-"+(1+e))))));else{if(!ze(t))throw new Error("This brewer is not supported");i=((e,t)=>{var i=Object.keys(e),r=i.map(t=>e[t]),n=pn.scaleOrdinal().range(r).domain(i);return i=>e.hasOwnProperty(i)?n(String(i)):t(i)})(t,()=>"color-default")}return i}createContinuesScale(e,t){if(!Array.isArray(t))throw new Error("This brewer is not supported");return pn.scaleLinear().domain(Ge(e.map(e=>e-0),t.length)).range(t)}},(e,t)=>st(e,{nice:t.defaultNiceColor,brewer:"measure"===e.dimType?t.defaultColorBrewer:t.defaultClassBrewer})).reg("fill",class extends fn{constructor(e,t){super(e,t);var i=this.scaleConfig,r=Mn.extent(this.vars),n=Number.isFinite(i.min)?i.min:r[0],a=Number.isFinite(i.max)?i.max:r[1];r=[Math.min(n,r[0]),Math.max(a,r[1])],this.vars=i.nice?Be(r):Mn.extent(r);var s=Qe(10).map(e=>`rgba(90,180,90,${(.2+e*(.8/9)).toFixed(2)})`),o=i.brewer||s;this.addField("scaleType","fill").addField("brewer",o)}isInDomain(e){var t=this.domain(),i=t[0],r=t[t.length-1];return!Number.isNaN(i)&&!Number.isNaN(r)&&e<=r&&e>=i}create(){var e=this.vars,t=this.getField("brewer");if(!Array.isArray(t))throw new Error("This brewer is not supported");var i=t.length,r=(e[1]-e[0])/i,n=Qe(i-1).map(e=>e+1).reduce((t,i)=>t.concat([e[0]+i*r]),[]),a=Mn.scaleThreshold().domain(n).range(t);return this.toBaseScale(a)}}).reg("size",class extends fn{constructor(e,t){super(e,t);var i=this.scaleConfig,r=o.extent(this.vars),n=Number.isFinite(i.min)?i.min:r[0],a=Number.isFinite(i.max)?i.max:r[1];this.vars=[Math.min(...[n,r[0]].filter(Number.isFinite)),Math.max(...[a,r[1]].filter(Number.isFinite))],this.addField("scaleType","size"),this.addField("funcType",t.func||"sqrt")}isInDomain(e){var t=this.domain().sort(),i=t[0],r=t[t.length-1];return!Number.isNaN(i)&&!Number.isNaN(r)&&e<=r&&e>=i}create(){var e,t=this.scaleConfig,i=this.vars,r=st({},t,{func:"sqrt",minSize:0,maxSize:1}),n=r.func,a=r.minSize,s=r.maxSize,o=gn[n],l=i.filter(e=>Number.isFinite(Number(e)));if(0===l.length)e=(()=>s);else{var c,d,u=Math.min(...l),h=Math.max(...l),f=o(Math.max(Math.abs(u),Math.abs(h),h-u));d=u<0?u:0,c=0===f?1:(s-a)/f,e=(e=>{var t=null!==e?parseFloat(e):0;return Number.isFinite(t)?a+o(t-d)*c:s})}return this.toBaseScale(e)}}).reg("ordinal",class extends fn{constructor(e,t){super(e,t),this.addField("scaleType","ordinal").addField("discrete",!0)}create(e){var t=this.scaleConfig,i=this.vars,r=l.scalePoint().domain(i).range(e).padding(.5),n=Math.max(...e),a=e=>"function"==typeof t.ratio?t.ratio(e,n,i):"object"==typeof t.ratio?t.ratio[e]:1/i.length,s=e=>t.ratio?n-i.slice(i.indexOf(e)+1).reduce((e,t)=>e+n*a(t),n*a(e)*.5):r(e);return Object.keys(r).forEach(e=>s[e]=r[e]),s.stepSize=(e=>a(e)*n),this.toBaseScale(s,e)}}).reg("period",class extends fn{constructor(e,t){super(e,t);var i=this.scaleConfig,r=this.vars,n=mn.extent(r),a=null===i.min||void 0===i.min?n[0]:new Date(i.min).getTime(),s=null===i.max||void 0===i.max?n[1]:new Date(i.max).getTime(),o=[new Date(Math.min(a,n[0])),new Date(Math.max(s,n[1]))],l=b.get(i.period,{utc:i.utcTime});i.fitToFrameByDims||null===l?this.vars=it(r.map(e=>new Date(e)),e=>e.getTime()).sort((e,t)=>Number(t)-Number(e)):this.vars=b.generate(o[0],o[1],i.period,{utc:i.utcTime}),this.periodGenerator=l,this.addField("scaleType","period").addField("utcTime",this.scaleConfig.utcTime).addField("period",this.scaleConfig.period).addField("discrete",!0)}isInDomain(e){const t=this.periodGenerator,i=new Date(e),r=(t?t.cast(i):i).getTime();return this.domain().map(e=>e.getTime()).indexOf(r)>=0}create(e){const t=this.periodGenerator;var i=this.vars,r=this.vars.map(e=>e.getTime()),n=this.scaleConfig,a=mn.scalePoint().domain(i).range(e).padding(.5),s=mn.scalePoint().domain(r.map(String)).range(e).padding(.5),o=Math.max(...e),l=e=>{var t=new Date(e).getTime();return"function"==typeof n.ratio?n.ratio(t,o,r):"object"==typeof n.ratio?n.ratio[t]:1/i.length},c=e=>{const i=new Date(e),a=(t?t.cast(i):i).getTime();return n.ratio?o-r.slice(r.indexOf(a)+1).reduce((e,t)=>e+o*l(t),o*l(e)*.5):s(String(a))};return Object.keys(a).forEach(e=>c[e]=a[e]),c.stepSize=(e=>l(e)*o),this.toBaseScale(c,e)}},(e,t)=>st(e,{utcTime:t.utcTime})).reg("time",class extends fn{constructor(e,t){super(e,t);var i=this.scaleConfig,r=this.vars;const n=i.period?b.get(this.scaleConfig.period,{utc:i.utcTime}):null,a=yn.extent(r).map(n?e=>n.cast(new Date(e)):e=>new Date(e)),s=null==i.min?a[0]:new Date(i.min).getTime(),o=null==i.max?a[1]:new Date(i.max).getTime();if(r=[new Date(Math.min(s,Number(a[0]))),new Date(Math.max(o,Number(a[1])))],this.niceIntervalFn=null,i.nice&&!n){var l=i.niceInterval,c=l&&vn(l)?i.utcTime?yn[`utc${(d=l)[0].toUpperCase()}${d.slice(1)}`]:vn(l):null;this.niceIntervalFn=c||null,this.vars=Ie(r,this.niceIntervalFn,{utc:i.utcTime})}else this.vars=r;var d;if(n&&Number(this.vars[0])===Number(this.vars[1])){let e=this.vars[0];this.vars[0]=n.cast(new Date(Number(e)-1)),this.vars[1]=n.next(e)}this.periodGenerator=n,this.addField("scaleType","time").addField("utcTime",this.scaleConfig.utcTime).addField("period",this.scaleConfig.period)}isInDomain(e){var t=new Date(e);this.scaleConfig.period&&(t=this.periodGenerator.cast(t));var i=this.domain(),r=i[0],n=i[i.length-1];return!Number.isNaN(r)&&!Number.isNaN(n)&&t<=n&&t>=r}create(e){var t=this.vars,i=this.scaleConfig.utcTime;const r=this.periodGenerator,n=(i?yn.scaleUtc:yn.scaleTime)().domain(t).range(e);var a=e=>{var i=t[0],r=t[1];return e>r&&(e=r),e<i&&(e=i),n(new Date(e))};if(this.scaleConfig.period){const[e,s]=t;n.ticks,n.ticks=(t=>("number"!=typeof t&&(t=10),function(e,t,i,r=10){const[n,a]=e,s=b.get(t,{utc:i}),o=Number(n),l=Number(a),c=Number(s.next(s.cast(n)))-Number(s.cast(n));return(l-o)/c<=r?b.generate(n,a,t,{utc:i}).filter(e=>e>=n&&e<=a):function(e,t,i=10){const r=Number(e[0]),n=Number(e[1]),a=Math.abs(n-r)/i;var s,o;const l=yn.bisector(e=>e.duration).right(_n,a);if(l===_n.length)s=t?yn.utcYear:yn.timeYear,o=yn.tickStep(r/xn.year.duration,n/xn.year.duration,i);else if(l){let e=a/_n[l-1].duration,i=_n[l].duration/a,r=_n[e<i?l-1:l];s=t?r.time.utc:r.time.interval,o=r.step}else s=t?yn.utcMillisecond:yn.timeMillisecond,o=yn.tickStep(r,n,i);return s.every(o).range(new Date(r),new Date(n+1))}(e,i,r)}([e,s],this.scaleConfig.period,i,t)));let o=r.cast(e);for(;o<e;)o=r.next(o);const l=r.cast(s);a=(e=>{let t=r.cast(e);return t<o&&(t=o),t>l&&(t=l),n(t)})}return Object.keys(n).forEach(e=>a[e]=n[e]),a.stepSize=(()=>0),this.toBaseScale(a,e)}},(e,t)=>st(e,{utcTime:t.utcTime})).reg("linear",class extends fn{constructor(e,t){super(e,t);var i=this.scaleConfig,r=wn.extent(this.vars),n=Number.isFinite(i.min)?i.min:r[0],a=Number.isFinite(i.max)?i.max:r[1];if(r=[Math.min(...[n,r[0]].filter(Number.isFinite)),Math.max(...[a,r[1]].filter(Number.isFinite))],this.vars=i.nice?Be(r):wn.extent(r),this.vars[0]===this.vars[1]){var s=Math.pow(10,Math.floor(Math.log(this.vars[0])/Math.LN10));this.vars[0]-=s,this.vars[1]+=s||10}this.addField("scaleType","linear").addField("discrete",!1)}isInDomain(e){var t=this.domain(),i=t[0],r=t[t.length-1];return!Number.isNaN(i)&&!Number.isNaN(r)&&e<=r&&e>=i}create(e){var t=this.vars,i=this.extendScale(wn.scaleLinear());return i.domain(t).range(e).clamp(!0),this.toBaseScale(i,e)}extendScale(e){var t=e.copy,i=e.ticks;return Object.assign(e,{stepSize:()=>0,copy:()=>this.extendScale(t.call(e)),ticks:this.getField("isInteger")?t=>i.call(e,t).filter(Number.isInteger):e.ticks}),e}}).reg("logarithmic",class extends fn{constructor(e,t){super(e,t);var i=this.scaleConfig,r=En.extent(this.vars),n=Number.isFinite(i.min)?i.min:r[0],a=Number.isFinite(i.max)?i.max:r[1];Tn(r=[Math.min(...[n,r[0]].filter(Number.isFinite)),Math.max(...[a,r[1]].filter(Number.isFinite))]),i.nice&&(r=function(e){var t=e[0]>0,i=e.map(e=>Math.abs(e)),r=Math.max(...i),n=Math.min(...i).toExponential().split("e"),a=r.toExponential().split("e"),s=parseFloat(Math.floor(Number(n[0]))+"e"+n[1]),o=parseFloat(Math.ceil(Number(a[0]))+"e"+a[1]);return t?[s,o]:[-o,-s]}(r)),this.vars=r,this.addField("scaleType","logarithmic").addField("discrete",!1)}isInDomain(e){var t=this.domain(),i=t[0],r=t[t.length-1];return!Number.isNaN(i)&&!Number.isNaN(r)&&e<=r&&e>=i}create(e){var t=this.vars;Tn(t);var i=function e(t){var i=t.copy;return t.ticks=function(e){var i=[],r=En.extent(t.domain()),n=Math.floor(Sn(r[0])),a=Math.ceil(Sn(r[1])),s=Math.ceil(10*(a-n)/(10*Math.ceil(e/10)));for(let e=n;e<=a;e+=s)for(let t=1;t<=10;t++){let n=Math.pow(t,s)*Math.pow(10,e);(n=parseFloat(n.toExponential(0)))>=r[0]&&n<=r[1]&&i.push(n)}return i},t.copy=function(){var r=i.call(t);return e(r),r},t}(En.scaleLog()).domain(t).range(e);return i.stepSize=(()=>0),this.toBaseScale(i,e)}}).reg("value",class extends fn{constructor(e,t){super(e,t),this.addField("scaleType","value").addField("georole",t.georole)}create(){return this.toBaseScale(e=>e)}});var Wn=[e=>e.data?[]:["[data] must be specified"]];Hn.chartTypesRegistry.add("scatterplot",e=>{return Rn("ELEMENT.POINT",Ln(e))},Wn).add("line",e=>{var t=Ln(e),i=t.data,r=t.settings.log,n={none:()=>null,horizontal:e=>e.x[e.x.length-1],vertical:e=>e.y[e.y.length-1],auto:e=>{var t,n=e.x,a=e.y,s=n[n.length-1],o=n.slice(0,n.length-1),l=a[a.length-1],c=a.slice(0,a.length-1),d=e.color,u=o.concat(c).concat([d]).filter(e=>null!==e),h=-1,f=[[[s].concat(u),l],[[l].concat(u),s]];return f.some((e,t)=>{var n=e[0],a=e[1],s=ri.isYFunctionOfX(i,n,[a]);return s.result?h=t:r(["Attempt to find a functional relation between",e[0]+" and "+e[1]+" is failed.","There are several "+s.error.keyY+" values (e.g. "+s.error.errY.join(",")+")","for ("+s.error.keyX+" = "+s.error.valX+")."].join(" ")),s.result})?t=f[h][0][0]:(r(["All attempts are failed.","Will orient line horizontally by default.","NOTE: the [scatterplot] chart is more convenient for that data."].join(" ")),t=s),t}},a=(t.lineOrientation||"").toLowerCase(),s=(n.hasOwnProperty(a)?n[a]:n.auto)(t);return null!==s&&(t.data=ri.sortByDim(i,s,t.dimensions[s])),Rn("ELEMENT.LINE",t)},Wn).add("area",Dn,Wn).add("stacked-area",e=>Dn(st(e,{stack:!0})),Wn).add("bar",e=>Fn(st(e,{flip:!1})),Wn).add("horizontalBar",e=>Fn(st({flip:!0},e)),Wn).add("horizontal-bar",e=>Fn(st({flip:!0},e)),Wn).add("stacked-bar",e=>Fn(st({flip:!1,stack:!0},e)),Wn).add("horizontal-stacked-bar",e=>Fn(st({flip:!0,stack:!0},e)),Wn).add("map",e=>{let t=Object.assign({sourcemap:e.settings.defaultSourceMap},e.guide||{});t.size=st(t.size||{},{min:1,max:10}),t.code=st(t.code||{},{georole:"countries"});var i={},r=(e,t,r={})=>{var n,a,s=t;return t?(n=`${e}_${t}`,a="/"):(n=`${e}:default`,a="?"),i.hasOwnProperty(n)||(i[n]=Object.assign({type:e,source:a,dim:s},r)),n};return{sources:{"?":{dims:{},data:[{}]},"/":{dims:Object.keys(e.dimensions).reduce((t,i)=>(t[i]={type:e.dimensions[i].type},t),{}),data:e.data}},scales:i,unit:{type:"COORDS.MAP",expression:{operator:"none",source:"/"},code:r("value",e.code,t.code),fill:r("fill",e.fill,t.fill),size:r("size",e.size,t.size),color:r("color",e.color,t.color),latitude:r("linear",e.latitude,{nice:!1}),longitude:r("linear",e.longitude,{nice:!1}),guide:t},plugins:e.plugins||[]}},Wn.concat([e=>{var t=e.fill&&e.code;if(e.fill&&!t)return"[code] must be specified when using [fill]"},e=>{var t=e.latitude&&e.longitude;if((e.latitude||e.longitude)&&!t)return"[latitude] and [longitude] both must be specified"}])).add("parallel",e=>{var t=Object.assign({columns:{}},e.guide||{}),i={},r=(e,t,r={})=>{var n,a,s=t;return t?(n=`${e}_${t}`,a="/"):(n=`${e}:default`,a="?"),i.hasOwnProperty(n)||(i[n]=Object.assign({type:e,source:a,dim:s},r)),n},n=e.columns.map(i=>r(e.dimensions[i].scale,i,t.columns[i]));return{sources:{"?":{dims:{},data:[{}]},"/":{dims:Object.keys(e.dimensions).reduce((t,i)=>(t[i]={type:e.dimensions[i].type},t),{}),data:e.data}},scales:i,unit:{type:"COORDS.PARALLEL",expression:{operator:"none",source:"/"},columns:n,guide:t,units:[{type:"PARALLEL/ELEMENT.LINE",color:r("color",e.color,t.color),columns:n,expression:{operator:"none",source:"/"}}]},plugins:e.plugins||[]}},Wn.concat([e=>{if(!(e.columns&&e.columns.length>1))return"[columns] property must contain at least 2 dimensions"}]));const Un="2.7.0";t.default={GPL:Ut,Plot:Xi,Chart:Ji,api:Hn,version:"2.7.0"}},function(e,i){e.exports=t},function(e,t){e.exports=i},function(e,t){e.exports=r},function(e,t){e.exports=n},function(e,t){e.exports=a},function(e,t){e.exports=s},function(e,t){e.exports=o},function(e,t){e.exports=l},function(e,t,i){var r,n,a;n=[],void 0===(a="function"==typeof(r=function(){return function(e){var t={};function i(r){if(t[r])return t[r].exports;var n=t[r]={exports:{},id:r,loaded:!1};return e[r].call(n.exports,n,n.exports,i),n.loaded=!0,n.exports}return i.m=e,i.c=t,i.p="",i(0)}([function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e,t){return e.indexOf(t)},r=window,n=r.document,a=n.documentElement,s=["top","bottom"];function o(e,t){for(var i in t)e[i]=t[i];return e}function l(e){var t,i=r.pageYOffset||a.scrollTop,n=r.pageXOffset||a.scrollLeft,s={left:0,right:0,top:0,bottom:0,width:0,height:0};if((t=e)&&null!=t.setInterval)s.width=r.innerWidth||a.clientWidth,s.height=r.innerHeight||a.clientHeight;else{if(!a.contains(e)||null==e.getBoundingClientRect)return s;o(s,e.getBoundingClientRect()),s.width=s.right-s.left,s.height=s.bottom-s.top}return s.top=s.top+i-a.clientTop,s.left=s.left+n-a.clientLeft,s.right=s.left+s.width,s.bottom=s.top+s.height,s}var c=function(e,t){return r.getComputedStyle(e)[t]};function d(e){var t=String(c(e,d.propName)),i=t.match(/([0-9.]+)([ms]{1,2})/);return i&&(t=Number(i[1]),"s"===i[2]&&(t*=1e3)),0|t}d.propName=function(){for(var e=n.createElement("div"),t=["transitionDuration","webkitTransitionDuration"],i=0;i<t.length;i++)if(e.style[t[i]]="1s","1s"===e.style[t[i]])return t[i]}();var u=Object.create;function h(e,t){if(!(this instanceof h))return new h(e,t);this.hidden=1,this.options=o(u(h.defaults),t),this._createElement(),e&&this.content(e)}h.prototype._createElement=function(){var e,t;this.element=n.createElement("div"),this.classes=(e=this.element,{add:function(t){e.classList.add(t)},remove:function(t){e.classList.remove(t)}}),this.classes.add(this.options.baseClass);for(var i=0;i<h.classTypes.length;i++)t=h.classTypes[i]+"Class",this.options[t]&&this.classes.add(this.options[t])},h.prototype.type=function(e){return this.changeClassType("type",e)},h.prototype.effect=function(e){return this.changeClassType("effect",e)},h.prototype.changeClassType=function(e,t){return e+="Class",this.options[e]&&this.classes.remove(this.options[e]),this.options[e]=t,t&&this.classes.add(t),this},h.prototype.updateSize=function(){var e;return this.hidden&&(this.element.style.visibility="hidden",n.body.appendChild(this.element)),this.width=this.element.offsetWidth,this.height=this.element.offsetHeight,null==this.spacing&&(this.spacing=null!=this.options.spacing?this.options.spacing:(e=c(this.element,"top"),0|Math.round(String(e).replace(/[^\-0-9.]/g,"")))),this.hidden?(n.body.removeChild(this.element),this.element.style.visibility=""):this.position(),this},h.prototype.content=function(e){return"object"==typeof e?(this.element.innerHTML="",this.element.appendChild(e)):this.element.innerHTML=e,this.updateSize(),this},h.prototype.place=function(e){return this.options.place=e,this.hidden||this.position(),this},h.prototype.attach=function(e){return this.attachedTo=e,this.hidden||this.position(),this},h.prototype.detach=function(){return this.hide(),this.attachedTo=null,this},h.prototype._pickPlace=function(e){if(!this.options.auto)return this.options.place;var t=l(r),n=this.options.place.split("-"),a=this.spacing;if(-1!==i(s,n[0]))switch(e.top-this.height-a<=t.top?n[0]="bottom":e.bottom+this.height+a>=t.bottom&&(n[0]="top"),n[1]){case"left":e.right-this.width<=t.left&&(n[1]="right");break;case"right":e.left+this.width>=t.right&&(n[1]="left");break;default:e.left+e.width/2+this.width/2>=t.right?n[1]="left":e.right-e.width/2-this.width/2<=t.left&&(n[1]="right")}else switch(e.left-this.width-a<=t.left?n[0]="right":e.right+this.width+a>=t.right&&(n[0]="left"),n[1]){case"top":e.bottom-this.height<=t.top&&(n[1]="bottom");break;case"bottom":e.top+this.height>=t.bottom&&(n[1]="top");break;default:e.top+e.height/2+this.height/2>=t.bottom?n[1]="top":e.bottom-e.height/2-this.height/2<=t.top&&(n[1]="bottom")}return n.join("-")},h.prototype.position=function(e,t){this.attachedTo&&(e=this.attachedTo),null==e&&this._p?(e=this._p[0],t=this._p[1]):this._p=arguments;var i,r,n="number"==typeof e?{left:0|e,right:0|e,top:0|t,bottom:0|t,width:0,height:0}:l(e),a=this.spacing,s=this._pickPlace(n);switch(s!==this.curPlace&&(this.curPlace&&this.classes.remove(this.curPlace),this.classes.add(s),this.curPlace=s),this.curPlace){case"top":i=n.top-this.height-a,r=n.left+n.width/2-this.width/2;break;case"top-left":i=n.top-this.height-a,r=n.right-this.width;break;case"top-right":i=n.top-this.height-a,r=n.left;break;case"bottom":i=n.bottom+a,r=n.left+n.width/2-this.width/2;break;case"bottom-left":i=n.bottom+a,r=n.right-this.width;break;case"bottom-right":i=n.bottom+a,r=n.left;break;case"left":i=n.top+n.height/2-this.height/2,r=n.left-this.width-a;break;case"left-top":i=n.bottom-this.height,r=n.left-this.width-a;break;case"left-bottom":i=n.top,r=n.left-this.width-a;break;case"right":i=n.top+n.height/2-this.height/2,r=n.right+a;break;case"right-top":i=n.bottom-this.height,r=n.right+a;break;case"right-bottom":i=n.top,r=n.right+a}return this.element.style.top=Math.round(i)+"px",this.element.style.left=Math.round(r)+"px",this},h.prototype.show=function(e,t){return e=this.attachedTo?this.attachedTo:e,clearTimeout(this.aIndex),null!=e&&this.position(e,t),this.hidden&&(this.hidden=0,n.body.appendChild(this.element)),this.attachedTo&&this._aware(),this.options.inClass&&(this.options.effectClass&&this.element.clientHeight,this.classes.add(this.options.inClass)),this},h.prototype.getElement=function(){return this.element},h.prototype.hide=function(){if(!this.hidden){var e=this,t=0;return this.options.inClass&&(this.classes.remove(this.options.inClass),this.options.effectClass&&(t=d(this.element))),this.attachedTo&&this._unaware(),clearTimeout(this.aIndex),this.aIndex=setTimeout(function(){e.aIndex=0,n.body.removeChild(e.element),e.hidden=1},t),this}},h.prototype.toggle=function(e,t){return this[this.hidden?"show":"hide"](e,t)},h.prototype.destroy=function(){clearTimeout(this.aIndex),this._unaware(),this.hidden||n.body.removeChild(this.element),this.element=this.options=null},h.prototype._aware=function(){-1===i(h.winAware,this)&&h.winAware.push(this)},h.prototype._unaware=function(){var e=i(h.winAware,this);-1!==e&&h.winAware.splice(e,1)},h.reposition=function(){var e,t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||function(e){return setTimeout(e,17)};function i(){e=0;for(var t=0,i=h.winAware.length;t<i;t++)h.winAware[t].position()}return function(){!e&&h.winAware.length&&(e=t(i))}}(),h.winAware=[],window.addEventListener("resize",h.reposition),window.addEventListener("scroll",h.reposition),h.classTypes=["type","effect"],h.defaults={baseClass:"tooltip",typeClass:null,effectClass:null,inClass:"in",place:"top",spacing:null,auto:0},t.Tooltip=h}])})?r.apply(t,n):r)||(e.exports=a)},function(e,t){e.exports=c},function(e,t){e.exports=d},function(e,t){e.exports=u},function(e,t){e.exports=h},function(e,t){e.exports=f},function(e,t,i){"use strict";var r,n,a,s,o;if(window.requestAnimationFrame||(r=0,window.requestAnimationFrame=function(e){var t=Date.now(),i=Math.max(0,16-t+r);return r=t+i,setTimeout(function(){e.call(null,t+i)},i)},window.cancelAnimationFrame=function(e){clearTimeout(e)}),window.requestIdleCallback||(window.requestIdleCallback=function(e,t){return setTimeout(e,t&&t.timeout?t.timeout:0)},window.cancelIdleCallback=function(e){clearTimeout(e)}),Number.isFinite||Object.defineProperty(Number,"isFinite",{value:function(e){return"number"==typeof e&&isFinite(e)},configurable:!0,enumerable:!1,writable:!0}),Number.isNaN||Object.defineProperty(Number,"isNaN",{value:function(e){return"number"==typeof e&&isNaN(e)},configurable:!0,enumerable:!1,writable:!0}),Number.isInteger||Object.defineProperty(Number,"isInteger",{value:function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},configurable:!0,enumerable:!1,writable:!0}),Number.MAX_SAFE_INTEGER||Object.defineProperty(Number,"MAX_SAFE_INTEGER",{value:9007199254740991,configurable:!1,enumerable:!1,writable:!1}),Math.sign||(Math.sign=function(e){return(e>0)-(e<0)||Number(e)}),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(e){if(null==this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var t,i=Object(this),r=i.length>>>0,n=arguments[1],a=0;a<r;a++)if(t=i[a],e.call(n,t,a,i))return t},configurable:!0,enumerable:!1,writable:!0}),Array.prototype.findIndex||Object.defineProperty(Array.prototype,"findIndex",{value:function(e){if(null==this)throw new TypeError("Array.prototype.findIndex called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var t,i=Object(this),r=i.length>>>0,n=arguments[1],a=0;a<r;a++)if(t=i[a],e.call(n,t,a,i))return a;return-1},configurable:!0,enumerable:!1,writable:!0}),!Array.from){Object.defineProperty(Array,"from",{value:(n=Object.prototype.toString,a=function(e){return"function"==typeof e||"[object Function]"===n.call(e)},s=Math.pow(2,53)-1,o=function(e){var t=function(e){var t=Number(e);return isNaN(t)?0:0!==t&&isFinite(t)?(t>0?1:-1)*Math.floor(Math.abs(t)):t}(e);return Math.min(Math.max(t,0),s)},function(e){var t=Object(e);if(null==e)throw new TypeError("Array.from requires an array-like object - not null or undefined");var i,r=arguments.length>1?arguments[1]:void 0;if(void 0!==r){if(!a(r))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(i=arguments[2])}for(var n,s=o(t.length),l=a(this)?Object(new this(s)):new Array(s),c=0;c<s;)n=t[c],l[c]=r?void 0===i?r(n,c):r.call(i,n,c):n,c+=1;return l.length=s,l}),configurable:!0,enumerable:!1,writable:!0});var l=Map.prototype.set;Object.defineProperty(Map.prototype,"set",{value:function(){return l.apply(this,arguments),this},configurable:!0,enumerable:!1,writable:!0}),Object.defineProperty(Map.prototype,"values",{value:function(){var e={},t=0;return this.forEach(i=>e[String(t++)]=i),e.length=t,e},configurable:!0,enumerable:!1,writable:!0}),Object.defineProperty(Map.prototype,"entries",{value:function(){var e={},t=0;return this.forEach((i,r)=>e[String(t++)]=[r,i]),e.length=t,e},configurable:!0,enumerable:!1,writable:!0})}Object.assign||Object.defineProperty(Object,"assign",{value:function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),i=1;i<arguments.length;i++){var r=arguments[i];if(null!=r)for(var n in r)r.hasOwnProperty(n)&&(t[n]=r[n])}return t},configurable:!0,enumerable:!1,writable:!0}),Element.prototype.matches||Object.defineProperty(Element.prototype,"matches",{value:Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,configurable:!0,enumerable:!0,writable:!0})},function(e,t,i){e.exports=function(e,t){"use strict";var i;return e=e&&e.hasOwnProperty("default")?e.default:e,t=t&&t.hasOwnProperty("default")?t.default:t,function(i){var r;function n(){return document.createElement("canvas")}i.exports,(r=window).DOMParser=window.DOMParser;var a,s=function(i,o,l){if(null!=i||null!=o||null!=l){var c=function(i){var s={opts:i,FRAMERATE:30,MAX_VIRTUAL_PIXELS:3e4,rootEmSize:12,emSize:12,log:function(e){}};1==s.opts.log&&"undefined"!=typeof console&&(s.log=function(e){console.log(e)}),s.init=function(e){var t=0;s.UniqueId=function(){return"canvg"+ ++t},s.Definitions={},s.Styles={},s.StylesSpecificity={},s.Animations=[],s.Images=[],s.ctx=e,s.ViewPort=new function(){this.viewPorts=[],this.Clear=function(){this.viewPorts=[]},this.SetCurrent=function(e,t){this.viewPorts.push({width:e,height:t})},this.RemoveCurrent=function(){this.viewPorts.pop()},this.Current=function(){return this.viewPorts[this.viewPorts.length-1]},this.width=function(){return this.Current().width},this.height=function(){return this.Current().height},this.ComputeSize=function(e){return null!=e&&"number"==typeof e?e:"x"==e?this.width():"y"==e?this.height():Math.sqrt(Math.pow(this.width(),2)+Math.pow(this.height(),2))/Math.sqrt(2)}}},s.init(),s.ImagesLoaded=function(){for(var e=0;e<s.Images.length;e++)if(!s.Images[e].loaded)return!1;return!0},s.trim=function(e){return e.replace(/^\s+|\s+$/g,"")},s.compressSpaces=function(e){return e.replace(/(?!\u3000)\s+/gm," ")},s.ajax=function(e){var t;return(t=r.XMLHttpRequest?new r.XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"))?(t.open("GET",e,!1),t.send(null),t.responseText):null},s.parseXml=function(e){if("undefined"!=typeof Windows&&void 0!==Windows.Data&&void 0!==Windows.Data.Xml){var t=new Windows.Data.Xml.Dom.XmlDocument,n=new Windows.Data.Xml.Dom.XmlLoadSettings;return n.prohibitDtd=!1,t.loadXml(e,n),t}if(!r.DOMParser){e=e.replace(/<!DOCTYPE svg[^>]*>/,"");var t=new ActiveXObject("Microsoft.XMLDOM");return t.async="false",t.loadXML(e),t}try{var a=i.xmldom?new r.DOMParser(i.xmldom):new r.DOMParser;return a.parseFromString(e,"image/svg+xml")}catch(t){return(a=i.xmldom?new r.DOMParser(i.xmldom):new r.DOMParser).parseFromString(e,"text/xml")}},s.Property=function(e,t){this.name=e,this.value=t},s.Property.prototype.getValue=function(){return this.value},s.Property.prototype.hasValue=function(){return null!=this.value&&""!==this.value},s.Property.prototype.numValue=function(){if(!this.hasValue())return 0;var e=parseFloat(this.value);return(this.value+"").match(/%$/)&&(e/=100),e},s.Property.prototype.valueOrDefault=function(e){return this.hasValue()?this.value:e},s.Property.prototype.numValueOrDefault=function(e){return this.hasValue()?this.numValue():e},s.Property.prototype.addOpacity=function(t){var i=this.value;if(null!=t.value&&""!=t.value&&"string"==typeof this.value){var r=new e(this.value);r.ok&&(i="rgba("+r.r+", "+r.g+", "+r.b+", "+t.numValue()+")")}return new s.Property(this.name,i)},s.Property.prototype.getDefinition=function(){var e=this.value.match(/#([^\)'"]+)/);return e&&(e=e[1]),e||(e=this.value),s.Definitions[e]},s.Property.prototype.isUrlDefinition=function(){return 0==this.value.indexOf("url(")},s.Property.prototype.getFillStyleDefinition=function(e,t){var i=this.getDefinition();if(null!=i&&i.createGradient)return i.createGradient(s.ctx,e,t);if(null!=i&&i.createPattern){if(i.getHrefAttribute().hasValue()){var r=i.attribute("patternTransform");i=i.getHrefAttribute().getDefinition(),r.hasValue()&&(i.attribute("patternTransform",!0).value=r.value)}return i.createPattern(s.ctx,e)}return null},s.Property.prototype.getDPI=function(e){return 96},s.Property.prototype.getREM=function(e){return s.rootEmSize},s.Property.prototype.getEM=function(e){return s.emSize},s.Property.prototype.getUnits=function(){var e=this.value+"";return e.replace(/[0-9\.\-]/g,"")},s.Property.prototype.isPixels=function(){if(!this.hasValue())return!1;var e=this.value+"";return!!e.match(/px$/)||!!e.match(/^[0-9]+$/)},s.Property.prototype.toPixels=function(e,t){if(!this.hasValue())return 0;var i=this.value+"";if(i.match(/rem$/))return this.numValue()*this.getREM(e);if(i.match(/em$/))return this.numValue()*this.getEM(e);if(i.match(/ex$/))return this.numValue()*this.getEM(e)/2;if(i.match(/px$/))return this.numValue();if(i.match(/pt$/))return this.numValue()*this.getDPI(e)*(1/72);if(i.match(/pc$/))return 15*this.numValue();if(i.match(/cm$/))return this.numValue()*this.getDPI(e)/2.54;if(i.match(/mm$/))return this.numValue()*this.getDPI(e)/25.4;if(i.match(/in$/))return this.numValue()*this.getDPI(e);if(i.match(/%$/))return this.numValue()*s.ViewPort.ComputeSize(e);var r=this.numValue();return t&&r<1?r*s.ViewPort.ComputeSize(e):r},s.Property.prototype.toMilliseconds=function(){if(!this.hasValue())return 0;var e=this.value+"";return e.match(/s$/)?1e3*this.numValue():(e.match(/ms$/),this.numValue())},s.Property.prototype.toRadians=function(){if(!this.hasValue())return 0;var e=this.value+"";return e.match(/deg$/)?this.numValue()*(Math.PI/180):e.match(/grad$/)?this.numValue()*(Math.PI/200):e.match(/rad$/)?this.numValue():this.numValue()*(Math.PI/180)};var o={baseline:"alphabetic","before-edge":"top","text-before-edge":"top",middle:"middle",central:"middle","after-edge":"bottom","text-after-edge":"bottom",ideographic:"ideographic",alphabetic:"alphabetic",hanging:"hanging",mathematical:"alphabetic"};return s.Property.prototype.toTextBaseline=function(){return this.hasValue()?o[this.value]:null},s.Font=new function(){this.Styles="normal|italic|oblique|inherit",this.Variants="normal|small-caps|inherit",this.Weights="normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit",this.CreateFont=function(e,t,i,r,n,a){var o=null!=a?this.Parse(a):this.CreateFont("","","","","",s.ctx.font);return{fontFamily:n=n||o.fontFamily,fontSize:r||o.fontSize,fontStyle:e||o.fontStyle,fontWeight:i||o.fontWeight,fontVariant:t||o.fontVariant,toString:function(){return[this.fontStyle,this.fontVariant,this.fontWeight,this.fontSize,this.fontFamily].join(" ")}}};var e=this;this.Parse=function(t){for(var i={},r=s.trim(s.compressSpaces(t||"")).split(" "),n={fontSize:!1,fontStyle:!1,fontWeight:!1,fontVariant:!1},a="",o=0;o<r.length;o++)n.fontStyle||-1==e.Styles.indexOf(r[o])?n.fontVariant||-1==e.Variants.indexOf(r[o])?n.fontWeight||-1==e.Weights.indexOf(r[o])?n.fontSize?"inherit"!=r[o]&&(a+=r[o]):("inherit"!=r[o]&&(i.fontSize=r[o].split("/")[0]),n.fontStyle=n.fontVariant=n.fontWeight=n.fontSize=!0):("inherit"!=r[o]&&(i.fontWeight=r[o]),n.fontStyle=n.fontVariant=n.fontWeight=!0):("inherit"!=r[o]&&(i.fontVariant=r[o]),n.fontStyle=n.fontVariant=!0):("inherit"!=r[o]&&(i.fontStyle=r[o]),n.fontStyle=!0);return""!=a&&(i.fontFamily=a),i}},s.ToNumberArray=function(e){for(var t=s.trim(s.compressSpaces((e||"").replace(/,/g," "))).split(" "),i=0;i<t.length;i++)t[i]=parseFloat(t[i]);return t},s.Point=function(e,t){this.x=e,this.y=t},s.Point.prototype.angleTo=function(e){return Math.atan2(e.y-this.y,e.x-this.x)},s.Point.prototype.applyTransform=function(e){var t=this.x*e[0]+this.y*e[2]+e[4],i=this.x*e[1]+this.y*e[3]+e[5];this.x=t,this.y=i},s.CreatePoint=function(e){var t=s.ToNumberArray(e);return new s.Point(t[0],t[1])},s.CreatePath=function(e){for(var t=s.ToNumberArray(e),i=[],r=0;r<t.length;r+=2)i.push(new s.Point(t[r],t[r+1]));return i},s.BoundingBox=function(e,t,i,r){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN,this.x=function(){return this.x1},this.y=function(){return this.y1},this.width=function(){return this.x2-this.x1},this.height=function(){return this.y2-this.y1},this.addPoint=function(e,t){null!=e&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=e,this.x2=e),e<this.x1&&(this.x1=e),e>this.x2&&(this.x2=e)),null!=t&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=t,this.y2=t),t<this.y1&&(this.y1=t),t>this.y2&&(this.y2=t))},this.addX=function(e){this.addPoint(e,null)},this.addY=function(e){this.addPoint(null,e)},this.addBoundingBox=function(e){this.addPoint(e.x1,e.y1),this.addPoint(e.x2,e.y2)},this.addQuadraticCurve=function(e,t,i,r,n,a){var s=e+2/3*(i-e),o=t+2/3*(r-t),l=s+1/3*(n-e),c=o+1/3*(a-t);this.addBezierCurve(e,t,s,l,o,c,n,a)},this.addBezierCurve=function(e,t,i,r,n,a,s,o){var l=[e,t],c=[i,r],d=[n,a],u=[s,o];this.addPoint(l[0],l[1]),this.addPoint(u[0],u[1]);for(var h=0;h<=1;h++){var f=function(e){return Math.pow(1-e,3)*l[h]+3*Math.pow(1-e,2)*e*c[h]+3*(1-e)*Math.pow(e,2)*d[h]+Math.pow(e,3)*u[h]},p=6*l[h]-12*c[h]+6*d[h],g=-3*l[h]+9*c[h]-9*d[h]+3*u[h],m=3*c[h]-3*l[h];if(0!=g){var b=Math.pow(p,2)-4*m*g;if(!(b<0)){var y=(-p+Math.sqrt(b))/(2*g);0<y&&y<1&&(0==h&&this.addX(f(y)),1==h&&this.addY(f(y)));var v=(-p-Math.sqrt(b))/(2*g);0<v&&v<1&&(0==h&&this.addX(f(v)),1==h&&this.addY(f(v)))}}else{if(0==p)continue;var x=-m/p;0<x&&x<1&&(0==h&&this.addX(f(x)),1==h&&this.addY(f(x)))}}},this.isPointInBox=function(e,t){return this.x1<=e&&e<=this.x2&&this.y1<=t&&t<=this.y2},this.addPoint(e,t),this.addPoint(i,r)},s.Transform=function(e){var t=this;this.Type={},this.Type.translate=function(e){this.p=s.CreatePoint(e),this.apply=function(e){e.translate(this.p.x||0,this.p.y||0)},this.unapply=function(e){e.translate(-1*this.p.x||0,-1*this.p.y||0)},this.applyToPoint=function(e){e.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0])}},this.Type.rotate=function(e){var t=s.ToNumberArray(e);this.angle=new s.Property("angle",t[0]),this.cx=t[1]||0,this.cy=t[2]||0,this.apply=function(e){e.translate(this.cx,this.cy),e.rotate(this.angle.toRadians()),e.translate(-this.cx,-this.cy)},this.unapply=function(e){e.translate(this.cx,this.cy),e.rotate(-1*this.angle.toRadians()),e.translate(-this.cx,-this.cy)},this.applyToPoint=function(e){var t=this.angle.toRadians();e.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0]),e.applyTransform([Math.cos(t),Math.sin(t),-Math.sin(t),Math.cos(t),0,0]),e.applyTransform([1,0,0,1,-this.p.x||0,-this.p.y||0])}},this.Type.scale=function(e){this.p=s.CreatePoint(e),this.apply=function(e){e.scale(this.p.x||1,this.p.y||this.p.x||1)},this.unapply=function(e){e.scale(1/this.p.x||1,1/this.p.y||this.p.x||1)},this.applyToPoint=function(e){e.applyTransform([this.p.x||0,0,0,this.p.y||0,0,0])}},this.Type.matrix=function(e){this.m=s.ToNumberArray(e),this.apply=function(e){e.transform(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5])},this.unapply=function(e){var t=this.m[0],i=this.m[2],r=this.m[4],n=this.m[1],a=this.m[3],s=this.m[5],o=1/(t*(1*a-0*s)-i*(1*n-0*s)+r*(0*n-0*a));e.transform(o*(1*a-0*s),o*(0*s-1*n),o*(0*r-1*i),o*(1*t-0*r),o*(i*s-r*a),o*(r*n-t*s))},this.applyToPoint=function(e){e.applyTransform(this.m)}},this.Type.SkewBase=function(e){this.base=t.Type.matrix,this.base(e),this.angle=new s.Property("angle",e)},this.Type.SkewBase.prototype=new this.Type.matrix,this.Type.skewX=function(e){this.base=t.Type.SkewBase,this.base(e),this.m=[1,0,Math.tan(this.angle.toRadians()),1,0,0]},this.Type.skewX.prototype=new this.Type.SkewBase,this.Type.skewY=function(e){this.base=t.Type.SkewBase,this.base(e),this.m=[1,Math.tan(this.angle.toRadians()),0,1,0,0]},this.Type.skewY.prototype=new this.Type.SkewBase,this.transforms=[],this.apply=function(e){for(var t=0;t<this.transforms.length;t++)this.transforms[t].apply(e)},this.unapply=function(e){for(var t=this.transforms.length-1;0<=t;t--)this.transforms[t].unapply(e)},this.applyToPoint=function(e){for(var t=0;t<this.transforms.length;t++)this.transforms[t].applyToPoint(e)};for(var i=s.trim(s.compressSpaces(e)).replace(/\)([a-zA-Z])/g,") $1").replace(/\)(\s?,\s?)/g,") ").split(/\s(?=[a-z])/),r=0;r<i.length;r++)if("none"!==i[r]){var n=s.trim(i[r].split("(")[0]),a=i[r].split("(")[1].replace(")",""),o=this.Type[n];if(void 0!==o){var l=new o(a);l.type=n,this.transforms.push(l)}}},s.AspectRatio=function(e,t,i,r,n,a,o,l,c,d){var u=(t=(t=s.compressSpaces(t)).replace(/^defer\s/,"")).split(" ")[0]||"xMidYMid",h=t.split(" ")[1]||"meet",f=i/r,p=n/a,g=Math.min(f,p),m=Math.max(f,p);"meet"==h&&(r*=g,a*=g),"slice"==h&&(r*=m,a*=m),c=new s.Property("refX",c),d=new s.Property("refY",d),c.hasValue()&&d.hasValue()?e.translate(-g*c.toPixels("x"),-g*d.toPixels("y")):(u.match(/^xMid/)&&("meet"==h&&g==p||"slice"==h&&m==p)&&e.translate(i/2-r/2,0),u.match(/YMid$/)&&("meet"==h&&g==f||"slice"==h&&m==f)&&e.translate(0,n/2-a/2),u.match(/^xMax/)&&("meet"==h&&g==p||"slice"==h&&m==p)&&e.translate(i-r,0),u.match(/YMax$/)&&("meet"==h&&g==f||"slice"==h&&m==f)&&e.translate(0,n-a)),"none"==u?e.scale(f,p):"meet"==h?e.scale(g,g):"slice"==h&&e.scale(m,m),e.translate(null==o?0:-o,null==l?0:-l)},s.Element={},s.EmptyProperty=new s.Property("EMPTY",""),s.Element.ElementBase=function(e){this.attributes={},this.styles={},this.stylesSpecificity={},this.children=[],this.attribute=function(e,t){var i=this.attributes[e];return null!=i?i:(1==t&&(i=new s.Property(e,""),this.attributes[e]=i),i||s.EmptyProperty)},this.getHrefAttribute=function(){for(var e in this.attributes)if("href"==e||e.match(/:href$/))return this.attributes[e];return s.EmptyProperty},this.style=function(e,t,i){var r=this.styles[e];if(null!=r)return r;var n=this.attribute(e);if(null!=n&&n.hasValue())return this.styles[e]=n;if(1!=i){var a=this.parent;if(null!=a){var o=a.style(e);if(null!=o&&o.hasValue())return o}}return 1==t&&(r=new s.Property(e,""),this.styles[e]=r),r||s.EmptyProperty},this.render=function(e){if("none"!=this.style("display").value&&"hidden"!=this.style("visibility").value){if(e.save(),this.style("mask").hasValue()){var t=this.style("mask").getDefinition();null!=t&&t.apply(e,this)}else if(this.style("filter").hasValue()){var i=this.style("filter").getDefinition();null!=i&&i.apply(e,this)}else this.setContext(e),this.renderChildren(e),this.clearContext(e);e.restore()}},this.setContext=function(e){},this.clearContext=function(e){},this.renderChildren=function(e){for(var t=0;t<this.children.length;t++)this.children[t].render(e)},this.addChild=function(e,t){var i=e;t&&(i=s.CreateElement(e)),i.parent=this,"title"!=i.type&&this.children.push(i)},this.addStylesFromStyleDefinition=function(){for(var t in s.Styles)if("@"!=t[0]&&a(e,t)){var i=s.Styles[t],r=s.StylesSpecificity[t];if(null!=i)for(var n in i){var o=this.stylesSpecificity[n];void 0===o&&(o="000"),o<r&&(this.styles[n]=i[n],this.stylesSpecificity[n]=r)}}};var t,i=new RegExp("^[A-Z-]+$");if(null!=e&&1==e.nodeType){for(var r=0;r<e.attributes.length;r++){var n=e.attributes[r],o=(t=n.nodeName,i.test(t)?t.toLowerCase():t);this.attributes[o]=new s.Property(o,n.value)}if(this.addStylesFromStyleDefinition(),this.attribute("style").hasValue()){var l=this.attribute("style").value.split(";");for(r=0;r<l.length;r++)if(""!=s.trim(l[r])){var c=l[r].split(":"),d=s.trim(c[0]),u=s.trim(c[1]);this.styles[d]=new s.Property(d,u)}}for(this.attribute("id").hasValue()&&null==s.Definitions[this.attribute("id").value]&&(s.Definitions[this.attribute("id").value]=this),r=0;r<e.childNodes.length;r++){var h=e.childNodes[r];if(1==h.nodeType&&this.addChild(h,!0),this.captureTextNodes&&(3==h.nodeType||4==h.nodeType)){var f=h.value||h.text||h.textContent||"";""!=s.compressSpaces(f)&&this.addChild(new s.Element.tspan(h),!1)}}}},s.Element.RenderedElementBase=function(e){this.base=s.Element.ElementBase,this.base(e),this.calculateOpacity=function(){for(var e=1,t=this;null!=t;){var i=t.style("opacity",!1,!0);i.hasValue()&&(e*=i.numValue()),t=t.parent}return e},this.setContext=function(e,t){if(!t){var i;if(this.style("fill").isUrlDefinition())null!=(i=this.style("fill").getFillStyleDefinition(this,this.style("fill-opacity")))&&(e.fillStyle=i);else if(this.style("fill").hasValue()){var r;"currentColor"==(r=this.style("fill")).value&&(r.value=this.style("color").value),"inherit"!=r.value&&(e.fillStyle="none"==r.value?"rgba(0,0,0,0)":r.value)}if(this.style("fill-opacity").hasValue()&&(r=(r=new s.Property("fill",e.fillStyle)).addOpacity(this.style("fill-opacity")),e.fillStyle=r.value),this.style("stroke").isUrlDefinition())null!=(i=this.style("stroke").getFillStyleDefinition(this,this.style("stroke-opacity")))&&(e.strokeStyle=i);else if(this.style("stroke").hasValue()){var n;"currentColor"==(n=this.style("stroke")).value&&(n.value=this.style("color").value),"inherit"!=n.value&&(e.strokeStyle="none"==n.value?"rgba(0,0,0,0)":n.value)}if(this.style("stroke-opacity").hasValue()&&(n=(n=new s.Property("stroke",e.strokeStyle)).addOpacity(this.style("stroke-opacity")),e.strokeStyle=n.value),this.style("stroke-width").hasValue()){var a=this.style("stroke-width").toPixels();e.lineWidth=0==a?.001:a}if(this.style("stroke-linecap").hasValue()&&(e.lineCap=this.style("stroke-linecap").value),this.style("stroke-linejoin").hasValue()&&(e.lineJoin=this.style("stroke-linejoin").value),this.style("stroke-miterlimit").hasValue()&&(e.miterLimit=this.style("stroke-miterlimit").value),this.style("paint-order").hasValue()&&(e.paintOrder=this.style("paint-order").value),this.style("stroke-dasharray").hasValue()&&"none"!=this.style("stroke-dasharray").value){var o=s.ToNumberArray(this.style("stroke-dasharray").value);void 0!==e.setLineDash?e.setLineDash(o):void 0!==e.webkitLineDash?e.webkitLineDash=o:void 0===e.mozDash||1==o.length&&0==o[0]||(e.mozDash=o);var l=this.style("stroke-dashoffset").toPixels();void 0!==e.lineDashOffset?e.lineDashOffset=l:void 0!==e.webkitLineDashOffset?e.webkitLineDashOffset=l:void 0!==e.mozDashOffset&&(e.mozDashOffset=l)}}if(void 0!==e.font){e.font=s.Font.CreateFont(this.style("font-style").value,this.style("font-variant").value,this.style("font-weight").value,this.style("font-size").hasValue()?this.style("font-size").toPixels()+"px":"",this.style("font-family").value).toString();var c=this.style("font-size",!1,!1);c.isPixels()&&(s.emSize=c.toPixels())}if(this.style("transform",!1,!0).hasValue()&&new s.Transform(this.style("transform",!1,!0).value).apply(e),this.style("clip-path",!1,!0).hasValue()){var d=this.style("clip-path",!1,!0).getDefinition();null!=d&&d.apply(e)}e.globalAlpha=this.calculateOpacity()}},s.Element.RenderedElementBase.prototype=new s.Element.ElementBase,s.Element.PathElementBase=function(e){this.base=s.Element.RenderedElementBase,this.base(e),this.path=function(e){return null!=e&&e.beginPath(),new s.BoundingBox},this.renderChildren=function(e){this.path(e),s.Mouse.checkPath(this,e),""!=e.fillStyle&&("inherit"!=this.style("fill-rule").valueOrDefault("inherit")?e.fill(this.style("fill-rule").value):e.fill()),""!=e.strokeStyle&&e.stroke();var t=this.getMarkers();if(null!=t){if(this.style("marker-start").isUrlDefinition()&&(i=this.style("marker-start").getDefinition()).render(e,t[0][0],t[0][1]),this.style("marker-mid").isUrlDefinition())for(var i=this.style("marker-mid").getDefinition(),r=1;r<t.length-1;r++)i.render(e,t[r][0],t[r][1]);this.style("marker-end").isUrlDefinition()&&(i=this.style("marker-end").getDefinition()).render(e,t[t.length-1][0],t[t.length-1][1])}},this.getBoundingBox=function(){return this.path()},this.getMarkers=function(){return null}},s.Element.PathElementBase.prototype=new s.Element.RenderedElementBase,s.Element.svg=function(e){this.base=s.Element.RenderedElementBase,this.base(e),this.baseClearContext=this.clearContext,this.clearContext=function(e){this.baseClearContext(e),s.ViewPort.RemoveCurrent()},this.baseSetContext=this.setContext,this.setContext=function(e){if(e.strokeStyle="rgba(0,0,0,0)",e.lineCap="butt",e.lineJoin="miter",e.miterLimit=4,e.canvas.style&&void 0!==e.font&&void 0!==r.getComputedStyle){e.font=r.getComputedStyle(e.canvas).getPropertyValue("font");var t=new s.Property("fontSize",s.Font.Parse(e.font).fontSize);t.hasValue()&&(s.rootEmSize=s.emSize=t.toPixels("y"))}this.baseSetContext(e),this.attribute("x").hasValue()||(this.attribute("x",!0).value=0),this.attribute("y").hasValue()||(this.attribute("y",!0).value=0),e.translate(this.attribute("x").toPixels("x"),this.attribute("y").toPixels("y"));var i=s.ViewPort.width(),n=s.ViewPort.height();if(this.attribute("width").hasValue()||(this.attribute("width",!0).value="100%"),this.attribute("height").hasValue()||(this.attribute("height",!0).value="100%"),void 0===this.root){i=this.attribute("width").toPixels("x"),n=this.attribute("height").toPixels("y");var a=0,o=0;this.attribute("refX").hasValue()&&this.attribute("refY").hasValue()&&(a=-this.attribute("refX").toPixels("x"),o=-this.attribute("refY").toPixels("y")),"visible"!=this.attribute("overflow").valueOrDefault("hidden")&&(e.beginPath(),e.moveTo(a,o),e.lineTo(i,o),e.lineTo(i,n),e.lineTo(a,n),e.closePath(),e.clip())}if(s.ViewPort.SetCurrent(i,n),this.attribute("viewBox").hasValue()){var l=s.ToNumberArray(this.attribute("viewBox").value),c=l[0],d=l[1];i=l[2],n=l[3],s.AspectRatio(e,this.attribute("preserveAspectRatio").value,s.ViewPort.width(),i,s.ViewPort.height(),n,c,d,this.attribute("refX").value,this.attribute("refY").value),s.ViewPort.RemoveCurrent(),s.ViewPort.SetCurrent(l[2],l[3])}}},s.Element.svg.prototype=new s.Element.RenderedElementBase,s.Element.rect=function(e){this.base=s.Element.PathElementBase,this.base(e),this.path=function(e){var t=this.attribute("x").toPixels("x"),i=this.attribute("y").toPixels("y"),r=this.attribute("width").toPixels("x"),n=this.attribute("height").toPixels("y"),a=this.attribute("rx").toPixels("x"),o=this.attribute("ry").toPixels("y");if(this.attribute("rx").hasValue()&&!this.attribute("ry").hasValue()&&(o=a),this.attribute("ry").hasValue()&&!this.attribute("rx").hasValue()&&(a=o),a=Math.min(a,r/2),o=Math.min(o,n/2),null!=e){var l=(Math.sqrt(2)-1)/3*4;e.beginPath(),e.moveTo(t+a,i),e.lineTo(t+r-a,i),e.bezierCurveTo(t+r-a+l*a,i,t+r,i+o-l*o,t+r,i+o),e.lineTo(t+r,i+n-o),e.bezierCurveTo(t+r,i+n-o+l*o,t+r-a+l*a,i+n,t+r-a,i+n),e.lineTo(t+a,i+n),e.bezierCurveTo(t+a-l*a,i+n,t,i+n-o+l*o,t,i+n-o),e.lineTo(t,i+o),e.bezierCurveTo(t,i+o-l*o,t+a-l*a,i,t+a,i),e.closePath()}return new s.BoundingBox(t,i,t+r,i+n)}},s.Element.rect.prototype=new s.Element.PathElementBase,s.Element.circle=function(e){this.base=s.Element.PathElementBase,this.base(e),this.path=function(e){var t=this.attribute("cx").toPixels("x"),i=this.attribute("cy").toPixels("y"),r=this.attribute("r").toPixels();return null!=e&&(e.beginPath(),e.arc(t,i,r,0,2*Math.PI,!1),e.closePath()),new s.BoundingBox(t-r,i-r,t+r,i+r)}},s.Element.circle.prototype=new s.Element.PathElementBase,s.Element.ellipse=function(e){this.base=s.Element.PathElementBase,this.base(e),this.path=function(e){var t=(Math.sqrt(2)-1)/3*4,i=this.attribute("rx").toPixels("x"),r=this.attribute("ry").toPixels("y"),n=this.attribute("cx").toPixels("x"),a=this.attribute("cy").toPixels("y");return null!=e&&(e.beginPath(),e.moveTo(n+i,a),e.bezierCurveTo(n+i,a+t*r,n+t*i,a+r,n,a+r),e.bezierCurveTo(n-t*i,a+r,n-i,a+t*r,n-i,a),e.bezierCurveTo(n-i,a-t*r,n-t*i,a-r,n,a-r),e.bezierCurveTo(n+t*i,a-r,n+i,a-t*r,n+i,a),e.closePath()),new s.BoundingBox(n-i,a-r,n+i,a+r)}},s.Element.ellipse.prototype=new s.Element.PathElementBase,s.Element.line=function(e){this.base=s.Element.PathElementBase,this.base(e),this.getPoints=function(){return[new s.Point(this.attribute("x1").toPixels("x"),this.attribute("y1").toPixels("y")),new s.Point(this.attribute("x2").toPixels("x"),this.attribute("y2").toPixels("y"))]},this.path=function(e){var t=this.getPoints();return null!=e&&(e.beginPath(),e.moveTo(t[0].x,t[0].y),e.lineTo(t[1].x,t[1].y)),new s.BoundingBox(t[0].x,t[0].y,t[1].x,t[1].y)},this.getMarkers=function(){var e=this.getPoints(),t=e[0].angleTo(e[1]);return[[e[0],t],[e[1],t]]}},s.Element.line.prototype=new s.Element.PathElementBase,s.Element.polyline=function(e){this.base=s.Element.PathElementBase,this.base(e),this.points=s.CreatePath(this.attribute("points").value),this.path=function(e){var t=new s.BoundingBox(this.points[0].x,this.points[0].y);null!=e&&(e.beginPath(),e.moveTo(this.points[0].x,this.points[0].y));for(var i=1;i<this.points.length;i++)t.addPoint(this.points[i].x,this.points[i].y),null!=e&&e.lineTo(this.points[i].x,this.points[i].y);return t},this.getMarkers=function(){for(var e=[],t=0;t<this.points.length-1;t++)e.push([this.points[t],this.points[t].angleTo(this.points[t+1])]);return 0<e.length&&e.push([this.points[this.points.length-1],e[e.length-1][1]]),e}},s.Element.polyline.prototype=new s.Element.PathElementBase,s.Element.polygon=function(e){this.base=s.Element.polyline,this.base(e),this.basePath=this.path,this.path=function(e){var t=this.basePath(e);return null!=e&&(e.lineTo(this.points[0].x,this.points[0].y),e.closePath()),t}},s.Element.polygon.prototype=new s.Element.polyline,s.Element.path=function(e){this.base=s.Element.PathElementBase,this.base(e);var t=this.attribute("d").value;t=t.replace(/,/gm," ");for(var i=0;i<2;i++)t=t.replace(/([MmZzLlHhVvCcSsQqTtAa])([^\s])/gm,"$1 $2");for(t=(t=t.replace(/([^\s])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2")).replace(/([0-9])([+\-])/gm,"$1 $2"),i=0;i<2;i++)t=t.replace(/(\.[0-9]*)(\.)/gm,"$1 $2");t=t.replace(/([Aa](\s+[0-9]+){3})\s+([01])\s*([01])/gm,"$1 $3 $4 "),t=s.compressSpaces(t),t=s.trim(t),this.PathParser=new function(e){this.tokens=e.split(" "),this.reset=function(){this.i=-1,this.command="",this.previousCommand="",this.start=new s.Point(0,0),this.control=new s.Point(0,0),this.current=new s.Point(0,0),this.points=[],this.angles=[]},this.isEnd=function(){return this.i>=this.tokens.length-1},this.isCommandOrEnd=function(){return!!this.isEnd()||null!=this.tokens[this.i+1].match(/^[A-Za-z]$/)},this.isRelativeCommand=function(){switch(this.command){case"m":case"l":case"h":case"v":case"c":case"s":case"q":case"t":case"a":case"z":return!0}return!1},this.getToken=function(){return this.i++,this.tokens[this.i]},this.getScalar=function(){return parseFloat(this.getToken())},this.nextCommand=function(){this.previousCommand=this.command,this.command=this.getToken()},this.getPoint=function(){var e=new s.Point(this.getScalar(),this.getScalar());return this.makeAbsolute(e)},this.getAsControlPoint=function(){var e=this.getPoint();return this.control=e},this.getAsCurrentPoint=function(){var e=this.getPoint();return this.current=e},this.getReflectedControlPoint=function(){return"c"!=this.previousCommand.toLowerCase()&&"s"!=this.previousCommand.toLowerCase()&&"q"!=this.previousCommand.toLowerCase()&&"t"!=this.previousCommand.toLowerCase()?this.current:new s.Point(2*this.current.x-this.control.x,2*this.current.y-this.control.y)},this.makeAbsolute=function(e){return this.isRelativeCommand()&&(e.x+=this.current.x,e.y+=this.current.y),e},this.addMarker=function(e,t,i){null!=i&&0<this.angles.length&&null==this.angles[this.angles.length-1]&&(this.angles[this.angles.length-1]=this.points[this.points.length-1].angleTo(i)),this.addMarkerAngle(e,null==t?null:t.angleTo(e))},this.addMarkerAngle=function(e,t){this.points.push(e),this.angles.push(t)},this.getMarkerPoints=function(){return this.points},this.getMarkerAngles=function(){for(var e=0;e<this.angles.length;e++)if(null==this.angles[e])for(var t=e+1;t<this.angles.length;t++)if(null!=this.angles[t]){this.angles[e]=this.angles[t];break}return this.angles}}(t),this.path=function(e){var t=this.PathParser;t.reset();var i=new s.BoundingBox;for(null!=e&&e.beginPath();!t.isEnd();)switch(t.nextCommand(),t.command){case"M":case"m":var r=t.getAsCurrentPoint();for(t.addMarker(r),i.addPoint(r.x,r.y),null!=e&&e.moveTo(r.x,r.y),t.start=t.current;!t.isCommandOrEnd();)r=t.getAsCurrentPoint(),t.addMarker(r,t.start),i.addPoint(r.x,r.y),null!=e&&e.lineTo(r.x,r.y);break;case"L":case"l":for(;!t.isCommandOrEnd();){var n=t.current;r=t.getAsCurrentPoint(),t.addMarker(r,n),i.addPoint(r.x,r.y),null!=e&&e.lineTo(r.x,r.y)}break;case"H":case"h":for(;!t.isCommandOrEnd();){var a=new s.Point((t.isRelativeCommand()?t.current.x:0)+t.getScalar(),t.current.y);t.addMarker(a,t.current),t.current=a,i.addPoint(t.current.x,t.current.y),null!=e&&e.lineTo(t.current.x,t.current.y)}break;case"V":case"v":for(;!t.isCommandOrEnd();)a=new s.Point(t.current.x,(t.isRelativeCommand()?t.current.y:0)+t.getScalar()),t.addMarker(a,t.current),t.current=a,i.addPoint(t.current.x,t.current.y),null!=e&&e.lineTo(t.current.x,t.current.y);break;case"C":case"c":for(;!t.isCommandOrEnd();){var o=t.current,l=t.getPoint(),c=t.getAsControlPoint(),d=t.getAsCurrentPoint();t.addMarker(d,c,l),i.addBezierCurve(o.x,o.y,l.x,l.y,c.x,c.y,d.x,d.y),null!=e&&e.bezierCurveTo(l.x,l.y,c.x,c.y,d.x,d.y)}break;case"S":case"s":for(;!t.isCommandOrEnd();)o=t.current,l=t.getReflectedControlPoint(),c=t.getAsControlPoint(),d=t.getAsCurrentPoint(),t.addMarker(d,c,l),i.addBezierCurve(o.x,o.y,l.x,l.y,c.x,c.y,d.x,d.y),null!=e&&e.bezierCurveTo(l.x,l.y,c.x,c.y,d.x,d.y);break;case"Q":case"q":for(;!t.isCommandOrEnd();)o=t.current,c=t.getAsControlPoint(),d=t.getAsCurrentPoint(),t.addMarker(d,c,c),i.addQuadraticCurve(o.x,o.y,c.x,c.y,d.x,d.y),null!=e&&e.quadraticCurveTo(c.x,c.y,d.x,d.y);break;case"T":case"t":for(;!t.isCommandOrEnd();)o=t.current,c=t.getReflectedControlPoint(),t.control=c,d=t.getAsCurrentPoint(),t.addMarker(d,c,c),i.addQuadraticCurve(o.x,o.y,c.x,c.y,d.x,d.y),null!=e&&e.quadraticCurveTo(c.x,c.y,d.x,d.y);break;case"A":case"a":for(;!t.isCommandOrEnd();){o=t.current;var u=t.getScalar(),h=t.getScalar(),f=t.getScalar()*(Math.PI/180),p=t.getScalar(),g=t.getScalar(),m=(d=t.getAsCurrentPoint(),new s.Point(Math.cos(f)*(o.x-d.x)/2+Math.sin(f)*(o.y-d.y)/2,-Math.sin(f)*(o.x-d.x)/2+Math.cos(f)*(o.y-d.y)/2)),b=Math.pow(m.x,2)/Math.pow(u,2)+Math.pow(m.y,2)/Math.pow(h,2);1<b&&(u*=Math.sqrt(b),h*=Math.sqrt(b));var y=(p==g?-1:1)*Math.sqrt((Math.pow(u,2)*Math.pow(h,2)-Math.pow(u,2)*Math.pow(m.y,2)-Math.pow(h,2)*Math.pow(m.x,2))/(Math.pow(u,2)*Math.pow(m.y,2)+Math.pow(h,2)*Math.pow(m.x,2)));isNaN(y)&&(y=0);var v=new s.Point(y*u*m.y/h,y*-h*m.x/u),x=new s.Point((o.x+d.x)/2+Math.cos(f)*v.x-Math.sin(f)*v.y,(o.y+d.y)/2+Math.sin(f)*v.x+Math.cos(f)*v.y),_=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2))},w=function(e,t){return(e[0]*t[0]+e[1]*t[1])/(_(e)*_(t))},E=function(e,t){return(e[0]*t[1]<e[1]*t[0]?-1:1)*Math.acos(w(e,t))},S=E([1,0],[(m.x-v.x)/u,(m.y-v.y)/h]),T=[(m.x-v.x)/u,(m.y-v.y)/h],M=[(-m.x-v.x)/u,(-m.y-v.y)/h],C=E(T,M);w(T,M)<=-1&&(C=Math.PI),1<=w(T,M)&&(C=0);var k=1-g?1:-1,A=S+k*(C/2),P=new s.Point(x.x+u*Math.cos(A),x.y+h*Math.sin(A));if(t.addMarkerAngle(P,A-k*Math.PI/2),t.addMarkerAngle(d,A-k*Math.PI),i.addPoint(d.x,d.y),null!=e){w=h<u?u:h;var O=h<u?1:u/h,N=h<u?h/u:1;e.translate(x.x,x.y),e.rotate(f),e.scale(O,N),e.arc(0,0,w,S,S+C,1-g),e.scale(1/O,1/N),e.rotate(-f),e.translate(-x.x,-x.y)}}break;case"Z":case"z":null!=e&&i.x1!==i.x2&&i.y1!==i.y2&&e.closePath(),t.current=t.start}return i},this.getMarkers=function(){for(var e=this.PathParser.getMarkerPoints(),t=this.PathParser.getMarkerAngles(),i=[],r=0;r<e.length;r++)i.push([e[r],t[r]]);return i}},s.Element.path.prototype=new s.Element.PathElementBase,s.Element.pattern=function(e){this.base=s.Element.ElementBase,this.base(e),this.createPattern=function(e,t){var i=this.attribute("width").toPixels("x",!0),r=this.attribute("height").toPixels("y",!0),a=new s.Element.svg;a.attributes.viewBox=new s.Property("viewBox",this.attribute("viewBox").value),a.attributes.width=new s.Property("width",i+"px"),a.attributes.height=new s.Property("height",r+"px"),a.attributes.transform=new s.Property("transform",this.attribute("patternTransform").value),a.children=this.children;var o=n();o.width=i,o.height=r;var l=o.getContext("2d");this.attribute("x").hasValue()&&this.attribute("y").hasValue()&&l.translate(this.attribute("x").toPixels("x",!0),this.attribute("y").toPixels("y",!0));for(var c=-1;c<=1;c++)for(var d=-1;d<=1;d++)l.save(),a.attributes.x=new s.Property("x",c*o.width),a.attributes.y=new s.Property("y",d*o.height),a.render(l),l.restore();return e.createPattern(o,"repeat")}},s.Element.pattern.prototype=new s.Element.ElementBase,s.Element.marker=function(e){this.base=s.Element.ElementBase,this.base(e),this.baseRender=this.render,this.render=function(e,t,i){if(t){e.translate(t.x,t.y),"auto"==this.attribute("orient").valueOrDefault("auto")&&e.rotate(i),"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&e.scale(e.lineWidth,e.lineWidth),e.save();var r=new s.Element.svg;r.attributes.viewBox=new s.Property("viewBox",this.attribute("viewBox").value),r.attributes.refX=new s.Property("refX",this.attribute("refX").value),r.attributes.refY=new s.Property("refY",this.attribute("refY").value),r.attributes.width=new s.Property("width",this.attribute("markerWidth").value),r.attributes.height=new s.Property("height",this.attribute("markerHeight").value),r.attributes.fill=new s.Property("fill",this.attribute("fill").valueOrDefault("black")),r.attributes.stroke=new s.Property("stroke",this.attribute("stroke").valueOrDefault("none")),r.children=this.children,r.render(e),e.restore(),"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&e.scale(1/e.lineWidth,1/e.lineWidth),"auto"==this.attribute("orient").valueOrDefault("auto")&&e.rotate(-i),e.translate(-t.x,-t.y)}}},s.Element.marker.prototype=new s.Element.ElementBase,s.Element.defs=function(e){this.base=s.Element.ElementBase,this.base(e),this.render=function(e){}},s.Element.defs.prototype=new s.Element.ElementBase,s.Element.GradientBase=function(e){this.base=s.Element.ElementBase,this.base(e),this.stops=[];for(var t=0;t<this.children.length;t++){var i=this.children[t];"stop"==i.type&&this.stops.push(i)}this.getGradient=function(){},this.gradientUnits=function(){return this.attribute("gradientUnits").valueOrDefault("objectBoundingBox")},this.attributesToInherit=["gradientUnits"],this.inheritStopContainer=function(e){for(var t=0;t<this.attributesToInherit.length;t++){var i=this.attributesToInherit[t];!this.attribute(i).hasValue()&&e.attribute(i).hasValue()&&(this.attribute(i,!0).value=e.attribute(i).value)}},this.createGradient=function(e,t,i){var r=this;this.getHrefAttribute().hasValue()&&(r=this.getHrefAttribute().getDefinition(),this.inheritStopContainer(r));var a=function(e){return i.hasValue()?new s.Property("color",e).addOpacity(i).value:e},o=this.getGradient(e,t);if(null==o)return a(r.stops[r.stops.length-1].color);for(var l=0;l<r.stops.length;l++)o.addColorStop(r.stops[l].offset,a(r.stops[l].color));if(this.attribute("gradientTransform").hasValue()){var c=s.ViewPort.viewPorts[0],d=new s.Element.rect;d.attributes.x=new s.Property("x",-s.MAX_VIRTUAL_PIXELS/3),d.attributes.y=new s.Property("y",-s.MAX_VIRTUAL_PIXELS/3),d.attributes.width=new s.Property("width",s.MAX_VIRTUAL_PIXELS),d.attributes.height=new s.Property("height",s.MAX_VIRTUAL_PIXELS);var u=new s.Element.g;u.attributes.transform=new s.Property("transform",this.attribute("gradientTransform").value),u.children=[d];var h=new s.Element.svg;h.attributes.x=new s.Property("x",0),h.attributes.y=new s.Property("y",0),h.attributes.width=new s.Property("width",c.width),h.attributes.height=new s.Property("height",c.height),h.children=[u];var f=n();f.width=c.width,f.height=c.height;var p=f.getContext("2d");return p.fillStyle=o,h.render(p),p.createPattern(f,"no-repeat")}return o}},s.Element.GradientBase.prototype=new s.Element.ElementBase,s.Element.linearGradient=function(e){this.base=s.Element.GradientBase,this.base(e),this.attributesToInherit.push("x1"),this.attributesToInherit.push("y1"),this.attributesToInherit.push("x2"),this.attributesToInherit.push("y2"),this.getGradient=function(e,t){var i="objectBoundingBox"==this.gradientUnits()?t.getBoundingBox(e):null;this.attribute("x1").hasValue()||this.attribute("y1").hasValue()||this.attribute("x2").hasValue()||this.attribute("y2").hasValue()||(this.attribute("x1",!0).value=0,this.attribute("y1",!0).value=0,this.attribute("x2",!0).value=1,this.attribute("y2",!0).value=0);var r="objectBoundingBox"==this.gradientUnits()?i.x()+i.width()*this.attribute("x1").numValue():this.attribute("x1").toPixels("x"),n="objectBoundingBox"==this.gradientUnits()?i.y()+i.height()*this.attribute("y1").numValue():this.attribute("y1").toPixels("y"),a="objectBoundingBox"==this.gradientUnits()?i.x()+i.width()*this.attribute("x2").numValue():this.attribute("x2").toPixels("x"),s="objectBoundingBox"==this.gradientUnits()?i.y()+i.height()*this.attribute("y2").numValue():this.attribute("y2").toPixels("y");return r==a&&n==s?null:e.createLinearGradient(r,n,a,s)}},s.Element.linearGradient.prototype=new s.Element.GradientBase,s.Element.radialGradient=function(e){this.base=s.Element.GradientBase,this.base(e),this.attributesToInherit.push("cx"),this.attributesToInherit.push("cy"),this.attributesToInherit.push("r"),this.attributesToInherit.push("fx"),this.attributesToInherit.push("fy"),this.getGradient=function(e,t){var i=t.getBoundingBox(e);this.attribute("cx").hasValue()||(this.attribute("cx",!0).value="50%"),this.attribute("cy").hasValue()||(this.attribute("cy",!0).value="50%"),this.attribute("r").hasValue()||(this.attribute("r",!0).value="50%");var r="objectBoundingBox"==this.gradientUnits()?i.x()+i.width()*this.attribute("cx").numValue():this.attribute("cx").toPixels("x"),n="objectBoundingBox"==this.gradientUnits()?i.y()+i.height()*this.attribute("cy").numValue():this.attribute("cy").toPixels("y"),a=r,s=n;this.attribute("fx").hasValue()&&(a="objectBoundingBox"==this.gradientUnits()?i.x()+i.width()*this.attribute("fx").numValue():this.attribute("fx").toPixels("x")),this.attribute("fy").hasValue()&&(s="objectBoundingBox"==this.gradientUnits()?i.y()+i.height()*this.attribute("fy").numValue():this.attribute("fy").toPixels("y"));var o="objectBoundingBox"==this.gradientUnits()?(i.width()+i.height())/2*this.attribute("r").numValue():this.attribute("r").toPixels();return e.createRadialGradient(a,s,0,r,n,o)}},s.Element.radialGradient.prototype=new s.Element.GradientBase,s.Element.stop=function(e){this.base=s.Element.ElementBase,this.base(e),this.offset=this.attribute("offset").numValue(),this.offset<0&&(this.offset=0),1<this.offset&&(this.offset=1);var t=this.style("stop-color",!0);""===t.value&&(t.value="#000"),this.style("stop-opacity").hasValue()&&(t=t.addOpacity(this.style("stop-opacity"))),this.color=t.value},s.Element.stop.prototype=new s.Element.ElementBase,s.Element.AnimateBase=function(e){this.base=s.Element.ElementBase,this.base(e),s.Animations.push(this),this.duration=0,this.begin=this.attribute("begin").toMilliseconds(),this.maxDuration=this.begin+this.attribute("dur").toMilliseconds(),this.getProperty=function(){var e=this.attribute("attributeType").value,t=this.attribute("attributeName").value;return"CSS"==e?this.parent.style(t,!0):this.parent.attribute(t,!0)},this.initialValue=null,this.initialUnits="",this.removed=!1,this.calcValue=function(){return""},this.update=function(e){if(null==this.initialValue&&(this.initialValue=this.getProperty().value,this.initialUnits=this.getProperty().getUnits()),this.duration>this.maxDuration){if("indefinite"==this.attribute("repeatCount").value||"indefinite"==this.attribute("repeatDur").value)this.duration=0;else if("freeze"!=this.attribute("fill").valueOrDefault("remove")||this.frozen){if("remove"==this.attribute("fill").valueOrDefault("remove")&&!this.removed)return this.removed=!0,this.getProperty().value=this.parent.animationFrozen?this.parent.animationFrozenValue:this.initialValue,!0}else this.frozen=!0,this.parent.animationFrozen=!0,this.parent.animationFrozenValue=this.getProperty().value;return!1}this.duration=this.duration+e;var t=!1;if(this.begin<this.duration){var i=this.calcValue();this.attribute("type").hasValue()&&(i=this.attribute("type").value+"("+i+")"),this.getProperty().value=i,t=!0}return t},this.from=this.attribute("from"),this.to=this.attribute("to"),this.values=this.attribute("values"),this.values.hasValue()&&(this.values.value=this.values.value.split(";")),this.progress=function(){var e={progress:(this.duration-this.begin)/(this.maxDuration-this.begin)};if(this.values.hasValue()){var t=e.progress*(this.values.value.length-1),i=Math.floor(t),r=Math.ceil(t);e.from=new s.Property("from",parseFloat(this.values.value[i])),e.to=new s.Property("to",parseFloat(this.values.value[r])),e.progress=(t-i)/(r-i)}else e.from=this.from,e.to=this.to;return e}},s.Element.AnimateBase.prototype=new s.Element.ElementBase,s.Element.animate=function(e){this.base=s.Element.AnimateBase,this.base(e),this.calcValue=function(){var e=this.progress();return e.from.numValue()+(e.to.numValue()-e.from.numValue())*e.progress+this.initialUnits}},s.Element.animate.prototype=new s.Element.AnimateBase,s.Element.animateColor=function(t){this.base=s.Element.AnimateBase,this.base(t),this.calcValue=function(){var t=this.progress(),i=new e(t.from.value),r=new e(t.to.value);if(i.ok&&r.ok){var n=i.r+(r.r-i.r)*t.progress,a=i.g+(r.g-i.g)*t.progress,s=i.b+(r.b-i.b)*t.progress;return"rgb("+parseInt(n,10)+","+parseInt(a,10)+","+parseInt(s,10)+")"}return this.attribute("from").value}},s.Element.animateColor.prototype=new s.Element.AnimateBase,s.Element.animateTransform=function(e){this.base=s.Element.AnimateBase,this.base(e),this.calcValue=function(){for(var e=this.progress(),t=s.ToNumberArray(e.from.value),i=s.ToNumberArray(e.to.value),r="",n=0;n<t.length;n++)r+=t[n]+(i[n]-t[n])*e.progress+" ";return r}},s.Element.animateTransform.prototype=new s.Element.animate,s.Element.font=function(e){this.base=s.Element.ElementBase,this.base(e),this.horizAdvX=this.attribute("horiz-adv-x").numValue(),this.isRTL=!1,this.isArabic=!1,this.fontFace=null,this.missingGlyph=null,this.glyphs=[];for(var t=0;t<this.children.length;t++){var i=this.children[t];"font-face"==i.type?(this.fontFace=i).style("font-family").hasValue()&&(s.Definitions[i.style("font-family").value]=this):"missing-glyph"==i.type?this.missingGlyph=i:"glyph"==i.type&&(""!=i.arabicForm?(this.isRTL=!0,this.isArabic=!0,void 0===this.glyphs[i.unicode]&&(this.glyphs[i.unicode]=[]),this.glyphs[i.unicode][i.arabicForm]=i):this.glyphs[i.unicode]=i)}},s.Element.font.prototype=new s.Element.ElementBase,s.Element.fontface=function(e){this.base=s.Element.ElementBase,this.base(e),this.ascent=this.attribute("ascent").value,this.descent=this.attribute("descent").value,this.unitsPerEm=this.attribute("units-per-em").numValue()},s.Element.fontface.prototype=new s.Element.ElementBase,s.Element.missingglyph=function(e){this.base=s.Element.path,this.base(e),this.horizAdvX=0},s.Element.missingglyph.prototype=new s.Element.path,s.Element.glyph=function(e){this.base=s.Element.path,this.base(e),this.horizAdvX=this.attribute("horiz-adv-x").numValue(),this.unicode=this.attribute("unicode").value,this.arabicForm=this.attribute("arabic-form").value},s.Element.glyph.prototype=new s.Element.path,s.Element.text=function(e){this.captureTextNodes=!0,this.base=s.Element.RenderedElementBase,this.base(e),this.baseSetContext=this.setContext,this.setContext=function(e){this.baseSetContext(e);var t=this.style("dominant-baseline").toTextBaseline();null==t&&(t=this.style("alignment-baseline").toTextBaseline()),null!=t&&(e.textBaseline=t)},this.initializeCoordinates=function(e){this.x=this.attribute("x").toPixels("x"),this.y=this.attribute("y").toPixels("y"),this.attribute("dx").hasValue()&&(this.x+=this.attribute("dx").toPixels("x")),this.attribute("dy").hasValue()&&(this.y+=this.attribute("dy").toPixels("y")),this.x+=this.getAnchorDelta(e,this,0)},this.getBoundingBox=function(e){this.initializeCoordinates(e);for(var t=null,i=0;i<this.children.length;i++){var r=this.getChildBoundingBox(e,this,this,i);null==t?t=r:t.addBoundingBox(r)}return t},this.renderChildren=function(e){this.initializeCoordinates(e);for(var t=0;t<this.children.length;t++)this.renderChild(e,this,this,t)},this.getAnchorDelta=function(e,t,i){var r=this.style("text-anchor").valueOrDefault("start");if("start"!=r){for(var n=0,a=i;a<t.children.length;a++){var s=t.children[a];if(i<a&&s.attribute("x").hasValue())break;n+=s.measureTextRecursive(e)}return-1*("end"==r?n:n/2)}return 0},this.adjustChildCoordinates=function(e,t,i,r){var n=i.children[r];return n.attribute("x").hasValue()?(n.x=n.attribute("x").toPixels("x")+t.getAnchorDelta(e,i,r),n.attribute("dx").hasValue()&&(n.x+=n.attribute("dx").toPixels("x"))):(n.attribute("dx").hasValue()&&(t.x+=n.attribute("dx").toPixels("x")),n.x=t.x),t.x=n.x+n.measureText(e),n.attribute("y").hasValue()?(n.y=n.attribute("y").toPixels("y"),n.attribute("dy").hasValue()&&(n.y+=n.attribute("dy").toPixels("y"))):(n.attribute("dy").hasValue()&&(t.y+=n.attribute("dy").toPixels("y")),n.y=t.y),t.y=n.y,n},this.getChildBoundingBox=function(e,t,i,r){var n=this.adjustChildCoordinates(e,t,i,r),a=n.getBoundingBox(e);for(r=0;r<n.children.length;r++){var s=t.getChildBoundingBox(e,t,n,r);a.addBoundingBox(s)}return a},this.renderChild=function(e,t,i,r){var n=this.adjustChildCoordinates(e,t,i,r);for(n.render(e),r=0;r<n.children.length;r++)t.renderChild(e,t,n,r)}},s.Element.text.prototype=new s.Element.RenderedElementBase,s.Element.TextElementBase=function(e){this.base=s.Element.RenderedElementBase,this.base(e),this.getGlyph=function(e,t,i){var r=t[i],n=null;if(e.isArabic){var a="isolated";(0==i||" "==t[i-1])&&i<t.length-2&&" "!=t[i+1]&&(a="terminal"),0<i&&" "!=t[i-1]&&i<t.length-2&&" "!=t[i+1]&&(a="medial"),0<i&&" "!=t[i-1]&&(i==t.length-1||" "==t[i+1])&&(a="initial"),void 0!==e.glyphs[r]&&null==(n=e.glyphs[r][a])&&"glyph"==e.glyphs[r].type&&(n=e.glyphs[r])}else n=e.glyphs[r];return null==n&&(n=e.missingGlyph),n},this.renderChildren=function(e){var t=this.parent.style("font-family").getDefinition();if(null==t)"stroke"==e.paintOrder?(""!=e.strokeStyle&&e.strokeText(s.compressSpaces(this.getText()),this.x,this.y),""!=e.fillStyle&&e.fillText(s.compressSpaces(this.getText()),this.x,this.y)):(""!=e.fillStyle&&e.fillText(s.compressSpaces(this.getText()),this.x,this.y),""!=e.strokeStyle&&e.strokeText(s.compressSpaces(this.getText()),this.x,this.y));else{var i=this.parent.style("font-size").numValueOrDefault(s.Font.Parse(s.ctx.font).fontSize),r=this.parent.style("font-style").valueOrDefault(s.Font.Parse(s.ctx.font).fontStyle),n=this.getText();t.isRTL&&(n=n.split("").reverse().join(""));for(var a=s.ToNumberArray(this.parent.attribute("dx").value),o=0;o<n.length;o++){var l=this.getGlyph(t,n,o),c=i/t.fontFace.unitsPerEm;e.translate(this.x,this.y),e.scale(c,-c);var d=e.lineWidth;e.lineWidth=e.lineWidth*t.fontFace.unitsPerEm/i,"italic"==r&&e.transform(1,0,.4,1,0,0),l.render(e),"italic"==r&&e.transform(1,0,-.4,1,0,0),e.lineWidth=d,e.scale(1/c,-1/c),e.translate(-this.x,-this.y),this.x+=i*(l.horizAdvX||t.horizAdvX)/t.fontFace.unitsPerEm,void 0===a[o]||isNaN(a[o])||(this.x+=a[o])}}},this.getText=function(){},this.measureTextRecursive=function(e){for(var t=this.measureText(e),i=0;i<this.children.length;i++)t+=this.children[i].measureTextRecursive(e);return t},this.measureText=function(e){var t=this.parent.style("font-family").getDefinition();if(null!=t){var i=this.parent.style("font-size").numValueOrDefault(s.Font.Parse(s.ctx.font).fontSize),r=0,n=this.getText();t.isRTL&&(n=n.split("").reverse().join(""));for(var a=s.ToNumberArray(this.parent.attribute("dx").value),o=0;o<n.length;o++)r+=(this.getGlyph(t,n,o).horizAdvX||t.horizAdvX)*i/t.fontFace.unitsPerEm,void 0===a[o]||isNaN(a[o])||(r+=a[o]);return r}var l=s.compressSpaces(this.getText());if(!e.measureText)return 10*l.length;e.save(),this.setContext(e,!0);var c=e.measureText(l).width;return e.restore(),c},this.getBoundingBox=function(e){var t=this.parent.style("font-size").numValueOrDefault(s.Font.Parse(s.ctx.font).fontSize);return new s.BoundingBox(this.x,this.y-t,this.x+this.measureText(e),this.y)}},s.Element.TextElementBase.prototype=new s.Element.RenderedElementBase,s.Element.tspan=function(e){this.captureTextNodes=!0,this.base=s.Element.TextElementBase,this.base(e),this.text=s.compressSpaces(e.value||e.text||e.textContent||""),this.getText=function(){return 0<this.children.length?"":this.text}},s.Element.tspan.prototype=new s.Element.TextElementBase,s.Element.tref=function(e){this.base=s.Element.TextElementBase,this.base(e),this.getText=function(){var e=this.getHrefAttribute().getDefinition();if(null!=e)return e.children[0].getText()}},s.Element.tref.prototype=new s.Element.TextElementBase,s.Element.a=function(e){this.base=s.Element.TextElementBase,this.base(e),this.hasText=0<e.childNodes.length;for(var t=0;t<e.childNodes.length;t++)3!=e.childNodes[t].nodeType&&(this.hasText=!1);this.text=this.hasText?e.childNodes[0].value||e.childNodes[0].data:"",this.getText=function(){return this.text},this.baseRenderChildren=this.renderChildren,this.renderChildren=function(e){if(this.hasText){this.baseRenderChildren(e);var t=new s.Property("fontSize",s.Font.Parse(s.ctx.font).fontSize);s.Mouse.checkBoundingBox(this,new s.BoundingBox(this.x,this.y-t.toPixels("y"),this.x+this.measureText(e),this.y))}else if(0<this.children.length){var i=new s.Element.g;i.children=this.children,i.parent=this,i.render(e)}},this.onclick=function(){r.open(this.getHrefAttribute().value)},this.onmousemove=function(){s.ctx.canvas.style.cursor="pointer"}},s.Element.a.prototype=new s.Element.TextElementBase,s.Element.image=function(e){this.base=s.Element.RenderedElementBase,this.base(e);var t=this.getHrefAttribute().value;if(""!=t){var i=t.match(/\.svg$/);if(s.Images.push(this),this.loaded=!1,i)this.img=s.ajax(t),this.loaded=!0;else{this.img=document.createElement("img"),1==s.opts.useCORS&&(this.img.crossOrigin="Anonymous");var r=this;this.img.onload=function(){r.loaded=!0},this.img.onerror=function(){s.log('ERROR: image "'+t+'" not found'),r.loaded=!0},this.img.src=t}this.renderChildren=function(e){var t=this.attribute("x").toPixels("x"),n=this.attribute("y").toPixels("y"),a=this.attribute("width").toPixels("x"),o=this.attribute("height").toPixels("y");0!=a&&0!=o&&(e.save(),i?e.drawSvg(this.img,t,n,a,o):(e.translate(t,n),s.AspectRatio(e,this.attribute("preserveAspectRatio").value,a,this.img.width,o,this.img.height,0,0),r.loaded&&(void 0===this.img.complete||this.img.complete)&&e.drawImage(this.img,0,0)),e.restore())},this.getBoundingBox=function(){var e=this.attribute("x").toPixels("x"),t=this.attribute("y").toPixels("y"),i=this.attribute("width").toPixels("x"),r=this.attribute("height").toPixels("y");return new s.BoundingBox(e,t,e+i,t+r)}}},s.Element.image.prototype=new s.Element.RenderedElementBase,s.Element.g=function(e){this.base=s.Element.RenderedElementBase,this.base(e),this.getBoundingBox=function(e){for(var t=new s.BoundingBox,i=0;i<this.children.length;i++)t.addBoundingBox(this.children[i].getBoundingBox(e));return t}},s.Element.g.prototype=new s.Element.RenderedElementBase,s.Element.symbol=function(e){this.base=s.Element.RenderedElementBase,this.base(e),this.render=function(e){}},s.Element.symbol.prototype=new s.Element.RenderedElementBase,s.Element.style=function(e){this.base=s.Element.ElementBase,this.base(e);for(var t="",i=0;i<e.childNodes.length;i++)t+=e.childNodes[i].data;t=t.replace(/(\/\*([^*]|[\r\n]|(\*+([^*\/]|[\r\n])))*\*+\/)|(^[\s]*\/\/.*)/gm,"");var r=(t=s.compressSpaces(t)).split("}");for(i=0;i<r.length;i++)if(""!=s.trim(r[i]))for(var n=r[i].split("{"),a=n[0].split(","),o=n[1].split(";"),l=0;l<a.length;l++){var c=s.trim(a[l]);if(""!=c){for(var d=s.Styles[c]||{},u=0;u<o.length;u++){var h=o[u].indexOf(":"),f=o[u].substr(0,h),g=o[u].substr(h+1,o[u].length-h);null!=f&&null!=g&&(d[s.trim(f)]=new s.Property(s.trim(f),s.trim(g)))}if(s.Styles[c]=d,s.StylesSpecificity[c]=p(c),"@font-face"==c)for(var m=d["font-family"].value.replace(/"/g,""),b=d.src.value.split(","),y=0;y<b.length;y++)if(0<b[y].indexOf('format("svg")'))for(var v=b[y].indexOf("url"),x=b[y].indexOf(")",v),_=b[y].substr(v+5,x-v-6),w=s.parseXml(s.ajax(_)).getElementsByTagName("font"),E=0;E<w.length;E++){var S=s.CreateElement(w[E]);s.Definitions[m]=S}}}},s.Element.style.prototype=new s.Element.ElementBase,s.Element.use=function(e){this.base=s.Element.RenderedElementBase,this.base(e),this.baseSetContext=this.setContext,this.setContext=function(e){this.baseSetContext(e),this.attribute("x").hasValue()&&e.translate(this.attribute("x").toPixels("x"),0),this.attribute("y").hasValue()&&e.translate(0,this.attribute("y").toPixels("y"))};var t=this.getHrefAttribute().getDefinition();this.path=function(e){null!=t&&t.path(e)},this.elementTransform=function(){if(null!=t&&t.style("transform",!1,!0).hasValue())return new s.Transform(t.style("transform",!1,!0).value)},this.getBoundingBox=function(e){if(null!=t)return t.getBoundingBox(e)},this.renderChildren=function(e){if(null!=t){var i=t;"symbol"==t.type&&((i=new s.Element.svg).type="svg",i.attributes.viewBox=new s.Property("viewBox",t.attribute("viewBox").value),i.attributes.preserveAspectRatio=new s.Property("preserveAspectRatio",t.attribute("preserveAspectRatio").value),i.attributes.overflow=new s.Property("overflow",t.attribute("overflow").value),i.children=t.children),"svg"==i.type&&(this.attribute("width").hasValue()&&(i.attributes.width=new s.Property("width",this.attribute("width").value)),this.attribute("height").hasValue()&&(i.attributes.height=new s.Property("height",this.attribute("height").value)));var r=i.parent;i.parent=null,i.render(e),i.parent=r}}},s.Element.use.prototype=new s.Element.RenderedElementBase,s.Element.mask=function(e){this.base=s.Element.ElementBase,this.base(e),this.apply=function(e,t){var i=this.attribute("x").toPixels("x"),r=this.attribute("y").toPixels("y"),a=this.attribute("width").toPixels("x"),o=this.attribute("height").toPixels("y");if(0==a&&0==o){for(var l=new s.BoundingBox,c=0;c<this.children.length;c++)l.addBoundingBox(this.children[c].getBoundingBox(e));i=Math.floor(l.x1),r=Math.floor(l.y1),a=Math.floor(l.width()),o=Math.floor(l.height())}var d=t.attribute("mask").value;t.attribute("mask").value="";var u=n();u.width=i+a,u.height=r+o;var h=u.getContext("2d");this.renderChildren(h);var f=n();f.width=i+a,f.height=r+o;var p=f.getContext("2d");t.render(p),p.globalCompositeOperation="destination-in",p.fillStyle=h.createPattern(u,"no-repeat"),p.fillRect(0,0,i+a,r+o),e.fillStyle=p.createPattern(f,"no-repeat"),e.fillRect(0,0,i+a,r+o),t.attribute("mask").value=d},this.render=function(e){}},s.Element.mask.prototype=new s.Element.ElementBase,s.Element.clipPath=function(e){this.base=s.Element.ElementBase,this.base(e),this.apply=function(e){var t="undefined"!=typeof CanvasRenderingContext2D,i=e.beginPath,r=e.closePath;t&&(CanvasRenderingContext2D.prototype.beginPath=function(){},CanvasRenderingContext2D.prototype.closePath=function(){}),i.call(e);for(var n=0;n<this.children.length;n++){var a=this.children[n];if(void 0!==a.path){var o=void 0!==a.elementTransform&&a.elementTransform();!o&&a.style("transform",!1,!0).hasValue()&&(o=new s.Transform(a.style("transform",!1,!0).value)),o&&o.apply(e),a.path(e),t&&(CanvasRenderingContext2D.prototype.closePath=r),o&&o.unapply(e)}}r.call(e),e.clip(),t&&(CanvasRenderingContext2D.prototype.beginPath=i,CanvasRenderingContext2D.prototype.closePath=r)},this.render=function(e){}},s.Element.clipPath.prototype=new s.Element.ElementBase,s.Element.filter=function(e){this.base=s.Element.ElementBase,this.base(e),this.apply=function(e,t){var i=t.getBoundingBox(e),r=Math.floor(i.x1),a=Math.floor(i.y1),s=Math.floor(i.width()),o=Math.floor(i.height()),l=t.style("filter").value;t.style("filter").value="";for(var c=0,d=0,u=0;u<this.children.length;u++){var h=this.children[u].extraFilterDistance||0;c=Math.max(c,h),d=Math.max(d,h)}var f=n();f.width=s+2*c,f.height=o+2*d;var p=f.getContext("2d");for(p.translate(-r+c,-a+d),t.render(p),u=0;u<this.children.length;u++)"function"==typeof this.children[u].apply&&this.children[u].apply(p,0,0,s+2*c,o+2*d);e.drawImage(f,0,0,s+2*c,o+2*d,r-c,a-d,s+2*c,o+2*d),t.style("filter",!0).value=l},this.render=function(e){}},s.Element.filter.prototype=new s.Element.ElementBase,s.Element.feMorphology=function(e){this.base=s.Element.ElementBase,this.base(e),this.apply=function(e,t,i,r,n){}},s.Element.feMorphology.prototype=new s.Element.ElementBase,s.Element.feComposite=function(e){this.base=s.Element.ElementBase,this.base(e),this.apply=function(e,t,i,r,n){}},s.Element.feComposite.prototype=new s.Element.ElementBase,s.Element.feColorMatrix=function(e){this.base=s.Element.ElementBase,this.base(e);var t=s.ToNumberArray(this.attribute("values").value);switch(this.attribute("type").valueOrDefault("matrix")){case"saturate":var i=t[0];t=[.213+.787*i,.715-.715*i,.072-.072*i,0,0,.213-.213*i,.715+.285*i,.072-.072*i,0,0,.213-.213*i,.715-.715*i,.072+.928*i,0,0,0,0,0,1,0,0,0,0,0,1];break;case"hueRotate":var r=t[0]*Math.PI/180,n=function(e,t,i){return e+Math.cos(r)*t+Math.sin(r)*i};t=[n(.213,.787,-.213),n(.715,-.715,-.715),n(.072,-.072,.928),0,0,n(.213,-.213,.143),n(.715,.285,.14),n(.072,-.072,-.283),0,0,n(.213,-.213,-.787),n(.715,-.715,.715),n(.072,.928,.072),0,0,0,0,0,1,0,0,0,0,0,1];break;case"luminanceToAlpha":t=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.2125,.7154,.0721,0,0,0,0,0,0,1]}function a(e,t,i,r,n,a){return e[i*r*4+4*t+a]}function o(e,t,i,r,n,a,s){e[i*r*4+4*t+a]=s}function l(e,i){var r=t[e];return r*(r<0?i-255:i)}this.apply=function(e,t,i,r,n){var s=e.getImageData(0,0,r,n);for(i=0;i<n;i++)for(t=0;t<r;t++){var c=a(s.data,t,i,r,0,0),d=a(s.data,t,i,r,0,1),u=a(s.data,t,i,r,0,2),h=a(s.data,t,i,r,0,3);o(s.data,t,i,r,0,0,l(0,c)+l(1,d)+l(2,u)+l(3,h)+l(4,1)),o(s.data,t,i,r,0,1,l(5,c)+l(6,d)+l(7,u)+l(8,h)+l(9,1)),o(s.data,t,i,r,0,2,l(10,c)+l(11,d)+l(12,u)+l(13,h)+l(14,1)),o(s.data,t,i,r,0,3,l(15,c)+l(16,d)+l(17,u)+l(18,h)+l(19,1))}e.clearRect(0,0,r,n),e.putImageData(s,0,0)}},s.Element.feColorMatrix.prototype=new s.Element.ElementBase,s.Element.feGaussianBlur=function(e){this.base=s.Element.ElementBase,this.base(e),this.blurRadius=Math.floor(this.attribute("stdDeviation").numValue()),this.extraFilterDistance=this.blurRadius,this.apply=function(e,i,r,n,a){t&&void 0!==t.canvasRGBA?(e.canvas.id=s.UniqueId(),e.canvas.style.display="none",document.body.appendChild(e.canvas),t.canvasRGBA(e.canvas,i,r,n,a,this.blurRadius),document.body.removeChild(e.canvas)):s.log("ERROR: StackBlur.js must be included for blur to work")}},s.Element.feGaussianBlur.prototype=new s.Element.ElementBase,s.Element.title=function(e){},s.Element.title.prototype=new s.Element.ElementBase,s.Element.desc=function(e){},s.Element.desc.prototype=new s.Element.ElementBase,s.Element.MISSING=function(e){s.log("ERROR: Element '"+e.nodeName+"' not yet implemented.")},s.Element.MISSING.prototype=new s.Element.ElementBase,s.CreateElement=function(e){var t=e.nodeName.replace(/^[^:]+:/,"");t=t.replace(/\-/g,"");var i=null;return(i=void 0!==s.Element[t]?new s.Element[t](e):new s.Element.MISSING(e)).type=e.nodeName,i},s.load=function(e,t){s.loadXml(e,s.ajax(t))},s.loadXml=function(e,t){s.loadXmlDoc(e,s.parseXml(t))},s.loadXmlDoc=function(e,t){s.init(e);var i=function(t){for(var i=e.canvas;i;)t.x-=i.offsetLeft,t.y-=i.offsetTop,i=i.offsetParent;return r.scrollX&&(t.x+=r.scrollX),r.scrollY&&(t.y+=r.scrollY),t};1!=s.opts.ignoreMouse&&(e.canvas.onclick=function(e){var t=i(new s.Point(null!=e?e.clientX:event.clientX,null!=e?e.clientY:event.clientY));s.Mouse.onclick(t.x,t.y)},e.canvas.onmousemove=function(e){var t=i(new s.Point(null!=e?e.clientX:event.clientX,null!=e?e.clientY:event.clientY));s.Mouse.onmousemove(t.x,t.y)});var n=s.CreateElement(t.documentElement);n.root=!0,n.addStylesFromStyleDefinition();var a=!0,o=function(){s.ViewPort.Clear(),e.canvas.parentNode?s.ViewPort.SetCurrent(e.canvas.parentNode.clientWidth,e.canvas.parentNode.clientHeight):s.ViewPort.SetCurrent(800,600),1!=s.opts.ignoreDimensions&&(n.style("width").hasValue()&&(e.canvas.width=n.style("width").toPixels("x"),e.canvas.style&&(e.canvas.style.width=e.canvas.width+"px")),n.style("height").hasValue()&&(e.canvas.height=n.style("height").toPixels("y"),e.canvas.style&&(e.canvas.style.height=e.canvas.height+"px")));var i=e.canvas.clientWidth||e.canvas.width,r=e.canvas.clientHeight||e.canvas.height;if(1==s.opts.ignoreDimensions&&n.style("width").hasValue()&&n.style("height").hasValue()&&(i=n.style("width").toPixels("x"),r=n.style("height").toPixels("y")),s.ViewPort.SetCurrent(i,r),null!=s.opts.offsetX&&(n.attribute("x",!0).value=s.opts.offsetX),null!=s.opts.offsetY&&(n.attribute("y",!0).value=s.opts.offsetY),null!=s.opts.scaleWidth||null!=s.opts.scaleHeight){var o=null,l=null,c=s.ToNumberArray(n.attribute("viewBox").value);null!=s.opts.scaleWidth&&(n.attribute("width").hasValue()?o=n.attribute("width").toPixels("x")/s.opts.scaleWidth:isNaN(c[2])||(o=c[2]/s.opts.scaleWidth)),null!=s.opts.scaleHeight&&(n.attribute("height").hasValue()?l=n.attribute("height").toPixels("y")/s.opts.scaleHeight:isNaN(c[3])||(l=c[3]/s.opts.scaleHeight)),null==o&&(o=l),null==l&&(l=o),n.attribute("width",!0).value=s.opts.scaleWidth,n.attribute("height",!0).value=s.opts.scaleHeight,n.style("transform",!0,!0).value+=" scale("+1/o+","+1/l+")"}1!=s.opts.ignoreClear&&e.clearRect(0,0,i,r),n.render(e),a&&(a=!1,"function"==typeof s.opts.renderCallback&&s.opts.renderCallback(t))},l=!0;s.ImagesLoaded()&&(l=!1,o()),s.intervalID=setInterval(function(){var e=!1;if(l&&s.ImagesLoaded()&&(e=!(l=!1)),1!=s.opts.ignoreMouse&&(e|=s.Mouse.hasEvents()),1!=s.opts.ignoreAnimation)for(var t=0;t<s.Animations.length;t++)e|=s.Animations[t].update(1e3/s.FRAMERATE);"function"==typeof s.opts.forceRedraw&&1==s.opts.forceRedraw()&&(e=!0),e&&(o(),s.Mouse.runEvents())},1e3/s.FRAMERATE)},s.stop=function(){s.intervalID&&clearInterval(s.intervalID)},s.Mouse=new function(){this.events=[],this.hasEvents=function(){return 0!=this.events.length},this.onclick=function(e,t){this.events.push({type:"onclick",x:e,y:t,run:function(e){e.onclick&&e.onclick()}})},this.onmousemove=function(e,t){this.events.push({type:"onmousemove",x:e,y:t,run:function(e){e.onmousemove&&e.onmousemove()}})},this.eventElements=[],this.checkPath=function(e,t){for(var i=0;i<this.events.length;i++){var r=this.events[i];t.isPointInPath&&t.isPointInPath(r.x,r.y)&&(this.eventElements[i]=e)}},this.checkBoundingBox=function(e,t){for(var i=0;i<this.events.length;i++){var r=this.events[i];t.isPointInBox(r.x,r.y)&&(this.eventElements[i]=e)}},this.runEvents=function(){s.ctx.canvas.style.cursor="";for(var e=0;e<this.events.length;e++)for(var t=this.events[e],i=this.eventElements[e];i;)t.run(i),i=i.parent;this.events=[],this.eventElements=[]}},s}(l||{});"string"==typeof i&&(i=document.getElementById(i)),null!=i.svg&&i.svg.stop(),i.childNodes&&1==i.childNodes.length&&"OBJECT"==i.childNodes[0].nodeName||(i.svg=c);var d=i.getContext("2d");void 0!==o.documentElement?c.loadXmlDoc(d,o):"<"==o.substr(0,1)?c.loadXml(d,o):c.load(d,o)}else for(var u=document.querySelectorAll("svg"),h=0;h<u.length;h++){var f=u[h],g=document.createElement("canvas");g.width=f.clientWidth,g.height=f.clientHeight,f.parentNode.insertBefore(g,f),f.parentNode.removeChild(f);var m=document.createElement("div");m.appendChild(f),s(g,m.innerHTML)}};"undefined"==typeof Element||(void 0!==Element.prototype.matches?a=function(e,t){return e.matches(t)}:void 0!==Element.prototype.webkitMatchesSelector?a=function(e,t){return e.webkitMatchesSelector(t)}:void 0!==Element.prototype.mozMatchesSelector?a=function(e,t){return e.mozMatchesSelector(t)}:void 0!==Element.prototype.msMatchesSelector?a=function(e,t){return e.msMatchesSelector(t)}:void 0!==Element.prototype.oMatchesSelector?a=function(e,t){return e.oMatchesSelector(t)}:("function"!=typeof jQuery&&"function"!=typeof Zepto||(a=function(e,t){return $(e).is(t)}),void 0===a&&"undefined"!=typeof Sizzle&&(a=Sizzle.matchesSelector)));var o=/(\[[^\]]+\])/g,l=/(#[^\s\+>~\.\[:]+)/g,c=/(\.[^\s\+>~\.\[:]+)/g,d=/(::[^\s\+>~\.\[:]+|:first-line|:first-letter|:before|:after)/gi,u=/(:[\w-]+\([^\)]*\))/gi,h=/(:[^\s\+>~\.\[:]+)/g,f=/([^\s\+>~\.\[:]+)/g;function p(e){var t=[0,0,0],i=function(i,r){var n=e.match(i);null!=n&&(t[r]+=n.length,e=e.replace(i," "))};return e=(e=e.replace(/:not\(([^\)]*)\)/g,"     $1 ")).replace(/{[\s\S]*/gm," "),i(o,1),i(l,0),i(c,1),i(d,2),i(u,1),i(h,1),e=(e=e.replace(/[\*\s\+>~]/g," ")).replace(/[#\.]/g," "),i(f,2),t.join("")}"undefined"!=typeof CanvasRenderingContext2D&&(CanvasRenderingContext2D.prototype.drawSvg=function(e,t,i,r,n,a){var o={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0,ignoreClear:!0,offsetX:t,offsetY:i,scaleWidth:r,scaleHeight:n};for(var l in a)a.hasOwnProperty(l)&&(o[l]=a[l]);s(this.canvas,e,o)}),i.exports=s}(i={exports:{}}),i.exports}(i(22),i(23))},function(e,t,i){(function(i){var r,n,a;n=[],void 0===(a="function"==typeof(r=function(){"use strict";function t(e,t,i){var r=new XMLHttpRequest;r.open("GET",e),r.responseType="blob",r.onload=function(){s(r.response,t,i)},r.onerror=function(){console.error("could not download file")},r.send()}function r(e){var t=new XMLHttpRequest;return t.open("HEAD",e,!1),t.send(),200<=t.status&&299>=t.status}function n(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(i){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var a="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof i&&i.global===i?i:void 0,s=a.saveAs||("object"!=typeof window||window!==a?function(){}:"download"in HTMLAnchorElement.prototype?function(e,i,s){var o=a.URL||a.webkitURL,l=document.createElement("a");i=i||e.name||"download",l.download=i,l.rel="noopener","string"==typeof e?(l.href=e,l.origin===location.origin?n(l):r(l.href)?t(e,i,s):n(l,l.target="_blank")):(l.href=o.createObjectURL(e),setTimeout(function(){o.revokeObjectURL(l.href)},4e4),setTimeout(function(){n(l)},0))}:"msSaveOrOpenBlob"in navigator?function(e,i,a){if(i=i||e.name||"download","string"!=typeof e)navigator.msSaveOrOpenBlob(function(e,t){return void 0===t?t={autoBom:!1}:"object"!=typeof t&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e}(e,a),i);else if(r(e))t(e,i,a);else{var s=document.createElement("a");s.href=e,s.target="_blank",setTimeout(function(){n(s)})}}:function(e,i,r,n){if((n=n||open("","_blank"))&&(n.document.title=n.document.body.innerText="downloading..."),"string"==typeof e)return t(e,i,r);var s="application/octet-stream"===e.type,o=/constructor/i.test(a.HTMLElement)||a.safari,l=/CriOS\/[\d]+/.test(navigator.userAgent);if((l||s&&o)&&"object"==typeof FileReader){var c=new FileReader;c.onloadend=function(){var e=c.result;e=l?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),n?n.location.href=e:location=e,n=null},c.readAsDataURL(e)}else{var d=a.URL||a.webkitURL,u=d.createObjectURL(e);n?n.location=u:location.href=u,n=null,setTimeout(function(){d.revokeObjectURL(u)},4e4)}});a.saveAs=s.saveAs=s,e.exports=s})?r.apply(t,n):r)||(e.exports=a)}).call(this,i(24))},function(e,t,i){(e.exports=i(25)(!1)).push([e.i,"body > * {\n    visibility: hidden;\n}\nbody {\n    overflow: hidden;\n}\nbody * {\n    visibility: hidden !important;\n}\n\n.tau-chart__print-block {\n    position: absolute;\n    top: 0;\n    left: 0;\n    visibility: visible !important;\n    display: block !important;\n    width: 100%;\n    /*height: 100%;*/\n}\n",""])},,function(e,t,i){e.exports=i(26)},function(e,t){e.exports=function(e){this.ok=!1,this.alpha=1,"#"==e.charAt(0)&&(e=e.substr(1,6)),e=(e=e.replace(/ /g,"")).toLowerCase();var t={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};e=t[e]||e;for(var i=[{re:/^rgba\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3}),\s*((?:\d?\.)?\d)\)$/,example:["rgba(123, 234, 45, 0.8)","rgba(255,234,245,1.0)"],process:function(e){return[parseInt(e[1]),parseInt(e[2]),parseInt(e[3]),parseFloat(e[4])]}},{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(e){return[parseInt(e[1]),parseInt(e[2]),parseInt(e[3])]}},{re:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,example:["#00ff00","336699"],process:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,example:["#fb0","f0f"],process:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}}],r=0;r<i.length;r++){var n=i[r].re,a=i[r].process,s=n.exec(e);if(s){var o=a(s);this.r=o[0],this.g=o[1],this.b=o[2],o.length>3&&(this.alpha=o[3]),this.ok=!0}}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.alpha=this.alpha<0?0:this.alpha>1||isNaN(this.alpha)?1:this.alpha,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toRGBA=function(){return"rgba("+this.r+", "+this.g+", "+this.b+", "+this.alpha+")"},this.toHex=function(){var e=this.r.toString(16),t=this.g.toString(16),i=this.b.toString(16);return 1==e.length&&(e="0"+e),1==t.length&&(t="0"+t),1==i.length&&(i="0"+i),"#"+e+t+i},this.getHelpXML=function(){for(var e=new Array,r=0;r<i.length;r++)for(var n=i[r].example,a=0;a<n.length;a++)e[e.length]=n[a];for(var s in t)e[e.length]=s;var o=document.createElement("ul");o.setAttribute("id","rgbcolor-examples");for(r=0;r<e.length;r++)try{var l=document.createElement("li"),c=new RGBColor(e[r]),d=document.createElement("div");d.style.cssText="margin: 3px; border: 1px solid black; background:"+c.toHex()+"; color:"+c.toHex(),d.appendChild(document.createTextNode("test"));var u=document.createTextNode(" "+e[r]+" -> "+c.toRGB()+" -> "+c.toHex());l.appendChild(d),l.appendChild(u),o.appendChild(l)}catch(e){}return o}}},function(e,t){var i=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],r=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function n(e,t,i,r,n){if("string"==typeof e)e=document.getElementById(e);else if("undefined"!=typeof HTMLCanvasElement&&!e instanceof HTMLCanvasElement)return;var a,s=e.getContext("2d");try{try{a=s.getImageData(t,i,r,n)}catch(e){throw new Error("unable to access local image data: "+e)}}catch(e){throw new Error("unable to access image data: "+e)}return a}function a(e,t,i,r,a,o){if(!(isNaN(o)||o<1)){o|=0;var l=n(e,t,i,r,a);l=s(l,t,i,r,a,o),e.getContext("2d").putImageData(l,t,i)}}function s(e,t,n,a,s,o){var l,d,u,h,f,p,g,m,b,y,v,x,_,w,E,S,T,M,C,k,A,P,O,N,L=e.data,R=o+o+1,F=a-1,D=s-1,$=o+1,z=$*($+1)/2,B=new c,I=B;for(u=1;u<R;u++)if(I=I.next=new c,u==$)var j=I;I.next=B;var V=null,H=null;g=p=0;var W=i[o],U=r[o];for(d=0;d<s;d++){for(S=T=M=C=m=b=y=v=0,x=$*(k=L[p]),_=$*(A=L[p+1]),w=$*(P=L[p+2]),E=$*(O=L[p+3]),m+=z*k,b+=z*A,y+=z*P,v+=z*O,I=B,u=0;u<$;u++)I.r=k,I.g=A,I.b=P,I.a=O,I=I.next;for(u=1;u<$;u++)h=p+((F<u?F:u)<<2),m+=(I.r=k=L[h])*(N=$-u),b+=(I.g=A=L[h+1])*N,y+=(I.b=P=L[h+2])*N,v+=(I.a=O=L[h+3])*N,S+=k,T+=A,M+=P,C+=O,I=I.next;for(V=B,H=j,l=0;l<a;l++)L[p+3]=O=v*W>>U,0!=O?(O=255/O,L[p]=(m*W>>U)*O,L[p+1]=(b*W>>U)*O,L[p+2]=(y*W>>U)*O):L[p]=L[p+1]=L[p+2]=0,m-=x,b-=_,y-=w,v-=E,x-=V.r,_-=V.g,w-=V.b,E-=V.a,h=g+((h=l+o+1)<F?h:F)<<2,m+=S+=V.r=L[h],b+=T+=V.g=L[h+1],y+=M+=V.b=L[h+2],v+=C+=V.a=L[h+3],V=V.next,x+=k=H.r,_+=A=H.g,w+=P=H.b,E+=O=H.a,S-=k,T-=A,M-=P,C-=O,H=H.next,p+=4;g+=a}for(l=0;l<a;l++){for(T=M=C=S=b=y=v=m=0,x=$*(k=L[p=l<<2]),_=$*(A=L[p+1]),w=$*(P=L[p+2]),E=$*(O=L[p+3]),m+=z*k,b+=z*A,y+=z*P,v+=z*O,I=B,u=0;u<$;u++)I.r=k,I.g=A,I.b=P,I.a=O,I=I.next;for(f=a,u=1;u<=o;u++)p=f+l<<2,m+=(I.r=k=L[p])*(N=$-u),b+=(I.g=A=L[p+1])*N,y+=(I.b=P=L[p+2])*N,v+=(I.a=O=L[p+3])*N,S+=k,T+=A,M+=P,C+=O,I=I.next,u<D&&(f+=a);for(p=l,V=B,H=j,d=0;d<s;d++)L[(h=p<<2)+3]=O=v*W>>U,O>0?(O=255/O,L[h]=(m*W>>U)*O,L[h+1]=(b*W>>U)*O,L[h+2]=(y*W>>U)*O):L[h]=L[h+1]=L[h+2]=0,m-=x,b-=_,y-=w,v-=E,x-=V.r,_-=V.g,w-=V.b,E-=V.a,h=l+((h=d+$)<D?h:D)*a<<2,m+=S+=V.r=L[h],b+=T+=V.g=L[h+1],y+=M+=V.b=L[h+2],v+=C+=V.a=L[h+3],V=V.next,x+=k=H.r,_+=A=H.g,w+=P=H.b,E+=O=H.a,S-=k,T-=A,M-=P,C-=O,H=H.next,p+=a}return e}function o(e,t,i,r,a,s){if(!(isNaN(s)||s<1)){s|=0;var o=n(e,t,i,r,a);o=l(o,t,i,r,a,s),e.getContext("2d").putImageData(o,t,i)}}function l(e,t,n,a,s,o){var l,d,u,h,f,p,g,m,b,y,v,x,_,w,E,S,T,M,C,k,A=e.data,P=o+o+1,O=a-1,N=s-1,L=o+1,R=L*(L+1)/2,F=new c,D=F;for(u=1;u<P;u++)if(D=D.next=new c,u==L)var $=D;D.next=F;var z=null,B=null;g=p=0;var I=i[o],j=r[o];for(d=0;d<s;d++){for(w=E=S=m=b=y=0,v=L*(T=A[p]),x=L*(M=A[p+1]),_=L*(C=A[p+2]),m+=R*T,b+=R*M,y+=R*C,D=F,u=0;u<L;u++)D.r=T,D.g=M,D.b=C,D=D.next;for(u=1;u<L;u++)h=p+((O<u?O:u)<<2),m+=(D.r=T=A[h])*(k=L-u),b+=(D.g=M=A[h+1])*k,y+=(D.b=C=A[h+2])*k,w+=T,E+=M,S+=C,D=D.next;for(z=F,B=$,l=0;l<a;l++)A[p]=m*I>>j,A[p+1]=b*I>>j,A[p+2]=y*I>>j,m-=v,b-=x,y-=_,v-=z.r,x-=z.g,_-=z.b,h=g+((h=l+o+1)<O?h:O)<<2,m+=w+=z.r=A[h],b+=E+=z.g=A[h+1],y+=S+=z.b=A[h+2],z=z.next,v+=T=B.r,x+=M=B.g,_+=C=B.b,w-=T,E-=M,S-=C,B=B.next,p+=4;g+=a}for(l=0;l<a;l++){for(E=S=w=b=y=m=0,v=L*(T=A[p=l<<2]),x=L*(M=A[p+1]),_=L*(C=A[p+2]),m+=R*T,b+=R*M,y+=R*C,D=F,u=0;u<L;u++)D.r=T,D.g=M,D.b=C,D=D.next;for(f=a,u=1;u<=o;u++)p=f+l<<2,m+=(D.r=T=A[p])*(k=L-u),b+=(D.g=M=A[p+1])*k,y+=(D.b=C=A[p+2])*k,w+=T,E+=M,S+=C,D=D.next,u<N&&(f+=a);for(p=l,z=F,B=$,d=0;d<s;d++)A[h=p<<2]=m*I>>j,A[h+1]=b*I>>j,A[h+2]=y*I>>j,m-=v,b-=x,y-=_,v-=z.r,x-=z.g,_-=z.b,h=l+((h=d+L)<N?h:N)*a<<2,m+=w+=z.r=A[h],b+=E+=z.g=A[h+1],y+=S+=z.b=A[h+2],z=z.next,v+=T=B.r,x+=M=B.g,_+=C=B.b,w-=T,E-=M,S-=C,B=B.next,p+=a}return e}function c(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}e.exports={image:function(e,t,i,r){if("string"==typeof e)e=document.getElementById(e);else if("undefined"!=typeof HTMLImageElement&&!e instanceof HTMLImageElement)return;var n=e.naturalWidth,s=e.naturalHeight;if("string"==typeof t)t=document.getElementById(t);else if("undefined"!=typeof HTMLCanvasElement&&!t instanceof HTMLCanvasElement)return;t.style.width=n+"px",t.style.height=s+"px",t.width=n,t.height=s;var l=t.getContext("2d");l.clearRect(0,0,n,s),l.drawImage(e,0,0),isNaN(i)||i<1||(r?a(t,0,0,n,s,i):o(t,0,0,n,s,i))},canvasRGBA:a,canvasRGB:o,imageDataRGBA:s,imageDataRGB:l}},function(e,t){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(e){"object"==typeof window&&(i=window)}e.exports=i},function(e,t,i){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var i=function(e,t){var i=e[1]||"",r=e[3];if(!r)return i;if(t&&"function"==typeof btoa){var n=(s=r,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(s))))+" */"),a=r.sources.map(function(e){return"/*# sourceURL="+r.sourceRoot+e+" */"});return[i].concat(a).concat([n]).join("\n")}var s;return[i].join("\n")}(t,e);return t[2]?"@media "+t[2]+"{"+i+"}":i}).join("")},t.i=function(e,i){"string"==typeof e&&(e=[[null,e,""]]);for(var r={},n=0;n<this.length;n++){var a=this[n][0];null!=a&&(r[a]=!0)}for(n=0;n<e.length;n++){var s=e[n];null!=s[0]&&r[s[0]]||(i&&!s[2]?s[2]=i:i&&(s[2]="("+s[2]+") and ("+i+")"),t.push(s))}},t}},function(e,t,i){"use strict";i.r(t);var r=i(1),n=i(9);function a(e,t){return e.replace(/\{\{\s*(.+?)\s*\}\}/g,(e,i)=>t.hasOwnProperty(i)?t[i]:"")}var s=r.default.api.utils,o=r.default.api.pluginsSDK,l=function(e,t,i){"front"===i?e.push(t):e.unshift(t)},c=function(e){return function(t){var i={},n=[{dim:t.scaleX.dim,scale:t.scaleY,method:"yi"},{dim:t.scaleY.dim,scale:t.scaleX,method:"xi"},{dim:null,scale:null,method:null,k:null}].find(function(t){return Array.isArray(e.dim)?e.dim.indexOf(t.dim)>=0:t.dim===e.dim});if(null===n.method)return i;var a={l:-.5,r:.5},s=n.method,o=n.scale;return i[s]=function(e){var i=a[e.__pos__]||0;if(o.discrete)return t[s](e)+o.stepSize(e[o.dim])*i;if(o.period){const t=r.default.api.tickPeriod.get(o.period,{utc:o.utcTime}),i=o.domain();let n=t.cast(i[0]);for(;n<i[0];)n=t.next(n);const a=t.cast(i[1]),s=(o(a)-o(n))/(a-n);switch(e.__pos__){case"l":{const e=Math.min(0,i[0]-n);return o(n)+s*e}case"r":{const e=Math.max(0,i[1]-a);return o(a)+s*e}}}return t[s](e)},i}};function d(e){const t=s.defaults(e||{},{items:[],formatters:{}});return{init(e){this._chart=e;var t=e.getSpec();t.scales.annotation_text={type:"value",dim:"text",source:"?"},t.transformations=t.transformations||{};const i=e=>t.settings.log(e,"LOG");this._dataRefs={},t.transformations.dataRange=((n,s)=>{var o=s.from,l=s.to,c=e.getScaleInfo(s.primaryScale),d=c.domain();if(c.period){var u=r.default.api.tickPeriod.get(c.period,{utc:t.settings.utcTime});o=u.cast(new Date(s.from)),l=u.cast(new Date(s.to))}o=null===o?d[0]:o,l=null===l?d[d.length-1]:l;var h=!c.isInDomain(o),f=!c.isInDomain(l);if(c.discrete?h||f:h&&f)return i("Annotation is out of domain"),[];var p=e.getScaleInfo(s.secondaryScale),g=p.domain(),m=[g[0],g[g.length-1]],b=c.dim,y=p.dim,v="__pos__",x={},_={},w={},E={};x[v]="l",x[b]=o,x[y]=m[0],_[v]="l",_[b]=l,_[y]=m[0],w[v]="r",w[b]=l,w[y]=m[1],E[v]="r",E[b]=o,E[y]=m[1];const S="y"===s.axis?w:E,T="y"===s.axis?E:w,M=this._getFormat(b);return s.startText&&(S.text=a(s.startText,{value:M(S[b])})),s.endText&&(T.text=a(s.endText,{value:M(T[b])})),this._useSavedDataRefs([x,_,w,E],String([b,o,l]))}),t.transformations.dataLimit=((n,s)=>{var o=s.primaryScale,l=s.secondaryScale,c=e.getScaleInfo(o),d=c.period?r.default.api.tickPeriod.get(c.period,{utc:t.settings.utcTime}).cast(new Date(s.from)):s.from;if(!c.isInDomain(d))return i("Annotation is out of domain"),[];var u=e.getScaleInfo(l),h=u.domain(),f=[h[0],h[h.length-1]],p={},g={},m=c.dim,b=u.dim,y="__pos__";const v=this._getFormat(m);return p[m]=d,p[b]=f[0],p[y]="l",s.startText&&(p.text=a(s.startText,{value:v(d)})),g[m]=d,g[b]=f[1],g[y]="r",s.endText&&(g.text=a(s.endText,{value:v(d)})),this._useSavedDataRefs([p,g],String([m,b,d]))}),t.transformations.lineNoteData=((t,n)=>{const s=n.xScale,o=n.yScale,l=e.getScaleInfo(s),c=e.getScaleInfo(o),d=l.period?r.default.api.tickPeriod.get(l.period,{utc:l.utcTime}):null,u=c.period?r.default.api.tickPeriod.get(c.period,{utc:c.utcTime}):null,h=n.points.map(e=>[d?d.cast(e[0]):e[0],u?u.cast(e[1]):e[1]]);if(h.some(e=>!l.isInDomain(e[0])||!c.isInDomain(e[1])))return i("Annotation is out of domain"),[];const f=l.dim,p=c.dim,g=[f,p].map(e=>this._getFormat(e)),m=h.map((e,t)=>{0===t||h.length;const i=0===t?n.startText:t===h.length-1?n.endText:"";return{[f]:e[0],[p]:e[1],text:i?a(i,{x:g[0](e[0]),y:g[1](e[1])}):null}});return this._useSavedDataRefs(m,JSON.stringify([f,p,n.points]))})},addAreaNote:function(e,t,i){var r=e.scales[t.x],n=e.scales[t.y],a=i.dim===r.dim?["x","y"]:i.dim===n.dim?["y","x"]:null;if(null===a)return void(t=>e.settings.log(t,"LOG"))("Annotation doesn't match any data field");var s=i.val[0],o=i.val[1];const d=i.text;var u={type:"ELEMENT.PATH",namespace:"annotations",x:t.x,y:t.y,color:i.colorScaleName,label:"annotation_text",expression:{inherit:!1,operator:"none",params:[],source:"/"},transformModel:[c(i)],transformation:[{type:"dataRange",args:{axis:a[0],startText:"string"==typeof d?d:d.start,endText:"string"==typeof d?"":d.end,from:s,to:o,primaryScale:t[a[0]],secondaryScale:t[a[1]]}}],guide:{animationSpeed:t.guide.animationSpeed,showAnchors:"never",cssClass:"tau-chart__annotation-area",label:{fontColor:i.color,position:["r","b","keep-in-box"]}}};l(t.units,u,i.position)},addLineNote:function(e,t,i){var r=e.scales[t.x],n=e.scales[t.y];let a,s=null,o=!0;if(Array.isArray(i.dim)?(o=!1,((a=i.dim)[0]===r.dim&&a[1]===n.dim||a[0]===n.dim&&a[1]===r.dim)&&(s=["x","y"])):i.dim===r.dim?s=["x","y"]:i.dim===n.dim&&(s=["y","x"]),null===s)return void(t=>e.settings.log(t,"LOG"))("Annotation doesn't match any field");var d=i.text,u={type:"ELEMENT.LINE",namespace:"annotations",x:t.x,y:t.y,label:"annotation_text",color:i.colorScaleName,expression:{inherit:!1,operator:"none",params:[],source:"/"},guide:{animationSpeed:t.guide.animationSpeed,showAnchors:"never",widthCssClass:"tau-chart__line-width-2",cssClass:"tau-chart__annotation-line",label:{fontColor:i.color,position:o?["r","b","keep-in-box"]:["auto:avoid-label-edges-overlap","auto:adjust-on-label-overflow","keep-in-box"]},x:{fillGaps:!1},y:{fillGaps:!1}}};let h=o?{transformModel:[c(i)],transformation:[{type:"dataLimit",args:{from:i.val,startText:"string"==typeof d?"":d.start,endText:"string"==typeof d?d:d.end,primaryScale:t[s[0]],secondaryScale:t[s[1]]}}]}:{transformation:[{type:"lineNoteData",args:{points:a[0]===r.dim?i.val:i.val.map(e=>e.slice().reverse()),startText:"string"==typeof d?"":d.start,endText:"string"==typeof d?d:d.end,xScale:t.x,yScale:t.y}}]};Object.assign(u,h),l(t.units,u,i.position)},onRender(){this._clearUnusedDataRefs()},onSpecReady(e,i){var r=this,a=[];this._setupAdditionalSeries(),this._startWatchingDataRefs(),e.traverseSpec(i,function(e){e&&"COORDS.RECT"===e.type&&e.units&&a.push(e)}),this._formatters=o.getFieldFormatters(i,t.formatters);var s=o.spec(i);a.forEach(function(e){t.items.map(function(e,t){var i=(e.color||"#BD10E0").toLowerCase(),r=n.rgb(i).toString();"black"!==i&&"rgb(0, 0, 0)"===r&&(r=null);var a=r||i,o="annotation_color_"+t;return s.addScale(o,{type:"color",source:"?",brewer:[a]}),{dim:e.dim,val:e.val,text:e.text,color:a,position:e.position,colorScaleName:o}}).forEach(function(t){Array.isArray(t.dim)?Array.isArray(t.val)&&t.val.every(Array.isArray)?r.addLineNote(i,e,t):(e=>i.settings.log(e,"LOG"))("Point annotation is not implemented yet"):Array.isArray(t.val)?r.addAreaNote(i,e,t):r.addLineNote(i,e,t)})})},_setupAdditionalSeries:function(){const e=this._chart,i=e.getSpec(),r=e.getDataSources()["/"].data,n=this._getAnnotatedDimValues(t.items);Object.keys(n).forEach(e=>{[`x_${e}`,`y_${e}`].forEach(t=>{if(t in i.scales){const a=i.scales[t],o=r.map(t=>t[e]),l=["period","time"].indexOf(a.type)>=0?n[e].map(e=>new Date(e)):n[e];a.series=s.unique(o.concat(l))}})})},_getFormat(e){return this._formatters[e]?this._formatters[e].format:e=>String(e)},_useSavedDataRefs(e,t){const i=this._dataRefs;return this._usedDataRefsKeys.add(t),t in i?(i[t].forEach((t,i)=>Object.assign(t,e[i])),i[t]):(i[t]=e,e)},_startWatchingDataRefs(){const e=this._dataRefs;this._initialDataRefsKeys=new Set(Object.keys(e)),this._usedDataRefsKeys=new Set},_clearUnusedDataRefs(){const e=this._dataRefs,t=this._initialDataRefsKeys,i=this._usedDataRefsKeys;Array.from(t).filter(e=>!i.has(e)).forEach(t=>delete e[t]),this._initialDataRefsKeys=null,this._usedDataRefsKeys=null},_getDataRowsFromItems(e){const t=(e,t)=>e.reduce((e,i,r)=>(e[i]=t[r],e),{});return e.reduce((e,i)=>(Array.isArray(i.dim)?Array.isArray(i.val)&&i.val.every(Array.isArray)&&i.val.forEach(r=>{e.push(t(i.dim,r))}):Array.isArray(i.val)?i.val.forEach(r=>{e.push(t([i.dim],[r]))}):e.push(t([i.dim],[i.val])),e),[])},_getAnnotatedDimValues(e){const t=this._getDataRowsFromItems(e),i={};return t.forEach(e=>{Object.keys(e).forEach(t=>{i[t]=i[t]||[],i[t].push(e[t])})}),i}}}r.default.api.plugins.add("annotations",d);var u=r.default.api.utils;function h(e){var t=e.x0,i=e.y0,r=null==e.collapse||e.collapse,n=function(e){return{y0:function(i){return e.scaleY.value(i[t])}}},a=function(e){return{y0:function(t){return e.scaleY.value(t[i])}}},s=function(e){var r=e.data();if(0===r.length)return{};var n=e.scaleY,a=Number.MAX_VALUE,s=Number.MIN_VALUE,o=e.flip?t:i,l=n.dim;return r.forEach(function(e){var t=e[o],i=e[l],r=t<i?t:i,n=i>t?i:t;a=r<a?r:a,s=n>s?n:s}),n.fixup(function(e){var t={};return(!e.hasOwnProperty("max")||e.max<s)&&(t.max=s),(!e.hasOwnProperty("min")||e.min>a)&&(t.min=a),t}),{}},o={},l={},c=function(e){var n=e.data().slice(),a=e.scaleX,s=e.scaleY;if(0===n.length||!a.discrete)return{};var c=e.flip?t:i,d=s.dim;n.sort(u.createMultiSorter(function(e,t){return e[c]-t[c]},function(e,t){return e[d]-t[d]}));var h=a.dim,f=a.domain().reduce(function(e,t){return e[t]=[],e},{}),p=new Map;return n.forEach(r?function(e){var t=e[h],i=f[t],r=i.findIndex(function(t){return t[t.length-1][d]<=e[c]});r<0&&(r=i.length,i.push([])),i[r].push(e),p.set(e,r)}:function(e){var t=e[h],i=f[t],r=r=i.length;i.push([]),i[r].push(e),p.set(e,r)}),Object.keys(f).forEach(function(e){o[e]=f[e]}),a.fixup(function(e){var t={},i=a.domain().reduce(function(e,t){return e+o[t].length},0);return a.domain().forEach(function(e){l[e]=i}),t.ratio=function(e){return o[e].length/l[e]},t}),{xi:function(t){var i=t[h],r=a.stepSize(i);return e.xi(t)-r/2+r/o[i].length*(p.get(t)+.5)}}};return{onSpecReady:function(e,t){e.traverseSpec(t,function(e,t){"ELEMENT.INTERVAL"===e.type&&(e.transformModel=[e.flip?n:a,c],e.adjustScales=[s],e.guide.enableColorToBarPosition=!1,e.guide.label=e.guide.label||{},e.guide.label.position=e.guide.label.position||(e.flip?["inside-start-then-outside-end-horizontal","hide-by-label-height-horizontal"]:["inside-start-then-outside-end-vertical"]))})}}}r.default.api.plugins.add("bar-as-span",h);var f=i(0),p=r.default.api.utils,g="minimum",m="maximum",b={MIN:g,MAX:m,MEDIAN:"median",Q1:"Q1",Q3:"Q3"};function y(e,t){var i=e.length-1,r=t/100*i,n=Math.floor(r);if(0===n)return{pos:0,value:e[0]};if(n===i)return{pos:i,value:e[i]};var a=r-n;return a?{pos:r,value:e[n]+a*(e[n+1]-e[n])}:{pos:r,value:e[r]}}function v(e,t,i){for(var r=e.sort(function(e,t){return e-t}),n=y(r,25),a=y(r,50),s=y(r,75),o=s.value-n.value,l=n.value-1.5*o,c=s.value+1.5*o,d=r[0],u=r[r.length-1],h=0;h<=n.pos;h++){var f=r[h];if(f>l){d=f;break}}for(var p=r.length-1;p>=s.pos;p--){var g=r[p];if(g<c){u=g;break}}return t[i.MIN]=d,t[i.MAX]=u,t[i.MEDIAN]=a.value,t[i.Q1]=n.value,t[i.Q3]=s.value,t}function x(e){return e=p.defaults(e||{},{mode:"outliers-only"}),{init:function(e){this._chart=e},onSpecReady:function(t,i){var r=!0===e.flip;i.transformations=i.transformations||{},i.transformations.empty=function(){return[]},i.transformations.outliers=function(e,t){var i=t.x.dim,r=t.y.dim,n=e.reduce(function(e,t){var n=t[i];return e[n]=e[n]||[],e[n].push(t[r]),e},{}),a=Object.keys(n).reduce(function(e,t){var a=v(n[t],{},b),s=a[b.MAX],o=a[b.MIN];return e.concat(function(e){return e[i]!==t||(e[r]>s||e[r]<o)})},[]);return e.filter(function(e){return!a.some(function(t){return!t(e)})})},t.traverseSpec(i,function(t,n){if("ELEMENT.POINT"===t.type){var a=JSON.parse(JSON.stringify(t));a.type="ELEMENT.BOX-WHISKERS",a.flip=r,a.namespace="boxwhiskers",a.guide=a.guide||{},a.guide.fitScale="hide-scatter"===e.mode;var s={"show-scatter":[],"hide-scatter":[{type:"empty"}],"outliers-only":[{type:"outliers",args:{x:i.scales[r?t.y:t.x],y:i.scales[r?t.x:t.y]}}]};t.transformation=t.transformation||[],t.transformation=t.transformation.concat(s[e.mode]),n.units.push(a)}})}}}r.default.api.unitsRegistry.reg("ELEMENT.BOX-WHISKERS",{getAdjustScalesRules:function(){var e=this,t=[];return e.node().config.guide.fitScale&&t.push(function(t){e.fixScale(t,e.calcStat(t))}),t},fixScale:function(e,t){var i=t.reduce(function(e,t){return e.concat([t[b.MIN],t[b.MAX]])},[]).sort(function(e,t){return e-t}),r=i[0],n=i[i.length-1];e.scaleY.fixup(function(e){var t={};if(e.hasOwnProperty("series")){var i=Math.min(e.series[0],r),a=Math.max(e.series[1],n);t.series=[i,a]}else t.series=[r,n];return t})},calcStat:function(e){var t=e.data().reduce(function(t,i){var r=i[e.scaleX.dim];return t[r]=t[r]||[],t[r].push(i[e.scaleY.dim]),t},{});return Object.keys(t).reduce(function(i,r){var n={};return n[e.scaleX.dim]=r,i.concat(v(t[r],n,b))},[])},buildRangeModel:function(e,t){var i=e.flip,r=i?"y":"x",n=i?"x":"y",a=i?"height":"width",s=i?"width":"height",o=i?t.y1:t.y0,l=i?t.y0:t.y1,c=t.size,d=e.model.scaleX,u=e.model.scaleY,h={class:t.class};return h[r]=function(e){return d(e[d.dim])-.5*c},h[n]=function(e){return u(e[l])},h[a]=function(){return c},h[s]=function(e){return Math.max(t.minHeight||1,Math.abs(u(e[o])-u(e[l])))},Object.assign(h,{fill:function(){return t.color||"rgba(0,0,256, 0.5)"}})},draw:function(){var e=this.node().config,t=e.options.slot(e.uid),i=this.calcStat(this.node().screenModel.model);this.drawElement(t,i)},drawElement:function(e,t){var i=this,n=this.node().screenModel,a=r.default.api.d3_animationInterceptor,s=function(e,t){var r=i.node().config.guide.animationSpeed,s=e.selectAll("."+t.class).data(function(e){return[e]},n.id);s.exit().call(a(r,null,{width:0},function(e){f.select(e).remove()})),s.call(a(r,null,t)),s.enter().append("rect").style("stroke-width",0).call(a(r,{width:0},t))},o=function(e){s(e,i.buildRangeModel(n,{size:2,y0:g,y1:"Q1",class:"range-min-Q1"})),s(e,i.buildRangeModel(n,{size:2,y0:"Q3",y1:m,class:"range-Q3-max"})),s(e,i.buildRangeModel(n,{size:20,y0:"Q1",y1:"Q3",class:"range-Q1-Q3"})),s(e,i.buildRangeModel(n,{size:20,minHeight:1,y0:m,y1:m,class:"limit-max"})),s(e,i.buildRangeModel(n,{size:20,minHeight:1,y0:g,y1:g,class:"limit-min"})),s(e,i.buildRangeModel(n,{size:20,minHeight:2,y0:"median",y1:"median",color:"#ff0000",class:"limit-median"}))},l=e.selectAll(".box-whiskers-node").data(t);l.exit().remove(),l.call(o),l.enter().append("g").attr("class","box-whiskers-node").call(o)}},"ELEMENT.GENERIC.CARTESIAN"),r.default.api.plugins.add("box-whiskers",x);const _=r.default.api.utils,w=r.default.api.pluginsSDK,E="tau-chart__category-filter",S=`${E}__value`,T=`${S}_checked`,M=`${S}__toggle`,C=e=>e.join("\n"),k=({categories:e})=>`\n    <div class="${E}">\n        ${C(e.map(e=>A(e)))}\n    </div>\n`,A=({label:e,values:t})=>`\n    <div class="${E}__category">\n        <div class="${E}__category__label">${e}</div>\n        <div class="${E}__category__values">\n            ${C(t.map(e=>P(e)))}\n    </div>\n\n`,P=({key:e,label:t,checked:i})=>`\n    <div class="${S}${i?` ${T}`:""}" data-key="${e}">\n        ${O()}\n        <span class="${S}__label">${t}</span>\n    </div>\n`,O=()=>[`<span class="${M}">`,`<span class="${M}__icon"></span>`,"</span>"].join(""),N=e=>{const t=document.createElement("div");return t.innerHTML=e,t.firstElementChild},L=(e,t,i,r)=>{e.addEventListener(t,function(e){let t=e.target;for(;t!==e.currentTarget&&null!==t;)t.matches(i)&&r(e,t),t=t.parentNode})},R=(e,t)=>{const i=e=>JSON.stringify((e=>null==e||""===e)(e)?null:e),r=i(t);return t=>{const n=t[e],a=i(n);return r===a}};class F{constructor(e){this.settings=_.defaults(e||{},{formatters:{},fields:null,skipColorDim:!0}),this._filters={},this.onRender=this._createRenderHandler()}init(e){this._chart=e;const t=t=>{const i=e.getSpec().scales;return Object.keys(i).map(e=>{return{name:e,config:i[e]}}).filter(t)};let i=t(({config:e,name:t})=>"ordinal"===e.type&&e.dim),r=_.unique(i.map(({config:e})=>e.dim));if(this.settings.fields&&(r=r.filter(e=>this.settings.fields.indexOf(e)>=0)),this.settings.skipColorDim){const e=t(({config:e,name:t})=>"color"===e.type&&e.dim).map(({config:e})=>e.dim);r=r.filter(t=>e.indexOf(t)<0)}i=i.filter(e=>r.indexOf(e.config.dim)>=0),this._categoryScales=i,this._render()}destroy(){const e=this._filters,t=this._chart;Object.keys(e).forEach(i=>t.removeFilter(e[i]));(e=>e&&e.parentElement&&e.parentElement.removeChild(e))(this._node)}_createRenderHandler(){return function(){if(this._lastClickedScrollInfo){const e=this._lastClickedScrollInfo.key,t=this._node.querySelector(`[data-key="${e}"]`);if(t){const e=this._lastClickedScrollInfo.top,i=t.getBoundingClientRect().top,r=this._getScrollContainer(),n=r.getBoundingClientRect().top;r.scrollTop=r.scrollTop-e-n+i}this._lastClickedScrollInfo=null}}}_getContent(e){return k({categories:e})}_getCategoriesInfo(){return this._categoryScales.map(({name:e})=>this._chart.getScaleInfo(e)).map(e=>{const t=e.dim,i=this._getFieldLabel(t),r=this._getFieldFormat(t),n=this._chart.getDataSources({excludeFilter:["category-filter"]}),a=_.unique(n[e.source].data.map(e=>e[t])).map(e=>{const i=r(e),n=this._getFilterKey(t,e);return{label:i,checked:!this._filters[n],key:n,value:e}});return{dim:t,label:i,values:a}})}_render(){this._clear(),this._formatters=w.getFieldFormatters(this._chart.getSpec(),this.settings.formatters);const e=this._getCategoriesInfo(),t=this._getContent(e),i=N(t);this._node=i,this._chart.insertToRightSidebar(i),this._subscribeToEvents(),this._filterKeys=e.reduce((e,t)=>{const i=t.dim;return t.values.forEach(({key:t,value:r})=>{e[t]={dim:i,value:r}}),e},{})}_subscribeToEvents(){const e=this._node;L(e,"click",`.${S}`,(e,t)=>{const i=t.getAttribute("data-key"),r=e.target.matches(`.${M}`);this._toggleCategory(i,r?"toggle":"focus")}),L(e,"mouseover",`.${S}`,(e,t)=>{const i=t.getAttribute("data-key");this._toggleHighlight(i,!0)}),L(e,"mouseout",`.${S}`,(e,t)=>{const i=t.getAttribute("data-key");this._toggleHighlight(i,!1)})}_isFilteredOut(e){return e in this._filters}_toggleCategory(e,t){const i=Array.from(this._node.querySelectorAll(`.${S}`)).reduce((e,t)=>{return e[t.getAttribute("data-key")]=t,e},{}),r=Object.keys(this._filterKeys).map(e=>{const{dim:t,value:r}=this._filterKeys[e];return{node:i[e],key:e,dim:t,value:r,isChecked:!this._isFilteredOut(e)}}),n=r.reduce((e,t)=>(e[t.key]=t,e),{})[e],a=r.filter(e=>e.dim===n.dim),s=(e,t)=>{t?e.classList.add(T):e.classList.remove(T)};switch(t){case"toggle":n.isChecked?(this._addFilter(e),s(n.node,!1)):(this._removeFilter(e),s(n.node,!0));break;case"focus":n.isChecked&&a.every(e=>e===n||!e.isChecked)?a.forEach(e=>{e.isChecked||(s(e.node,!0),this._removeFilter(e.key))}):(a.forEach(e=>{e!==n&&e.isChecked&&(s(e.node,!1),this._addFilter(e.key))}),n.isChecked||(s(n.node,!0),this._removeFilter(n.key)));break}this._lastClickedScrollInfo={key:e,top:n.node.getBoundingClientRect().top-this._getScrollContainer().getBoundingClientRect().top},this._chart.refresh()}_toggleHighlight(e,t){if(this._isFilteredOut(e))return;const{dim:i,value:r}=this._filterKeys[e],n=t?R(i,r):e=>null;this._chart.select(e=>!0).forEach(e=>e.fire("highlight",n))}_clear(){const e=this._node;e&&e.parentElement&&e.parentElement.removeChild(e)}_getScrollContainer(){return this._node.parentElement.parentElement}_getFilterKey(e,t){return`${e}__${t}`}_addFilter(e){const{dim:t,value:i}=this._filterKeys[e],r=R(t,i);this._filters[e]=this._chart.addFilter({tag:"category-filter",predicate:e=>!r(e)})}_removeFilter(e){const t=this._filters[e];delete this._filters[e],this._chart.removeFilter(t)}_getFieldLabel(e){return this._formatters[e]?this._formatters[e].label:e}_getFieldFormat(e){return this._formatters[e]?this._formatters[e].format:e=>String(e)}}r.default.api.plugins.add("category-filter",function(e){return new F(e)});const D="http://www.w3.org/2000/svg";var $=r.default.api.utils,z=r.default.api.svgUtils,B=r.default.api.pluginsSDK;function I(e){e=e||{};var t=document.createElementNS(D,"g"),i=f.select(t).attr("class","tau-crosshair__label");i.append("rect").attr("class","tau-crosshair__label__box"),i.append("text").attr("class","tau-crosshair__label__text-shadow"),i.append("text").attr("class","tau-crosshair__label__text");var r={options:function(t){return e=Object.assign(e,t),r},show:function(n){return e.container.appendChild(t),function(t){var r=t.x,n=t.y,a=t.text,s=t.color,o=t.colorCls;i.attr("class","tau-crosshair__label "+o);var l=e.halign,c=e.valign,d=e.hpad,u=e.vpad,h={left:"end",middle:"middle",right:"start"}[l],f={left:-d,middle:0,right:d}[l],p=i.select(".tau-crosshair__label__text").attr("fill",s),g=i.selectAll(".tau-crosshair__label__text, .tau-crosshair__label__text-shadow").attr("text-anchor",h).attr("x",r+f).attr("y",0).text(a),m=p.node().getBBox(),b={top:-u-m.height/2,middle:0,bottom:u+m.height/2}[c]-m.height/2-m.y;g.attr("y",n+b);var y=m.width+2*d,v=m.height+2*u,x={left:-y,middle:-y/2,right:0}[l],_={top:-v,middle:-v/2,bottom:0}[c];i.select(".tau-crosshair__label__box").attr("fill",s).attr("rx",e.boxCornerRadius).attr("ry",e.boxCornerRadius).attr("x",r+x).attr("y",n+_).attr("width",y).attr("height",v)}(n),function(){i.attr("transform","");var r=e.chart.getLayout().contentContainer.getBoundingClientRect(),n=e.chart.getSVG().getBoundingClientRect(),a=t.getBoundingClientRect(),s=Math.max(0,Math.max(r.left,n.left)-a.left)||Math.min(0,Math.min(r.right,n.right)-a.right),o=Math.max(0,Math.max(r.top,n.top)-a.top)||Math.min(0,Math.min(r.bottom,n.bottom)-a.bottom);i.attr("transform","translate("+s+","+o+")")}(),r},hide:function(){return t.parentNode&&t.parentNode.removeChild(t),r}};return r}function j(e){var t=$.defaults(e||{},{xAxis:!0,yAxis:!0,formatters:{},labelBoxHPadding:5,labelBoxVPadding:3,labelBoxCornerRadius:3,axisHPadding:22,axisVPadding:22});return{init:function(e){this._chart=e,this._formatters={},this._createNode()},_createNode:function(){var e=f.select(document.createElementNS(D,"g")).attr("class","tau-crosshair");this._labels={x:null,y:null};var i=function(i){var r=e.append("g").attr("class","tau-crosshair__group "+i);r.append("line").attr("class","tau-crosshair__line-shadow"),r.append("line").attr("class","tau-crosshair__line"),this._labels[i]=I({container:r.node(),chart:this._chart,halign:"x"===i?"middle":"left",valign:"x"===i?"bottom":"middle",boxCornerRadius:t.labelBoxCornerRadius,hpad:t.labelBoxHPadding,vpad:t.labelBoxVPadding})}.bind(this);t.xAxis&&i("x"),t.yAxis&&i("y"),this._element=e},_setValues:function(e,i,r){var n=function(e){var i=this._element.select(".tau-crosshair__group."+e.dir);i.select(".tau-crosshair__line").attr("class","tau-crosshair__line "+r.cls).attr("stroke",r.color),i.selectAll(".tau-crosshair__line, .tau-crosshair__line-shadow").attr("x1",e.startPt.x).attr("x2",e.valuePt.x).attr("y1",e.startPt.y).attr("y2",e.valuePt.y),("x"===e.dir&&t.xAxis||"y"===e.dir&&t.yAxis)&&this._labels[e.dir].options({halign:e.labelHAlign,valign:e.labelVAlign}).show({x:e.startPt.x,y:e.startPt.y,text:e.label,color:r.color,colorCls:r.cls})}.bind(this);n({dir:"x",startPt:{x:e.value,y:i.start+(e.minMode?0:t.axisVPadding)},valuePt:{x:e.value,y:i.value+i.crossPadding},label:e.label,labelHAlign:"middle",labelVAlign:"bottom"}),n({dir:"y",startPt:{x:e.start-(i.minMode?0:t.axisHPadding),y:i.value},valuePt:{x:e.value-e.crossPadding,y:i.value},label:i.label,labelHAlign:"left",labelVAlign:"middle"})},_showCrosshair:function(e,t,i){var r=this._chart.getSVG(),n=t.config.options.container.node(),a=z.getDeepTransformTranslate(n);this._element.attr("transform",z.translate(a.x,a.y)),r.appendChild(this._element.node());var s=t.getScale("x"),o=t.getScale("y"),l=t.getScale("color"),c=l(e.data[l.dim]),d=e.data[s.dim],u=e.data[o.dim],h=t.screenModel.x(e.data),f=t.screenModel.y(e.data);if(t.config.stack)if(t.config.flip){var p=t.data().filter(function(i){var r=i[o.dim];return i===e.data||(r===u||r-u==0)&&(t.screenModel.x(e.data)-t.screenModel.x(i))*i[s.dim]>0});h=(d<0?Math.min:Math.max).apply(null,p.map(function(e){return t.screenModel.x(e)},0)),d=p.reduce(function(e,t){return e+t[s.dim]},0)}else{var g=t.data().filter(function(i){var r=i[s.dim];return i===e.data||(r===d||r-d==0)&&(t.screenModel.y(i)-t.screenModel.y(e.data))*i[o.dim]>0});f=(u<0?Math.max:Math.min).apply(null,g.map(function(e){return t.screenModel.y(e)},0)),u=g.reduce(function(e,t){return e+t[o.dim]},0)}var m=e.node.getBBox(),b=["ELEMENT.AREA","ELEMENT.INTERVAL","ELEMENT.INTERVAL.STACKED"].indexOf(t.config.type)>=0?{x:m.width*(t.config.flip?d>0?1:0:.5),y:m.height*(t.config.flip?.5:u>0?1:0)}:{x:m.width/2,y:m.height/2};this._setValues({label:this._getFormat(s.dim)(d),start:0,value:h,crossPadding:b.x,minMode:i&&i.guide.x.hide},{label:this._getFormat(o.dim)(u),start:t.config.options.height,value:f,crossPadding:b.y,minMode:i&&i.guide.y.hide},{cls:l.toColor(c)?"":c,color:l.toColor(c)?c:""})},_hideCrosshair:function(){var e=this._element.node();e.parentNode&&e.parentNode.removeChild(e)},destroy:function(){this._hideCrosshair()},_subscribeToHover:function(){var e=["ELEMENT.LINE","ELEMENT.AREA","ELEMENT.PATH","ELEMENT.INTERVAL","ELEMENT.INTERVAL.STACKED","ELEMENT.POINT"];this._chart.select(function(t){return e.indexOf(t.config.type)>=0}).forEach(function(e){e.on("data-hover",function(e,t){if(t.data){if(e===t.unit){var i=B.getParentUnit(this._chart.getSpec(),e.config);this._showCrosshair(t,e,i)}}else this._hideCrosshair()}.bind(this))},this)},_getFormat:function(e){return this._formatters[e]?this._formatters[e].format:e=>String(e)},onRender:function(){this._formatters=B.getFieldFormatters(this._chart.getSpec(),t.formatters),this._subscribeToHover()}}}r.default.api.plugins.add("crosshair",j);const V="tau-chart__tooltip";function H(e,t){return{render(e){return this.args=e,e=Object.assign({},e,{fields:this.filterFields(e.fields)}),this.rootTemplate(e)},rootTemplate(e){return[`<div class="${V}__buttons ${V}__clickable">`,this.buttonsTemplate(),"</div>",`<div class="i-role-content ${V}__content">`,this.contentTemplate(e),"</div>"].join("\n")},contentTemplate(e){return this.fieldsTemplate(e)},filterFields:e=>e,getLabel:t=>e.getFieldLabel(t),getFormatter:t=>e.getFieldFormat(t),fieldsTemplate({data:e,fields:t}){return t.map(t=>this.itemTemplate({data:e,field:t})).join("\n")},itemTemplate({data:e,field:t}){const i=this.getLabel(t),r=this.getFormatter(t)(e[t]);return[`<div class="${V}__list__item">`,`  <div class="${V}__list__elem">${i}</div>`,`  <div class="${V}__list__elem">${r}</div>`,"</div>"].join("\n")},buttonsTemplate(){return[this.buttonTemplate({cls:"i-role-exclude",text:"Exclude",icon:()=>'<span class="tau-icon-close-gray"></span>'})].join("\n")},buttonTemplate:({icon:e,text:t,cls:i})=>[`<div class="${V}__button ${i}">`,`  <div class="${V}__button__wrap">`,`    ${e?`${e()} `:""}${t}`,"  </div>","</div>"].join("\n"),didMount(){const t=e.getDomNode().querySelector(".i-role-exclude");t&&t.addEventListener("click",()=>{e.excludeHighlightedElement(),e.setState({highlight:null,isStuck:!1})})}}}const W=r.default.api.utils,U=r.default.api.domUtils,X=r.default.api.pluginsSDK,G="tau-chart__tooltip";class q{constructor(e){this.settings=W.defaults(e||{},{align:"bottom-right",clickable:!0,clsClickable:`${G}__clickable`,clsStuck:"stuck",clsTarget:`${G}-target`,escapeHtml:!0,fields:null,formatters:{},getTemplate:null,spacing:24,winBound:12,onExclude:()=>{}}),this.onRender=this._getRenderHandler()}init(e){this._chart=e,this._tooltip=this._chart.addBalloon({spacing:this.settings.spacing,winBound:this.settings.winBound,auto:!0,effectClass:"fade"}),this._initDomEvents(),this.state={highlight:null,isStuck:!1},this.setState(this.state),this._template=this._getTemplate()}_getTemplate(){const e=H(this,this.settings);return"function"==typeof this.settings.getTemplate?this.settings.getTemplate(e,this,this.settings):e}_renderTemplate(e,t){return this._template.render({data:e,fields:t})}_initDomEvents(){this._scrollHandler=(()=>{this.setState({highlight:null,isStuck:!1})}),window.addEventListener("scroll",this._scrollHandler,!0),this.settings.clickable&&(this._outerClickHandler=(e=>{const t=Array.from(document.querySelectorAll(`.${this.settings.clsClickable}`)).concat(this.getDomNode()).map(e=>e.getBoundingClientRect()),i=Math.min(...t.map(e=>e.top)),r=Math.min(...t.map(e=>e.left)),n=Math.max(...t.map(e=>e.right)),a=Math.max(...t.map(e=>e.bottom));(e.clientX<r||e.clientX>n||e.clientY<i||e.clientY>a)&&this.setState({highlight:null,isStuck:!1})}))}getDomNode(){return this._tooltip.getElement()}setState(e){const t=this.settings,i=this.state,r=this.state=Object.assign({},i,e);i.highlight=i.highlight||{data:null,cursor:null,unit:null},r.highlight=r.highlight||{data:null,cursor:null,unit:null},r.isStuck&&i.highlight.data&&(r.highlight=i.highlight),r.highlight.data!==i.highlight.data&&(r.highlight.data?(this._hideTooltip(),this._showTooltip(r.highlight.data,r.highlight.cursor),this._setTargetSvgClass(!0),requestAnimationFrame(()=>{this._setTargetSvgClass(!0)})):r.isStuck||!i.highlight.data||r.highlight.data||(this._removeFocus(),this._hideTooltip(),this._setTargetSvgClass(!1))),!r.highlight.data||i.highlight.cursor&&r.highlight.cursor.x===i.highlight.cursor.x&&r.highlight.cursor.y===i.highlight.cursor.y||(this._tooltip.position(r.highlight.cursor.x,r.highlight.cursor.y),this._tooltip.updateSize());const n=this.getDomNode();this.settings.clickable&&r.isStuck!==i.isStuck&&(r.isStuck?(window.addEventListener("click",this._outerClickHandler,!0),n.classList.add(t.clsStuck),this._setTargetEventsEnabled(!1),this._accentFocus(r.highlight.data),this._tooltip.updateSize()):(window.removeEventListener("click",this._outerClickHandler,!0),n.classList.remove(t.clsStuck),requestAnimationFrame(()=>{this._setTargetEventsEnabled(!0);const e=this._chart.getSVG();e&&U.dispatchMouseEvent(e,"mouseleave")})))}_showTooltip(e,t){const i=this.settings,r=i.fields||"function"==typeof i.getFields&&i.getFields(this._chart)||Object.keys(e),n=this._renderTemplate(e,r);this._tooltip.content(n).position(t.x,t.y).place(i.align).show().updateSize(),this._template.didMount&&this._template.didMount()}_hideTooltip(){window.removeEventListener("click",this._outerClickHandler,!0),this._template.willUnmount&&this._template.willUnmount(),this._tooltip.hide()}destroy(){window.removeEventListener("scroll",this._scrollHandler,!0),this._setTargetSvgClass(!1),this.setState({highlight:null,isStuck:!1}),this._tooltip.destroy()}_subscribeToHover(){var e=["ELEMENT.LINE","ELEMENT.AREA","ELEMENT.PATH","ELEMENT.INTERVAL","ELEMENT.INTERVAL.STACKED","ELEMENT.POINT"];this._chart.select(t=>e.indexOf(t.config.type)>=0).forEach(e=>{e.on("data-hover",(e,t)=>{var i=document.body.getBoundingClientRect();this.setState({highlight:t.data?{data:t.data,cursor:{x:t.event.clientX-i.left,y:t.event.clientY-i.top},unit:t.unit}:null})}),this.settings.clickable&&e.on("data-click",(e,t)=>{const i=document.body.getBoundingClientRect();this.setState(t.data?{highlight:{data:t.data,cursor:{x:t.event.clientX-i.left,y:t.event.clientY-i.top},unit:t.unit},isStuck:!0}:{highlight:null,isStuck:null})})})}getFieldFormat(e){const t=this._formatters[e]?this._formatters[e].format:e=>String(e);return this.settings.escapeHtml?e=>W.escapeHtml(t(e)):t}getFieldLabel(e){const t=this._formatters[e]?this._formatters[e].label:e;return this.settings.escapeHtml?W.escapeHtml(t):t}_accentFocus(e){const t=t=>t===e;this._chart.select(()=>!0).forEach(e=>{e.fire("highlight",t)})}_removeFocus(){const e=()=>null;this._chart.select(()=>!0).forEach(t=>{t.fire("highlight",e),t.fire("highlight-data-points",e)})}excludeHighlightedElement(){const e=this.state.highlight.data;this._chart.addFilter({tag:"exclude",predicate:t=>t!==e}),this.settings.onExclude(e),this._chart.refresh()}_getRenderHandler(){return function(){this._formatters=X.getFieldFormatters(this._chart.getSpec(),this.settings.formatters),this._subscribeToHover(),this.setState({highlight:null,isStuck:!1})}}_setTargetSvgClass(e){f.select(this._chart.getSVG()).classed(this.settings.clsTarget,e)}_setTargetEventsEnabled(e){e?this._chart.enablePointerEvents():this._chart.disablePointerEvents()}}const Y="diff-tooltip",K=`${Y}__item`,J=`${Y}__header`;function Q(e,t){const i=H(e);return Object.assign({},i,{hasColor(){const{colorField:e}=this.args;return null!=e},contentTemplate(e){return[this.fieldsTemplate(e),this.tableTemplate(e)].join("\n")},filterFields(t){const r=e.state.highlight.unit.screenModel,{scaleColor:n,scaleX:a,scaleY:s}=r.model,o=t.filter(e=>e!==n.dim&&e!==a.dim&&e!==s.dim),l=()=>o.push(a.dim);return this.shouldShowColorTable()?l():(l(),(()=>n.dim&&o.push(n.dim))(),(()=>o.push(s.dim))()),i.filterFields.call(this,o)},itemTemplate({data:e,field:t}){const i=this.getLabel(t),r=this.getFormatter(t)(e[t]),n=this.args.prev,a=(this.args.valueField,this.shouldShowDiff(t)),s=[`<span class="${K}__value">`,`${r}`,a?` ${this.fieldUpdownTemplate(this.getDiff({data:e,prev:n,field:t}))}`:"","</span>"].join("");return[`<div class="${V}__list__item">`,`  <div class="${V}__list__elem">${i}</div>`,`  ${s}`,"</div>"].join("\n")},shouldShowDiff(e){return e===this.args.valueField},getDiff({data:e,prev:t,field:i}){const r=this.getFormatter(i),n=(e?e[i]:0)-(t?t[i]:0);return{diff:r(n),sign:Math.sign(n)}},fieldUpdownTemplate({diff:e,sign:t}){const i=`${Y}__field__updown`;return[`<span class="${i} ${`${i}_${t>0?"positive":"negative"}`}">`,`${t>0?"&#x25B2;":t<0?"&#x25BC;":""}${0===t?"":e}`,"</span>"].join("")},shouldShowColorTable(){const e=this.args.groups;return this.hasColor()&&e.length>1},tableTemplate(e){return this.shouldShowColorTable()?[`<div class="${Y}__table">`,this.tableHeaderTemplate(e),this.tableBodyTemplate(e),"</div>"].join("\n"):""},tableHeaderTemplate({colorField:e,valueField:t}){const i=this.getLabel(e),r=this.getLabel(t);return[`<div class="${J}">`,`  <span class="${J}__text">${i}</span>`,`  <span class="${J}__value">${r}</span>`,`  <span class="${J}__updown">&#x25BC;&#x25B2;</span>`,"</div>"].join("\n")},tableBodyTemplate({data:e,groups:t,valueField:i,colorField:r}){const n=e,a=t.map(({data:e})=>e?e[i]:0),s=Math.min(...a),o=Math.max(...a);return[`<div class="${Y}__body">`,`<div class="${Y}__body__content">`,t.map(({data:e,prev:t})=>this.tableRowTemplate({data:e,prev:t,highlighted:n,valueField:i,colorField:r,min:s,max:o})).join("\n"),"</div>","</div>"].join("\n")},tableRowTemplate({data:e,prev:t,highlighted:i,valueField:r,colorField:n,min:a,max:s}){const o=e?e[r]:0,l=this.getFormatter(n)((e||t)[n]),c=this.getFormatter(r)(o),d=e===i,{diff:u,sign:h}=this.getDiff({data:e,prev:t,field:r}),{color:f,colorCls:p}=this.getColor(e||t);return[`<div class="${K}${d?` ${K}_highlighted`:""}">`,`  ${this.valueBarTemplate({min:a,max:s,v:o,color:f,colorCls:p})}`,`  <span class="${K}__text">${l}</span>`,`  <span class="${K}__value">${c}</span>`,`  ${this.updownTemplate({diff:u,sign:h})}`,"</div>"].join("\n")},valueBarTemplate({min:e,max:t,v:i,color:r,colorCls:n}){e=Math.min(e,0);const a=(t=Math.max(0,t))-e;return["<span",`    class="${K}__bg${n?` ${n}`:""}"`,`    style="left: ${100*(0===a?0:(i<0?i-e:-e)/a)}%; width: ${100*(0===a?0:(i<0?-i:i)/a)}%; background-color: ${r};"`,"    ></span>"].join("\n")},getColor(t){const i=e.state.highlight.unit.screenModel;return{color:i.color(t),colorCls:i.class(t)}},updownTemplate({diff:e,sign:t}){const i=`${K}__updown`;return[`<span class="${i} ${`${i}_${t>0?"positive":"negative"}`}">`,`${t>0?"&#x25B2;":t<0?"&#x25BC;":""}${0===t?"":e}`,"</span>"].join("")},didMount(){i.didMount.call(this),this._scrollToHighlighted(),this._reserveSpaceForUpdown()},_scrollToHighlighted(){const t=e.getDomNode(),i=t.querySelector(`.${Y}__body`),r=t.querySelector(`.${Y}__body__content`),n=t.querySelector(`.${K}_highlighted`);if(!(i&&r&&n))return;const a=i.getBoundingClientRect(),s=r.getBoundingClientRect(),o=n.getBoundingClientRect();var l=0;if(o.bottom>a.bottom){const e=o.bottom-a.bottom+o.height,t=s.bottom-a.bottom;l=-Math.min(e,t),r.style.transform=`translateY(${l}px)`}s.top+l<a.top&&i.classList.add(`${Y}__body_overflow-top`),s.bottom+l>a.bottom&&i.classList.add(`${Y}__body_overflow-bottom`)},_reserveSpaceForUpdown(){const t=e.getDomNode(),i=t.querySelector(`.${Y}__body`),r=t.querySelector(`.${J}`);if(!i||!r)return;const n=`.${K}__updown:not(:empty)`,a=Array.from(t.querySelectorAll(n)).map(e=>e.scrollWidth),s=Math.max(...a),o=Math.max(0,Math.ceil(s-15));i.style.paddingRight=`${o}px`,r.style.paddingRight=`${o}px`}})}const Z=r.default.api.utils,ee="ELEMENT.INTERVAL_HIGHLIGHT";var te={draw(){const e=this.node().config;this._container=e.options.slot(e.uid)},addInteraction(){this.node().on("interval-highlight",(e,t)=>{this._drawRange(t)})},_drawRange(e){const t=this.node(),i=t.config,r=t.screenModel.flip,n=this._container,a="interval-highlight",s=`${a}__gradient`,o=e?e[0]:null,l=e?e[1]:null,c=r?i.options.width:i.options.height;Z.take(function(){const t=n.selectAll(`.${a}`).data(e?[1]:[]);t.exit().remove();const i=t.enter().append("g").attr("class",a).attr("pointer-events","none");return{g:t,gEnter:i}}()).then(t=>{!function(){const t=`${a}__defs`,o=`${a}__gradient-start`,l=`${a}__gradient-end`;for(var c=n.node();"svg"!==(c=c.parentNode).tagName;);const d=`${t}__${i.uid}`,u=f.select(c).selectAll(`#${d}`).data(e?[1]:[]);u.exit().remove();const h=u.enter().append("defs").attr("class",t).attr("id",d).append("linearGradient").attr("id",s).attr("x1","0%").attr("y1",r?"100%":"0%").attr("x2",r?"0%":"100%").attr("y2","0%");h.append("stop").attr("class",o).attr("offset","0%"),h.append("stop").attr("class",l).attr("offset","100%")}(),function({g:e,gEnter:t}){const i=`${a}__range`,n=e.select(`.${i}`),d=t.append("rect").attr("class",i).attr("fill",`url(#${s})`),{x:u,y:h,width:f,height:p}=r?{x:0,y:l,width:c,height:o-l}:{x:o,y:0,width:l-o,height:c};d.merge(n).attr("x",u).attr("y",h).attr("width",Math.abs(f)).attr("height",Math.abs(p))}(t),function({g:e,gEnter:t}){const i=`${a}__range-start`,n=e.select(`.${i}`),s=t.append("line").attr("class",i),{x1:l,y1:d,x2:u,y2:h}=r?{x1:0,y1:o,x2:c,y2:o}:{x1:o,y1:0,x2:o,y2:c};s.merge(n).attr("x1",l).attr("y1",d).attr("x2",u).attr("y2",h)}(t),function({g:e,gEnter:t}){const i=`${a}__range-end`,n=e.select(`.${i}`),s=t.append("line").attr("class",i),{x1:o,y1:d,x2:u,y2:h}=r?{x1:0,y1:l,x2:c,y2:l}:{x1:l,y1:0,x2:l,y2:c};s.merge(n).attr("x1",o).attr("y1",d).attr("x2",u).attr("y2",h)}(t)})}};const ie=r.default.api.utils;class re extends q{constructor(e){super(e),this.onSpecReady=this._getSpecReadyHandler()}init(e){super.init(e),this._unitsGroupedData=new Map}_getTemplate(){const e=Q(this,this.settings);return"function"==typeof this.settings.getTemplate?this.settings.getTemplate(e,this,this.settings):e}_renderTemplate(e,t){const i=this.state.highlight.unit,r=i.screenModel,{scaleColor:n,scaleX:a,scaleY:s}=r.model,o=this._unitsGroupedData.get(i),[l,c]=this._getHighlightRange(e,i),d=e=>{const t=r.model.color(e);return isFinite(l)&&o[l][t]?o[l][t][0]:null},u=d(e),h=i.config.stack,f=!(!i.config.flip&&i.config.guide.obsoleteVerticalStackOrder&&i.config.stack),p=(()=>{const e=n.domain().slice().reduce((e,t,i)=>(e[t]=i,e),{});return f?(t,i)=>e[t[n.dim]]-e[i[n.dim]]:(t,i)=>e[i[n.dim]]-e[t[n.dim]]})(),g=f?(e,t)=>s(e[s.dim])-s(t[s.dim]):(e,t)=>s(t[s.dim])-s(e[s.dim]),m=e=>Object.keys(o[e]).reduce((t,i)=>t.concat(o[e][i]),[]).sort(h?p:g),b=m(c).map(e=>{r.model.color(e);return{data:e,prev:d(e)}});if(isFinite(l)){const e=m(l),t=b.reduce((e,t)=>(e[r.model.color(t.data)]=!0,e),{});e.forEach(e=>{const i=r.model.color(e);t[i]||b.push({data:null,prev:e})}),h&&b.sort((e,t)=>p(e.data||e.prev,t.data||t.prev))}return this._template.render({data:e,prev:u,fields:t,groups:b,valueField:s.dim,colorField:n.dim})}_getRenderHandler(){const e=super._getRenderHandler();return function(){e.call(this);const t=this._chart,i=t.select(e=>"chart"===e.config.namespace&&0===e.config.type.indexOf("ELEMENT.")&&e.config.type!==ee),r=t.select(e=>e.config.type===ee).reduce((e,t,i)=>(e[i]=t,e),{});i.forEach((e,t)=>{const i=e.data();this._unitsGroupedData.set(e,this._getGroupedData(i,e)),e.on("data-hover",(i,n)=>{const a=r[t],s=n.unit&&n.unit===e?this._getHighlightRange(n.data,n.unit):null;a.fire("interval-highlight",s)})})}}_getSpecReadyHandler(){return function(e,t){e.traverseSpec(t,(e,t)=>{if(0!==e.type.indexOf("ELEMENT."))return;const i=JSON.parse(JSON.stringify(e));i.type=ee,i.namespace="highlight";const r=t.units.indexOf(e);t.units.splice(r,0,i)})}}_getGroupedData(e,t){const i=t.screenModel.model.scaleX,n=ie.groupBy(e,e=>i(e[i.dim]).toString()),a=t.config.guide.x.tickPeriod||t.config.guide.x.timeInterval;if(a){const e=i.domain(),s=t.config.guide.utcTime;r.default.api.tickPeriod.generate(e[0],e[1],a,{utc:s}).filter(t=>t>=e[0]&&t<=e[1]).forEach(e=>{const t=i(e);n[t]||(n[t]=[])})}return Object.keys(n).reduce((e,i)=>(e[i]=ie.groupBy(n[i],e=>t.screenModel.model.color(e)),e),{})}_getHighlightRange(e,t){const i=t.screenModel.flip,r=t.screenModel.model.scaleX,n=r(e[r.dim]),a=this._unitsGroupedData.get(t),s=Object.keys(a).map(Number).sort(i?(e,t)=>t-e:(e,t)=>e-t),o=s.indexOf(n);return 0===o?[n,n]:[s[o-1],n]}}function ne(e){return new re(e)}r.default.api.unitsRegistry.reg(ee,te,"ELEMENT.GENERIC.CARTESIAN"),r.default.api.plugins.add("diff-tooltip",ne);var ae=i(17),se=i.n(ae),oe=i(18),le=i(19),ce=i.n(le);const de="Taucharts Export Plug-in:";var ue=r.default.api.utils,he=r.default.api.pluginsSDK,fe=he.tokens(),pe=function(e,t){return e.replace(new RegExp("^"+t+"+|"+t+"+$","g"),"")},ge=function(e){return(e=Math.round(e))%2?e+1:e},me=function(e){return null===e||""===e||void 0===e};var be,ye={BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38},ve=function(e,t){t=t||"all";var i=document.createElement("style");return i.setAttribute("media",t),i.innerHTML=e,i},xe=ve(ce.a,"print"),_e=function(){xe&&xe.parentNode&&xe.parentNode.removeChild(xe),be&&be.parentNode&&be.parentNode.removeChild(be)};/PhantomJS/.test(navigator.userAgent)||("onafterprint"in window?window.addEventListener("afterprint",_e):window.matchMedia("screen").addListener(function(e){e.matches&&_e()}));var we=function(e,t,i){var r="data:"+t+";charset=UTF-8,%ef%bb%bf"+encodeURIComponent(i),n=document.createElement("a");n.setAttribute("href",r),n.setAttribute("download",e),n.setAttribute("target","_new"),document.body.appendChild(n),n.click(),document.body.removeChild(n),n=null},Ee=function(e){return[].slice.call(e.querySelectorAll("text.label")).forEach(function(e){e.innerHTML=[].slice.call(e.querySelectorAll("tspan")).reduce(function(e,t){var i=t.value||t.text||t.textContent||"";return e+(i=i.charAt(0).toUpperCase()+i.substr(1))},"")}),e},Se=function(e,t,i){i=null==i?"":String(i);var r=(e||{})[t]||{};return(ue.isObject(r.label)?r.label.text:r.label)||i};function Te(e){return{onRender:function(){this._info=he.extractFieldsFormatInfo(this._chart.getSpec())},_normalizeExportFields:function(e,t){var i=this._info;return e.map(function(e){var t=e,r=i[e]||{};return"string"==typeof e&&(t={field:e,title:r.label||e}),"function"!=typeof t.value&&(t.value=function(e){var t=e[this.field];return r.isComplexField?(t||{})[r.tickLabel]:t}),t}).filter(function(e){return!t.find(function(t){return e.field===t})})},_handleError(e){r.default.api.globalSettings.log([de,e],"error")},_createDataUrl:function(e,t){!function(...e){const t=e.slice(0,e.length-1),i=e[e.length-1];if(0===t.length)return void setTimeout(()=>i(null,[]),0);const r=ue.range(0,t.length).map(()=>null),n=t.map((e,t)=>{const a=new XMLHttpRequest;a.onload=(()=>{if(a.status>=200&&a.status<300){const e=a.responseText;r[t]=e,n.splice(n.indexOf(a),1),0===n.length&&i(null,r)}else n.forEach(e=>e.abort()),i(new Error(`${a.status}: ${a.statusText}`),null)}),a.onerror=(e=>{n.forEach(e=>e.abort()),i(e.error,null)}),a.open("GET",e,!0),a.send(null)})}(...this._cssPaths,(i,n)=>{if(i)t(i,null);else try{const c=n.join(" ").replace(/&/g,"");var a=ve(c),s=document.createElement("div");e.fire("beforeExportSVGNode");var o=e.getSVG().cloneNode(!0);e.fire("afterExportSVGNode"),s.appendChild(Ee(o)),f.select(o).attr("version",1.1).attr("xmlns","http://www.w3.org/2000/svg"),o.insertBefore(a,o.firstChild),this._renderAdditionalInfo(o,e),this._addBackground(o,this._backgroundColor);var l=document.createElement("canvas");l.height=o.getAttribute("height"),l.width=o.getAttribute("width"),se()(l,o.parentNode.innerHTML,{renderCallback:function(e){var i=(new XMLSerializer).serializeToString(e);"<html"===i.substring(0,5).toLowerCase()&&(r.default.api.globalSettings.log("[export plugin]: canvg error","error"),r.default.api.globalSettings.log(i,"error")),t(null,l.toDataURL("image/png"))}})}catch(i){t(i,null)}})},_findUnit:function(e){var t=e.getSpec(),i=e.getSpec(),r=function(e){var t=i.scales[e];return t&&t.dim&&t.source&&i.sources[t.source].dims[t.dim]};return he.depthFirstSearch(t.unit,function(e){if(r(e.color))return!0;if(r(e.size)){var t=i.scales[e.size];return"measure"===i.sources[t.source].dims[t.dim].type}})},_toPng:function(e){this._createDataUrl(e,(e,t)=>{if(e)this._handleError(e);else{for(var i=atob(t.substring("data:image/png;base64,".length)),r=new Uint8Array(i.length),n=0,a=i.length;n<a;++n)r[n]=i.charCodeAt(n);var s=new Blob([r.buffer],{type:"image/png"});Object(oe.saveAs)(s,(this._fileName||"export")+".png")}})},_toPrint:function(e){this._createDataUrl(e,(e,t)=>{if(e)this._handleError(e);else{(be=document.createElement("img")).classList.add("tau-chart__print-block");var i=be;document.body.appendChild(i),i.src=t,document.head.appendChild(xe),i.onload=function(){window.print()}}})},_toJson:function(e){var t=this._exportFields,i=e.getData(),r=e.getDataDims(),n=t.length?t:Object.keys(r),a=this._normalizeExportFields(n.concat(this._appendFields),this._excludeFields),s=i.map(function(e){return a.reduce(function(t,i){return t[i.title]=i.value(e),t},{})}),o=JSON.stringify(s,null,2),l=(this._fileName||"export")+".json";we(l,"application/json",o)},_toCsv:function(e){var t=this._csvSeparator,i=this._exportFields,r=e.getData(),n=e.getDataDims(),a=i.length?i:Object.keys(n),s=this._normalizeExportFields(a.concat(this._appendFields),this._excludeFields),o=r.reduce(function(e,i){return e.concat(s.reduce(function(e,t){var r=t.value(i),n=JSON.stringify(r);if(!ue.isDate(r)&&ue.isObject(r))n='"'+n.replace(/"/g,'""')+'"';else{var a=pe(n,'"').replace(/"/g,'""');n=Boolean(['"',",",";","\n","\r"].find(function(e){return a.indexOf(e)>=0}))?'"'+a+'"':a}return e.concat(n)},[]).join(t))},[s.map(function(e){return e.title}).join(t)]).join("\r\n"),l=(this._fileName||"export")+".csv";we(l,"text/csv",o)},_renderFillLegend:function(t,i,r,n){var a=function(e,t){var i=e[0],r=e[1],n=(r-i)/(t-1),a=ue.range(t-2).map(function(e){return i+n*(e+1)});return[i].concat(a).concat(r)},s=this._unit.getScale("color"),o=Se(t.guide,"color",s.dim).toUpperCase(),l="text-transform:uppercase;font-weight:600;font-size:"+e.fontSize+"px",c=s.domain().sort(function(e,t){return e-t}),d=s.brewer.length,u=e.fontSize,h=a(c,d).reverse().map(function(e,t){return'<stop offset="'+t/(d-1)*100+'%"      style="stop-color:'+s(e)+';stop-opacity:1" />'}),f=a(c,3).reverse().map(function(e,t,i){return'<text x="25" y="'+(100*(t/2)+.5*(0===t?u:t===i.length-1?-u:0)+u/2)+'">'+e+"</text>"}),p=['<svg version="1.1" xmlns="http://www.w3.org/2000/svg" height="120" width="100%">',"   <defs>",'       <linearGradient id="grad1" x1="0%" y1="0%" x2="0%" y2="100%">',h.join(""),"       </linearGradient>","   </defs>",'   <text x="0" y="10" style="'+l+'">'+o+"</text>",'   <g transform="translate(0,20)">','       <rect x="0" y="0" height="100" width="20" fill="url(#grad1)">',"       </rect>",f.join(""),"   </g>","   Sorry, your browser does not support inline SVG.","</svg>"].join(""),g=(new DOMParser).parseFromString(p,"application/xml").documentElement;return document.body.appendChild(g),i.append("g").attr("class","legend").attr("transform","translate("+(n+10)+","+e.paddingTop+")").node().appendChild(g),{h:120,w:0}},_renderColorLegend:function(t,i,r,n){var a=this._unit.getScale("color"),s=Se(t.guide,"color",a.dim).toUpperCase(),o=this._getColorMap(r.getChartModelData({excludeFilter:["legend"]}),a,a.dim).values,l=i.append("g").attr("class","legend").attr("transform","translate("+(n+10)+","+e.paddingTop+")");return l.append("text").text(s.toUpperCase()).style({"text-transform":"uppercase","font-weight":"600","font-size":e.fontSize+"px"}),l.selectAll("g").data(o).enter().append("g").call(function(t){t.attr("transform",function(e,t){return"translate(5,"+20*(t+1)+")"}),t.append("circle").attr("r",6).attr("fill",function(e){return a.toColor(e.color)}).attr("class",function(e){return a.toClass(e.color)}),t.append("text").attr("x",12).attr("y",5).text(function(e){return ue.escape(me(e.label)?"No "+s:e.label)}).style({"font-size":e.fontSize+"px"})}),{h:20*o.length,w:0}},_renderSizeLegend:function(t,i,r,n,a){var s,o,l=this._unit.getScale("size"),c=Se(t.guide,"size",l.dim).toUpperCase(),d=r.getChartModelData().sort(function(e,t){return l(e[l.dim])-l(t[l.dim])}),u=d.length,h=d[0][l.dim],f=d[u-1][l.dim];if(f-h){var p=(o=f-h,Math.log(o)/Math.LN10),g=4-p<0?0:Math.round(4-p),m=Math.pow(10,g),b=(f-h)/5;s=ue.unique([h,h+b,h+2*b,h+3*b,f].map(function(e){return e===f||e===h?e:Math.round(e*m)/m}))}else s=[h];var y=s.map(function(e){var i=l(e),r=i/2;return{diameter:ge(i+2),radius:r,value:e,className:t.color?"color-definite":""}}.bind(this)).reverse(),v=Math.max.apply(null,y.map(function(e){return e.diameter})),x=e.fontSize,_=0,w=i.append("g").attr("class","legend").attr("transform","translate("+(n+10)+","+(e.paddingTop+a.h+20)+")");w.append("text").text(c.toUpperCase()).style({"text-transform":"uppercase","font-weight":"600","font-size":x+"px"}),w.selectAll("g").data(y).enter().append("g").call(function(e){e.attr("transform",function(){var e="translate(5,"+(_+=v)+")";return _+=10,e}),e.append("circle").attr("r",function(e){return e.radius}).attr("class",function(e){return e.className}).style({opacity:.4}),e.append("g").attr("transform",function(){return"translate("+v+","+x/2+")"}).append("text").attr("x",0).attr("y",0).text(function(e){return e.value}).style({"font-size":x+"px"})})},_renderAdditionalInfo:function(e,t){var i=this._findUnit(t);if(i){var r={h:0,w:0};e=f.select(e);var n=parseInt(e.attr("width"),10);e.attr("height");e.attr("width",n+160);var a=t.getScaleInfo(i.color);if(a.dim&&!a.discrete){var s=this._renderFillLegend(i,e,t,n);r.h=s.h+20,r.w=s.w}if(a.dim&&a.discrete){var o=this._renderColorLegend(i,e,t,n);r.h=o.h+20,r.w=o.w}var l=t.getScaleInfo(i.size);l.dim&&!l.discrete&&this._renderSizeLegend(i,e,t,n,r)}},_addBackground:function(e,t){if(t&&"transparent"!==t){var i=document.createElementNS("http://www.w3.org/2000/svg","rect");i.setAttribute("fill",t),i.setAttribute("x",0),i.setAttribute("y",0),i.setAttribute("width",e.getAttribute("width")),i.setAttribute("height",e.getAttribute("height")),e.insertBefore(i,e.firstChild)}},onUnitDraw:function(e,t){r.default.api.isChartElement(t)&&"chart"===t.config.namespace&&(this._unit=t)},_getColorMap:function(e,t,i){return ue.unique(e.map(function(e){var r=e[i];return{color:t(r),value:r,label:r}}),function(e){return e.value}).reduce(function(e,t){return e.brewer[t.value]=t.color,e.values.push(t),e},{brewer:{},values:[]})},_select:function(e,t){var i=this["_to"+(e=e||"").charAt(0).toUpperCase()+e.slice(1)];i&&i.call(this,t)},_handleMenu:function(e,t,i){e.addEventListener("click",function(e){if("a"===e.target.tagName.toLowerCase()){var r=e.target.getAttribute("data-value");this._select(r,t),i.hide()}}.bind(this)),e.addEventListener("mouseover",function(e){"a"===e.target.tagName.toLowerCase()&&e.target.focus()}.bind(this)),e.addEventListener("keydown",function(e){if(e.keyCode===ye.ESCAPE&&i.hide(),e.keyCode===ye.DOWN&&(e.target.parentNode.nextSibling?e.target.parentNode.nextSibling.childNodes[0].focus():e.target.parentNode.parentNode.firstChild.childNodes[0].focus()),e.keyCode===ye.UP&&(e.target.parentNode.previousSibling?e.target.parentNode.previousSibling.childNodes[0].focus():e.target.parentNode.parentNode.lastChild.childNodes[0].focus()),e.keyCode===ye.ENTER){var r=e.target.getAttribute("data-value");this._select(r,t)}e.preventDefault()}.bind(this));var r=null,n=function(){r=setTimeout(function(){i.hide()},100)},a=function(){clearTimeout(r)},s=function(){i.toggle(),i.hidden||e.querySelectorAll("a")[0].focus()};e.addEventListener("blur",n,!0),e.addEventListener("focus",a,!0),this._container.addEventListener("click",s),this._onDestroy(function(){e.removeEventListener("blur",n,!0),e.removeEventListener("focus",a,!0),this._container.removeEventListener("click",s),clearTimeout(r)})},init:function(t){e=e||{},e=ue.defaults(e,{backgroundColor:"white",visible:!0,fontSize:13,paddingTop:30}),this._chart=t,this._info={},this._cssPaths=e.cssPaths,this._fileName=e.fileName,this._backgroundColor=e.backgroundColor||"white",this._destroyListeners=[],this._csvSeparator=e.csvSeparator||",",this._exportFields=e.exportFields||[],this._appendFields=e.appendFields||[],this._excludeFields=e.excludeFields||[],this._cssPaths||(this._cssPaths=[],r.default.api.globalSettings.log('[export plugin]: the "cssPath" parameter should be specified for correct operation',"warn"));var i=e.visible?"":"display:none";this._container=t.insertToHeader('<a class="tau-chart__export" style="'+i+'">Export</a>');var n=t.addBalloon({place:"bottom-left"});n.content(['<ul class="tau-chart__export__list">','<li class="tau-chart__export__item">','   <a data-value="print" tabindex="1">'+fe.get("Print")+"</a>","</li>",'<li class="tau-chart__export__item">','   <a data-value="png" tabindex="2">'+fe.get("Export to png")+"</a>","</li>",'<li class="tau-chart__export__item">','   <a data-value="csv" tabindex="3">'+fe.get("Export to CSV")+"</a>","</li>",'<li class="tau-chart__export__item">','   <a data-value="json" tabindex="4">'+fe.get("Export to JSON")+"</a>","</li>","</ul>"].join("")),n.attach(this._container);var a=n.getElement();a.setAttribute("tabindex","-1"),this._handleMenu(a,t,n);const s=t.on("export-to",function(e,{type:t,fileName:i}){this._fileName=i||this._fileName,this._select(t,e)}.bind(this)),o=t.on("exportTo",function(e,t){r.default.api.globalSettings.log([de,"`exportTo` event is deprecated, use `export-to` instead."],"warn"),this._select(t,e)}.bind(this));this._onDestroy(function(){n.destroy(),t.removeHandler(s),t.removeHandler(o)})},_onDestroy:function(e){this._destroyListeners.push(e)},destroy:function(){this._destroyListeners.forEach(function(e){e.call(this)},this);(e=>e&&e.parentElement&&e.parentElement.removeChild(e))(this._container)}}}r.default.api.plugins.add("export-to",Te);const Me={...f},Ce=r.default.api.domUtils;var ke=r.default.api.utils,Ae=16,Pe="#E5E7EB",Oe="#FFFFFF",Ne=1,Le=0,Re="__transitionAttrs__",Fe="__floatingAxesSrcParent__",De="__floatingAxesSrcTransform__",$e=0,ze=function(){return++$e};function Be(e){var t=ke.defaults(e||{},{detectBackground:!0,bgcolor:"#fff"});return{init:function(e){this.instanceId=ze(),this.chart=e,this.rootNode=e.getLayout().contentContainer,this.beforeExportHandler=e.on("beforeExportSVGNode",function(){this.removeFloatingLayout()},this),this.afterExportHandler=e.on("afterExportSVGNode",function(){this.createFloatingLayout()},this)},onBeforeRender:function(){this.removeFloatingLayout()},onRender:function(){if(t.detectBackground){var e=this.detectChartBackgroundColor();e&&(t.bgcolor=e)}Oe=t.bgcolor;var i=!0;this.chart.traverseSpec(this.chart.getSpec(),function(e){e&&0===e.type.indexOf("COORDS.")&&("COORDS.RECT"!==e.type?i=!1:"extract-axes"!==(e.guide||{}).autoLayout&&(i=!1))}),i&&this.createFloatingLayout()},destroy:function(){this.removeFloatingLayout(),this.chart.removeHandler(this.beforeExportHandler,this),this.chart.removeHandler(this.afterExportHandler,this)},createFloatingLayout:function(){var e,i,n=this.instanceId,a=this.rootNode,s=this.chart.getSVG(),o=Me.select(s),l=this.chart.configGPL.settings.animationSpeed,c=this.scrollManager=new He(a),d=(e=function(e){var t="> ."+e+".axis.tau-active";return[".frame-root.tau-active "+t,".frame-root.tau-active .cell.tau-active "+t].join(", ")},{x:Array.from(s.querySelectorAll(e("x"))),y:Array.from(s.querySelectorAll(e("y")))}),u=function(){function e(e){return{axis:e,parentTransform:function(e){var t,i={translate0:{x:0,y:0},translate:{x:0,y:0}},r=e;for(;r&&"SVG"!==r.nodeName.toUpperCase();)t=Ve(r),i.translate0.x+=t.translate0.x,i.translate0.y+=t.translate0.y,i.translate.x+=t.translate.x,i.translate.y+=t.translate.y,r=r.parentNode;return i}(e.parentNode),axisTransform:Ve(e)}}return{x:d.x.map(e),y:d.y.map(e)}}(),h=(i=u.y.map(function(e){return e.axisTransform.translate.x+e.parentTransform.translate.x}),Math.max.apply(null,i)+1),p=function(e){return Math.min.apply(null,e)}(u.x.map(function(e){return e.axisTransform.translate.y+e.parentTransform.translate.y}))-1,g=r.default.api.globalSettings.getScrollbarSize(a);var m={scrollLeft:a.scrollLeft,scrollTop:a.scrollTop,visibleWidth:a.clientWidth,visibleHeight:a.clientHeight,scrollbarWidth:g.width,scrollbarHeight:g.height,svgWidth:Number(o.attr("width")),svgHeight:Number(o.attr("height")),minXAxesY:p,maxYAxesX:h},b=function(){var e=o.append("defs").attr("class","floating-axes floating-axes__defs"),t={ns:{x1:0,y1:0,x2:0,y2:1},ew:{x1:1,y1:0,x2:0,y2:0},sn:{x1:0,y1:1,x2:0,y2:0},we:{x1:0,y1:0,x2:1,y2:0}};return Object.keys(t).forEach(function(i){var r=t[i],a=e.append("linearGradient").attr("id","shadow-gradient-"+i+"-"+n).attr("x1",r.x1).attr("y1",r.y1).attr("x2",r.x2).attr("y2",r.y2);a.append("stop").attr("class","floating-axes__shadow-start").attr("offset","0%").attr("stop-color",Pe).attr("stop-opacity",Ne),a.append("stop").attr("class","floating-axes__shadow-end").attr("offset","100%").attr("stop-color",Oe).attr("stop-opacity",Le)}),e}();function y(e,t){t.forEach(function(t){t.axis[Fe]=t.axis.parentNode;var i=e.append("g");l?i.attr("transform",Ie(t.parentTransform.translate0.x,t.parentTransform.translate0.y)).transition().duration(l).attr("transform",Ie(t.parentTransform.translate.x,t.parentTransform.translate.y)):i.attr("transform",Ie(t.parentTransform.translate.x,t.parentTransform.translate.y)),i.node().appendChild(t.axis),Array.prototype.forEach.call(t.axis.querySelectorAll(".label"),function(e){e[De]=e.getAttribute("transform")})})}var v,x,_=function(){var e=m.svgHeight-m.minXAxesY+1+m.scrollbarHeight,t=o.append("g").attr("class","floating-axes floating-axes__x").call(S,m.svgWidth,e,0,m.minXAxesY);y(t,u.x);var i=t.selectAll(".label");return c.handleVisibilityFor(t,"y").handleVisibilityFor(i,"x").onScroll(function(e,r){var n=Math.min(m.visibleHeight+r-m.svgHeight-m.scrollbarHeight,0);t.attr("transform",Ie(0,n)),i.each(function(){var t=je(this[De]),i=-m.svgWidth+m.visibleWidth+e-10;this.setAttribute("transform","translate("+(t.x+i)+","+t.y+") rotate("+t.r+")")})}),t}(),w=function(){var e=o.append("g").attr("class","floating-axes floating-axes__y").call(S,m.maxYAxesX,m.svgHeight);y(e,u.y);var t=e.selectAll(".label");return c.handleVisibilityFor(e,"x").handleVisibilityFor(t,"y").onScroll(function(i,r){var n=Math.max(i,0);e.attr("transform",Ie(n,0)),t.each(function(){var e=je(this[De]);const t=r+10;this.setAttribute("transform","translate("+e.x+","+(e.y+t)+") rotate("+e.r+")")})}),e}(),E=(v=m.svgHeight-m.minXAxesY+m.scrollbarHeight,x=o.append("g").attr("class","floating-axes floating-axes__corner").call(S,m.maxYAxesX,v),c.handleVisibilityFor(x,"xy").onScroll(function(e,t){var i=Math.max(e,0),r=m.minXAxesY,n=Math.min(t+m.visibleHeight-v,r);x.attr("transform",Ie(i,n))}),x);function S(e,i,r,n,a){n=n||0,a=a||0,e.append("rect").attr("class","i-role-bg").attr("x",n-1).attr("y",a-1).attr("width",Math.max(0,i+2)).attr("height",Math.max(0,r+2)).attr("fill",t.bgcolor)}var T=function(){var e=m.maxYAxesX,t=m.svgHeight-m.minXAxesY+m.scrollbarHeight,i=o.append("g").attr("class","floating-axes floating-axes__shadows").attr("pointer-events","none"),r=function(e,t,r,a,s){return i.append("rect").attr("fill","url(#shadow-gradient-"+e+"-"+n+")").attr("x",t).attr("y",r).attr("width",Math.max(0,a)).attr("height",Math.max(0,s))},a=r("ns",0,0,e,Ae),s=r("ew",m.visibleWidth-Ae,m.visibleHeight-t,Ae,t),l=r("sn",0,m.visibleHeight-t-Ae,e,Ae),d=r("we",e,m.visibleHeight-t,Ae,t);c.handleVisibilityFor(a,"xy").handleVisibilityFor(s,"xy").handleVisibilityFor(l,"xy").handleVisibilityFor(d,"xy").onScroll(function(e,t){var r=e,n=t;i.attr("transform",Ie(r,n));var o=function(e,t){e.style("visibility",t?"":"hidden")};o(a,t>0&&m.svgHeight>m.visibleHeight),o(s,e+m.visibleWidth<m.svgWidth&&m.svgWidth>m.visibleWidth),o(l,t+m.visibleHeight<m.svgHeight&&m.svgHeight>m.visibleHeight),o(d,e>0&&m.svgWidth>m.visibleWidth)})}(),M=_.node(),C=w.node(),k=E.node();c.onScroll(function(e){s.insertBefore(M,0===e?k.nextElementSibling:C)}),c.fireScroll(),this.floatingLayout={defs:b,xAxes:_,yAxes:w,shadows:T},o.selectAll(".floating-axes").on("mouseenter",function(){Ce.dispatchMouseEvent(s,"mouseleave")}).on("mousemove",function(){f.event.stopPropagation()}).on("click",function(){f.event.stopPropagation()})},removeFloatingLayout:function(){function e(e){e.selectAll(".axis").each(function(){this[Fe].appendChild(this),delete this[Fe],Array.prototype.forEach.call(this.querySelectorAll(".label"),function(e){e.setAttribute("transform",e[De]),delete e[De]})})}this.floatingLayout&&(this.floatingLayout.xAxes.call(e),this.floatingLayout.yAxes.call(e),this.scrollManager.destroy(),this.floatingLayout=null),Me.select(this.chart.getSVG()).selectAll(".floating-axes").remove()},detectChartBackgroundColor:function(){var e,t=this.chart.getLayout().layout;do{if("none"!==(e=window.getComputedStyle(t)).backgroundImage)return null;if("transparent"!==e.backgroundColor&&"rgba(0, 0, 0, 0)"!==e.backgroundColor)return e.backgroundColor}while(t=t.parentElement);return null}}}function Ie(e,t){return"translate("+e+","+t+")"}function je(e){var t={x:0,y:0,r:0};if(!e)return t;var i=e.indexOf("translate(");if(i>=0){var r=e.indexOf(")",i+10),n=e.substring(i+10,r).trim().replace(","," ").replace(/\s+/," ").split(" ");t.x=parseFloat(n[0]),n.length>1&&(t.y=parseFloat(n[1]))}var a=e.indexOf("rotate(");if(a>=0){var s=e.indexOf(")",a+7),o=e.substring(a+7,s);t.r=parseFloat(o.trim())}return t}function Ve(e){var t=e[Re]&&e[Re].transform,i=je(e.getAttribute("transform"));return{translate0:i,translate:t?je(e[Re].transform):i}}function He(e){var t={x:[],y:[]},i={x:0,y:0},r={x:null,y:null},n=e,a=[];this.onScroll=function(e){return a.push(e),this},this.handleVisibilityFor=function(e,i){return i.indexOf("x")>=0&&t.x.push(e),i.indexOf("y")>=0&&t.y.push(e),this};var s=function(){var e=n.scrollLeft,s=n.scrollTop;a.forEach(function(t){t.call(null,e,s)});var l=function(n){var a="x"===n?e:s;a!==i[n]&&(clearTimeout(r[n]),o(t[n],function(e){e.transition("floatingAxes_scrollVisibility"),e.attr("opacity",1e-6)}),r[n]=setTimeout(function(){o(t[n],function(e){r[n]=null,e.transition("floatingAxes_scrollVisibility").duration(256).attr("opacity",1)})},128)),i[n]=a};l("x"),l("y")};function o(e,t,i){e.forEach(function(e){t.call(i,e)})}n.addEventListener("scroll",s),this.fireScroll=function(){s.call(null,n.scrollLeft,n.scrollTop)},this.destroy=function(){n.removeEventListener("scroll",s)}}r.default.api.plugins.add("floating-axes",Be);var We=r.default.api.utils;function Ue(e){We.defaults(e||{},{});var t=function(e,t,i,r){e.addEventListener(t,function(e){for(var t=e.target;t!==e.currentTarget&&null!==t;)t.classList.contains(i)&&r(e,t),t=t.parentNode})};return{init:function(e){this._chart=e,this._currentFilters={},this._legendColorByScaleId={};var i=this._chart.getSpec(),r=function(e){return function(t,r){var n=i.scales[r];return n.type===e&&n.dim&&t.push(r),t}};this._color=Object.keys(i.scales).reduce(r("color"),[]),this._fill=Object.keys(i.scales).reduce(r("fill"),[]);var n=this._color.length>0,a=this._fill.length>0;(n||a)&&(this._container=this._chart.insertToRightSidebar(this._containerTemplate),n&&(t(this._container,"click","tau-chart__legend__item-color",function(e,t){this._toggleLegendItem(t)}.bind(this)),t(this._container,"mouseover","tau-chart__legend__item-color",function(e,t){this._highlightToggle(t,!0)}.bind(this)),t(this._container,"mouseout","tau-chart__legend__item-color",function(e,t){this._highlightToggle(t,!1)}.bind(this))))},onSpecReady:function(){this._assignStaticBrewersOrEx()},onRender:function(){this._clearPanel(),this._drawColorLegend(),this._drawFillLegend()},_containerTemplate:'<div class="tau-chart__legend"></div>',_template:We.template('<div class="tau-chart__legend"><div class="tau-chart__legend__title"><%=name%></div><%=items%></div>'),_itemTemplate:We.template(["<div data-scale-id='<%= scaleId %>' data-dim='<%= dim %>' data-value='<%= value %>' class=\"tau-chart__legend__item tau-chart__legend__item-color <%=classDisabled%>\">",'<div class="tau-chart__legend__guide__wrap">','<div class="tau-chart__legend__guide <%=color%>"></div>',"</div>","<%=label%>","</div>"].join("")),_itemFillTemplate:We.template(['<div data-value=\'<%=value%>\' class="tau-chart__legend__item tau-chart__legend__item-color" style="padding: 6px 0px 10px 40px;margin-left:10px;">','<div class="tau-chart__legend__guide__wrap" style="top:0;left:0;">','   <span class="tau-chart__legend__guide" style="background-color:<%=color%>;border-radius:0"></span>','   <span style="padding-left: 20px"><%=label%></span>',"</div>","</div>"].join("")),_clearPanel:function(){this._container&&(this._container.innerHTML="")},_drawColorLegend:function(){var e=this;e._color.forEach(function(t){var i=e._chart.select(function(e){return e.config.color===t})[0];if(i){var r=i.getScale("color"),n=e._chart.getDataSources({excludeFilter:["legend"]}),a=We.unique(n[r.source].data.map(function(e){return e[r.dim]})).map(function(i){var n=We.escape(i),a=r.dim+n;return{scaleId:t,dim:r.dim,color:r(i),disabled:e._currentFilters.hasOwnProperty(a),label:i,value:n}});e._legendColorByScaleId[t]=a,e._container.insertAdjacentHTML("beforeend",e._template({items:a.map(function(t){return e._itemTemplate({scaleId:t.scaleId,dim:t.dim,color:t.color,classDisabled:t.disabled?"disabled":"",label:t.label,value:t.value})}).join(""),name:(((i.guide||{}).color||{}).label||{}).text||r.dim}))}})},_drawFillLegend:function(){var e=this;e._fill.forEach(function(t){var i=e._chart.select(function(e){return"COORDS.MAP"===e.config.type&&e.config.fill===t});if(i.length>0){var r=i[0].getScale("fill"),n=r.brewer,a=r.domain(),s=(a[1]-a[0])/n.length,o=We.range(n.length).map(function(t){var i=a[0]+t*s,o="";return 0===t&&(o=a[0]),t===n.length-1&&(o=a[1]),e._itemFillTemplate({color:r(i),label:o,value:We.escape(i)})});e._container.insertAdjacentHTML("beforeend",e._template({items:o.join(""),name:(((i[0].guide||{}).fill||{}).label||{}).text||r.dim}))}})},_toggleLegendItem:function(e){var t=e.getAttribute("data-scale-id"),i=e.getAttribute("data-dim"),r=e.getAttribute("data-value"),n=i+r,a=this._legendColorByScaleId[t].filter(function(e){return!e.disabled});if(1!==a.length||t!==a[0].scaleId||r!==a[0].value){var s=this._currentFilters;if(s.hasOwnProperty(n)){var o=s[n];delete s[n],e.classList.remove("disabled"),this._chart.removeFilter(o)}else e.classList.add("disabled"),s[n]=this._chart.addFilter({tag:"legend",predicate:function(e){return e[i]!=r}});this._chart.refresh()}},_highlightToggle:function(e,t){var i=e.getAttribute("data-scale-id"),r=e.getAttribute("data-dim"),n=e.getAttribute("data-value");this._chart.select(function(e){return e.config.color===i}).forEach(function(e){e.fire("highlight",function(e){return!t||e[r]==n})})},_generateColorMap:function(e){var t=We.range(20).map(function(e){return"color20-"+(1+e)});return e.reduce(function(e,i,r){return e[i]=t[r%20],e},{})},_assignStaticBrewersOrEx:function(){var e=this;e._color.forEach(function(t){var i=e._chart.getSpec().scales[t],r=e._chart.getDataSources({excludeFilter:["legend"]}),n=e._chart.getScaleFactory(r).createScaleInfoByName(t).domain();i.brewer||(i.brewer="measure"!==i.dimType?e._generateColorMap(n):["#e5f5e0","#a1d99b","#31a354"])})}}}r.default.api.plugins.add("geomap-legend",Ue);var Xe=r.default.api.utils;function Ge(e){Xe.defaults(e||{},{});var t=function(){return!1};return{init:function(e){this._currNode=null,this._currData=null,this._chart=e,this._tooltip=e.addBalloon({spacing:3,auto:!0,effectClass:"fade"}),this._tooltip.content(this.template),this._tooltip.getElement().addEventListener("click",function(e){for(var t=e.target;t!==e.currentTarget&&null!==t;)t.classList.contains("i-role-exclude")&&(i._exclude(),i._tooltip.hide(),i._blurSelection()),t=t.parentNode},!1);var t,i=this;this._showTooltip=function(e){clearTimeout(t),i._currData=e.data;var r="No data";null!==e.data&&(r=Object.keys(e.data).map(function(t){return i.itemTemplate({label:t,value:e.data[t]})}).join(""));var n=i._tooltip.getElement().querySelectorAll(".i-role-content");n[0]&&(n[0].innerHTML=r);var a=i._tooltip.getElement().querySelectorAll(".i-role-exclude");if(a[0]){var s=e.data&&i._chart.getChartModelData().length>1;a[0].style.visibility=s?"visible":"hidden"}i._tooltip.show(e.event.pageX,e.event.pageY).updateSize()},this._hideTooltip=function(e){t=setTimeout(function(){i._tooltip.hide()},e?0:1e3)},this._tooltip.getElement().addEventListener("mouseover",function(e){clearTimeout(t)},!1),this._tooltip.getElement().addEventListener("mouseleave",function(e){i._hideTooltip(!0),i._blurSelection()},!1)},onRender:function(){var e=this;this._chart.select(function(e){return"COORDS.MAP"===e.config.type}).forEach(function(t){e._subscribeToPoints(t),e._subscribeToArea(t)})},template:['<div class="tau-chart__tooltip__buttons tau-chart__tooltip__clickable">','<div class="tau-chart__tooltip__button i-role-exclude">','<div class="tau-chart__tooltip__button__wrap">','<span class="tau-icon-close-gray"></span>',"Exclude","</div>","</div>","</div>",'<div class="i-role-content tau-chart__tooltip__content"></div>'].join(""),itemTemplate:Xe.template(['<div class="tau-chart__tooltip__list__item">','<div class="tau-chart__tooltip__list__elem"><%=label%></div>','<div class="tau-chart__tooltip__list__elem"><%=value%></div>',"</div>"].join("")),_exclude:function(){var e;this._chart.addFilter({tag:"exclude",predicate:(e=this._currData,function(t){return JSON.stringify(t)!==JSON.stringify(e)})}),this._chart.refresh()},_blurSelection:function(){this._chart.select(function(e){return"COORDS.MAP"===e.config.type}).forEach(function(e){e.fire("highlight-area",t)}),this._currNode=null,this._currData=null},_subscribeToPoints:function(e){var t=this;e.on("point-mouseover",function(e,i){t._showTooltip(i)}),e.on("point-mouseout",function(e,i){t._hideTooltip()})},_subscribeToArea:function(e){var t=this;!e.getScale("code").dim||e.on("area-click",function(i,r){var n,a;t._currNode=i,r.data?t._currData===r.data?(t._hideTooltip(!0),t._blurSelection()):(e.fire("highlight-area",(n=r.data,a=JSON.stringify(n),function(e){return JSON.stringify(e)===a})),t._showTooltip(r)):(t._showTooltip(r),t._hideTooltip(!1),t._blurSelection())})}}}r.default.api.plugins.add("geomap-tooltip",Ge);var qe=i(2),Ye=r.default.api.utils,Ke=r.default.api.pluginsSDK,Je=Ke.tokens();function Qe(e){var t=Ye.defaults(e||{},{title:"Layers",label:"Layer Type",showPanel:!0,showLayers:!0,mode:"merge",axisWidth:45,layers:[]});t.layers.forEach(function(e){e.guide=Ye.defaults(e.guide||{},{scaleOrient:"left",textAnchor:"end",hide:!1})});var i=function(e){return function(t){return Object.assign(t,e)}},r={line:i({type:"ELEMENT.LINE"}),area:i({type:"ELEMENT.AREA"}),dots:i({type:"ELEMENT.POINT"}),scatterplot:i({type:"ELEMENT.POINT"}),bar:i({type:"ELEMENT.INTERVAL"}),"stacked-bar":i({type:"ELEMENT.INTERVAL",stack:!0})};return{init:function(e){this._chart=e;var i=Ke.spec(this._chart.getSpec()),r=this.checkIfApplicable(i);if(this._isApplicable=0===r.length,i.addTransformation("defined-only",function(e,t){var i=t.key;return e.filter(function(e){return null!==e[i]&&void 0!==e[i]})}),this._isApplicable){this.isFacet=this.checkIsFacet(i),this.primaryY=this.findPrimaryLayer(i);var n=this.getLayersText(),a=this.getLayersGroup(),s=t.label;this.fieldColorScale=s,i.setSettings("excludeNull",!1).setSettings("fitModel",null).addScale(s,{type:"color",source:"/",dim:s,brewer:t.brewer}).addTransformation("slice-layer",function(e,t){var i=t.key,r=t.group;return r?e.filter(function(e){var t=e[r],i=e[t];return t&&null!=i}):e.filter(function(e){return e[s]===n[i]&&null!==e[i]&&void 0!==e[i]})});var o=[this.primaryY].concat(t.layers).reduce(function(e,t){return e.concat(t.y)},[]);e.setupChartSourceModel(function(e){var t={};t[s]={type:"category"};var i={"/":{dims:t,data:[]}};return i["/"].dims=Object.assign(t,e["/"].dims),i["/"].data=e["/"].data.reduce(function(e,t){return e.concat(o.map(function(e){var i={};i[s]=n[e];var r=a[e];return r&&(i[r]=t[e],i.subLayer=r),Object.assign(i,t)}))},[]),Object.assign(i,Ye.omit(e,"/"))}),t.showPanel&&(this._container=e.insertToRightSidebar(this.containerTemplate),this._container.classList.add("applicable-true"),this.uiChangeEventsDispatcher=function(e){var i=e.target,r=i.classList;r.contains("i-role-show-layers")&&(t.showLayers=i.checked),r.contains("i-role-change-mode")&&(t.mode=i.value),this._chart.refresh()}.bind(this),this._container.addEventListener("change",this.uiChangeEventsDispatcher,!1))}else{i.getSettings("log")("[layers plugin]: is not applicable. "+r.join(" / "))}},getLayersText:function(){return[this.primaryY].concat(t.layers).reduce(function(e,t){return(Array.isArray(t.y)?t.y:[t.y]).reduce(function(e,i){return e[i]=this.extractLabelForKey(t,i),e}.bind(this),e)}.bind(this),{})},getLayersGroup:function(){return[this.primaryY].concat(t.layers).reduce(function(e,t){var i=null;return Array.isArray(t.y)&&(i=t.y.join(", ")),Ye.flatten([t.y]).reduce(function(e,t){return e[t]=i,e},e)}.bind(this),{})},checkIsFacet:function(e){return e.unit().reduce(function(e,t,i){return e||(i&&"COORDS.RECT"===i.type&&"COORDS.RECT"===t.type?e=!0:e)},!1)},checkIfApplicable:function(e){return e.unit().reduce(function(t,i,r){if(r&&"COORDS.RECT"!==r.type)return t.concat("Chart specification contains non-rectangular coordinates");if(r&&"COORDS.RECT"===r.type&&"COORDS.RECT"!==i.type){var n=e.getScale(i.y);if("measure"!==e.getSourceDim(n.source,n.dim).type)return t.concat("Y scale is not a measure")}return t},[])},isLeafElement:function(e,t){return t&&"COORDS.RECT"===t.type&&"COORDS.RECT"!==e.type},isFirstCoordNode:function(e,t){return!t&&e&&"COORDS.RECT"===e.type},isFinalCoordNode:function(e,t){return e&&"COORDS.RECT"===e.type&&e.units.every(function(e){return"COORDS.RECT"!==e.type})},buildLayersLayout:function(e){return e.regSource("$",{dims:{x:{type:"category"},y:{type:"category"}},data:[{x:1,y:1}]}).addScale("xLayoutScale",{type:"ordinal",source:"$",dim:"x"}).addScale("yLayoutScale",{type:"ordinal",source:"$",dim:"y"}).unit({type:"COORDS.RECT",x:"xLayoutScale",y:"yLayoutScale",expression:{source:"$",inherit:!1,operator:!1},guide:{showGridLines:"",x:{cssClass:"facet-axis"},y:{cssClass:"facet-axis"}}})},findPrimaryLayer:function(e){var t=this,i=e.unit().reduce(function(i,r){return i.concat(t.isFinalCoordNode(r)?{y:e.getScale(r.y).dim,isPrimary:!0,guide:r.guide.y,scaleName:r.y}:[])},[]);return Ke.cloneObject(i[0])},createPrimaryUnitReducer:function(e,i,r,n){var a=this;return function(s,o,l){var c=function(e){return!0!==e.guide.hide};if(a.isFacet&&a.isFirstCoordNode(o,l)){o.guide.y.label=o.guide.y.label||{};var d=o.guide.y.label._original_text||o.guide.y.label.text;o.guide.y.label.text=[d,i.filter(c).map(a.extractLayerLabel.bind(a)).join(", ")].join(e.getSettings("facetLabelDelimiter")),"dock"===t.mode&&(o.guide.y.label.padding-=15,o.guide.y.padding+=15,o.guide.y.rotate=-90,o.guide.y.textAnchor="middle")}return a.isLeafElement(o,l)&&(l.units=l.units.filter(function(e){return e!==o})),a.isFinalCoordNode(o)&&(o.guide.y.label=o.guide.y.label||{},"dock"===t.mode&&(o.guide.padding.l=r,o.guide.padding.r=n,o.guide.y.hide=!0),"merge"===t.mode&&(o.guide.y.label.text=a.isFacet?"":i.filter(c).map(a.extractLayerLabel.bind(a)).join(", "))),s}},createSecondaryUnitReducer:function(e,i,n,a,s,o,l,c){var d=this,u=d.getScaleName(i.scaleName||i.y),h=i.guide.scaleOrient,f=Array.isArray(i.y),p=i.isPrimary;return function(g,m,b){if(d.isFacet&&d.isFirstCoordNode(m,b)&&(m.guide.y.label.text="",m.guide.x.hide=!0,m.guide.y.hide=!0),d.isLeafElement(m,b)){(i.type?r[i.type]:function(e){return e})(m),m.y=u;var y=e.getScale(m.size).dim;if(p&&y);else{var v="size_null"+c;e.addScale(v,{type:"size",source:"?",mid:1}),m.size=v}var x=e.getScale(m.color).dim;p&&x||(m.color=d.fieldColorScale,m.expression.operator="groupBy",m.expression.params=f?["subLayer"]:[d.fieldColorScale]);var _=f?{group:"subLayer"}:{key:i.y};Ke.unit(m).addTransformation("slice-layer",_)}if(d.isFinalCoordNode(m)){if(m.y=u,m.guide.y=Object.assign(m.guide.y,i.guide||{}),m.guide.y.label=m.guide.y.label||{},m.guide.y.label.text=d.extractLayerLabel(i),m.guide.x.hide=!0,"dock"===t.mode){m.guide.showGridLines="",m.guide.padding.l=n,m.guide.padding.r=a,m.guide.y.label.textAnchor="end",m.guide.y.label.dock="right",m.guide.y.label.padding="right"===h?1:-10,m.guide.y.label.cssClass="label inline";var w="right"===h?l:o;m.guide.y.padding+=s*w}"merge"===t.mode&&(m.guide.showGridLines="",m.guide.y.hide=!0)}return g}},getScaleName:function(e){return Array.isArray(e)?e.join(", "):e},extractLabelForKey:function(e,t){var i=e.guide||{};i.label="string"==typeof i.label?{text:i.label}:i.label;var r=i.label||{},n=r.byKeys||{};return Array.isArray(e.y)?n[t]||t:r.text||r._original_text||e.y},extractLayerLabel:function(e){var t=this;return(Array.isArray(e.y)?e.y:[e.y]).map(function(i){return t.extractLabelForKey(e,i)}).join(", ")},onSpecReady:function(e,i){var r=this,n=Ke.spec(i);if(t.showLayers&&r._isApplicable){n=t.layers.reduce(function(e,t){var i=r.getScaleName(t.y);return e.addScale(i,Object.assign({type:"linear",source:"/",dim:i,autoScale:!0},Ye.pick(t.guide||{},"min","max","autoScale","nice","niceInterval")))},n);var a,s=[this.primaryY].concat(t.layers).sort(function(e,t){return(e.guide.zIndex||0)-(t.guide.zIndex||0)}),o=n.unit(),l=t.axisWidth,c=function(e){return function(t){var i=t.guide.scaleOrient||"left";return!0!==t.guide.hide&&i===e}},d=c("left"),u=c("right"),h=s.filter(d).length*l,f=s.filter(u).length*l,p=r.buildLayersLayout(n).addFrame({key:{x:1,y:1},units:[(a=Ke.unit(o.clone())).reduce(r.createPrimaryUnitReducer(n,s,h,f),a).value()]}),g=-1,m=-1;s.reduce(function(e,t,i){return g=d(t)?g+1:g,m=u(t)?m+1:m,e.addFrame({key:{x:1,y:1},units:[(a=Ke.unit(o.clone())).reduce(r.createSecondaryUnitReducer(n,t,h,f,l,g,m,i),a).value()]})},p)}else n.unit().traverse(function(e,t){r.isLeafElement(e,t)&&Ke.unit(e).addTransformation("defined-only",{key:n.getScale(e.y).dim})})},onUnitsStructureExpanded:function(){var e=this;if(e._isApplicable&&"merge"===t.mode){var i=Ke.spec(e._chart.getSpec()),r=e.primaryY.scaleName,n=t.layers.map(function(t){return e.getScaleName(t.y)}).filter(function(e){return i.getScale(e)}).concat(r),a=n.reduce(function(t,i){var r=e._chart.getScaleInfo(i);return t[i]=r.domain().filter(function(e){return Number.isFinite(e)}),t},{}),s=qe.extent(Ye.flatten(Object.keys(a).map(function(e){return a[e]})));n.forEach(function(e){var t=i.getScale(e);t.min=s[0],t.max=s[1],t.nice=!1})}},containerTemplate:'<div class="tau-chart__trendlinepanel"></div>',template:Ye.template(['<label class="tau-chart__trendlinepanel__title tau-chart__checkbox">','   <input type="checkbox"','          class="tau-chart__checkbox__input i-role-show-layers"','          <%= (showLayers ? "checked" : "") %>',"   />",'   <span class="tau-chart__checkbox__icon"></span>','   <span class="tau-chart__checkbox__text"><%= title %></span>',"</label>","<div>",'<select class="i-role-change-mode tau-chart__select tau-chart__trendlinepanel__control">','   <option <%= ((mode === "dock")  ? "selected" : "") %> value="dock">'+Je.get("Dock")+"</option>",'   <option <%= ((mode === "merge") ? "selected" : "") %> value="merge">'+Je.get("Merge")+"</option>","</select>","</div>"].join("")),onRender:function(){this._isApplicable&&t.showPanel&&(this._container.innerHTML=this.template({title:t.title,mode:t.mode,showLayers:t.showLayers}))}}}r.default.api.plugins.add("layers",Qe);var Ze=i(6);const et=r.default.api.utils,tt=r.default.api.pluginsSDK,it=".tau-chart__legend__reset",rt=".tau-chart__legend__item-color",nt=".tau-chart__legend__guide--color__overlay",at=4,st=13;let ot=0;const lt=()=>++ot,ct=r.default.api.utils.xml,dt=(e,t)=>{const i=e[0],r=e[1],n=(r-i)/(t-1),a=et.range(t-2).map(e=>i+n*(e+1));return[i].concat(a).concat(r)},ut=(e,t,i)=>{if(e.length<3)return e.slice(0);if(t<3)return[e[0],e[e.length-1]];const r=e[0]<0?Math.abs(e[0]):0,n=e=>e,a="sqrt"===i?e=>Math.sqrt(e+r):n,s="sqrt"===i?e=>e**2-r:n;let o=[(e=e.map(a))[0]];const l=e[e.length-1]-e[0],c=.5*l/(t-1),d=et.range(1,t-1).map(e=>{const i=l*e/(t-1);return{min:i-c,mid:i,max:i+c,diff:Number.MAX_VALUE,closest:null}});let u,h=0;const f=()=>{if(h===d.length)return;const e=u;(u=d[h++]).min=Math.max(u.min,(e&&null!==e.closest?e.closest:o[0])+c)};return f(),e.forEach(e=>{if(e<u.min)return;e>u.max&&f();const t=Math.abs(e-u.mid);t<u.diff&&t<c?(u.diff=t,u.closest=e):f(),0===t&&f()}),d.forEach(e=>{null!==e.closest&&o.push(e.closest)}),o.push(e[e.length-1]),o=o.map(s)},ht=e=>Math.log(e)/Math.LN10,ft=e=>0===e?0:Math.floor(ht(Math.abs(e))),pt=(()=>{const e=/\.0+([^\d].*)?$/,t=/(\.\d+?)0+([^\d].*)?$/;return i=>i.replace(e,"$1").replace(t,"$1$2")})(),gt=Ze.format(".3s"),mt=e=>pt(gt(e)),bt=(e,t)=>{const i=Math.max(Math.abs(e),Math.abs(t)),r=ft(i),n=e*t>0?Math.abs(t-e):i,a=ft(n),s=Math.abs(r-a);return Math.abs(r)>3&&s<=3?mt:e=>{const t=ft(i-e),r=Math.min((a<0?Math.abs(a):0)+(t<a?1:0),20);return pt(e.toFixed(r))}};function yt(e){let t=!0;const i=et.defaults(e||{},{formatters:{},onSelect:()=>{}}),r=e=>null===e||""===e||void 0===e,n=e=>e.every(e=>et.isDate(e)),a=(e,t)=>i=>{const n=i[e],a=JSON.stringify(r(n)?null:n);return t===a},s=(e,t,i,r)=>{e.addEventListener(t,e=>{let t=e.target;for(;t!==e.currentTarget&&null!==t;)t.matches(i)&&r(e,t),t=t.parentNode})};return{init(e){this.instanceId=lt(),this._chart=e,this._currentFilters={},this._legendColorByScaleId={},this._legendOrderState={};const t=this._chart.getSpec(),r=e=>(i,r)=>{const n=t.scales[r];return n.type===e&&n.dim&&i.push(r),i};this._color=Object.keys(t.scales).reduce(r("color"),[]).filter(t=>e.getScaleInfo(t).discrete),this._fill=Object.keys(t.scales).reduce(r("color"),[]).filter(t=>!e.getScaleInfo(t).discrete),this._size=Object.keys(t.scales).reduce(r("size"),[]);const n=this._color.length>0,a=this._fill.length>0,o=this._size.length>0;if(this._assignStaticBrewersOrEx(),n||a||o){switch(i.position){case"left":this._container=this._chart.insertToLeftSidebar(this._containerTemplate);break;case"right":this._container=this._chart.insertToRightSidebar(this._containerTemplate);break;case"top":this._container=this._chart.insertToHeader(this._containerTemplate);break;case"bottom":this._container=this._chart.insertToFooter(this._containerTemplate);break;default:this._container=this._chart.insertToRightSidebar(this._containerTemplate)}n&&(s(this._container,"click",it,(e,t)=>{this._toggleLegendItem(t,"reset")}),s(this._container,"click",rt,(e,t)=>{const i=e.ctrlKey||e.target.matches(nt)?"leave-others":"focus-single";this._toggleLegendItem(t,i)}),s(this._container,"mouseover",rt,(e,t)=>{this._highlightToggle(t,!0)}),s(this._container,"mouseout",rt,(e,t)=>{this._highlightToggle(t,!1)}))}},destroy(){const e=this._currentFilters,t=this._chart;Object.keys(e).forEach(i=>t.removeFilter(e[i])),this._container&&this._container.parentElement&&(this._clearPanel(),this._container.parentElement.removeChild(this._container))},onSpecReady(e,t){this._formatters=tt.getFieldFormatters(t,i.formatters)},_getFormat(e){return this._formatters[e]?this._formatters[e].format:e=>String(e)},onRender(){if(t&&i.selectedCategories&&0!==i.selectedCategories.length){let e=this._getLegendColorByScales();return Object.keys(e).forEach(t=>{e[t].legendColorItems.forEach(({value:e,dim:t})=>{if(-1===i.selectedCategories.indexOf(JSON.parse(e))){const i=t+e,r=a(t,e);this._currentFilters[i]=this._chart.addFilter({tag:"legend",predicate:e=>!r(e)})}})}),t=!1,void this._chart.refresh()}this._clearPanel(),this._drawColorLegend(),this._drawFillLegend(),this._drawSizeLegend()},_containerTemplate:'<div class="tau-chart__legend"></div>',_template:et.template(['<div class="tau-chart__legend__wrap">',"<%=top%>",'<div class="tau-chart__legend__title"><%=name%></div>',"<%=items%>","</div>"].join("")),_itemTemplate:et.template(["<div data-scale-id='<%= scaleId %>' data-dim='<%= dim %>' data-value='<%= value %>' class=\"tau-chart__legend__item tau-chart__legend__item-color <%=classDisabled%>\">",'   <div class="tau-chart__legend__guide__wrap">','   <div class="tau-chart__legend__guide tau-chart__legend__guide--color <%=cssClass%>"','        style="background-color: <%=cssColor%>; border-color: <%=borderColor%>;">','       <div class="tau-chart__legend__guide--color__overlay">',"       </div>","   </div>","   </div>",'   <span class="tau-chart__legend__guide__label"><%=label%></span>',"</div>"].join("")),_resetTemplate:et.template(['<div class="tau-chart__legend__reset <%=classDisabled%>">','    <div role="button" class="tau-chart__button">Reset</div>',"</div>"].join("")),_clearPanel(){this._container&&(clearTimeout(this._scrollTimeout),this._getScrollContainer().removeEventListener("scroll",this._scrollListener),this._container.innerHTML="")},_drawFillLegend(){const e=this;e._fill.forEach(t=>{const i=e._chart.select(e=>e.config.color===t)[0];if(i){const t=i.config.guide||{},r=i.getScale("color"),a=r.domain().sort((e,t)=>e-t),s=n(a),o=s?a.map(Number):a,l=bt(o[0],o[o.length-1]),c=(()=>{const t=e._chart.getSpec();let i=tt.extractFieldsFormatInfo(t)[r.dim].format;return i||(i=(e=>new Date(e))),e=>String(i(e))})(),d=s?c:l,u=r.brewer.length,h=((t.color||{}).label||{}).text||r.dim,f=e=>e.length*st*.618,p=r.isInteger?(o[1]-o[0])%3==0?4:(o[1]-o[0])%2==0?3:2:3,g=dt(o,p);let m=(s?g.map(e=>new Date(e)):g).map(d);m[0]===m[m.length-1]&&(m=[m[0]]),e._container.insertAdjacentHTML("beforeend",e._template({name:et.escape(h),top:null,items:'<div class="tau-chart__legend__gradient-wrapper"></div>'}));const b=e._container.lastElementChild.querySelector(".tau-chart__legend__gradient-wrapper"),y=b.getBoundingClientRect().width;let v=!1;m.reduce((e,t)=>e+f(t),0)>y&&(m.length>1&&f(m[0])+f(m[m.length-1])>y?v=!0:m=[m[0],m[m.length-1]]);const x=20,_=v?(()=>{const e=-.382*st/2;return{width:y,height:120,barX:0,barY:0,barWidth:x,barHeight:120,textAnchor:"start",textX:et.range(p).map(()=>25),textY:1===m.length?60+.618*st:m.map((t,i)=>{const r=(m.length-1-i)/(m.length-1);return st*(1-r)+120*r+e})}})():(()=>{const e=f(m[0])/2,t=f(m[m.length-1])/2;return{width:y,height:x+8+st,barX:0,barY:0,barWidth:y,barHeight:x,textAnchor:"middle",textX:1===m.length?[y/2]:m.map((i,r)=>{const n=r/(m.length-1);return e*(1-n)+(y-t)*n}),textY:et.range(p).map(()=>x+8+st)}})(),w=dt(o,u).map((e,t)=>{return ct("stop",{offset:`${t/(u-1)*100}%`,style:`stop-color:${r(e)};stop-opacity:1"`})}),E=`legend-gradient-${e.instanceId}`,S=ct("svg",{class:"tau-chart__legend__gradient",width:_.width,height:_.height},ct("defs",ct("linearGradient",{id:E,x1:"0%",y1:v?"100%":"0%",x2:v?"0%":"100%",y2:"0%"},...w)),ct("rect",{class:"tau-chart__legend__gradient__bar",x:_.barX,y:_.barY,width:_.barWidth,height:_.barHeight,fill:`url(#${E})`}),...m.map((e,t)=>ct("text",{x:_.textX[t],y:_.textY[t],"text-anchor":_.textAnchor},e)));b.insertAdjacentHTML("beforeend",S)}})},_drawSizeLegend(){const e=this;e._size.forEach(t=>{const i=e._chart.select(e=>e.config.size===t)[0];if(i){const t=i.config.guide||{},r=i.getScale("size"),n=r.domain().sort((e,t)=>e-t);if(!Array.isArray(n)||!n.every(isFinite))return;const a=((t.size||{}).label||{}).text||r.dim,s=n[0],o=n[n.length-1];let l=[s];if(o-s){const t=ht(o-s),i=10**Math.round(4-t),n=et.unique(e._chart.getDataSources({excludeFilter:["legend"]})[r.source].data.map(e=>e[r.dim]).filter(e=>e>=s&&e<=o)).sort((e,t)=>e-t),a=ut(n,at,r.funcType);l=et.unique(a.map(e=>Math.round(e*i)/i))}const c=bt(l[0],l[l.length-1]),d=e=>e.length*st*.618;l.reverse();const u=l.map(r),h=Math.max.apply(null,u),f=l.map(c);e._container.insertAdjacentHTML("beforeend",e._template({name:et.escape(a),top:null,items:'<div class="tau-chart__legend__size-wrapper"></div>'}));const p=e._container.lastElementChild.querySelector(".tau-chart__legend__size-wrapper"),g=p.getBoundingClientRect().width;let m=!1;(Math.max.apply(null,f.map(d))>g/4||1===f.length)&&(m=!0);const b=m?(()=>{const e=st,t=u[0]/2,i=u[u.length-1]/2,r=[t];for(let t,i,n=1;n<u.length;n++)i=u[n-1]/2,t=u[n]/2,r.push(r[n-1]+Math.max(1.618*st,i+e+t));const n=.618*st/2;return{width:g,height:r[r.length-1]+Math.max(i,st/2),circleX:et.range(u.length).map(()=>h/2),circleY:r,textAnchor:"start",textX:et.range(f.length).map(()=>h+8),textY:r.map(e=>e+n)}})():(()=>{const e=Math.max(d(f[0])/2,u[0]/2),t=Math.max(d(f[f.length-1])/2,u[u.length-1]/2),i=(g-u.reduce((e,t,i)=>e+(0===i||i===u.length-1?t/2:t),0)-e-t)/(at-1),r=[e];for(let e,t,n=1;n<u.length;n++)t=u[n-1]/2,e=u[n]/2,r.push(r[n-1]+t+i+e);const n=u.map(e=>h-e/2);return{width:g,height:h+8+st,circleX:r,circleY:n,textAnchor:"middle",textX:r,textY:et.range(f.length).map(()=>h+8+st)}})(),y=ct("svg",{class:"tau-chart__legend__size",width:b.width,height:b.height},...u.map((e,t)=>ct("circle",{class:`tau-chart__legend__size__item__circle ${i.config.color?"color-definite":"color-default-size"}`,cx:b.circleX[t],cy:b.circleY[t],r:e/2})),...f.map((e,t)=>ct("text",{class:"tau-chart__legend__size__item__label",x:b.textX[t],y:b.textY[t],"text-anchor":b.textAnchor},e)));p.insertAdjacentHTML("beforeend",y)}})},_getLegendColorByScales(){const e=this;return e._color.reduce((t,i)=>{const a=e._chart.select(e=>e.config.color===i)[0];if(a){const s=a.config.guide||{},o=a.getScale("color"),l=e._chart.getDataSources({excludeFilter:["legend"]});let c=et.unique(l[o.source].data.map(e=>e[o.dim]));const d=e._chart.getSpec().scales[i],u=n(c);if(d.order)c=et.union(et.intersection(d.order,c),c);else if("order"===d.dimType&&u)c=c.sort((e,t)=>new Date(e)-new Date(t));else{const t=e._legendOrderState[i];c=c.sort((e,i)=>{const r=t[e]-t[i];return r&&r/Math.abs(r)})}const h=((s.color||{}).label||{}).text||o.dim,f=(s.color||{}).tickFormatNullAlias||`No ${h}`,p=e._getFormat(o.dim);let g=c.map(t=>{const n=JSON.stringify(r(t)?null:t),a=o.dim+n;return{scaleId:i,dim:o.dim,color:o(t),disabled:e._currentFilters.hasOwnProperty(a),label:p(t),value:n}});t[i]={legendColorItems:g,title:h,colorScale:o,noVal:f}}return t},{})},_drawColorLegend(){const e=this,t=this._getLegendColorByScales();Object.keys(t).forEach(i=>{const{legendColorItems:n,title:a,colorScale:s,noVal:o}=t[i];e._container.insertAdjacentHTML("beforeend",e._template({name:et.escape(a),top:e._resetTemplate({classDisabled:n.some(function(e){return e.disabled})?"":"disabled"}),items:n.map(function(t){return e._itemTemplate({scaleId:t.scaleId,dim:et.escape(t.dim),color:t.color,cssClass:s.toClass(t.color),cssColor:t.disabled?"transparent":s.toColor(t.color),borderColor:s.toColor(t.color),classDisabled:t.disabled?"disabled":"",label:et.escape(r(t.label)?o:t.label),value:et.escape(t.value)})}).join("")}))}),e._color.length>0&&(e._updateResetButtonPosition(),e._scrollTimeout=null,e._scrollListener=(()=>{const t=e._container.querySelector(it);t.style.display="none",e._scrollTimeout&&clearTimeout(e._scrollTimeout),e._scrollTimeout=setTimeout(()=>{e._updateResetButtonPosition(),t.style.display="",e._scrollTimeout=null},250)}),e._getScrollContainer().addEventListener("scroll",e._scrollListener))},_toggleLegendItem(e,t){const r=this._currentFilters,n=e?Array.prototype.filter.call(e.parentNode.childNodes,e=>e.matches(rt)):null,s=e=>{const t=e.getAttribute("data-dim"),i=e.getAttribute("data-value");return{sid:e.getAttribute("data-scale-id"),dim:t,val:i,key:t+i}},o=e=>e in r,l=(e,t)=>{const i=s(e);if(o(i.key)===t)if(t){const t=r[i.key];delete r[i.key],e.classList.remove("disabled"),this._chart.removeFilter(t)}else{e.classList.add("disabled");const t=a(i.dim,i.val);r[i.key]=this._chart.addFilter({tag:"legend",predicate:e=>!t(e)})}},c=t=>t===e,d=!!e&&o(s(e).key),u=(e,t)=>{e.querySelector(".tau-chart__legend__guide").style.backgroundColor=t?"":"transparent"};if("reset"===t)n.forEach(e=>{l(e,!0),u(e,!0)});else if("leave-others"===t)n.forEach(e=>{c(e)&&l(e,d)}),u(e,d);else if("focus-single"===t){const t=!d&&n.every(e=>c(e)||o(s(e).key));n.forEach(e=>{const i=c(e)||t;l(e,i)}),d&&u(e,!0)}const h=n.filter(e=>!o(s(e).key)).map(e=>JSON.parse(s(e).val));i.onSelect({type:t,selectedCategories:h}),this._chart.refresh()},_highlightToggle(e,t){if(e.matches(".disabled"))return;const i=e.getAttribute("data-dim"),r=e.getAttribute("data-value"),n=t?a(i,r):e=>null;this._chart.select(e=>!0).forEach(e=>{e.fire("highlight",n)})},_getScrollContainer(){return this._container.parentNode.parentNode},_updateResetButtonPosition(){this._container.querySelector(it).style.top=`${this._getScrollContainer().scrollTop}px`},_generateColorMap(e,t){const i=t.length;return e.reduce((e,r,n)=>(e[r]=t[n%i],e),{})},_assignStaticBrewersOrEx(){const e=this;e._color.forEach(t=>{const i=e._chart.getSpec().scales[t],r=e._chart.getDataSources({excludeFilter:["legend"]}),n=e._chart.getScaleFactory(r).createScaleInfoByName(t).domain();if(!i.brewer||Array.isArray(i.brewer)){const t=i.brewer||et.range(20).map(e=>`color20-${1+e}`);i.brewer=e._generateColorMap(n,t)}e._legendOrderState[t]=n.reduce((e,t,i)=>(e[t]=i,e),{})})}}}r.default.api.plugins.add("legend",yt);var vt=r.default.api.utils;function xt(e){var t=vt.defaults(e||{},{verbose:!1,forceBrush:{}}),i={init:function(e){t.verbose&&(this.panel=e.insertToRightSidebar(this.template())),e.traverseSpec(e.getSpec(),function(e){e&&"COORDS.PARALLEL"===e.type&&(e.guide=e.guide||{},e.guide.enableBrushing=!0)}),i.forceBrush=t.forceBrush||{}},onRender:function(e){var r=e.getSpec().scales,n=Object.keys(r).reduce(function(e,t){var n=r[t].dim;return i.forceBrush[n]&&(e[t]=i.forceBrush[n]),e},{}),a=e.select(function(e){return"PARALLEL/ELEMENT.LINE"===e.config.type});a.forEach(function(e,r){e.parentUnit.on("brush",function(n,a){i.forceBrush={};var s=a.map(function(e){var t=e.dim,r=e.func,n=e.args;i.forceBrush[t]=n;var a=function(){return!0};return"between"===r&&(a=function(e){return e[t]>=n[0]&&n[1]>=e[t]}),"inset"===r&&(a=function(e){return n.indexOf(e[t])>=0}),a}),o=0;if(e.fire("highlight",function(e){var t=s.every(function(t){return t(e)});return o+=t?1:0,t}),t.verbose){var l=i.panel.getElementsByClassName("i-"+r);if(0===l.length){var c=document.createElement("div");c.className="i-"+r,i.panel.appendChild(c),l[0]=c}l[0].innerHTML=a.reduce(function(e,t){return e+"<div>"+t.dim+": ["+t.args.join(",")+"]</div>"},"<div>Matched: "+o+"</div>")}})}),a.forEach(function(e){e.parentUnit.fire("force-brush",n)})},template:vt.template('<div class="tau-chart__chart_brushing_panel"></div>')};return i}r.default.api.plugins.add("parallel-brushing",xt);var _t=r.default.api.utils;function wt(e){_t.defaults(e||{},{});return{init:function(e){this._cursor=null,this._chart=e,this._tooltip=e.addBalloon({spacing:3,auto:!0,effectClass:"fade"}),this._tooltip.content(this.template),this._tooltip.getElement().addEventListener("click",function(e){for(var t=e.target;t!==e.currentTarget&&null!==t;)t.classList.contains("i-role-exclude")&&i._exclude(),t=t.parentNode;i._tooltip.hide()},!1);var t,i=this;this.showTooltip=function(e){clearTimeout(t),i._cursor=e.data;var r=i._tooltip.getElement().querySelectorAll(".i-role-content");r[0]&&(r[0].innerHTML=Object.keys(e.data).map(function(t){return i.itemTemplate({label:t,value:e.data[t]})}).join("")),i._tooltip.show(e.event.pageX,e.event.pageY).updateSize()},this.hideTooltip=function(e){t=setTimeout(function(){i._tooltip.hide()},1e3)},this._tooltip.getElement().addEventListener("mouseover",function(e){clearTimeout(t)},!1),this._tooltip.getElement().addEventListener("mouseleave",function(e){i._tooltip.hide()},!1)},_exclude:function(){var e;this._chart.addFilter({tag:"exclude",predicate:(e=this._cursor,function(t){return JSON.stringify(t)!==JSON.stringify(e)})}),this._chart.refresh()},onRender:function(e){var t=this;e.select(function(e){return"PARALLEL/ELEMENT.LINE"===e.config.type}).forEach(function(e){e.on("mouseout",function(e,i){t.hideTooltip(i)}),e.on("mouseover",function(e,i){t.showTooltip(i)})})},template:['<div class="tau-chart__tooltip__buttons tau-chart__tooltip__clickable">','<div class="tau-chart__tooltip__button i-role-exclude">','<div class="tau-chart__tooltip__button__wrap">','<span class="tau-icon-close-gray"></span>',"Exclude","</div>","</div>","</div>",'<div class="i-role-content tau-chart__tooltip__content"></div>'].join(""),itemTemplate:_t.template(['<div class="tau-chart__tooltip__list__item">','<div class="tau-chart__tooltip__list__elem"><%=label%></div>','<div class="tau-chart__tooltip__list__elem"><%=value%></div>',"</div>"].join(""))}}r.default.api.plugins.add("parallel-tooltip",wt);var Et=i(8),St=i(3),Tt=i(7);const Mt={...qe,...Et,...St,...f,...Tt};var Ct=r.default.api.utils,kt=0;function At(e={}){return{init:function(t){this._chart=t,this._currentFilters={},this._data={},this._bounds={},this._filter={},this._container={},this._layout=this._chart.getLayout().layout;var i=this,r=this._chart.getSpec(),n=r.sources["/"],a=e.fields||e;this._fields=Array.isArray(a)&&a.length>0?a:Object.keys(n.dims),this._fieldBounds=e.fieldBounds||{},this._applyImmediately=Boolean(e.applyImmediately);var s=i._chart.getChartModelData();this._filtersContainer=i._chart.insertToRightSidebar(i._filtersContainer),this._filtersContainer.style.maxHeight="0px",i._fields.filter(function(e){var t="measure"===n.dims[e].type;return t||r.settings.log("The ["+e+"] isn't measure so Quick Filter plugin skipped it"),t}).forEach(function(e){i._data[e]=s.map(function(t){return t[e]});const t=i._fieldBounds[e];i._bounds[e]=t?[t.min,t.max]:Mt.extent(i._data[e]),i._filter[e]=i._bounds[e],i._filtersContainer.insertAdjacentHTML("beforeend",i._filterWrapper({name:e})),i._container[e]=i._filtersContainer.lastChild,i._drawFilter(e)})},onRender:function(){this._filtersContainer.style.maxHeight="none"},_filtersContainer:'<div class="tau-chart__filter"></div>',_filterWrapper:Ct.template('<div class="tau-chart__filter__wrap"><div class="tau-chart__legend__title"><%=name%></div></div>'),_drawFilter:function(e){var t=this._data[e],i=this._bounds[e],r=this._filter[e],n=Ct.isDate(i[0])||Ct.isDate(i[1]),a=this,s=0,o=24,l=21,c=12,d=180-c-o,u=41-s-l-8,h=Mt.scaleLinear().domain(i).range([0,d]),p=Mt.brushX().extent([[0,0],[d,20]]).on("start",function(){a._layout.style["overflow-y"]="hidden"}).on("brush",this._applyImmediately?E:w).on("end",function(){a._layout.style["overflow-y"]="",E()}),g=Mt.select(this._container[e]).append("svg").attr("width",d+c+o).attr("height",u+s+l+4).append("g").attr("transform","translate("+c+","+s+")"),m=(g.append("g").selectAll("rect").data(t).enter().append("rect").attr("transform",function(e){return"translate("+h(e)+","+(s+4)+")"}).attr("height",u).attr("width",1),g.append("g").attr("class","brush").call(p));m.append("g").attr("class","resize e").attr("cursor","ew-resize").attr("pointer-events","none"),m.append("g").attr("class","resize w").attr("cursor","ew-resize").attr("pointer-events","none"),m.selectAll(".resize").append("line").attr("transform","translate(0, 0)").attr("x1",0).attr("x2",0).attr("y1",0).attr("y2",u+8),m.selectAll(".resize").append("text").attr("x",0).attr("y",2*(u+4)),m.selectAll("rect").attr("height",u+8);var b=g.append("text").attr("x",d/2).attr("y",2*(u+4)).attr("class","date-label"),y=function(e){return Math.log(e)/Math.LN10}(a._filter[e][1]-a._filter[e][0]),v=Math.round(3-y),x=Math.pow(10,v);if(n){var _=function(e){var t=e.findIndex(function(e){var t=Mt.timeFormat(e);return t(new Date(i[0]))!==t(new Date(i[1]))});return t=t<0?e.length:t,{comm:e.slice(0,t),diff:e.slice(t)}}(["’%y","&thinsp;%b","%d","%H",":%M",":%S"]);_.comm.length<3?(_.diff.splice(-3),_.diff.reverse(),_.comm.reverse()):(_.comm.length<5&&_.diff.pop(),_.diff=_.comm.splice(3,_.comm.length-3).concat(_.diff),_.comm.reverse())}function w(){const t=f.event;if(t&&Array.isArray(t.selection)){const i=t.selection.map(h.invert);r=i,a._filter[e]=i}else r=a._filter[e];var i=n?new Date(r[0]).getTime():r[0],s=n?new Date(r[1]).getTime():r[1],o=Math.round(parseFloat(i)*x)/x,l=Math.round(parseFloat(s)*x)/x;m.select(".handle--w"),m.select(".handle--e");m.select(".resize.w").attr("transform",`translate(${h(r[0])},0)`),m.select(".resize.e").attr("transform",`translate(${h(r[1])},0)`);var c=m.selectAll(".w text"),d=m.selectAll(".e text");if(n){var u=Mt.timeFormat(_.comm.join("")),p=Mt.timeFormat(_.diff.join(""));b.html(p(new Date(o))+"&thinsp;..&thinsp;"+p(new Date(l))+' <tspan class="common">'+u(new Date(l))+"</tspan>")}else c.text(o),d.text(l)}function E(){w(),a._applyFilter(e)}E(),p.move(m,r.map(h))},destroy(){const e=this._currentFilters,t=this._chart;Object.keys(e).forEach(i=>t.removeFilter(e[i]));(e=>e&&e.parentElement&&e.parentElement.removeChild(e))(this._filtersContainer)},_applyFilter:function(e){var t=this._currentFilters,i=function(e,t,i){return function(r){var n=r[e];return n<t||n>i}}(e,this._filter[e][0],this._filter[e][1]),r=t[e];delete t[e],this._chart.removeFilter(r),t[e]=this._chart.addFilter({tag:"quick-filter",predicate:function(e){return!i(e)}}),kt<0?this._chart.refresh():(this._refreshRequestId&&clearTimeout(this._refreshRequestId),this._refreshRequestId=setTimeout(function(){this._refreshRequestId=null,this._chart.refresh()}.bind(this),kt))}}}r.default.api.plugins.add("quick-filter",At);var Pt=r.default.api.utils;function Ot(e){var t=Pt.defaults(e||{},{show:!0,modes:["normal","entire-view","fit-width","fit-height","minimal"]});return{init:function(e){t.show&&(t.selectedMode=e.getSpec().settings.fitModel,e.insertToHeader(this.template({modes:t.modes.map(function(e){return"<option "+(t.selectedMode===e?"selected":"")+' value="'+e+'">'+e+"</option>"})})).addEventListener("change",function(i){var r=i.target;r.classList.contains("i-role-fit-model")&&(t.selectedMode=r.value,e.getSpec().settings.fitModel=t.selectedMode,e.refresh())},!1))},template:Pt.template(['<div class="tau-chart__chartsettingspanel">',"    <div>","        <span>View Mode:&nbsp;</span>",'        <select class="i-role-fit-model tau-chart__select">',"        <%= modes %> />","        </select>","    </div>","</div>"].join(""))}}r.default.api.plugins.add("settings",Ot);function Nt(e){return new q(e)}r.default.api.plugins.add("tooltip",Nt);var Lt,Rt=(Lt={linear:function(e){for(var t=[0,0,0,0,0],i=0,r=[];i<e.length;i++)e[i][1]&&(t[0]+=e[i][0],t[1]+=e[i][1],t[2]+=e[i][0]*e[i][0],t[3]+=e[i][0]*e[i][1],t[4]+=e[i][1]*e[i][1]);var n=(i*t[3]-t[0]*t[1])/(i*t[2]-t[0]*t[0]);n=isNaN(n)?0:n;for(var a=t[1]/i-n*t[0]/i,s=0,o=e.length;s<o;s++){var l=[e[s][0],e[s][0]*n+a];r.push(l)}return{equation:[n,a],points:r,string:"y = "+Math.round(100*n)/100+"x + "+Math.round(100*a)/100}},exponential:function(e){var t=[0,0,0,0,0,0],i=0,r=[];for(l=e.length;i<l;i++)e[i][1]&&(t[0]+=e[i][0],t[1]+=e[i][1],t[2]+=e[i][0]*e[i][0]*e[i][1],t[3]+=e[i][1]*Math.log(e[i][1]),t[4]+=e[i][0]*e[i][1]*Math.log(e[i][1]),t[5]+=e[i][0]*e[i][1]);for(var n=t[1]*t[2]-t[5]*t[5],a=Math.pow(Math.E,(t[2]*t[3]-t[5]*t[4])/n),s=(t[1]*t[4]-t[5]*t[3])/n,o=0,l=e.length;o<l;o++){var c=[e[o][0],a*Math.pow(Math.E,s*e[o][0])];r.push(c)}return{equation:[a,s],points:r,string:"y = "+Math.round(100*a)/100+"e^("+Math.round(100*s)/100+"x)"}},logarithmic:function(e){var t=[0,0,0,0],i=0,r=[];for(o=e.length;i<o;i++)e[i][1]&&(t[0]+=Math.log(e[i][0]),t[1]+=e[i][1]*Math.log(e[i][0]),t[2]+=e[i][1],t[3]+=Math.pow(Math.log(e[i][0]),2));for(var n=(i*t[1]-t[2]*t[0])/(i*t[3]-t[0]*t[0]),a=(t[2]-n*t[0])/i,s=0,o=e.length;s<o;s++){var l=[e[s][0],a+n*Math.log(e[s][0])];r.push(l)}return{equation:[a,n],points:r,string:"y = "+Math.round(100*a)/100+" + "+Math.round(100*n)/100+" ln(x)"}},power:function(e){var t=[0,0,0,0],i=0,r=[];for(o=e.length;i<o;i++)e[i][1]&&(t[0]+=Math.log(e[i][0]),t[1]+=Math.log(e[i][1])*Math.log(e[i][0]),t[2]+=Math.log(e[i][1]),t[3]+=Math.pow(Math.log(e[i][0]),2));for(var n=(i*t[1]-t[2]*t[0])/(i*t[3]-t[0]*t[0]),a=Math.pow(Math.E,(t[2]-n*t[0])/i),s=0,o=e.length;s<o;s++){var l=[e[s][0],a*Math.pow(e[s][0],n)];r.push(l)}return{equation:[a,n],points:r,string:"y = "+Math.round(100*a)/100+"x^"+Math.round(100*n)/100}},polynomial:function(e,t){void 0===t&&(t=2);for(var i=[],r=[],n=[],a=0,s=0,o=0,l=t+1;o<l;o++){for(var c=0,d=e.length;c<d;c++)e[c][1]&&(a+=Math.pow(e[c][0],o)*e[c][1]);i.push(a),a=0;for(var u=[],h=0;h<l;h++){for(c=0,d=e.length;c<d;c++)e[c][1]&&(s+=Math.pow(e[c][0],o+h));u.push(s),s=0}r.push(u)}r.push(i);var f=function(e,t){var i=0,r=0,n=0,a=0,s=0,o=e.length-1,l=new Array(t);for(i=0;i<o;i++){for(a=i,r=i+1;r<o;r++)Math.abs(e[i][r])>Math.abs(e[i][a])&&(a=r);for(n=i;n<o+1;n++)s=e[n][i],e[n][i]=e[n][a],e[n][a]=s;for(r=i+1;r<o;r++)for(n=o;n>=i;n--)e[n][r]-=e[n][i]*e[i][r]/e[i][i]}for(r=o-1;r>=0;r--){for(s=0,n=r+1;n<o;n++)s+=e[n][r]*l[n];l[r]=(e[o][r]-s)/e[r][r]}return l}(r,l);for(o=0,d=e.length;o<d;o++){for(var p=0,g=0;g<f.length;g++)p+=f[g]*Math.pow(e[o][0],g);n.push([e[o][0],p])}var m="y = ";for(o=f.length-1;o>=0;o--)m+=o>1?Math.round(100*f[o])/100+"x^"+o+" + ":1==o?Math.round(100*f[o])/100+"x + ":Math.round(100*f[o])/100;return{equation:f,points:n,string:m}},lastvalue:function(e){for(var t=[],i=null,r=0;r<e.length;r++)e[r][1]?(i=e[r][1],t.push([e[r][0],e[r][1]])):t.push([e[r][0],i]);return{equation:[i],points:t,string:""+i}},loess:function(e){return{equation:"loess",points:(t=e,i=.5,r=t.map(function(e){return e[0]}),n=function(e,t,i){function r(e){var t=1-e*e*e;return t*t*t}for(var n=[],a=0,s=Math.floor(i*e.length)-1,o=0;o<e.length;o++){var l,c=e[o];o>0&&s<e.length-1&&e[s+1]-e[o]<e[o]-e[a]&&(a++,s++),l=e[o]-e[a]>e[s]-e[o]?a:s;for(var d=Math.abs(1/(e[l]-c)),u=0,h=0,f=0,p=0,g=0,m=a;m<=s;){var b=e[m],y=t[m],v=r((m<o?c-b:b-c)*d),x=b*v;u+=v,h+=x,f+=b*x,p+=y*v,g+=y*x,m++}var _,w=h/u,E=p/u,S=g/u,T=f/u,M=E-(_=T==w*w?0:(S-w*E)/(T-w*w))*w;n[o]=_*c+M}return n}(r,t.map(function(e){return e[1]}),i),r.map(function(e,t){return[e,n[t]]})),string:"loess"};var t,i,r,n}},function(e,t,i){if("string"==typeof e)return Lt[e](t,i)}),Ft=r.default.api.utils;function Dt(e){var t=Ft.defaults(e||{},{type:"linear",hideError:!1,showPanel:!0,showTrend:!0,models:["linear","exponential","logarithmic"]});return{init:function(e){if(this._chart=e,this._applicableElements=["ELEMENT.POINT","ELEMENT.LINE","ELEMENT.AREA","ELEMENT.INTERVAL"],this._isApplicable=this.checkIfApplicable(e),t.showPanel){this._container=e.insertToRightSidebar(this.containerTemplate);var i="applicable-true";this._isApplicable||(i="applicable-false",this._error=["Trend line can't be computed for categorical data.","Each axis should be either a measure or a date."].join(" ")),this._container.classList.add(i),t.hideError&&this._container.classList.add("hide-trendline-error"),this.uiChangeEventsDispatcher=function(e){var i=e.target,r=i.classList;r.contains("i-role-show-trend")&&(t.showTrend=i.checked),r.contains("i-role-change-model")&&(t.type=i.value),this._chart.refresh()}.bind(this),this._container.addEventListener("change",this.uiChangeEventsDispatcher,!1)}},checkIfApplicable:function(e){var t=this,i=e.getSpec(),r=!1;return e.traverseSpec(i,function(e,n){t.predicateIsApplicable(i,e,n)&&(r=!0)}),r},predicateIsApplicable:function(e,t,i){if(i&&"COORDS.RECT"!==i.type)return!1;if(i&&!i.units)return!1;if(-1===this._applicableElements.indexOf(t.type)||t.stack||"chart"!==t.namespace)return!1;var r=e.scales[t.x],n=e.scales[t.y];return!("ordinal"===r.type||"ordinal"===n.type)},onSpecReady:function(e,i){var n=this;if(t.showTrend){var a=r.default.api.tickPeriod,s=function(e){var t=a.get(e,{utc:i.settings.utcTime});return function(e){return t.cast(new Date(e))}};i.transformations=i.transformations||{},i.transformations.regression=function(e,t){var i=t.x.dim,r=t.y.dim,n=t.g.dim;const a=Boolean(t.x.period),o=Boolean(t.y.period);var l=a?s(t.x.period):function(e){return e},c=o?s(t.y.period):function(e){return e},d=e.map(function(e){return[Ft.isDate(e[i])?e[i].getTime():e[i],Ft.isDate(e[r])?e[r].getTime():e[r],e[n]]}),u=Ft.groupBy(d,function(e){return e[2]});return Object.keys(u).reduce(function(e,s){var d=u[s],h=Rt(t.type,d).points.filter(function(e){return null!==e[0]&&null!==e[1]}).sort(function(e,t){return e[0]-t[0]}).map(function(e){var t={};return t[i]=l(e[0]),t[r]=c(e[1]),n&&(t[n]=s),t});return h.length>1&&(a||o)&&(h=[h[0],h[h.length-1]]),e.concat(h.length>1?h:[])},[])},e.traverseSpec(i,function(e,r){if(n.predicateIsApplicable(i,e,r)){var a=i.scales[e.x],s=i.scales[e.y],o=i.scales[e.color]||{},l=JSON.parse(JSON.stringify(e));l.type="ELEMENT.LINE",l.size="size_null",l.namespace="trendline",l.transformation=l.transformation||[],l.transformation.push({type:"regression",args:{type:t.type,x:a,y:s,g:o}});l.guide=Ft.defaults({},l.guide||{}),l.guide.interpolate="linear",l.guide.showAnchors="never",l.guide.cssClass="tau-chart__trendline",l.guide.widthCssClass="tau-chart__line-width-1",l.guide.x=l.guide.x||{},l.guide.x.fillGaps=!1,delete l.guide.label,delete l.label,r.units.push(l)}})}},containerTemplate:'<div class="tau-chart__trendlinepanel"></div>',template:Ft.template(['<label class="tau-chart__trendlinepanel__title tau-chart__checkbox">','<input type="checkbox" class="tau-chart__checkbox__input i-role-show-trend" <%= showTrend %> />','<span class="tau-chart__checkbox__icon"></span>','<span class="tau-chart__checkbox__text">',"<%= title %>","</span>","</label>","<div>",'<select class="i-role-change-model tau-chart__select tau-chart__trendlinepanel__control">',"<%= models %>","</select>","</div>",'<div class="tau-chart__trendlinepanel__error-message"><%= error %></div>'].join("")),onRender:function(e){if(this._container){this._container.innerHTML=this.template({title:"Trend line",error:this._error,showTrend:t.showTrend&&this._isApplicable?"checked":"",models:t.models.map(function(e){return"<option "+(t.type===e?"selected":"")+' value="'+e+'">'+e+"</option>"})});var i=function(e){return function(){f.select(this).classed({active:e,"tau-chart__line-width-1":!e,"tau-chart__line-width-3":e})}};f.select(e.getSVG()).selectAll(".tau-chart__trendline").on("mouseenter",i(!0)).on("mouseleave",i(!1))}}}}r.default.api.plugins.add("trendline",Dt);var $t={YlGn:{3:["#f7fcb9","#addd8e","#31a354"],4:["#ffffcc","#c2e699","#78c679","#238443"],5:["#ffffcc","#c2e699","#78c679","#31a354","#006837"],6:["#ffffcc","#d9f0a3","#addd8e","#78c679","#31a354","#006837"],7:["#ffffcc","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#005a32"],8:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#005a32"],9:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"]},YlGnBu:{3:["#edf8b1","#7fcdbb","#2c7fb8"],4:["#ffffcc","#a1dab4","#41b6c4","#225ea8"],5:["#ffffcc","#a1dab4","#41b6c4","#2c7fb8","#253494"],6:["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#2c7fb8","#253494"],7:["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#0c2c84"],8:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#0c2c84"],9:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"]},GnBu:{3:["#e0f3db","#a8ddb5","#43a2ca"],4:["#f0f9e8","#bae4bc","#7bccc4","#2b8cbe"],5:["#f0f9e8","#bae4bc","#7bccc4","#43a2ca","#0868ac"],6:["#f0f9e8","#ccebc5","#a8ddb5","#7bccc4","#43a2ca","#0868ac"],7:["#f0f9e8","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#08589e"],8:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#08589e"],9:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"]},BuGn:{3:["#e5f5f9","#99d8c9","#2ca25f"],4:["#edf8fb","#b2e2e2","#66c2a4","#238b45"],5:["#edf8fb","#b2e2e2","#66c2a4","#2ca25f","#006d2c"],6:["#edf8fb","#ccece6","#99d8c9","#66c2a4","#2ca25f","#006d2c"],7:["#edf8fb","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#005824"],8:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#005824"],9:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"]},PuBuGn:{3:["#ece2f0","#a6bddb","#1c9099"],4:["#f6eff7","#bdc9e1","#67a9cf","#02818a"],5:["#f6eff7","#bdc9e1","#67a9cf","#1c9099","#016c59"],6:["#f6eff7","#d0d1e6","#a6bddb","#67a9cf","#1c9099","#016c59"],7:["#f6eff7","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016450"],8:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016450"],9:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"]},PuBu:{3:["#ece7f2","#a6bddb","#2b8cbe"],4:["#f1eef6","#bdc9e1","#74a9cf","#0570b0"],5:["#f1eef6","#bdc9e1","#74a9cf","#2b8cbe","#045a8d"],6:["#f1eef6","#d0d1e6","#a6bddb","#74a9cf","#2b8cbe","#045a8d"],7:["#f1eef6","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#034e7b"],8:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#034e7b"],9:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"]},BuPu:{3:["#e0ecf4","#9ebcda","#8856a7"],4:["#edf8fb","#b3cde3","#8c96c6","#88419d"],5:["#edf8fb","#b3cde3","#8c96c6","#8856a7","#810f7c"],6:["#edf8fb","#bfd3e6","#9ebcda","#8c96c6","#8856a7","#810f7c"],7:["#edf8fb","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#6e016b"],8:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#6e016b"],9:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"]},RdPu:{3:["#fde0dd","#fa9fb5","#c51b8a"],4:["#feebe2","#fbb4b9","#f768a1","#ae017e"],5:["#feebe2","#fbb4b9","#f768a1","#c51b8a","#7a0177"],6:["#feebe2","#fcc5c0","#fa9fb5","#f768a1","#c51b8a","#7a0177"],7:["#feebe2","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177"],8:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177"],9:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"]},PuRd:{3:["#e7e1ef","#c994c7","#dd1c77"],4:["#f1eef6","#d7b5d8","#df65b0","#ce1256"],5:["#f1eef6","#d7b5d8","#df65b0","#dd1c77","#980043"],6:["#f1eef6","#d4b9da","#c994c7","#df65b0","#dd1c77","#980043"],7:["#f1eef6","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#91003f"],8:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#91003f"],9:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"]},OrRd:{3:["#fee8c8","#fdbb84","#e34a33"],4:["#fef0d9","#fdcc8a","#fc8d59","#d7301f"],5:["#fef0d9","#fdcc8a","#fc8d59","#e34a33","#b30000"],6:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#e34a33","#b30000"],7:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"],8:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"],9:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"]},YlOrRd:{3:["#ffeda0","#feb24c","#f03b20"],4:["#ffffb2","#fecc5c","#fd8d3c","#e31a1c"],5:["#ffffb2","#fecc5c","#fd8d3c","#f03b20","#bd0026"],6:["#ffffb2","#fed976","#feb24c","#fd8d3c","#f03b20","#bd0026"],7:["#ffffb2","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],8:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],9:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"]},YlOrBr:{3:["#fff7bc","#fec44f","#d95f0e"],4:["#ffffd4","#fed98e","#fe9929","#cc4c02"],5:["#ffffd4","#fed98e","#fe9929","#d95f0e","#993404"],6:["#ffffd4","#fee391","#fec44f","#fe9929","#d95f0e","#993404"],7:["#ffffd4","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#8c2d04"],8:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#8c2d04"],9:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"]},Purples:{3:["#efedf5","#bcbddc","#756bb1"],4:["#f2f0f7","#cbc9e2","#9e9ac8","#6a51a3"],5:["#f2f0f7","#cbc9e2","#9e9ac8","#756bb1","#54278f"],6:["#f2f0f7","#dadaeb","#bcbddc","#9e9ac8","#756bb1","#54278f"],7:["#f2f0f7","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"],8:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"],9:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"]},Blues:{3:["#deebf7","#9ecae1","#3182bd"],4:["#eff3ff","#bdd7e7","#6baed6","#2171b5"],5:["#eff3ff","#bdd7e7","#6baed6","#3182bd","#08519c"],6:["#eff3ff","#c6dbef","#9ecae1","#6baed6","#3182bd","#08519c"],7:["#eff3ff","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],8:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],9:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"]},Greens:{3:["#e5f5e0","#a1d99b","#31a354"],4:["#edf8e9","#bae4b3","#74c476","#238b45"],5:["#edf8e9","#bae4b3","#74c476","#31a354","#006d2c"],6:["#edf8e9","#c7e9c0","#a1d99b","#74c476","#31a354","#006d2c"],7:["#edf8e9","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#005a32"],8:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#005a32"],9:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"]},Oranges:{3:["#fee6ce","#fdae6b","#e6550d"],4:["#feedde","#fdbe85","#fd8d3c","#d94701"],5:["#feedde","#fdbe85","#fd8d3c","#e6550d","#a63603"],6:["#feedde","#fdd0a2","#fdae6b","#fd8d3c","#e6550d","#a63603"],7:["#feedde","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#8c2d04"],8:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#8c2d04"],9:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"]},Reds:{3:["#fee0d2","#fc9272","#de2d26"],4:["#fee5d9","#fcae91","#fb6a4a","#cb181d"],5:["#fee5d9","#fcae91","#fb6a4a","#de2d26","#a50f15"],6:["#fee5d9","#fcbba1","#fc9272","#fb6a4a","#de2d26","#a50f15"],7:["#fee5d9","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#99000d"],8:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#99000d"],9:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"]},Greys:{3:["#f0f0f0","#bdbdbd","#636363"],4:["#f7f7f7","#cccccc","#969696","#525252"],5:["#f7f7f7","#cccccc","#969696","#636363","#252525"],6:["#f7f7f7","#d9d9d9","#bdbdbd","#969696","#636363","#252525"],7:["#f7f7f7","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525"],8:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525"],9:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"]},PuOr:{3:["#f1a340","#f7f7f7","#998ec3"],4:["#e66101","#fdb863","#b2abd2","#5e3c99"],5:["#e66101","#fdb863","#f7f7f7","#b2abd2","#5e3c99"],6:["#b35806","#f1a340","#fee0b6","#d8daeb","#998ec3","#542788"],7:["#b35806","#f1a340","#fee0b6","#f7f7f7","#d8daeb","#998ec3","#542788"],8:["#b35806","#e08214","#fdb863","#fee0b6","#d8daeb","#b2abd2","#8073ac","#542788"],9:["#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788"],10:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],11:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"]},BrBG:{3:["#d8b365","#f5f5f5","#5ab4ac"],4:["#a6611a","#dfc27d","#80cdc1","#018571"],5:["#a6611a","#dfc27d","#f5f5f5","#80cdc1","#018571"],6:["#8c510a","#d8b365","#f6e8c3","#c7eae5","#5ab4ac","#01665e"],7:["#8c510a","#d8b365","#f6e8c3","#f5f5f5","#c7eae5","#5ab4ac","#01665e"],8:["#8c510a","#bf812d","#dfc27d","#f6e8c3","#c7eae5","#80cdc1","#35978f","#01665e"],9:["#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e"],10:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],11:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"]},PRGn:{3:["#af8dc3","#f7f7f7","#7fbf7b"],4:["#7b3294","#c2a5cf","#a6dba0","#008837"],5:["#7b3294","#c2a5cf","#f7f7f7","#a6dba0","#008837"],6:["#762a83","#af8dc3","#e7d4e8","#d9f0d3","#7fbf7b","#1b7837"],7:["#762a83","#af8dc3","#e7d4e8","#f7f7f7","#d9f0d3","#7fbf7b","#1b7837"],8:["#762a83","#9970ab","#c2a5cf","#e7d4e8","#d9f0d3","#a6dba0","#5aae61","#1b7837"],9:["#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837"],10:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],11:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"]},PiYG:{3:["#e9a3c9","#f7f7f7","#a1d76a"],4:["#d01c8b","#f1b6da","#b8e186","#4dac26"],5:["#d01c8b","#f1b6da","#f7f7f7","#b8e186","#4dac26"],6:["#c51b7d","#e9a3c9","#fde0ef","#e6f5d0","#a1d76a","#4d9221"],7:["#c51b7d","#e9a3c9","#fde0ef","#f7f7f7","#e6f5d0","#a1d76a","#4d9221"],8:["#c51b7d","#de77ae","#f1b6da","#fde0ef","#e6f5d0","#b8e186","#7fbc41","#4d9221"],9:["#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221"],10:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],11:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"]},RdBu:{3:["#ef8a62","#f7f7f7","#67a9cf"],4:["#ca0020","#f4a582","#92c5de","#0571b0"],5:["#ca0020","#f4a582","#f7f7f7","#92c5de","#0571b0"],6:["#b2182b","#ef8a62","#fddbc7","#d1e5f0","#67a9cf","#2166ac"],7:["#b2182b","#ef8a62","#fddbc7","#f7f7f7","#d1e5f0","#67a9cf","#2166ac"],8:["#b2182b","#d6604d","#f4a582","#fddbc7","#d1e5f0","#92c5de","#4393c3","#2166ac"],9:["#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac"],10:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],11:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"]},RdGy:{3:["#ef8a62","#ffffff","#999999"],4:["#ca0020","#f4a582","#bababa","#404040"],5:["#ca0020","#f4a582","#ffffff","#bababa","#404040"],6:["#b2182b","#ef8a62","#fddbc7","#e0e0e0","#999999","#4d4d4d"],7:["#b2182b","#ef8a62","#fddbc7","#ffffff","#e0e0e0","#999999","#4d4d4d"],8:["#b2182b","#d6604d","#f4a582","#fddbc7","#e0e0e0","#bababa","#878787","#4d4d4d"],9:["#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d"],10:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],11:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"]},RdYlBu:{3:["#fc8d59","#ffffbf","#91bfdb"],4:["#d7191c","#fdae61","#abd9e9","#2c7bb6"],5:["#d7191c","#fdae61","#ffffbf","#abd9e9","#2c7bb6"],6:["#d73027","#fc8d59","#fee090","#e0f3f8","#91bfdb","#4575b4"],7:["#d73027","#fc8d59","#fee090","#ffffbf","#e0f3f8","#91bfdb","#4575b4"],8:["#d73027","#f46d43","#fdae61","#fee090","#e0f3f8","#abd9e9","#74add1","#4575b4"],9:["#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4"],10:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],11:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"]},Spectral:{3:["#fc8d59","#ffffbf","#99d594"],4:["#d7191c","#fdae61","#abdda4","#2b83ba"],5:["#d7191c","#fdae61","#ffffbf","#abdda4","#2b83ba"],6:["#d53e4f","#fc8d59","#fee08b","#e6f598","#99d594","#3288bd"],7:["#d53e4f","#fc8d59","#fee08b","#ffffbf","#e6f598","#99d594","#3288bd"],8:["#d53e4f","#f46d43","#fdae61","#fee08b","#e6f598","#abdda4","#66c2a5","#3288bd"],9:["#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd"],10:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],11:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"]},RdYlGn:{3:["#fc8d59","#ffffbf","#91cf60"],4:["#d7191c","#fdae61","#a6d96a","#1a9641"],5:["#d7191c","#fdae61","#ffffbf","#a6d96a","#1a9641"],6:["#d73027","#fc8d59","#fee08b","#d9ef8b","#91cf60","#1a9850"],7:["#d73027","#fc8d59","#fee08b","#ffffbf","#d9ef8b","#91cf60","#1a9850"],8:["#d73027","#f46d43","#fdae61","#fee08b","#d9ef8b","#a6d96a","#66bd63","#1a9850"],9:["#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850"],10:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],11:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"]},Accent:{3:["#7fc97f","#beaed4","#fdc086"],4:["#7fc97f","#beaed4","#fdc086","#ffff99"],5:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0"],6:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f"],7:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17"],8:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"]},Dark2:{3:["#1b9e77","#d95f02","#7570b3"],4:["#1b9e77","#d95f02","#7570b3","#e7298a"],5:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e"],6:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02"],7:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d"],8:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"]},Paired:{3:["#a6cee3","#1f78b4","#b2df8a"],4:["#a6cee3","#1f78b4","#b2df8a","#33a02c"],5:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99"],6:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c"],7:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f"],8:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00"],9:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6"],10:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a"],11:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99"],12:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"]},Pastel1:{3:["#fbb4ae","#b3cde3","#ccebc5"],4:["#fbb4ae","#b3cde3","#ccebc5","#decbe4"],5:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6"],6:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc"],7:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd"],8:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec"],9:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},Pastel2:{3:["#b3e2cd","#fdcdac","#cbd5e8"],4:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4"],5:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9"],6:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae"],7:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc"],8:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"]},Set1:{3:["#e41a1c","#377eb8","#4daf4a"],4:["#e41a1c","#377eb8","#4daf4a","#984ea3"],5:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00"],6:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33"],7:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628"],8:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf"],9:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"]},Set2:{3:["#66c2a5","#fc8d62","#8da0cb"],4:["#66c2a5","#fc8d62","#8da0cb","#e78ac3"],5:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854"],6:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f"],7:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494"],8:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"]},Set3:{3:["#8dd3c7","#ffffb3","#bebada"],4:["#8dd3c7","#ffffb3","#bebada","#fb8072"],5:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3"],6:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462"],7:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69"],8:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5"],9:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9"],10:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd"],11:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5"],12:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"]}},zt=function(e,t){return $t[e][t].map(function(i,r){return e+" q"+r+"-"+t})};r.default.api.colorBrewers.add("tauBrewer",zt);i.d(t,"GPL",function(){return Bt}),i.d(t,"Plot",function(){return It}),i.d(t,"Chart",function(){return jt}),i.d(t,"api",function(){return Vt}),i.d(t,"version",function(){return Ht});const{GPL:Bt,Plot:It,Chart:jt,api:Vt,version:Ht}=r.default}])});