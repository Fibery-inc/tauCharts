/*!
 * /*
 * taucharts@2.7.0 (2019-03-08)
 * Copyright 2019 Targetprocess, Inc.
 * Licensed under Apache License 2.0
 * * /
 * 
 */
!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e(require("taucharts"),require("d3-selection"));else if("function"==typeof define&&define.amd)define(["taucharts","d3-selection"],e);else{var i="object"==typeof exports?e(require("taucharts"),require("d3-selection")):e(t.Taucharts,t.d3);for(var s in i)("object"==typeof exports?exports:t)[s]=i[s]}}(window,function(t,e){return function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=35)}({0:function(e,i){e.exports=t},1:function(t,i){t.exports=e},2:function(t,e,i){"use strict";i.d(e,"a",function(){return s}),i.d(e,"b",function(){return n});const s="tau-chart__tooltip";function n(t,e){return{render(t){return this.args=t,t=Object.assign({},t,{fields:this.filterFields(t.fields)}),this.rootTemplate(t)},rootTemplate(t){return[`<div class="${s}__buttons ${s}__clickable">`,this.buttonsTemplate(),"</div>",`<div class="i-role-content ${s}__content">`,this.contentTemplate(t),"</div>"].join("\n")},contentTemplate(t){return this.fieldsTemplate(t)},filterFields:t=>t,getLabel:e=>t.getFieldLabel(e),getFormatter:e=>t.getFieldFormat(e),fieldsTemplate({data:t,fields:e}){return e.map(e=>this.itemTemplate({data:t,field:e})).join("\n")},itemTemplate({data:t,field:e}){const i=this.getLabel(e),n=this.getFormatter(e)(t[e]);return[`<div class="${s}__list__item">`,`  <div class="${s}__list__elem">${i}</div>`,`  <div class="${s}__list__elem">${n}</div>`,"</div>"].join("\n")},buttonsTemplate(){return[this.buttonTemplate({cls:"i-role-exclude",text:"Exclude",icon:()=>'<span class="tau-icon-close-gray"></span>'})].join("\n")},buttonTemplate:({icon:t,text:e,cls:i})=>[`<div class="${s}__button ${i}">`,`  <div class="${s}__button__wrap">`,`    ${t?`${t()} `:""}${e}`,"  </div>","</div>"].join("\n"),didMount(){const e=t.getDomNode().querySelector(".i-role-exclude");e&&e.addEventListener("click",()=>{t.excludeHighlightedElement(),t.setState({highlight:null,isStuck:!1})})}}}},3:function(t,e,i){"use strict";i.d(e,"a",function(){return d});var s=i(0),n=i.n(s),a=i(1),o=i(2);const l=n.a.api.utils,r=n.a.api.domUtils,c=n.a.api.pluginsSDK,h="tau-chart__tooltip";class d{constructor(t){this.settings=l.defaults(t||{},{align:"bottom-right",clickable:!0,clsClickable:`${h}__clickable`,clsStuck:"stuck",clsTarget:`${h}-target`,escapeHtml:!0,fields:null,formatters:{},getTemplate:null,spacing:24,winBound:12,onExclude:()=>{}}),this.onRender=this._getRenderHandler()}init(t){this._chart=t,this._tooltip=this._chart.addBalloon({spacing:this.settings.spacing,winBound:this.settings.winBound,auto:!0,effectClass:"fade"}),this._initDomEvents(),this.state={highlight:null,isStuck:!1},this.setState(this.state),this._template=this._getTemplate()}_getTemplate(){const t=Object(o.b)(this,this.settings);return"function"==typeof this.settings.getTemplate?this.settings.getTemplate(t,this,this.settings):t}_renderTemplate(t,e){return this._template.render({data:t,fields:e})}_initDomEvents(){this._scrollHandler=(()=>{this.setState({highlight:null,isStuck:!1})}),window.addEventListener("scroll",this._scrollHandler,!0),this.settings.clickable&&(this._outerClickHandler=(t=>{const e=Array.from(document.querySelectorAll(`.${this.settings.clsClickable}`)).concat(this.getDomNode()).map(t=>t.getBoundingClientRect()),i=Math.min(...e.map(t=>t.top)),s=Math.min(...e.map(t=>t.left)),n=Math.max(...e.map(t=>t.right)),a=Math.max(...e.map(t=>t.bottom));(t.clientX<s||t.clientX>n||t.clientY<i||t.clientY>a)&&this.setState({highlight:null,isStuck:!1})}))}getDomNode(){return this._tooltip.getElement()}setState(t){const e=this.settings,i=this.state,s=this.state=Object.assign({},i,t);i.highlight=i.highlight||{data:null,cursor:null,unit:null},s.highlight=s.highlight||{data:null,cursor:null,unit:null},s.isStuck&&i.highlight.data&&(s.highlight=i.highlight),s.highlight.data!==i.highlight.data&&(s.highlight.data?(this._hideTooltip(),this._showTooltip(s.highlight.data,s.highlight.cursor),this._setTargetSvgClass(!0),requestAnimationFrame(()=>{this._setTargetSvgClass(!0)})):s.isStuck||!i.highlight.data||s.highlight.data||(this._removeFocus(),this._hideTooltip(),this._setTargetSvgClass(!1))),!s.highlight.data||i.highlight.cursor&&s.highlight.cursor.x===i.highlight.cursor.x&&s.highlight.cursor.y===i.highlight.cursor.y||(this._tooltip.position(s.highlight.cursor.x,s.highlight.cursor.y),this._tooltip.updateSize());const n=this.getDomNode();this.settings.clickable&&s.isStuck!==i.isStuck&&(s.isStuck?(window.addEventListener("click",this._outerClickHandler,!0),n.classList.add(e.clsStuck),this._setTargetEventsEnabled(!1),this._accentFocus(s.highlight.data),this._tooltip.updateSize()):(window.removeEventListener("click",this._outerClickHandler,!0),n.classList.remove(e.clsStuck),requestAnimationFrame(()=>{this._setTargetEventsEnabled(!0);const t=this._chart.getSVG();t&&r.dispatchMouseEvent(t,"mouseleave")})))}_showTooltip(t,e){const i=this.settings,s=i.fields||"function"==typeof i.getFields&&i.getFields(this._chart)||Object.keys(t),n=this._renderTemplate(t,s);this._tooltip.content(n).position(e.x,e.y).place(i.align).show().updateSize(),this._template.didMount&&this._template.didMount()}_hideTooltip(){window.removeEventListener("click",this._outerClickHandler,!0),this._template.willUnmount&&this._template.willUnmount(),this._tooltip.hide()}destroy(){window.removeEventListener("scroll",this._scrollHandler,!0),this._setTargetSvgClass(!1),this.setState({highlight:null,isStuck:!1}),this._tooltip.destroy()}_subscribeToHover(){var t=["ELEMENT.LINE","ELEMENT.AREA","ELEMENT.PATH","ELEMENT.INTERVAL","ELEMENT.INTERVAL.STACKED","ELEMENT.POINT"];this._chart.select(e=>t.indexOf(e.config.type)>=0).forEach(t=>{t.on("data-hover",(t,e)=>{var i=document.body.getBoundingClientRect();this.setState({highlight:e.data?{data:e.data,cursor:{x:e.event.clientX-i.left,y:e.event.clientY-i.top},unit:e.unit}:null})}),this.settings.clickable&&t.on("data-click",(t,e)=>{const i=document.body.getBoundingClientRect();this.setState(e.data?{highlight:{data:e.data,cursor:{x:e.event.clientX-i.left,y:e.event.clientY-i.top},unit:e.unit},isStuck:!0}:{highlight:null,isStuck:null})})})}getFieldFormat(t){const e=this._formatters[t]?this._formatters[t].format:t=>String(t);return this.settings.escapeHtml?t=>l.escapeHtml(e(t)):e}getFieldLabel(t){const e=this._formatters[t]?this._formatters[t].label:t;return this.settings.escapeHtml?l.escapeHtml(e):e}_accentFocus(t){const e=e=>e===t;this._chart.select(()=>!0).forEach(t=>{t.fire("highlight",e)})}_removeFocus(){const t=()=>null;this._chart.select(()=>!0).forEach(e=>{e.fire("highlight",t),e.fire("highlight-data-points",t)})}excludeHighlightedElement(){const t=this.state.highlight.data;this._chart.addFilter({tag:"exclude",predicate:e=>e!==t}),this.settings.onExclude(t),this._chart.refresh()}_getRenderHandler(){return function(){this._formatters=c.getFieldFormatters(this._chart.getSpec(),this.settings.formatters),this._subscribeToHover(),this.setState({highlight:null,isStuck:!1})}}_setTargetSvgClass(t){a.select(this._chart.getSVG()).classed(this.settings.clsTarget,t)}_setTargetEventsEnabled(t){t?this._chart.enablePointerEvents():this._chart.disablePointerEvents()}}},35:function(t,e,i){"use strict";i.r(e);var s=i(0),n=i.n(s),a=i(3),o=i(2);const l="diff-tooltip",r=`${l}__item`,c=`${l}__header`;function h(t,e){const i=Object(o.b)(t,e);return Object.assign({},i,{hasColor(){const{colorField:t}=this.args;return null!=t},contentTemplate(t){return[this.fieldsTemplate(t),this.tableTemplate(t)].join("\n")},filterFields(e){const s=t.state.highlight.unit.screenModel,{scaleColor:n,scaleX:a,scaleY:o}=s.model,l=e.filter(t=>t!==n.dim&&t!==a.dim&&t!==o.dim),r=()=>l.push(a.dim);return this.shouldShowColorTable()?r():(r(),(()=>n.dim&&l.push(n.dim))(),(()=>l.push(o.dim))()),i.filterFields.call(this,l)},itemTemplate({data:t,field:e}){const i=this.getLabel(e),s=this.getFormatter(e)(t[e]),n=this.args.prev,a=(this.args.valueField,this.shouldShowDiff(e)),l=[`<span class="${r}__value">`,`${s}`,a?` ${this.fieldUpdownTemplate(this.getDiff({data:t,prev:n,field:e}))}`:"","</span>"].join("");return[`<div class="${o.a}__list__item">`,`  <div class="${o.a}__list__elem">${i}</div>`,`  ${l}`,"</div>"].join("\n")},shouldShowDiff(t){return t===this.args.valueField},getDiff({data:t,prev:e,field:i}){const s=this.getFormatter(i),n=(t?t[i]:0)-(e?e[i]:0);return{diff:s(n),sign:Math.sign(n)}},fieldUpdownTemplate({diff:t,sign:e}){const i=`${l}__field__updown`;return[`<span class="${i} ${`${i}_${e>0?"positive":"negative"}`}">`,`${e>0?"&#x25B2;":e<0?"&#x25BC;":""}${0===e?"":t}`,"</span>"].join("")},shouldShowColorTable(){const t=this.args.groups;return this.hasColor()&&t.length>1},tableTemplate(t){return this.shouldShowColorTable()?[`<div class="${l}__table">`,this.tableHeaderTemplate(t),this.tableBodyTemplate(t),"</div>"].join("\n"):""},tableHeaderTemplate({colorField:t,valueField:e}){const i=this.getLabel(t),s=this.getLabel(e);return[`<div class="${c}">`,`  <span class="${c}__text">${i}</span>`,`  <span class="${c}__value">${s}</span>`,`  <span class="${c}__updown">&#x25BC;&#x25B2;</span>`,"</div>"].join("\n")},tableBodyTemplate({data:t,groups:e,valueField:i,colorField:s}){const n=t,a=e.map(({data:t})=>t?t[i]:0),o=Math.min(...a),r=Math.max(...a);return[`<div class="${l}__body">`,`<div class="${l}__body__content">`,e.map(({data:t,prev:e})=>this.tableRowTemplate({data:t,prev:e,highlighted:n,valueField:i,colorField:s,min:o,max:r})).join("\n"),"</div>","</div>"].join("\n")},tableRowTemplate({data:t,prev:e,highlighted:i,valueField:s,colorField:n,min:a,max:o}){const l=t?t[s]:0,c=this.getFormatter(n)((t||e)[n]),h=this.getFormatter(s)(l),d=t===i,{diff:u,sign:g}=this.getDiff({data:t,prev:e,field:s}),{color:p,colorCls:_}=this.getColor(t||e);return[`<div class="${r}${d?` ${r}_highlighted`:""}">`,`  ${this.valueBarTemplate({min:a,max:o,v:l,color:p,colorCls:_})}`,`  <span class="${r}__text">${c}</span>`,`  <span class="${r}__value">${h}</span>`,`  ${this.updownTemplate({diff:u,sign:g})}`,"</div>"].join("\n")},valueBarTemplate({min:t,max:e,v:i,color:s,colorCls:n}){t=Math.min(t,0);const a=(e=Math.max(0,e))-t;return["<span",`    class="${r}__bg${n?` ${n}`:""}"`,`    style="left: ${100*(0===a?0:(i<0?i-t:-t)/a)}%; width: ${100*(0===a?0:(i<0?-i:i)/a)}%; background-color: ${s};"`,"    ></span>"].join("\n")},getColor(e){const i=t.state.highlight.unit.screenModel;return{color:i.color(e),colorCls:i.class(e)}},updownTemplate({diff:t,sign:e}){const i=`${r}__updown`;return[`<span class="${i} ${`${i}_${e>0?"positive":"negative"}`}">`,`${e>0?"&#x25B2;":e<0?"&#x25BC;":""}${0===e?"":t}`,"</span>"].join("")},didMount(){i.didMount.call(this),this._scrollToHighlighted(),this._reserveSpaceForUpdown()},_scrollToHighlighted(){const e=t.getDomNode(),i=e.querySelector(`.${l}__body`),s=e.querySelector(`.${l}__body__content`),n=e.querySelector(`.${r}_highlighted`);if(!(i&&s&&n))return;const a=i.getBoundingClientRect(),o=s.getBoundingClientRect(),c=n.getBoundingClientRect();var h=0;if(c.bottom>a.bottom){const t=c.bottom-a.bottom+c.height,e=o.bottom-a.bottom;h=-Math.min(t,e),s.style.transform=`translateY(${h}px)`}o.top+h<a.top&&i.classList.add(`${l}__body_overflow-top`),o.bottom+h>a.bottom&&i.classList.add(`${l}__body_overflow-bottom`)},_reserveSpaceForUpdown(){const e=t.getDomNode(),i=e.querySelector(`.${l}__body`),s=e.querySelector(`.${c}`);if(!i||!s)return;const n=`.${r}__updown:not(:empty)`,a=Array.from(e.querySelectorAll(n)).map(t=>t.scrollWidth),o=Math.max(...a),h=Math.max(0,Math.ceil(o-15));i.style.paddingRight=`${h}px`,s.style.paddingRight=`${h}px`}})}var d=i(1);const u=n.a.api.utils,g="ELEMENT.INTERVAL_HIGHLIGHT";var p={draw(){const t=this.node().config;this._container=t.options.slot(t.uid)},addInteraction(){this.node().on("interval-highlight",(t,e)=>{this._drawRange(e)})},_drawRange(t){const e=this.node(),i=e.config,s=e.screenModel.flip,n=this._container,a="interval-highlight",o=`${a}__gradient`,l=t?t[0]:null,r=t?t[1]:null,c=s?i.options.width:i.options.height;u.take(function(){const e=n.selectAll(`.${a}`).data(t?[1]:[]);e.exit().remove();const i=e.enter().append("g").attr("class",a).attr("pointer-events","none");return{g:e,gEnter:i}}()).then(e=>{!function(){const e=`${a}__defs`,l=`${a}__gradient-start`,r=`${a}__gradient-end`;for(var c=n.node();"svg"!==(c=c.parentNode).tagName;);const h=`${e}__${i.uid}`,u=d.select(c).selectAll(`#${h}`).data(t?[1]:[]);u.exit().remove();const g=u.enter().append("defs").attr("class",e).attr("id",h).append("linearGradient").attr("id",o).attr("x1","0%").attr("y1",s?"100%":"0%").attr("x2",s?"0%":"100%").attr("y2","0%");g.append("stop").attr("class",l).attr("offset","0%"),g.append("stop").attr("class",r).attr("offset","100%")}(),function({g:t,gEnter:e}){const i=`${a}__range`,n=t.select(`.${i}`),h=e.append("rect").attr("class",i).attr("fill",`url(#${o})`),{x:d,y:u,width:g,height:p}=s?{x:0,y:r,width:c,height:l-r}:{x:l,y:0,width:r-l,height:c};h.merge(n).attr("x",d).attr("y",u).attr("width",Math.abs(g)).attr("height",Math.abs(p))}(e),function({g:t,gEnter:e}){const i=`${a}__range-start`,n=t.select(`.${i}`),o=e.append("line").attr("class",i),{x1:r,y1:h,x2:d,y2:u}=s?{x1:0,y1:l,x2:c,y2:l}:{x1:l,y1:0,x2:l,y2:c};o.merge(n).attr("x1",r).attr("y1",h).attr("x2",d).attr("y2",u)}(e),function({g:t,gEnter:e}){const i=`${a}__range-end`,n=t.select(`.${i}`),o=e.append("line").attr("class",i),{x1:l,y1:h,x2:d,y2:u}=s?{x1:0,y1:r,x2:c,y2:r}:{x1:r,y1:0,x2:r,y2:c};o.merge(n).attr("x1",l).attr("y1",h).attr("x2",d).attr("y2",u)}(e)})}};const _=n.a.api.utils;class m extends a.a{constructor(t){super(t),this.onSpecReady=this._getSpecReadyHandler()}init(t){super.init(t),this._unitsGroupedData=new Map}_getTemplate(){const t=h(this,this.settings);return"function"==typeof this.settings.getTemplate?this.settings.getTemplate(t,this,this.settings):t}_renderTemplate(t,e){const i=this.state.highlight.unit,s=i.screenModel,{scaleColor:n,scaleX:a,scaleY:o}=s.model,l=this._unitsGroupedData.get(i),[r,c]=this._getHighlightRange(t,i),h=t=>{const e=s.model.color(t);return isFinite(r)&&l[r][e]?l[r][e][0]:null},d=h(t),u=i.config.stack,g=!(!i.config.flip&&i.config.guide.obsoleteVerticalStackOrder&&i.config.stack),p=(()=>{const t=n.domain().slice().reduce((t,e,i)=>(t[e]=i,t),{});return g?(e,i)=>t[e[n.dim]]-t[i[n.dim]]:(e,i)=>t[i[n.dim]]-t[e[n.dim]]})(),_=g?(t,e)=>o(t[o.dim])-o(e[o.dim]):(t,e)=>o(e[o.dim])-o(t[o.dim]),m=t=>Object.keys(l[t]).reduce((e,i)=>e.concat(l[t][i]),[]).sort(u?p:_),f=m(c).map(t=>{s.model.color(t);return{data:t,prev:h(t)}});if(isFinite(r)){const t=m(r),e=f.reduce((t,e)=>(t[s.model.color(e.data)]=!0,t),{});t.forEach(t=>{const i=s.model.color(t);e[i]||f.push({data:null,prev:t})}),u&&f.sort((t,e)=>p(t.data||t.prev,e.data||e.prev))}return this._template.render({data:t,prev:d,fields:e,groups:f,valueField:o.dim,colorField:n.dim})}_getRenderHandler(){const t=super._getRenderHandler();return function(){t.call(this);const e=this._chart,i=e.select(t=>"chart"===t.config.namespace&&0===t.config.type.indexOf("ELEMENT.")&&t.config.type!==g),s=e.select(t=>t.config.type===g).reduce((t,e,i)=>(t[i]=e,t),{});i.forEach((t,e)=>{const i=t.data();this._unitsGroupedData.set(t,this._getGroupedData(i,t)),t.on("data-hover",(i,n)=>{const a=s[e],o=n.unit&&n.unit===t?this._getHighlightRange(n.data,n.unit):null;a.fire("interval-highlight",o)})})}}_getSpecReadyHandler(){return function(t,e){t.traverseSpec(e,(t,e)=>{if(0!==t.type.indexOf("ELEMENT."))return;const i=JSON.parse(JSON.stringify(t));i.type=g,i.namespace="highlight";const s=e.units.indexOf(t);e.units.splice(s,0,i)})}}_getGroupedData(t,e){const i=e.screenModel.model.scaleX,s=_.groupBy(t,t=>i(t[i.dim]).toString()),a=e.config.guide.x.tickPeriod||e.config.guide.x.timeInterval;if(a){const t=i.domain(),o=e.config.guide.utcTime;n.a.api.tickPeriod.generate(t[0],t[1],a,{utc:o}).filter(e=>e>=t[0]&&e<=t[1]).forEach(t=>{const e=i(t);s[e]||(s[e]=[])})}return Object.keys(s).reduce((t,i)=>(t[i]=_.groupBy(s[i],t=>e.screenModel.model.color(t)),t),{})}_getHighlightRange(t,e){const i=e.screenModel.flip,s=e.screenModel.model.scaleX,n=s(t[s.dim]),a=this._unitsGroupedData.get(e),o=Object.keys(a).map(Number).sort(i?(t,e)=>e-t:(t,e)=>t-e),l=o.indexOf(n);return 0===l?[n,n]:[o[l-1],n]}}function f(t){return new m(t)}n.a.api.unitsRegistry.reg(g,p,"ELEMENT.GENERIC.CARTESIAN"),n.a.api.plugins.add("diff-tooltip",f);e.default=f}})});