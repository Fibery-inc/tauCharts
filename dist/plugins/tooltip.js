/*!
 * /*
 * taucharts@2.7.0 (2019-03-08)
 * Copyright 2019 Targetprocess, Inc.
 * Licensed under Apache License 2.0
 * * /
 * 
 */
!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e(require("taucharts"),require("d3-selection"));else if("function"==typeof define&&define.amd)define(["taucharts","d3-selection"],e);else{var i="object"==typeof exports?e(require("taucharts"),require("d3-selection")):e(t.Taucharts,t.d3);for(var s in i)("object"==typeof exports?exports:t)[s]=i[s]}}(window,function(t,e){return function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=33)}({0:function(e,i){e.exports=t},1:function(t,i){t.exports=e},2:function(t,e,i){"use strict";i.d(e,"a",function(){return s}),i.d(e,"b",function(){return n});const s="tau-chart__tooltip";function n(t,e){return{render(t){return this.args=t,t=Object.assign({},t,{fields:this.filterFields(t.fields)}),this.rootTemplate(t)},rootTemplate(t){return[`<div class="${s}__buttons ${s}__clickable">`,this.buttonsTemplate(),"</div>",`<div class="i-role-content ${s}__content">`,this.contentTemplate(t),"</div>"].join("\n")},contentTemplate(t){return this.fieldsTemplate(t)},filterFields:t=>t,getLabel:e=>t.getFieldLabel(e),getFormatter:e=>t.getFieldFormat(e),fieldsTemplate({data:t,fields:e}){return e.map(e=>this.itemTemplate({data:t,field:e})).join("\n")},itemTemplate({data:t,field:e}){const i=this.getLabel(e),n=this.getFormatter(e)(t[e]);return[`<div class="${s}__list__item">`,`  <div class="${s}__list__elem">${i}</div>`,`  <div class="${s}__list__elem">${n}</div>`,"</div>"].join("\n")},buttonsTemplate(){return[this.buttonTemplate({cls:"i-role-exclude",text:"Exclude",icon:()=>'<span class="tau-icon-close-gray"></span>'})].join("\n")},buttonTemplate:({icon:t,text:e,cls:i})=>[`<div class="${s}__button ${i}">`,`  <div class="${s}__button__wrap">`,`    ${t?`${t()} `:""}${e}`,"  </div>","</div>"].join("\n"),didMount(){const e=t.getDomNode().querySelector(".i-role-exclude");e&&e.addEventListener("click",()=>{t.excludeHighlightedElement(),t.setState({highlight:null,isStuck:!1})})}}}},3:function(t,e,i){"use strict";i.d(e,"a",function(){return u});var s=i(0),n=i.n(s),l=i(1),a=i(2);const o=n.a.api.utils,r=n.a.api.domUtils,h=n.a.api.pluginsSDK,c="tau-chart__tooltip";class u{constructor(t){this.settings=o.defaults(t||{},{align:"bottom-right",clickable:!0,clsClickable:`${c}__clickable`,clsStuck:"stuck",clsTarget:`${c}-target`,escapeHtml:!0,fields:null,formatters:{},getTemplate:null,spacing:24,winBound:12,onExclude:()=>{}}),this.onRender=this._getRenderHandler()}init(t){this._chart=t,this._tooltip=this._chart.addBalloon({spacing:this.settings.spacing,winBound:this.settings.winBound,auto:!0,effectClass:"fade"}),this._initDomEvents(),this.state={highlight:null,isStuck:!1},this.setState(this.state),this._template=this._getTemplate()}_getTemplate(){const t=Object(a.b)(this,this.settings);return"function"==typeof this.settings.getTemplate?this.settings.getTemplate(t,this,this.settings):t}_renderTemplate(t,e){return this._template.render({data:t,fields:e})}_initDomEvents(){this._scrollHandler=(()=>{this.setState({highlight:null,isStuck:!1})}),window.addEventListener("scroll",this._scrollHandler,!0),this.settings.clickable&&(this._outerClickHandler=(t=>{const e=Array.from(document.querySelectorAll(`.${this.settings.clsClickable}`)).concat(this.getDomNode()).map(t=>t.getBoundingClientRect()),i=Math.min(...e.map(t=>t.top)),s=Math.min(...e.map(t=>t.left)),n=Math.max(...e.map(t=>t.right)),l=Math.max(...e.map(t=>t.bottom));(t.clientX<s||t.clientX>n||t.clientY<i||t.clientY>l)&&this.setState({highlight:null,isStuck:!1})}))}getDomNode(){return this._tooltip.getElement()}setState(t){const e=this.settings,i=this.state,s=this.state=Object.assign({},i,t);i.highlight=i.highlight||{data:null,cursor:null,unit:null},s.highlight=s.highlight||{data:null,cursor:null,unit:null},s.isStuck&&i.highlight.data&&(s.highlight=i.highlight),s.highlight.data!==i.highlight.data&&(s.highlight.data?(this._hideTooltip(),this._showTooltip(s.highlight.data,s.highlight.cursor),this._setTargetSvgClass(!0),requestAnimationFrame(()=>{this._setTargetSvgClass(!0)})):s.isStuck||!i.highlight.data||s.highlight.data||(this._removeFocus(),this._hideTooltip(),this._setTargetSvgClass(!1))),!s.highlight.data||i.highlight.cursor&&s.highlight.cursor.x===i.highlight.cursor.x&&s.highlight.cursor.y===i.highlight.cursor.y||(this._tooltip.position(s.highlight.cursor.x,s.highlight.cursor.y),this._tooltip.updateSize());const n=this.getDomNode();this.settings.clickable&&s.isStuck!==i.isStuck&&(s.isStuck?(window.addEventListener("click",this._outerClickHandler,!0),n.classList.add(e.clsStuck),this._setTargetEventsEnabled(!1),this._accentFocus(s.highlight.data),this._tooltip.updateSize()):(window.removeEventListener("click",this._outerClickHandler,!0),n.classList.remove(e.clsStuck),requestAnimationFrame(()=>{this._setTargetEventsEnabled(!0);const t=this._chart.getSVG();t&&r.dispatchMouseEvent(t,"mouseleave")})))}_showTooltip(t,e){const i=this.settings,s=i.fields||"function"==typeof i.getFields&&i.getFields(this._chart)||Object.keys(t),n=this._renderTemplate(t,s);this._tooltip.content(n).position(e.x,e.y).place(i.align).show().updateSize(),this._template.didMount&&this._template.didMount()}_hideTooltip(){window.removeEventListener("click",this._outerClickHandler,!0),this._template.willUnmount&&this._template.willUnmount(),this._tooltip.hide()}destroy(){window.removeEventListener("scroll",this._scrollHandler,!0),this._setTargetSvgClass(!1),this.setState({highlight:null,isStuck:!1}),this._tooltip.destroy()}_subscribeToHover(){var t=["ELEMENT.LINE","ELEMENT.AREA","ELEMENT.PATH","ELEMENT.INTERVAL","ELEMENT.INTERVAL.STACKED","ELEMENT.POINT"];this._chart.select(e=>t.indexOf(e.config.type)>=0).forEach(t=>{t.on("data-hover",(t,e)=>{var i=document.body.getBoundingClientRect();this.setState({highlight:e.data?{data:e.data,cursor:{x:e.event.clientX-i.left,y:e.event.clientY-i.top},unit:e.unit}:null})}),this.settings.clickable&&t.on("data-click",(t,e)=>{const i=document.body.getBoundingClientRect();this.setState(e.data?{highlight:{data:e.data,cursor:{x:e.event.clientX-i.left,y:e.event.clientY-i.top},unit:e.unit},isStuck:!0}:{highlight:null,isStuck:null})})})}getFieldFormat(t){const e=this._formatters[t]?this._formatters[t].format:t=>String(t);return this.settings.escapeHtml?t=>o.escapeHtml(e(t)):e}getFieldLabel(t){const e=this._formatters[t]?this._formatters[t].label:t;return this.settings.escapeHtml?o.escapeHtml(e):e}_accentFocus(t){const e=e=>e===t;this._chart.select(()=>!0).forEach(t=>{t.fire("highlight",e)})}_removeFocus(){const t=()=>null;this._chart.select(()=>!0).forEach(e=>{e.fire("highlight",t),e.fire("highlight-data-points",t)})}excludeHighlightedElement(){const t=this.state.highlight.data;this._chart.addFilter({tag:"exclude",predicate:e=>e!==t}),this.settings.onExclude(t),this._chart.refresh()}_getRenderHandler(){return function(){this._formatters=h.getFieldFormatters(this._chart.getSpec(),this.settings.formatters),this._subscribeToHover(),this.setState({highlight:null,isStuck:!1})}}_setTargetSvgClass(t){l.select(this._chart.getSVG()).classed(this.settings.clsTarget,t)}_setTargetEventsEnabled(t){t?this._chart.enablePointerEvents():this._chart.disablePointerEvents()}}},33:function(t,e,i){"use strict";i.r(e);var s=i(0),n=i.n(s),l=i(3);function a(t){return new l.a(t)}n.a.api.plugins.add("tooltip",a),e.default=a}})});