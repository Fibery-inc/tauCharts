/*!
 * /*
 * taucharts@2.7.0 (2019-03-08)
 * Copyright 2019 Targetprocess, Inc.
 * Licensed under Apache License 2.0
 * * /
 * 
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("d3-selection"),require("d3-array"),require("d3-scale"),require("topojson-client"),require("d3-transition"),require("d3-format"),require("d3-time-format"),require("d3-brush"),require("d3-color"),require("d3-axis"),require("d3-geo"),require("d3-quadtree"),require("d3-shape"),require("d3-time")):"function"==typeof define&&define.amd?define(["d3-selection","d3-array","d3-scale","topojson-client","d3-transition","d3-format","d3-time-format","d3-brush","d3-color","d3-axis","d3-geo","d3-quadtree","d3-shape","d3-time"],t):"object"==typeof exports?exports.Taucharts=t(require("d3-selection"),require("d3-array"),require("d3-scale"),require("topojson-client"),require("d3-transition"),require("d3-format"),require("d3-time-format"),require("d3-brush"),require("d3-color"),require("d3-axis"),require("d3-geo"),require("d3-quadtree"),require("d3-shape"),require("d3-time")):e.Taucharts=t(e.d3,e.d3,e.d3,e.topojson,e.d3,e.d3,e.d3,e.d3,e.d3,e.d3,e.d3,e.d3,e.d3,e.d3)}(window,function(e,t,i,r,n,a,s,o,l,c,u,d,h,g){return function(e){var t={};function i(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(r,n,function(t){return e[t]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=20)}([function(t,i){t.exports=e},function(e,t,i){"use strict";i.r(t);var r={};i.r(r),i.d(r,"translate",function(){return S}),i.d(r,"rotate",function(){return M}),i.d(r,"getOrientation",function(){return k}),i.d(r,"parseTransformTranslate",function(){return E}),i.d(r,"isIntersect",function(){return A}),i.d(r,"getDeepTransformTranslate",function(){return T}),i.d(r,"raiseElements",function(){return O});var n={};i.r(n),i.d(n,"traverseJSON",function(){return Me}),i.d(n,"traverseSpec",function(){return ke}),i.d(n,"clone",function(){return $e}),i.d(n,"isDate",function(){return De}),i.d(n,"isObject",function(){return Pe}),i.d(n,"niceZeroBased",function(){return je}),i.d(n,"niceTimeDomain",function(){return Ie}),i.d(n,"generateHash",function(){return He}),i.d(n,"generateRatioFunction",function(){return Ue}),i.d(n,"isSpecRectCoordsOnly",function(){return Ge}),i.d(n,"throttleLastEvent",function(){return qe}),i.d(n,"splitEvenly",function(){return Xe}),i.d(n,"extRGBColor",function(){return Ye}),i.d(n,"extCSSClass",function(){return Ve}),i.d(n,"toRadian",function(){return Je}),i.d(n,"normalizeAngle",function(){return Ke}),i.d(n,"range",function(){return Ze}),i.d(n,"hasXOverflow",function(){return Qe}),i.d(n,"hasYOverflow",function(){return et}),i.d(n,"flatten",function(){return tt}),i.d(n,"unique",function(){return it}),i.d(n,"groupBy",function(){return rt}),i.d(n,"union",function(){return nt}),i.d(n,"intersection",function(){return at}),i.d(n,"defaults",function(){return st}),i.d(n,"omit",function(){return ot}),i.d(n,"memoize",function(){return lt}),i.d(n,"createMultiSorter",function(){return ct}),i.d(n,"pick",function(){return ut}),i.d(n,"escape",function(){return dt}),i.d(n,"template",function(){return ht}),i.d(n,"escapeHtml",function(){return gt}),i.d(n,"xml",function(){return yt}),i.d(n,"take",function(){return xt}),i.d(n,"isChartElement",function(){return vt}),i.d(n,"isFacetUnit",function(){return wt});var a={};i.r(a),i.d(a,"appendTo",function(){return Mt}),i.d(a,"getScrollbarSize",function(){return kt}),i.d(a,"setScrollPadding",function(){return Et}),i.d(a,"getStyle",function(){return At}),i.d(a,"getStyleAsNum",function(){return Tt}),i.d(a,"getContainerSize",function(){return Ot}),i.d(a,"getAxisTickLabelSize",function(){return Ct}),i.d(a,"getLabelSize",function(){return Nt}),i.d(a,"getCharSize",function(){return Lt}),i.d(a,"selectOrAppend",function(){return Ft}),i.d(a,"selectImmediate",function(){return zt}),i.d(a,"selectAllImmediate",function(){return Rt}),i.d(a,"sortChildren",function(){return $t}),i.d(a,"classes",function(){return Dt}),i.d(a,"dispatchMouseEvent",function(){return Pt});var s=i(0),o=i(2),l=i(3),c={},u={};function d(e){var t=u[e];return t||(t=function(){for(var t,i,r=this,n=0,a=[];r=r.handler;){if("function"==typeof(i=r.callbacks[e])){if(!t)for(t=[this],n=0;n<arguments.length;n++)t.push(arguments[n]);a.unshift({fn:i,context:r.context,args:t})}if("function"==typeof(i=r.callbacks["*"])){if(!t)for(t=[this],n=0;n<arguments.length;n++)t.push(arguments[n]);a.unshift({fn:i,context:r.context,args:[{sender:this,type:e,args:t}]})}}a.forEach(e=>e.fn.apply(e.context,e.args))},u[e]=t),t}class h{constructor(){this.handler=null,this.emit_destroy=d("destroy")}addHandler(e,t){t=t||this,this.handler={callbacks:e,context:t,handler:this.handler}}on(e,t,i){var r={};return r[e]=t,this.addHandler(r,i),r}fire(e,t){d.call(this,e).call(this,t)}removeHandler(e,t){var i,r=this;for(t=t||this;i=r,r=r.handler;)if(r.callbacks===e&&r.context===t)return r.callbacks=c,void(i.handler=r.handler)}destroy(){this.emit_destroy(),this.handler=null}}class g extends h{constructor(e){super(),this.screenModel=null,this._elementNameSpace=e.namespace||"default",this._elementScalesHub={}}regScale(e,t){return this._elementScalesHub[e]=t,this}getScale(e){return this._elementScalesHub[e]||null}fireNameSpaceEvent(e,t){var i=this._elementNameSpace;this.fire(`${e}.${i}`,t)}subscribe(e,t=(e=>e),i=(e=>e)){var r=this,n={};[{event:"mouseover",limit:0},{event:"mouseout",limit:0},{event:"click",limit:0},{event:"mousemove",limit:"requestAnimationFrame"}].forEach(a=>{var o=a.event,l=a.limit;e.on(o,qe(n,o,function(e){var n={data:t.call(this,e),event:i.call(this,s.event,e)};r.fire(o,n),r.fireNameSpaceEvent(o,n)},l))})}allocateRect(){return{left:0,top:0,width:0,height:0}}defineGrammarModel(e){return{}}getGrammarRules(){return[]}getAdjustScalesRules(){return[]}createScreenModel(e){return null}getClosestElement(e,t){return null}addInteraction(){}draw(){this.config.options.container=this.config.options.slot(this.config.uid),this.drawFrames(this.config.frames)}data(){return this.config.frames.reduce((e,t)=>e.concat(t.part()),[])}node(){return this}}const p=e=>({day:{cast:function(t){var i=new Date(t);return new Date(i[e.setHours](0,0,0,0))},next:function(t){var i=new Date(t),r=new Date(i[e.setDate](i[e.getDate]()+1));return this.cast(r)}},week:{cast:function(t){var i=new Date(t);return i=new Date(i[e.setHours](0,0,0,0)),new Date(i[e.setDate](i[e.getDate]()-i[e.getDay]()))},next:function(t){var i=new Date(t),r=new Date(i[e.setDate](i[e.getDate]()+7));return this.cast(r)}},month:{cast:function(t){var i=new Date(t);return i=new Date(i[e.setHours](0,0,0,0)),i=new Date(i[e.setDate](1))},next:function(t){var i=new Date(t),r=new Date(i[e.setMonth](i[e.getMonth]()+1));return this.cast(r)}},quarter:{cast:function(t){var i=new Date(t);i=new Date(i[e.setHours](0,0,0,0));var r=(i=new Date(i[e.setDate](1)))[e.getMonth](),n=r-r%3;return new Date(i[e.setMonth](n))},next:function(t){var i=new Date(t),r=new Date(i[e.setMonth](i[e.getMonth]()+3));return this.cast(r)}},year:{cast(t){var i=new Date(t);return i=new Date(i[e.setHours](0,0,0,0)),i=new Date(i[e.setDate](1)),i=new Date(i[e.setMonth](0))},next:function(t){var i=new Date(t),r=new Date(i[e.setFullYear](i[e.getFullYear]()+1));return this.cast(r)}}}),f=p({setHours:"setHours",setDate:"setDate",getDate:"getDate",setMonth:"setMonth",getDay:"getDay",getMonth:"getMonth",setFullYear:"setFullYear",getFullYear:"getFullYear"});var m=p({setHours:"setUTCHours",setDate:"setUTCDate",getDate:"getUTCDate",setMonth:"setUTCMonth",getDay:"getUTCDay",getMonth:"getUTCMonth",setFullYear:"setUTCFullYear",getFullYear:"getUTCFullYear"}),y={add(e,t,{utc:i}={utc:!1}){return(i?m:f)[e.toLowerCase()]=t,this},get:(e,{utc:t}={utc:!1})=>(t?m:f)[(e||"").toLowerCase()]||null,generate:(e,t,i,{utc:r}={utc:!1})=>{var n=[],a=y.get(i,{utc:r});if(a){var s=a.cast(new Date(t)),o=a.cast(new Date(e));for(n.push(o);(o=a.next(new Date(o)))<=s;)n.push(o)}return n}};class x extends Error{constructor(e,t,i){super(),this.name="TauChartError",this.message=e,this.errorCode=t,this.errorArgs=i}}const b={STACKED_FIELD_NOT_NUMBER:"STACKED_FIELD_NOT_NUMBER",NO_DATA:"NO_DATA",NOT_SUPPORTED_TYPE_CHART:"NOT_SUPPORTED_TYPE_CHART",UNKNOWN_UNIT_TYPE:"UNKNOWN_UNIT_TYPE",INVALID_LOG_DOMAIN:"INVALID_LOG_DOMAIN"},v={},w={get:e=>v[e],reg(e,t){return v[e]=t,this}},_="taucharts_synthetic_record";function S(e,t){return`translate(${e},${t})`}function M(e){return`rotate(${e})`}function k(e){return["bottom","top"].indexOf(e.toLowerCase())>=0?"h":"v"}function E(e){var t={x:0,y:0},i=e.indexOf("translate(");if(i>=0){var r=e.indexOf(")",i+10),n=e.substring(i+10,r).trim().replace(","," ").replace(/\s+/," ").split(" ");t.x=parseFloat(n[0]),n.length>1&&(t.y=parseFloat(n[1]))}return t}function A(e,t,i,r,n,a,s,o){var l,c,u,d,h,g;return g=((u=s-n)*(t-a)-(d=o-a)*(e-n))/(-u*(c=r-t)+(l=i-e)*d),(h=(-c*(e-n)+l*(t-a))/(-u*c+l*d))>=0&&h<=1&&g>=0&&g<=1}function T(e){for(var t,i,r={x:0,y:0},n=e;n&&"SVG"!==n.nodeName.toUpperCase();)(i=n.getAttribute("transform"))&&(t=E(i),r.x+=t.x,r.y+=t.y),n=n.parentNode;return r}function O(e,t,i){const r=e.selectAll(t).filter(i);if(r.empty())return;const n=s.select(r.node().parentNode).selectAll(t).filter(e=>!i(e)).nodes(),a=n[n.length-1];if(a){const e=Array.prototype.indexOf.call(a.parentNode.childNodes,a),t=a.nextSibling;r.each(function(){Array.prototype.indexOf.call(this.parentNode.childNodes,this)>e||this.parentNode.insertBefore(this,t)})}}w.reg("identity",()=>({})).reg("flip",e=>{var t=e.scaleY,i=e.scaleX;const r=i.domain(),n=i.discrete?r[0]:Math.max(0,Math.min(...r)),a=i.value(n)+-.5*i.stepSize(n);return{flip:!0,scaleX:t,scaleY:i,xi:e=>t.value(e[t.dim]),yi:e=>i.value(e[i.dim]),y0:()=>a}}).reg("obsoleteVerticalStackOrder",()=>({obsoleteVerticalStackOrder:!0})).reg("positioningByColor",e=>{return(e.scaleX.discrete?e=>{const t=e.data().reduce((t,i)=>{const r=i[e.scaleX.dim],n=i[e.scaleColor.dim];return t.hasOwnProperty(r)||(t[r]=[]),t[r].indexOf(n)<0&&t[r].push(n),t},{});var i=e.scaleX,r=e.scaleColor,n=r.discrete?r.domain():r.originalSeries().sort((e,t)=>e-t),a=n.length||1;const s=n.reduce((e,t,i)=>(e[t]=i,e),{});return Object.keys(t).forEach(e=>t[e].sort((e,t)=>s[e]-s[t])),{xi:r=>{const n=r[e.scaleX.dim],s=t[n]||[r[e.scaleColor.dim]],o=s.length,l=s.indexOf(r[e.scaleColor.dim]);var c=(e=>i.stepSize(e[i.dim])*(a/(1+a)))(r)/(a+1);return e.xi(r)-(o+1)*c/2+(1+l)*c}}}:()=>({}))(e)}).reg("groupOrderByAvg",e=>{const t=e.data(),i=t=>t.map(e.yi).reduce((e,t)=>e+t,0)/t.length,r=t.reduce((t,i)=>{var r=e.group(i);return t[r]=t[r]||[],t[r].push(i),t},{}),n=Object.keys(r).map(e=>[e,i(r[e])]).sort((e,t)=>e[1]-t[1]).map(e=>e[0]);return{order:e=>{const t=n.indexOf(e);return t<0?Number.MAX_VALUE:t}}}).reg("stack",e=>{const t=e.data(),i=e.scaleX,r=e.scaleY;if(r.discrete||r.domain().some(e=>"number"!=typeof e))throw new x(`Stacked field [${r.dim}] should be a number`,b.STACKED_FIELD_NOT_NUMBER,{field:r.dim});const n=e=>t=>{const n=t[i.dim],a=t[r.dim],s=a>=0?e.positive:e.negative,o=s[n]||0,l=o+a;return s[n]=l,{nextStack:l,prevStack:o}},a=n({positive:{},negative:{}}),s=n({positive:{},negative:{}}),o=t=>lt(t,e.id);var l=Number.MAX_VALUE,c=Number.MIN_VALUE;const u=e=>(l=e<l?e:l,c=e>c?e:c,r.value(e)),d=o(e=>u(a(e).nextStack)),h=o(e=>u(s(e).prevStack)),g=t=>e.group(t)+"/"+(t[r.dim]>=0?1:-1),p=rt(t,g),f=Object.keys(p).sort(e.flip||!e.flip&&e.obsoleteVerticalStackOrder?(t,i)=>e.order(t)-e.order(i):(t,i)=>e.order(i)-e.order(t)).reduce((e,t)=>e.concat(p[t]),[]);return f.forEach(e=>{d(e),h(e)}),r.fixup(e=>{const t={};return(!e.hasOwnProperty("max")||e.max<c)&&(t.max=c),(!e.hasOwnProperty("min")||e.min>l)&&(t.min=l),t}),{group:g,data:()=>f,yi:d,y0:h}}).reg("size_distribute_evenly",(e,{minLimit:t,maxLimit:i,defMin:r,defMax:n})=>{const a=e.data(),s=(e,t)=>e-t,o=e.scaleX.discrete?e.scaleX.stepSize()/2:Number.MAX_VALUE,l=a.map(t=>e.xi(t)).sort(s);var c=l[0],u=l.slice(1).map(e=>{var t=e-c;return c=e,t}).filter(e=>e>0).sort(s).concat(Number.MAX_VALUE)[0];const d=Math.min(u,o),h="number"==typeof t?t:r,g={minSize:h,maxSize:"number"==typeof i?i:Math.max(h,Math.min(n,d))};return e.scaleSize.fixup(e=>{const t={};return e.fixed?e.maxSize>g.maxSize&&(t.maxSize=g.maxSize):(t.fixed=!0,t.minSize=g.minSize,t.maxSize=g.maxSize),t}),{}}).reg("adjustStaticSizeScale",(e,{minLimit:t,maxLimit:i,defMin:r,defMax:n})=>{var a={minSize:"number"==typeof t?t:r,maxSize:"number"==typeof i?i:n};return e.scaleSize.fixup(e=>{var t={};return e.fixed||(t.fixed=!0,t.minSize=a.minSize,t.maxSize=a.maxSize),t}),{}}).reg("adjustSigmaSizeScale",(e,{minLimit:t,maxLimit:i,defMin:r,defMax:n})=>{const a=(e,t)=>e-t,s=e.data().map(t=>e.xi(t)).sort(a);var o=s[0];const l=s.slice(1).map(e=>{const t=e-o;return o=e,t}).filter(e=>e>0).sort(a).concat(Number.MAX_VALUE)[0],c=e.scaleX.discrete?e.scaleX.stepSize()/2:Number.MAX_VALUE,u=Math.min(l,c),d="number"==typeof t?t:r,h="number"==typeof i?i:n,g={minSize:d,maxSize:Math.max(d,Math.min(h,(e=>{var t=(d+h)/2,i=h,r=d;return Math.round(t+(i-t)/(1+Math.exp(-(e-r)/.5)))})(u)))};return e.scaleSize.fixup(e=>{const t={};return e.fixed?e.maxSize>g.maxSize&&(t.maxSize=g.maxSize):(t.fixed=!0,t.minSize=g.minSize,t.maxSize=g.maxSize),t}),{}}).reg("avoidScalesOverflow",(e,{sizeDirection:t})=>{const i=(e,i)=>!e||e.discrete||"logarithmic"===e.scaleType||t.indexOf(i)<0,r=i(e.scaleX,"x"),n=i(e.scaleY,"y");if(r&&n)return{};var a,s;e.scaleSize.fixup(e=>(a=e.minSize,s=e.maxSize,e));var o=e.data().reduce((t,i)=>{var o,l,c=e.size(i),u=(c>=a?c:a+c*(s-a))/2;return r||(o=e.xi(i),t.left=Math.min(t.left,o-u),t.right=Math.max(t.right,o+u)),n||(l=e.yi(i),t.top=Math.min(t.top,l-u),t.bottom=Math.max(t.bottom,l+u)),t},{top:Number.MAX_VALUE,right:-Number.MAX_VALUE,bottom:-Number.MAX_VALUE,left:Number.MAX_VALUE});const l=(t,i,r,n)=>{var a=t.domain(),s=Math.abs(t.value(a[1])-t.value(a[0])),o=(a[1]-a[0])/s;if(0===s)return 1;var l=Math.max(0,-i),c=Math.max(0,r-s),u=e.flip?c:l,d=e.flip?l:c,h=Number(a[0])-(n?d:u)*o,g=Number(a[1])+(n?u:d)*o;return t.fixup(e=>{var t={};if(e.fixedBorders){let[n,a]=e.fixedBorders.slice();(n>i||a<r)&&(t.min=Math.min(e.min,h),t.max=Math.max(e.max,g),n=Math.min(i,n),a=Math.max(r,a)),t.fixedBorders=[n,a]}else t.fixed=!0,t.min=h,t.max=g,t.nice=!1,t.fixedBorders=[i,r];return t}),s/(u+s+d)};var c=r?1:l(e.scaleX,o.left,o.right,!1),u=n?1:l(e.scaleY,o.top,o.bottom,!0),d=Math.min(a*c,a*u),h=Math.min(s*c,s*u);return e.scaleSize.fixup(()=>({minSize:d,maxSize:h})),{}}).reg("fillGaps",(e,{isStack:t,xPeriod:i,utc:r})=>{const n=rt(e.data(),e.group),a=Object.keys(n).sort((t,i)=>e.order(t)-e.order(i)).reduce((e,t)=>e.concat([n[t]]),[]),s=e.scaleX.dim,o=e.scaleY.dim,l=e.scaleColor.dim,c=e.scaleSplit.dim,u=e=>e[o]>=0?1:-1,d=(t,i,r)=>{const n=rt(i,e=>e[s]),a=i[0];return t.reduce((t,i)=>t.concat(n[i]||((t,i,r)=>{const n=[t,e.id(i),r].join(" ");return{[s]:t,[o]:1e-10*r,[c]:i[c],[l]:i[l],[_]:!0,[`${_}id`]:n}})(i,a,r)),[])},h=(e,t)=>e-t,g=()=>it(a.reduce((e,t)=>e.concat(t.map(e=>e[s])),[])).sort(h),p=i?(()=>{const t=g(),n=Math.max(...t.map(e=>Number(e))),a=e.scaleX.domain(),s=y.generate(a[0],a[1],i,{utc:r}).filter(e=>e>=a[0]&&e<=a[1]);let o=0;const l=[],c=y.get(i,{utc:r});return s.forEach(e=>{const i=Number(e);if(!(i>=n)){for(let e=o;e<t.length;e++)if(Number(c.cast(t[e]))===i)return void o++;l.push(e)}}),t.concat(l).sort(h)})():g(),f=a.map(t=>t.sort((t,i)=>e.xi(t)-e.xi(i))).reduce(t?(e,t)=>{const i=rt(t,e=>String(u(e)));return Object.keys(i).reduce((e,t)=>e.concat(d(p,i[t],t)),e)}:(e,t)=>{rt(t,e=>String(u(e)));const i=Math.max(...t.map(e=>e[s]));return e.concat(d(p.filter(e=>e<=i),t,0))},[]);return{data:()=>f,size:t=>t[_]?e.scaleSize(0):e.size(t),id:t=>t[_]?t[`${_}id`]:e.id(t)}});var C=i(5);const N="tau-chart__";function L(e){return e}const F=1e-6;function z(e){return`translate(${e+.5},0)`}function R(e){return`translate(0,${e+.5})`}const $={top:1,right:2,bottom:3,left:4};function D(e){const t=$[e.scaleGuide.scaleOrient],i=e.scale,r=e.scaleGuide,n=r.label,{ticksCount:a,tickFormat:s,tickSize:o,tickPadding:l,gridOnly:c}=st(e,{tickSize:6,tickPadding:3,gridOnly:!1}),u="linear"===i.scaleType,d="ordinal"===i.scaleType||"period"===i.scaleType,h=t===$.top||t===$.bottom,g=t===$.top||t===$.left?-1:1,p=h?"x":"y",f=h?"y":"x",m=h?z:R,y=h?1:-1;return x=>{var b;if(i.ticks){b=i.ticks(a);let e=Math.floor(1.25*a);for(;b.length>e&&e>2&&b.length>2;)b=i.ticks(--e)}else b=i.domain();r.hideTicks&&(b=c?b.filter(e=>0==e):[]);const v=null==s?i.tickFormat?i.tickFormat(a):L:s,w=Math.max(o,0)+l,_=i.range(),S=_[0]+.5,k=_[_.length-1]+.5;let A=(i.bandwidth?function(e){var t=Math.max(0,e.bandwidth()-1)/2;return e.round()&&(t=Math.round(t)),function(i){return e(i)+t}}:L)(i);if(r.facetAxis){let e=A;A=(t=>e(t)-i.stepSize(t)/2)}const T=x.selection?x:null,O=T?T.selection():x,C=function(e){let t=e.node();for(;t&&"svg"!==t.tagName;)t=t.parentNode;return t}(O).getBoundingClientRect();function z(e){const i=Ke(r.rotate);if(e.attr("transform",M(i)),Math.abs(i/90)%2>0){let r=i<180?1:-1,n=h?.5:-2,a=t===$.top||t===$.left?-1:1,s=n*(t===$.top||t===$.bottom?a<0?0:.71:.32);e.attr("x",9*r).attr("y",0).attr("dx",h?null:`${s}em`).attr("dy",`${s}em`)}}function R(e,t=0){const n=e=>Math.max(i.stepSize(e),r.tickFormatWordWrapLimit,t);r.tickFormatWordWrap?de(e,n,r.tickFormatWordWrapLines,r.tickFontHeight,!h):ue(e,n)}function D(e){!function(e,t){const i=t?-10:20,r=t?0:1,n=t?1:-1;var a=[];e.each(function(){var e=le.select(this),t=e.attr("transform").replace("translate(","").replace(" ",",").split(",")[r],i=n*parseFloat(t),s=e.select("text"),o=s.node().getBBox().width,l=o/2,c=i-l,u=i+l;a.push({c:i,s:c,e:u,l:0,textRef:s,tickRef:e})});var s=a.sort((e,t)=>e.c-t.c);((e,t)=>e.map((e,i,r)=>t(r[i-1]||{e:-1/0,s:-1/0,l:0},e,r[i+1]||{e:1/0,s:1/0,l:0})))(s,(e,r,n)=>{var a=e.e>r.s,s=n.s<r.e;if(a||s){r.l=((e,t)=>{var i={"[T][1]":-1,"[T][-1]":0,"[T][0]":1,"[F][0]":-1},r=`[${t.toString().toUpperCase().charAt(0)}][${e}]`;return i.hasOwnProperty(r)?i[r]:0})(e.l,a);var o=r.textRef.size(),l=r.textRef.text();o>1&&(l=l.replace(/([\.]*$)/gi,"")+"...");var c=11*r.l,u=t?parseFloat(r.textRef.attr("y"))+c:0;let n=t?0:c,s=t?c:0;var d=function(e){var t=0;if(!e)return t;var i=e.indexOf("rotate(");if(i>=0){var r=e.indexOf(")",i+7),n=e.substring(i+7,r);t=parseFloat(n.trim())}return t}(r.textRef.attr("transform"));r.textRef.text((e,t)=>0===t?l:"").attr("transform","translate("+n+","+s+") rotate("+d+")");var h={x1:0,x2:0,y1:u+(t?-1:5),y2:i};t||(h.transform="rotate(-90)"),Ft(r.tickRef,"line.label-ref").call(ve(h))}else r.tickRef.selectAll("line.label-ref").remove();return r})}(e,h)}O.attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",t===$.right?"start":t===$.left?"end":"middle"),c||function(){const e=r.hideTicks||r.hide?[]:[null];xt(O.selectAll(".domain").data(e)).then(e=>(T&&e.exit().transition(T).attr("opacity",0).remove(),e.merge(e.enter().insert("path",".tick").attr("class","domain").attr("opacity",1).attr("stroke","#000")))).then(e=>T?e.transition(T):e).then(e=>{e.attr("d",t===$.left||t==$.right?`M${g*o},${S}H0.5V${k}H${g*o}`:`M${S},${g*o}V0.5H${k}V${g*o}`)})}();const P=xt(O.selectAll(".tick").data(b,e=>String(i(e))).order()).then(e=>{const t=e.exit(),i=e.enter().append("g").attr("class","tick");return{tickExit:t,tickEnter:i,tick:e.merge(i)}}).then(e=>{if(u){const t=i.ticks(),r=i.domain(),n=b.length-1,a=t.length>1&&r[0]*r[1]<0&&-r[0]>(t[1]-t[0])/2&&r[1]>(t[n]-t[n-1])/2;e.tick.classed("zero-tick",e=>0==e&&a)}return e}).result();!function(e){xt(e).then(({tickEnter:e,tickExit:t,tick:i})=>T?(e.attr("opacity",F).attr("transform",function(e){const t=A(e);return m(t)}),{tick:i.transition(T),tickExit:t.transition(T).attr("opacity",F).attr("transform",function(e){const t=A(e);return isFinite(t)?m(t):this.getAttribute("transform")})}):{tick:i,tickExit:t}).then(({tick:e,tickExit:t})=>{t.remove(),e.attr("opacity",1).attr("transform",e=>m(A(e)))})}(P),r.facetAxis||function(e){const t=g*o,r=d?e=>y*i.stepSize(e)/2:null;xt(e).then(({tick:e,tickEnter:i})=>{const n=e.select("line"),a=i.append("line").attr("stroke","#000").attr(`${f}2`,t);return d&&a.attr(`${p}1`,r).attr(`${p}2`,r),n.merge(a)}).then(e=>T?e.transition(T):e).then(e=>{e.attr(`${f}2`,t),d&&e.attr(`${p}1`,r).attr(`${p}2`,r)})}(P),d&&c&&d&&b&&b.length&&xt(O.selectAll(".extra-tick-line").data([null])).then(e=>e.merge(e.enter().insert("line",".tick").attr("class","extra-tick-line").attr("stroke","#000"))).then(e=>T?e.transition(T):e).then(e=>{e.attr(`${p}1`,S).attr(`${p}2`,S).attr(`${f}1`,0).attr(`${f}2`,g*o)}),c||(function(n){const a=r.textAnchor,s=g*w,o=t===$.top?"0em":t===$.bottom?"0.71em":"0.32em";function l(t){if(r.facetAxis)return t.attr("dx",18-e.position[0]).attr("dy",16)}xt(n).then(({tick:e,tickEnter:t})=>{const i=e.select("text"),r=t.append("text").attr("fill","#000").attr(f,s).attr("dy",o);return z(r),l(r),i.merge(r)}).then(e=>{if(e.text(v).attr("text-anchor",a),!1===h&&!0===r.facetAxis){const t=E(O.node().parentNode.getAttribute("transform"));R(e,C.width-Math.abs(t.x))}else R(e);return h&&"time"===i.scaleType&&function(e){if(b.length<2)return;var t=0,i=-1;const r=e.nodes();r.forEach((e,r)=>{const n=e.textContent||"";var a=n.length;a>t&&(t=a,i=r)});const n=A(b[1])-A(b[0]);var a=!1;if(i>=0){var s=r[i].getBoundingClientRect();a=n-s.width<8}O.classed(`${N}time-axis-overflow`,a)}(e),!h||"time"!==i.scaleType&&"linear"!==i.scaleType||function(e){if(0===b.length)return;const t=b[0],i=b[b.length-1],r=O.append("line").attr("x1",A(t)).attr("x2",A(t)).attr("y1",0).attr("y2",1),n=O.append("line").attr("x1",A(i)).attr("x2",A(i)).attr("y1",0).attr("y2",1),a={left:r.node().getBoundingClientRect().left-C.left,right:C.right-n.node().getBoundingClientRect().right};r.remove(),n.remove();const s=(e,t,i)=>{const r=e.getBoundingClientRect(),n=t>0?"right":"left",s=(A(i),a[n]),o=Math.ceil(r.width/2-s+1);e.setAttribute("dx",String(o>0?-t*o:0))},o=e.filter(e=>e===t).node(),l=e.filter(e=>e===i).node();e.attr("dx",null),s(o,-1,t),s(l,1,i)}(e),e}).then(e=>T?e.transition(T):e).then(e=>{e.attr(f,s),z(e),l(e),d&&r.avoidCollisions&&!r.facetAxis&&(T?T.on("end.fixTickTextCollision",()=>D(n.tick)):D(n.tick))})}(P),n.hide||function(){const e=n,t=Ft(O,"text.label").attr("class",Dt("label",e.cssClass)).attr("transform",M(e.rotate)).attr("text-anchor",e.textAnchor);xt(t).then(e=>T?e.transition(T):e).then(t=>{const i=y*e.padding,r=Math.abs(k-S),n=h?r:0;t.attr("x",n).attr("y",i).attr("text-anchor","end")});const i=e.text.split(" → ");for(var r=i.length-1;r>0;r--)i.splice(r,0," → ");t.selectAll("tspan").data(i).enter().append("tspan").attr("class",(e,t)=>t%2?`label-token-delimiter label-token-delimiter-${t}`:`label-token label-token-${t}`).text(e=>e).exit().remove()}())}}function P(e){return D({scale:e.scale,scaleGuide:e.scaleGuide,ticksCount:e.ticksCount,tickSize:e.tickSize,gridOnly:!0,position:e.position})}function j(e,...t){return 2===t.length?t[0]*(1-e)+t[1]*e:3===t.length?t[0]*(1-e)*(1-e)+2*t[1]*(1-e)*e+t[2]*e*e:t[0]*(1-e)*(1-e)*(1-e)+3*t[1]*(1-e)*(1-e)*e+3*t[2]*(1-e)*e*e+t[3]*e*e*e}function I(e,...t){var i=t.map(e=>e.x),r=t.map(e=>e.y);return{x:j(e,...i),y:j(e,...r)}}function B(e,t,i,r,n){var a=I(e,t,i),s=I(e,t,i,r),o=I(e,i,r,n),l=I(e,r,n);return[t,a,s,I(e,s,o),o,l,n]}function W(e,t,i="polyline"){var r;return n=>0===n?e:1===n?t:(r||(r=("cubic"===i?function(e,t){for(var i=2;i<e.length-1;i+=3)e[i-1].isCubicControl=!0,e[i].isCubicControl=!0;for(i=2;i<t.length-1;i+=3)t[i-1].isCubicControl=!0,t[i].isCubicControl=!0;var r,n;for(e=e.filter(e=>!e.isInterpolated),i=e.length-2;i>=0;i--)n=e[i+1],(r=e[i]).isCubicControl||n.isCubicControl||(e.splice(i+1,0,I(1/3,n,r),I(2/3,n,r)),e[i+1].isCubicControl=!0,e[i+2].isCubicControl=!0);var a=e.filter((e,t)=>t%3==0),s=t.filter((e,t)=>t%3==0),o=a.map(e=>e.id),l=s.map(e=>e.id),c=o.reduce((t,i)=>(t[i]=e.findIndex(e=>e.id===i),t),{}),u=l.reduce((e,i)=>(e[i]=t.findIndex(e=>e.id===i),e),{}),d=o.filter(e=>l.indexOf(e)>=0),h=a.filter(e=>!e.positionIsBeingChanged),g=s.filter(e=>!e.positionIsBeingChanged),p=Q(h,g),f=Q(g,h),m=[];d.forEach((i,r)=>{var n=c[i],a=u[i];if(0===r&&(n>0||a>0)&&m.push(H({polylineFrom:e.slice(0,n+1),polylineTo:t.slice(0,a+1),toOppositeScale:0===a?p:f,isCubic:!0})),r>0){var s=c[d[r-1]],o=u[d[r-1]];n-s>3||a-o>3?m.push(U({polylineFrom:e.slice(s,n+1),polylineTo:t.slice(o,a+1),isCubic:!0})):m.push(function({polylineFrom:e,polylineTo:t}){return i=>J(e.slice(1,3),t.slice(1,3),i)}({polylineFrom:e.slice(s,n+1),polylineTo:t.slice(o,a+1)}))}m.push(G({pointFrom:e[n],pointTo:t[a]})),r===d.length-1&&(e.length-n-1>0||t.length-a-1>0)&&m.push(H({polylineFrom:e.slice(n),polylineTo:t.slice(a),toOppositeScale:t.length-a==1?p:f,isCubic:!0}))}),0===m.length&&(t.length>0&&0===d.length||e.length>0&&0===d.length)&&m.push(q({polylineFrom:e.slice(0),polylineTo:t.slice(0),isCubic:!0}));return e=>{var t=[];return m.forEach(i=>{var r=i(e);X(t,r)}),t}}:function(e,t){var i=(e=e.filter(e=>!e.isInterpolated)).map(e=>e.id),r=t.map(e=>e.id),n=i.filter(e=>r.indexOf(e)>=0),a=e.filter(e=>!e.positionIsBeingChanged),s=t.filter(e=>!e.positionIsBeingChanged),o=Q(a,s),l=Q(s,a),c=[];n.forEach((a,s)=>{var u=i.indexOf(a),d=r.indexOf(a);if(0===s&&(u>0||d>0)&&c.push(H({isCubic:!1,polylineFrom:e.slice(0,u+1),polylineTo:t.slice(0,d+1),toOppositeScale:0===d?o:l})),s>0){var h=i.indexOf(n[s-1]),g=r.indexOf(n[s-1]);(u-h>1||d-g>1)&&c.push(U({isCubic:!1,polylineFrom:e.slice(h,u+1),polylineTo:t.slice(g,d+1)}))}c.push(G({pointFrom:e[u],pointTo:t[d]})),s===n.length-1&&(e.length-u-1>0||t.length-d-1>0)&&c.push(H({isCubic:!1,polylineFrom:e.slice(u),polylineTo:t.slice(d),toOppositeScale:t.length-d==1?o:l}))}),0===c.length&&(t.length>0&&0===n.length||e.length>0&&0===n.length)&&c.push(q({isCubic:!1,polylineFrom:e.slice(0),polylineTo:t.slice(0)}));return e=>{var t=[];return c.forEach(i=>{var r=i(e);X(t,r)}),t}})(e,t)),r(n))}function H({polylineFrom:e,polylineTo:t,isCubic:i,toOppositeScale:r}){var n=e.length>t.length?e:t,a=1===t.length,s=e[0].id!==t[0].id,o=Boolean(s!==a);return e=>{var t=(i?Z:K)({t:e,polyline:n,decreasing:a,rightToLeft:o});a===o?t.shift():t.pop();var s=J(t.map(r),t,a?1-e:e);return s.forEach(e=>e.positionIsBeingChanged=!0),s}}function U({polylineFrom:e,polylineTo:t,isCubic:i}){var r=e.length,n=t.length;if(n!==r){var a=n<r,s=a?e:t,o=(i?function({smallerPolyline:e,biggerPolyline:t,decreasing:i}){var r=(e.length-1)/3,n=(t.length-1)/3,a=Math.floor(n/r)+1,s=n%r,o=Ze(r).map(e=>a+Number(e<s)),l=[e[0]],c=3;return o.forEach(r=>{if(r>2){var n=function(e,t){for(var i,r,n=[t[0]],a=0;a<e.length;a++)i=0===a?e[0]:e[a]/(1-e[a-1]),r=te(i,t),X(n,r.slice(1,4)),t=r.slice(3);return X(n,t.slice(1)),n}(Ze(1,r-1).map(e=>e/(r-1)),e.slice(c-3,c+1));Ze(r-2).forEach(e=>n[3*(e+1)].id=t[l.length-1+3*e].id),i&&n.forEach((e,t)=>{t>0&&t<n.length-1&&(e.isInterpolated=!0)}),X(l,n.slice(1))}else{var a=Object.assign({},e[c-2]),s=Object.assign({},e[c-1]),o=Object.assign({},e[c]);i||(o.id=t[l.length+2].id),l.push(a,s,o)}c+=3}),l}:function({smallerPolyline:e,biggerPolyline:t,decreasing:i}){var r=e.length-1,n=t.length-1,a=Math.floor(n/r)+1,s=n%r,o=Ze(r).map(e=>a+Number(e<s)),l=[e[0]],c=1;return o.forEach(r=>{Ze(1,r).forEach(n=>{var a;n===r-1?(a=Object.assign({},e[c]),i||(a.id=t[l.length].id)):((a=V(e[c-1],e[c],n/(r-1))).id=t[l.length].id,i&&(a.isInterpolated=!0)),l.push(a)}),c++}),l})({smallerPolyline:a?t:e,biggerPolyline:s,decreasing:a}),l=s.slice(1,s.length-1),c=o.slice(1,o.length-1);return e=>{var t=J(c,l,a?1-e:e);return t.forEach(e=>e.positionIsBeingChanged=!0),t}}var u=e.slice(1,e.length-1),d=t.slice(1,t.length-1);return e=>{var t=J(u,d,e);return t.forEach(e=>e.positionIsBeingChanged=!0),t}}function G({pointFrom:e,pointTo:t}){return i=>[V(e,t,i)]}function q({polylineFrom:e,polylineTo:t,isCubic:i}){var r=0===t.length,n=r,a=r?e:t;return e=>{var t=(i?Z:K)({t:e,polyline:a,decreasing:r,rightToLeft:n});return t.forEach((e,t)=>{t>0&&(e.positionIsBeingChanged=!0)}),t}}function X(e,t){return Array.prototype.push.apply(e,t)}function Y(e,t,i){return void 0===t?e:"number"==typeof t?e+i*(t-e):t}function V(e,t,i){if(e===t)return t;var r={};return Object.keys(e).forEach(n=>r[n]=Y(e[n],t[n],i)),void 0!==t.id&&(r.id=t.id),r}function J(e,t,i){return e.map((e,r)=>V(e,t[r],i))}function K({t:e,polyline:t,decreasing:i,rightToLeft:r}){var n=Boolean(i)!==Boolean(r),a=function(e,t){var i=0;if(e>0){for(var r,n,a,s,o=[0],l=0,c=1;c<t.length;c++)a=t[c-1].x,s=t[c-1].y,r=t[c].x,n=t[c].y,l+=Math.sqrt((r-a)*(r-a)+(n-s)*(n-s)),o.push(l);var u=e*l;for(c=1;c<o.length;c++)if(u<=o[c]){i=Math.min(1,(c-1+(u-o[c-1])/(o[c]-o[c-1]))/(t.length-1));break}}var d=Math.floor((t.length-1)*i)+1,h=t.length-d,g=d,p=t.slice(0,d);if(i<1){var f=i*(t.length-1)%1,m=V(t[d-1],t[d],f);X(p,Ze(h).map(e=>Object.assign({},m,{id:t[g+e].id,isInterpolated:!0})))}return p}(i?1-e:e,n?t.slice(0).reverse():t);return n&&a.reverse(),a}function Z({t:e,polyline:t,decreasing:i,rightToLeft:r}){var n=Boolean(i)!==Boolean(r),a=function(e,t){var i=(t.length-1)/3+1,r=0;if(e>0){for(var n,a,s,o,l,c,u,d,h=[0],g=0,p=1;p<i;p++)s=t[3*p-3].x,o=t[3*p-3].y,l=t[3*p-2].x,c=t[3*p-2].y,u=t[3*p-1].x,d=t[3*p-1].y,n=t[3*p].x,a=t[3*p].y,g+=(ee(s,o,l,c)+ee(l,c,u,d)+ee(u,d,n,a)+ee(n,a,s,o))/2,h.push(g);var f=e*g;for(p=1;p<h.length;p++)if(f<=h[p]){r=Math.min(1,(p-1+(f-h[p-1])/(h[p]-h[p-1]))/(i-1));break}}var m=Math.floor((i-1)*r)+1,y=i-m,x=3*m,b=t.slice(0,3*(m-1)+1);if(r<1){var v=te(r*(i-1)%1,t.slice(3*(m-1),3*m+1)).slice(1,4);v.forEach(e=>e.isInterpolated=!0),v[2].id=t[x].id,X(b,v),Ze(1,y).forEach(e=>{X(b,[{x:v[2].x,y:v[2].y,isCubicControl:!0,isInterpolated:!0},{x:v[2].x,y:v[2].y,isCubicControl:!0,isInterpolated:!0},Object.assign({},v[2],{id:t[x+3*e].id,isInterpolated:!0})])})}return b}(i?1-e:e,n?t.slice(0).reverse():t);return n&&a.reverse(),a}function Q(e,t){var i,r,n,a,s=[],o=[],l=0,c=e.length,u=t.length;for(i=0;i<c;i++)for(n=e[i],r=l;r<u;r++)if(a=t[r],n.id===a.id){l=r+1,s.push(n),o.push(a);break}if(s.length<1||o.length<1)return e=>e;var d=Object.keys(s[0]).filter(e=>"number"==typeof s[0][e]).filter(e=>"id"!==e),h={},g=(e,t,i,r)=>n=>r+(n-t)*(r-i)/(t-e);return d.forEach(e=>{for(var t,i,r=s[0][e],n=o[0][e],a=s.length-1;a>0;a--)if((t=s[a][e])!==r)return i=o[a][e],void(h[e]=g(r,t,n,i));h[e]=((e,t)=>i=>i-e+t)(r,n)}),e=>{var t=Object.assign({},e);return d.forEach(i=>{t[i]=h[i](e[i])}),t}}function ee(e,t,i,r){return Math.sqrt((i-e)*(i-e)+(r-t)*(r-t))}function te(e,[t,i,r,n]){var a=B(e,t,i,r,n);return[a[1],a[2],a[4],a[5]].forEach(e=>e.isCubicControl=!0),Object.keys(n).forEach(i=>{"x"!==i&&"y"!==i&&"id"!==i&&(a[3][i]=Y(t[i],n[i],e))}),a}function ie(e,t){if(e.length<2)return e.slice(0);if(2===e.length)return[e[0],{x:re(e[0].x,e[1].x,1/3),y:re(e[0].y,e[1].y,1/3)},{x:re(e[0].x,e[1].x,2/3),y:re(e[0].y,e[1].y,2/3)},e[1]];var i,r,n,a,s,o,l,c,u,d,h,g,p,f,m=new Array(3*(e.length-1)+1);const y=m.length-1;for(var x=0;x<e.length;x++)m[3*x]=e[x],x>0&&(m[3*x-2]=I(1/3,e[x-1],e[x]),m[3*x-1]=I(2/3,e[x-1],e[x]));for(var b=m.slice(0),v=0;v<3;v++){for(m[1]={x:re(m[0].x,m[3].x,1/3),y:re(m[0].y,re(m[3].y,m[2].y,1.5),2/3)},m[y-1]={x:re(m[y].x,m[y-3].x,1/3),y:re(m[y].y,re(m[y-3].y,m[y-2].y,1.5),2/3)},t&&((m[1].y-m[0].y)*(m[3].y-m[2].y)<0&&(m[1]={x:m[1].x,y:m[0].y}),(m[y-1].y-m[y].y)*(m[y-3].y-m[y-2].y)<0&&(m[y-1]={x:m[y-1].x,y:m[y].y})),x=6;x<b.length;x+=3)i=b[x-5],r=b[x-3],n=b[x-1],(r.x-i.x)*(n.x-r.x)*1e12<1?(a=re(i.x,r.x,.5),o=re(r.x,n.x,.5),s=re(i.y,r.y,.5),l=re(r.y,n.y,.5)):(d=(r.x-i.x)/(n.x-i.x),c=(r.x-i.x*(1-d)*(1-d)-n.x*d*d)/(2*(1-d)*d),u=(r.y-i.y*(1-d)*(1-d)-n.y*d*d)/(2*(1-d)*d),a=re(i.x,c,d),o=re(c,n.x,d),s=re(i.y,u,d),l=re(u,n.y,d),t&&(g=r.x-a,p=o-r.x,h=(l-r.y)/p,(r.y-i.y)*(n.y-r.y)<=0?h=0:(r.y>i.y==l>n.y&&(p=re(p*(f=(n.y-r.y)/(l-r.y)),p,1/(1+Math.abs(f))),h=(n.y-r.y)/p),r.y>i.y==s<i.y&&(g=re(g*(f=(r.y-i.y)/(r.y-s)),g,1/(1+Math.abs(f))),h=(r.y-i.y)/g)),a=r.x-g,o=r.x+p,s=r.y-h*g,l=r.y+h*p)),m[x-4]={x:a,y:s},m[x-2]={x:o,y:l};b=m.slice(0)}return b}function re(e,t,i){return e+i*(t-e)}var ne={linear:e=>e,step:function(e){for(var t,i,r,n,a=[],s=void 0!==e[0].id,o=void 0!==e[0].size,l=1;l<e.length;l++)t=e[l-1],i=e[l],r={x:(t.x+i.x)/2,y:t.y},n={x:(t.x+i.x)/2,y:i.y},s&&(r.id=`${t.id}-${i.id}-1`,n.id=`${t.id}-${i.id}-2`),o&&(r.size=t.size,n.size=i.size),1===l&&a.push(t),a.push(r,n,i);return a},"step-before":function(e){for(var t,i,r,n=[],a=void 0!==e[0].id,s=void 0!==e[0].size,o=1;o<e.length;o++)t=e[o-1],i=e[o],r={x:t.x,y:i.y},a&&(r.id=`${t.id}-${i.id}`),s&&(r.size=i.size),1===o&&n.push(t),n.push(r,i);return n},"step-after":function(e){for(var t,i,r,n=[],a=void 0!==e[0].id,s=void 0!==e[0].size,o=1;o<e.length;o++)t=e[o-1],r={x:(i=e[o]).x,y:t.y},a&&(r.id=`${t.id}-${i.id}`),s&&(r.size=t.size),1===o&&n.push(t),n.push(r,i);return n}},ae={smooth:function(e){return ie(e,!1)},"smooth-keep-extremum":function(e){return ie(e,!0)}};function se(e){return ne[e]||ae[e]}function oe(e){return void 0!==ae[e]?"cubic":"polyline"}const le={...s,...C};var ce=()=>lt(e=>e.node().getComputedTextLength(),e=>e.node().textContent.length),ue=(e,t,i)=>{i=i||ce(),e.each(function(){var e=le.select(this.parentNode).data()[0],r=t(e),n=le.select(this),a=n.text().split(/\s+/),s=!1,o=a.reduce((e,t,a)=>{if(s)return e;var o=a>0?[e,t].join(" "):t,l=i(n.text(o));if(l<r)e=o;else{var c=Math.floor(r/l*o.length);e=o.substr(0,c-4)+"...",s=!0}return e},"");n.text(o)})},de=(e,t,i,r,n,a)=>{a=a||ce();var s=(e,t,i,r,n,a,s)=>{var o=s*i+a;return e.append("tspan").attr("x",r).attr("y",n).attr("dy",o+"em").text(t)};e.each(function(){var e=le.select(this.parentNode).data()[0],o=t(e),l=le.select(this),c=l.text().split(/\s+/),u=l.attr("x"),d=l.attr("y"),h=parseFloat(l.attr("dy"));l.text(null);var g=s(l,null,1.1,u,d,h,0),p=!1,f=c.length-1,m=c.reduce((e,t,r)=>{if(p)return e;var n=e.length===i||r===f,s=e[e.length-1],l=""!==s?s+" "+t:t,c=a(g.text(l)),u=c>o;if(u&&n){var d=Math.floor(o/c*l.length);e[e.length-1]=l.substr(0,d-4)+"...",p=!0}return u&&!n&&e.push(t),u||(e[e.length-1]=l),e},[""]).filter(e=>e.length>0);d=n?-1*(m.length-1)*Math.floor(.5*r):d,m.forEach((e,t)=>s(l,e,1.1,u,d,h,t)),g.remove()})};var he=(e,t,i)=>(t>0&&!document.hidden&&((e=e.transition(i).duration(t)).attr=ge),e.onTransitionEnd=function(e){return me(this,e),this},e),ge=function(e,t){var i,r=le.transition.prototype.attr.apply(this,arguments);if(0===arguments.length)throw new Error("Unexpected `transition().attr()` arguments.");1===arguments.length?i=e:arguments.length>1&&(i={[e]:t});var n="__transitionAttrs__",a="__lastTransitions__",s=fe();this.each(function(){var e={};for(var t in i)"function"==typeof i[t]?e[t]=i[t].apply(this,arguments):e[t]=i[t];this[n]=Object.assign(this[n]||{},e),this[n][a]||Object.defineProperty(this[n],a,{value:{}}),Object.keys(e).forEach(e=>this[n][a][e]=s)});var o=function(){this[n]&&(Object.keys(i).filter(e=>this[n][a][e]===s).forEach(e=>delete this[n][e]),0===Object.keys(this[n]).length&&delete this[n])};return this.on(`interrupt.${s}`,()=>this.each(o)),this.on(`end.${s}`,()=>this.each(o)),r},pe=0,fe=function(){return++pe},me=(e,t)=>{if(le.transition.prototype.isPrototypeOf(e)&&!e.empty()){var i=()=>t.call(null,e);return e.on("interrupt.d3_on_transition_end",i),e.on("end.d3_on_transition_end",i),e}t.call(null,e)},ye=(e,t,i,r)=>{const n=r||(e=>e),a=function(){n(this)};return function(r){var n=r;return t&&(n=n.call(ve(st(t,i)))),n=(n=he(n,e)).call(ve(i)),e>0?n.on("end.d3_animationInterceptor",()=>n.each(a)):n.each(a),n}},xe=(e,t)=>{var i=e.node();return e.selectAll(t).filter(function(){return this.parentNode===i})},be=(e,t,i,r,n="linear")=>{const a="__pathPoints__";return function(e){this[a]||(this[a]=i.map(()=>[]));const s=i.map((t,i)=>{const s=it(e,r).map(t),o=(se(n)||se("linear"))(s),l=this[a][i];return{pointsFrom:l,pointsTo:o,interpolate:W(l,o,oe(n))}});return e=>{if(0===e){let e=s.map(e=>e.pointsFrom);return t(...e)}if(1===e){let e=s.map(e=>e.pointsTo);return this[a]=e,t(...e)}const i=s.map(t=>t.interpolate(e));return this[a]=i,t(...i)}}},ve=e=>t=>(Object.keys(e).forEach(i=>t.attr(i,e[i])),t),we=e=>t=>(Object.keys(e).forEach(i=>t.classed(i,e[i])),t);class _e extends g{constructor(e){super(e),this.config=e,this.config.guide=st(this.config.guide||{},{animationSpeed:0,enableColorToBarPosition:!1}),this.config.guide.size=this.config.guide.size||{};var t=this.config.stack,i=this.config.guide.enableColorToBarPosition,r=[e.flip&&w.get("flip"),t&&w.get("stack"),i&&w.get("positioningByColor")];this.decorators=(this.config.transformRules||r).concat(e.transformModel||[]),this.adjusters=(this.config.adjustRules||[]).concat(e.adjustScales||[])}defineGrammarModel(e){const t=this.config;this.regScale("x",e("pos",t.x,[0,t.options.width])).regScale("y",e("pos",t.y,[t.options.height,0])).regScale("y",e("pos",t.y,e=>["ordinal","period"].indexOf(e.type)>=0?[0,t.options.height]:[t.options.height,0])).regScale("size",e("size",t.size,{})).regScale("color",e("color",t.color,{})).regScale("split",e("split",t.split,{})).regScale("label",e("label",t.label,{})).regScale("identity",e("identity",t.identity,{}));const i=this.getScale("x"),r=this.getScale("y"),n=this.getScale("size"),a=this.getScale("label"),s=this.getScale("color"),o=this.getScale("split"),l=this.getScale("identity"),c=r.domain(),u=r.discrete?c[0]:Math.max(0,Math.min(...c)),d=r.value(u)+.5*r.stepSize(u),h=s.domain(),g={data:()=>this.data(),flip:!1,scaleX:i,scaleY:r,scaleSize:n,scaleLabel:a,scaleColor:s,scaleSplit:o,scaleIdentity:l,color:e=>s.value(e[s.dim]),label:e=>a.value(e[a.dim]),group:e=>`${e[s.dim]}(@taucharts@)${e[o.dim]}`,order:e=>{const t=e.split("(@taucharts@)")[0],i=h.indexOf(t);return i<0?Number.MAX_VALUE:i},size:e=>n.value(e[n.dim]),id:e=>l.value(e[l.dim],e),xi:e=>i.value(e[i.dim]),yi:e=>r.value(e[r.dim]),y0:()=>d};return g.data().forEach(e=>g.id(e)),g}getGrammarRules(){return this.decorators.filter(e=>e)}getAdjustScalesRules(){return(this.adjusters||[]).filter(e=>e)}createScreenModel(e){const t=e.flip,i=(e,t,i)=>e?t:i;return{flip:t,id:e.id,x:i(t,e.yi,e.xi),y:i(t,e.xi,e.yi),x0:i(t,e.y0,e.xi),y0:i(t,e.xi,e.y0),size:e.size,group:e.group,order:e.order,label:e.label,color:t=>e.scaleColor.toColor(e.color(t)),class:t=>e.scaleColor.toClass(e.color(t)),model:e,toFibers:()=>{const t=rt(e.data(),e.group);return Object.keys(t).sort((t,i)=>e.order(t)-e.order(i)).reduce((e,i)=>e.concat([t[i]]),[])}}}drawFrames(){var e=this,t=this.config.options,i=t=>((e,t)=>{var i=Math.pow(10,t);return Math.round(i*e)/i})(e.screenModel.size(t)/2,4),r=ye,n=function(t,i,n){var a=e.config.guide.animationSpeed,o=t.selectAll(`.${i}`).data(e=>[e],e.screenModel.id);o.exit().call(r(a,null,{width:0},e=>s.select(e).remove())),o.call(r(a,null,n)),o.enter().append("rect").style("stroke-width",0).call(r(a,{width:0},n))},a=this.config.flip,o=a?"y":"x",l=a?"x":"y",c=a?"x0":"y0",u=a?"height":"width",d=a?"width":"height",h=function(t){n(t,"lvl-top",{[u]:e=>i(e),[d]:1,[o]:t=>e.screenModel[o](t)-i(t)/2,[l]:t=>e.screenModel[l](t),fill:t=>e.screenModel.color(t),class:t=>`lvl-top ${e.screenModel.class(t)}`}),n(t,"lvl-btm",{[u]:e=>i(e),[d]:1,[o]:t=>e.screenModel[o](t)-i(t)/2,[l]:t=>e.screenModel[c](t),fill:t=>e.screenModel.color(t),class:t=>`lvl-btm ${e.screenModel.class(t)}`}),n(t,"lvl-link",{[u]:.5,[d]:t=>Math.abs(e.screenModel[l](t)-e.screenModel[c](t)),[o]:t=>e.screenModel[o](t)-.25,[l]:t=>Math.min(e.screenModel[l](t),e.screenModel[c](t)),fill:t=>e.screenModel.color(t),class:t=>`lvl-link ${e.screenModel.class(t)}`})},g=function(t){t.attr("class",`frame-id-${e.config.uid}`).call(function(t){var i=t.selectAll(".generic").data(e=>e,e.screenModel.id);i.exit().remove(),i.call(h),i.enter().append("g").attr("class","generic").call(h)})},p=rt(this.data(),e.screenModel.group),f=Object.keys(p).sort((t,i)=>e.screenModel.order(t)-e.screenModel.order(i)).reduce((e,t)=>e.concat([p[t]]),[]),m=t.container.selectAll(`.frame-id-${e.config.uid}`).data(f);m.exit().remove(),m.call(g),m.enter().append("g").call(g)}}const Se={...o,...l};function Me(e,t,i,r){var n=r(i(e),e);return(n[t]||[]).forEach(e=>Me(e,t,i,r)),n}function ke(e,t,i,r=0){t(e,r)&&(e.units||[]).map(e=>ke(e,t,i,r+1)),i(e,r)}var Ee=function(){var e=[];function t(e){for(var t in e)this[t]=e[t]}function i(){this.copiedObjects=[];var e=this;this.recursiveDeepCopy=function(t){return e.deepCopy(t)},this.depth=0}function r(e,t){var r=new i;return t&&(r.maxDepth=t),r.deepCopy(e)}return t.prototype={constructor:t,canCopy:function(e){return!1},create:function(e){},populate:function(e,t,i){}},i.prototype={constructor:i,maxDepth:256,cacheResult:function(e,t){this.copiedObjects.push([e,t])},getCachedResult:function(e){for(var t=this.copiedObjects,i=t.length,r=0;r<i;r++)if(t[r][0]===e)return t[r][1]},deepCopy:function(t){if(null===t)return null;if("object"!=typeof t)return t;var i=this.getCachedResult(t);if(i)return i;for(var r=0;r<e.length;r++){var n=e[r];if(n.canCopy(t))return this.applyDeepCopier(n,t)}throw new Error("no DeepCopier is able to copy "+t)},applyDeepCopier:function(e,t){var i=e.create(t);if(this.cacheResult(t,i),this.depth++,this.depth>this.maxDepth)throw new Error("Exceeded max recursion depth in deep copy.");return e.populate(this.recursiveDeepCopy,t,i),this.depth--,i}},r.DeepCopier=t,r.deepCopiers=e,r.register=function(i){i instanceof t||(i=new t(i)),e.unshift(i)},r.register({canCopy:function(){return!0},create:function(e){return e instanceof e.constructor?"object"==typeof(t=e.constructor.prototype)?JSON.parse(JSON.stringify(t)):t:{};var t},populate:function(e,t,i){for(var r in t)t.hasOwnProperty(r)&&(i[r]=e(t[r]));return i}}),r.register({canCopy:function(e){return e instanceof Array},create:function(e){return new e.constructor},populate:function(e,t,i){for(var r=0;r<t.length;r++)i.push(e(t[r]));return i}}),r.register({canCopy:function(e){return e instanceof Date},create:function(e){return new Date(e)}}),r}(),Ae=e=>/^(#|rgb\(|rgba\()/.test(e),Te=/(.)^/;let Oe={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},Ce={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},Ne=/\\|'|\r|\n|\u2028|\u2029/g,Le="(?:"+Object.keys(Oe).join("|")+")",Fe=RegExp(Le),ze=RegExp(Le,"g"),Re={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};function $e(e){return Ee(e)}function De(e){return e instanceof Date&&!isNaN(Number(e))}function Pe(e){return null!=e&&"object"==typeof e}function je(e){var t=parseFloat(Math.min(...e).toFixed(15)),i=parseFloat(Math.max(...e).toFixed(15));if(t===i){i-=(i>=0?-1:1)*(i||1)/10}for(var r=[t=Math.min(0,t),i=Math.max(0,i)],n=r[1]-r[0],a=Math.pow(10,Math.floor(Math.log(n/10)/Math.LN10)),s=10/n*a,o=[[.15,10],[.35,5],[.75,2],[1,1],[2,1]],l=-1;s>o[++l][0];);a*=o[l][1],r[0]=Math.floor(r[0]/a)*a,r[1]=Math.ceil(r[1]/a)*a;var c=t-r[0],u=r[1]-i,d=a/2;if(t<0){var h=c>=d?-c:0;r[0]=r[0]-h}if(i>0){var g=u>=d?-u:0;r[1]=r[1]+g}return[parseFloat(r[0].toFixed(15)),parseFloat(r[1].toFixed(15))]}function Ie(e,t,{utc:i}={utc:!1}){var[r,n]=Se.extent(e),a=+n-+r,s=i?Se.scaleUtc:Se.scaleTime;if(0===a){return r=new Date(r.getTime()-864e5),n=new Date(n.getTime()+864e5),s().domain([r,n]).nice(t).domain()}var o=s().domain([r,n]).nice(t);if(t)return o.domain();var[l,c]=s().domain([r,n]).nice(t).domain(),u=o.ticks(),d=u.length-1;return(+r-+l)/(+u[1]-+l)<.5&&(r=l),(+c-+n)/(+c-+u[d-1])<.5&&(n=c),[r,n]}var Be=0,We={};function He(e){var t=btoa(encodeURIComponent(e)).replace(/=/g,"_");return We.hasOwnProperty(t)||(We[t]=`H${++Be}`),We[t]}function Ue(e,t,i){var r=0,n=null,a=lt((e,t)=>it(e.map(e=>t.reduce((t,i)=>t.concat((e=>De(e)?e.getTime():e)(e[i])),[])),e=>JSON.stringify(e)).reduce((e,t)=>{var i=t[0];return e[i]=e[i]||0,e[i]+=1,e},{}),(e,t)=>{let i=n===e?r:++r;return n=e,`${t.join("")}-${i}`});return(r,n,s)=>{var o=s.length,l=i.getSpec(),c=l.sources["/"].data,u=l.unit.units[0].guide||{};u.padding=u.padding||{l:0,r:0,t:0,b:0};var d=0;"x"===e?d=u.padding.l+u.padding.r:"y"===e&&(d=u.padding.t+u.padding.b);var h=(n-o*d)/(e=>{var t=a(c,e);return Object.keys(t).reduce((e,i)=>e+t[i],0)})(t);return(((e,t)=>a(c,e)[t])(t,r)*h+d)/n}}function Ge(e){var t=!0;try{ke(e,e=>{if(0===e.type.indexOf("COORDS.")&&"COORDS.RECT"!==e.type)throw new Error("Not applicable")},e=>e)}catch(e){"Not applicable"===e.message&&(t=!1)}return t}function qe(e,t,i,r=0){if("requestAnimationFrame"===r){var n=!1;return function(...r){n||(requestAnimationFrame(()=>{n=!1}),i.apply(this,r),n=!0),e.e=t,e.ts=Date.now()}}return function(...n){var a={e:t,ts:Date.now()};(e.e&&e.e===a.e?a.ts-e.ts:r)>=r&&i.apply(this,n),e.e=a.e,e.ts=a.ts}}function Xe(e,t){var i=e[0],r=e[1],n=(r-i)/(t-1),a=t>=2?Ze(t-2).map(e=>i+n*(e+1)):[];return[i,...a,r]}function Ye(e){return Ae(e)?e:""}function Ve(e){return Ae(e)?"":e}function Je(e){return e/180*Math.PI}function Ke(e){return Math.abs(e)>=360&&(e%=360),e<0&&(e=360+e),e}function Ze(e,t){1===arguments.length&&(t=e,e=0);const i=[];for(let r=e;r<t;r++)i.push(r);return i}function Qe(e,t,i,r){return e+t*(90===i?-1:1)-r>100}function et(e,t,i,r){return e+t*(-90===i?-1:1)-r>20}function tt(e){return Array.isArray(e)?[].concat(...e.map(e=>tt(e))):e}function it(e,t){for(var i={},r=[],n=e.length,a=t||(e=>String(e)),s=0;s<n;++s){var o=e[s],l=a(o);i.hasOwnProperty(l)||(i[l]=!0,r.push(o))}return r}function rt(e,t){return e.reduce((e,i)=>{var r=t(i);return e[r]=e[r]||[],e[r].push(i),e},{})}function nt(e,t){return it(e.concat(t))}function at(e,t){return e.filter(e=>-1!==t.indexOf(e))}function st(e,...t){var i=t.length;if(0===i||!e)return e;for(var r=0;r<i;r++)for(var n=t[r],a=Pe(n)?Object.keys(n):[],s=a.length,o=0;o<s;o++){var l=a[o];void 0===e[l]&&(e[l]=n[l])}return e}function ot(e,...t){let i=Object.assign({},e);return t.forEach(e=>{delete i[e]}),i}function lt(e,t){const i=function(r){const n=i.cache,a=String(t?t.apply(this,arguments):r);return n.hasOwnProperty(a)||(n[a]=e.apply(this,arguments)),n[a]};return i.cache={},i}function ct(...e){return(t,i)=>{var r=0;return e.every(e=>0===(r=e(t,i))),r}}function ut(e,...t){return null==e?{}:t.reduce((t,i)=>{let r=e[i];return r&&(t[i]=r),t},{})}function dt(e){return e=null==e?"":String(e),Fe.test(e)?e.replace(ze,e=>Oe[e]):e}function ht(e,t,i){!t&&i&&(t=i),t=st({},t,Re);var r=RegExp([(t.escape||Te).source,(t.interpolate||Te).source,(t.evaluate||Te).source].join("|")+"|$","g"),n=0,a="__p+='";e.replace(r,function(t,i,r,s,o){return a+=e.slice(n,o).replace(Ne,e=>"\\"+Ce[e]),n=o+t.length,i?a+="'+\n((__t=("+i+"))==null?'':utils.escape(__t))+\n'":r?a+="'+\n((__t=("+r+"))==null?'':__t)+\n'":s&&(a+="';\n"+s+"\n__p+='"),t}),a+="';\n",t.variable||(a="with(obj||{}){\n"+a+"}\n"),a="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+a+"return __p;\n";try{var s=new Function(t.variable||"obj",a)}catch(e){throw e.source=a,e}var o=function(e){return s.call(this,e)},l=t.variable||"obj";return o.source="function("+l+"){\n"+a+"}",o}function gt(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}const pt="  ",ft=32,mt=["img","input","br","embed","link","meta","area","base","basefont","bgsound","col","command","frame","hr","image","isindex","keygen","menuitem","nextid","param","source","track","wbr","circle","ellipse","line","path","polygon","rect"].reduce((e,t)=>(e[t]=!0,e),{});function yt(e){var t=2,i=arguments[1];("object"!=typeof arguments[1]||Array.isArray(arguments[1]))&&(t=1,i={});const r=tt(Array.prototype.slice.call(arguments,t)),n=1===r.length&&"<"!==r[0].trim()[0],a=mt[e];if(a&&r.length>0)throw new Error(`Tag "${e}" is void but content is assigned to it`);const s=`<${e}`;var o=Object.keys(i).map(function(e){return` ${e}="${i[e]}"`}).join("");o.length>ft&&(o=Object.keys(i).map(function(e){return`\n${pt}${e}="${i[e]}"`}).join(""));const l=n?r[0]:"\n"+r.map(e=>{return String(e).split("\n").map(e=>`${pt}${e}`).join("\n")}).join("\n")+"\n";return`${s}${o}${a?"/>":`>${l}</${e}>`}`}function xt(e){var t=e;const i={then:e=>(t=e(t),i),result:()=>t};return i}const bt=[_e];function vt(e){return bt.some(t=>e instanceof t)}function wt(e){return(e.units||[]).some(e=>e.hasOwnProperty("units"))}var _t=document.createElement("div"),St=new WeakMap;function Mt(e,t){var i;return e instanceof Node?i=e:(_t.insertAdjacentHTML("afterbegin",e),i=_t.childNodes[0]),t.appendChild(i),i}function kt(e){if(St.has(e))return St.get(e);var t=e.style.overflow;e.style.overflow="scroll";var i={width:e.offsetWidth-e.clientWidth,height:e.offsetHeight-e.clientHeight};return e.style.overflow=t,St.set(e,i),i}function Et(e,t){var i="horizontal"===(t=t||"both")||"both"===t,r="vertical"===t||"both"===t,n=kt(e),a=r?`${n.width}px`:"0",s=i?`${n.height}px`:"0";e.style.overflow="hidden",e.style.padding=`0 ${a} ${s} 0`;var o=e.scrollWidth>e.clientWidth,l=e.scrollHeight>e.clientHeight,c=r&&!l?`${n.width}px`:"0",u=i&&!o?`${n.height}px`:"0";return e.style.padding=`0 ${c} ${u} 0`,e.style.overflow="",e.style.overflowX=o?"scroll":"hidden",e.style.overflowY=l?"scroll":"hidden",n}function At(e,t){return window.getComputedStyle(e).getPropertyValue(t)}function Tt(e,t){return parseInt(At(e,t)||"0",10)}function Ot(e){var t=Tt(e,"padding-left"),i=Tt(e,"padding-right"),r=Tt(e,"padding-bottom"),n=Tt(e,"padding-top"),a=Tt(e,"border-top-width")+Tt(e,"border-left-width")+Tt(e,"border-right-width")+Tt(e,"border-bottom-width"),s=e.getBoundingClientRect();return{width:s.width-t-i-2*a,height:s.height-r-n-2*a}}function Ct(e){var t=document.createElement("div");t.style.position="absolute",t.style.visibility="hidden",t.style.width="100px",t.style.height="100px",t.style.border="1px solid green",t.style.top="0",document.body.appendChild(t),t.innerHTML='<svg class="tau-chart__svg">\n                <g class="tau-chart__cell cell">\n                <g class="x axis">\n                <g class="tick"><text></text></g>\n                </g>\n                </g>\n                </svg>';var i=t.querySelector(".x.axis .tick text");i.textContent=e;var r={width:0,height:0},n=i.getBoundingClientRect();r.width=n.right-n.left,r.height=n.bottom-n.top;var a=0!==e.length?r.width/e.length:0;return r.width=r.width+1.5*a,document.body.removeChild(t),r}function Nt(e,{fontSize:t,fontFamily:i,fontWeight:r}){var n="string"==typeof t?t:`${t}px`,a=e.map(function(e){for(var t=0,a=0;t<=e.length-1;t++){a+=Lt(e.charAt(t),{fontSize:n,fontFamily:i,fontWeight:r}).width}return a}).sort(function(e,t){return t-e})[0],s=e.length,o=parseInt(n);return{width:a,height:o*s+.39*o*s}}const Lt=lt((e,{fontSize:t,fontFamily:i,fontWeight:r})=>{var n=document.createElement("div");n.style.position="absolute",n.style.visibility="hidden",n.style.border="0px",n.style.top="0",n.style.fontSize=t,n.style.fontFamily=i,n.style.fontWeight=r,document.body.appendChild(n),n.innerHTML=" "===e?"&nbsp;":e;var a={width:0,height:0},s=n.getBoundingClientRect();return a.width=s.right-s.left,a.height=s.bottom-s.top,document.body.removeChild(n),a},(e,t)=>`${e}_${JSON.stringify(t)}`);function Ft(e,t){var i={".":(e,t)=>t.classed(e,!0),"#":(e,t)=>t.attr("id",e)},r=Object.keys(i).join("");if(t.indexOf(" ")>=0)throw new Error("Selector should not contain whitespaces.");if(r.indexOf(t[0])>=0)throw new Error("Selector must have tag at the beginning.");var n,a=e instanceof Element,o=a?s.select(e):e,l=e=>a?e.node():e,c=o.selectAll(t).filter(function(){return this.parentNode===o.node()}).filter((e,t)=>0===t);if(!c.empty())return l(c);for(var u,d=-1,h=null,g=1,p=t.length;g<=p;g++)(g==p||r.indexOf(t[g])>=0)&&(u=t.substring(d+1,g),d<0?n=o.append(u):i[h].call(null,u,n),h=t[g],d=g);return l(n)}function zt(e,t){return Rt(e,t)[0]||null}function Rt(e,t){for(var i=[],r=Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,n=e.firstElementChild;Boolean(n);n=n.nextElementSibling)r.call(n,t)&&i.push(n);return i}function $t(e,t){if(e.childElementCount>0){const n=Array.prototype.filter.call(e.childNodes,e=>e.nodeType===Node.ELEMENT_NODE),a=n.slice().sort(t),s=n.reduce((e,t,i)=>(e.set(t,i),e),new Map);var i,r;const o=a.reduce((e,t,n)=>{const o=s.get(t),l=n-o;return l!==r&&(i&&e.push(i),r=l,i={from:o,to:n,elements:[]}),i.elements.push(t),n===a.length-1&&e.push(i),e},[]),l=o.slice().sort((e,t)=>e.from-t.from),c=l.reduce((e,t,i)=>(e.set(t,i),e),new Map),u=e=>{const t=o.map((e,t)=>({elements:e.elements,from:c.get(e),to:t})).sort(ct((e,t)=>e.elements.length-t.elements.length,e?(e,t)=>t.to-e.to:(e,t)=>e.to-t.to));for(var i,r,n,a=0;a<t.length;a++){if((r=t[a]).from>r.to)for(i=a+1;i<t.length;i++)(n=t[i]).from>=r.to&&n.from<r.from&&n.from++;if(r.from<r.to)for(i=a+1;i<t.length;i++)(n=t[i]).from>r.from&&n.from<=r.to&&n.from--}return t.filter(e=>e.from!==e.to)},d=u(!0),h=u(!1),g=d.length<h.length?d:h,p=l.map(e=>e.elements);g.forEach(t=>{const i=p.splice(t.from,1)[0],r=p[t.to],n=r?r[0]:null;var a;1===t.elements.length?a=i[0]:(a=document.createDocumentFragment(),i.forEach(e=>{a.appendChild(e)})),e.insertBefore(a,n),p.splice(t.to,0,i)})}}function Dt(...e){var t=[];return e.filter(e=>Boolean(e)).forEach(e=>{"string"==typeof e?t.push(e):"object"==typeof e&&t.push.apply(t,Object.keys(e).filter(t=>Boolean(e[t])))}),it(t).join(" ").trim().replace(/\s{2,}/g," ")}function Pt(e,t,...i){const r=document.createEvent("MouseEvents"),n=[!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null],a=i.concat(n.slice(i.length));r.initMouseEvent(t,...a),e.dispatchEvent(r)}var jt=e=>De(e)?e.getTime():e,It={cross(e,t,i){var r=e(),n=it(r.map(e=>e[t]),jt),a=it(r.map(e=>e[i]),jt),s=0===n.length?[null]:n;return(0===a.length?[null]:a).reduce((e,r)=>e.concat(s.map(e=>{var n={};return t&&(n[t]=jt(e)),i&&(n[i]=jt(r)),n})),[])},cross_period(e,t,i,r,n,a){var s=e(),o=!!a&&a.utcTime,l=it(s.map(e=>e[t]),jt),c=it(s.map(e=>e[i]),jt),u=0===l.length?[null]:l,d=0===c.length?[null]:c;return r&&(u=y.generate(Math.min(...l),Math.max(...l),r,{utc:o})),n&&(d=y.generate(Math.min(...c),Math.max(...c),n,{utc:o})),d.reduce((e,r)=>e.concat(u.map(e=>{var n={};return t&&(n[t]=jt(e)),i&&(n[i]=jt(r)),n})),[])},groupBy:(e,t)=>it(e().map(e=>e[t]),jt).map(e=>({[t]:jt(e)})),none:()=>[null]};class Bt{constructor({key:e,pipe:t,source:i,units:r},n,a={}){this.key=e,this.pipe=t||[],this.source=i,this.units=r,this._frame={key:e,source:i,pipe:this.pipe},this._data=n,this._pipeReducer=((e,t)=>a[t.type](e,t.args))}hash(){return He([this._frame.pipe,this._frame.key,this._frame.source].map(e=>JSON.stringify(e)).join(""))}full(){return this._data}part(e=(e=>e)){return this._frame.pipe.map(e).reduce(this._pipeReducer,this._data)}}var Wt=e=>De(e)?e.getTime():e;const Ht=function(e){Object.keys(e).forEach(t=>this[t]=e[t])},Ut=(e,t,i)=>e.map(e=>"string"==typeof e?i.get(e):e).filter(e=>e).reduce((e,t)=>((e,t={})=>Object.assign(new Ht(e),t))(e,t(e,{})),t);class Gt extends h{constructor(e,t,i,r){super(),st(e.scales,{size_null:{type:"size",source:"?"},split_null:{type:"value",source:"?"},label_null:{type:"value",source:"?"},color_null:{type:"color",source:"?"},identity_null:{type:"identity",source:"?"},"size:default":{type:"size",source:"?"},"color:default":{type:"color",source:"?"},"split:default":{type:"value",source:"?"},"label:default":{type:"value",source:"?"},"identity:default":{type:"identity",source:"?"}}),e.settings=e.settings||{},this.config=e,this.sources=e.sources,this.scales=e.scales,this.unitSet=i,this.grammarRules=r,this.scalesHub=t,this.transformations=Object.assign(e.transformations||{},{where(e,t){var i=Object.keys(t||{}).map(e=>i=>Wt(i[e])===t[e]);return e.filter(e=>i.every(t=>t(e)))}})}static traverseSpec(e,t,i,r=null,n=null){var a=[],s=(e,t,i,r,n)=>{a.push(()=>{t(e,r,n)}),e.frames&&e.frames.forEach(r=>{(r.units||[]).map(n=>s(n,t,i,e,r))}),a.push(()=>i(e,r,n))};return s(e.unit,t,i,r,n),a}unfoldStructure(){return this.root=this._expandUnitsStructure(this.config.unit),this.config}getDrawScenarioQueue(e){const t=this.grammarRules;var i=this._flattenDrawScenario(e,(e,i,r)=>{const n=!1===i.expression.inherit?null:r,a=this._createFrameScalesFactoryMethod(n),s=this.unitSet.create(i.type,Object.assign({},i,{options:e.allocateRect(r.key)})),o=new Ht(s.defineGrammarModel(a)),l=Ut(s.getGrammarRules(),o,t);return Ut(s.getAdjustScalesRules(),l,t),s.node().screenModel=s.createScreenModel(l),s}),r=this._flattenDrawScenario(e,(e,i,r)=>{const n=!1===i.expression.inherit?null:r,a=this._createFrameScalesFactoryMethod(n),s=this.unitSet.create(i.type,Object.assign({},i,{options:e.allocateRect(r.key)})),o=new Ht(s.defineGrammarModel(a)),l=Ut(s.getGrammarRules(),o,t);return s.node().screenModel=s.createScreenModel(l),s.parentUnit=e,s.addInteraction(),s});return i.concat(()=>{Object.keys(this.scales).forEach(e=>this.scalesHub.createScaleInfo(this.scales[e]).commit())}).concat(r)}_flattenDrawScenario(e,t){var i={},r=[],n=[e],a=Gt.traverseSpec({unit:this.root},(e,a,s)=>{e.uid=(()=>{var t=He((a?`${a.uid}/`:"")+JSON.stringify(Object.keys(e).filter(t=>"string"==typeof e[t]).reduce((t,i)=>(t[i]=e[i],t),{}))+`-${JSON.stringify(s.pipe)}`);return i.hasOwnProperty(t)?t+=`-${++i[t]}`:i[t]=0,t})(),e.guide=$e(e.guide);var o=t((()=>n[0])(),e,s);r.push(o),0===e.type.indexOf("COORDS.")&&(e=>n.unshift(e))(o)},e=>{0===e.type.indexOf("COORDS.")&&(()=>n.shift())()},null,this._datify({source:this.root.expression.source,pipe:[]}));return a.push(()=>r),a}_expandUnitsStructure(e,t=[]){var i=this;if(!1===e.expression.operator)e.frames=e.frames.map(e=>i._datify(e));else{var r=this._parseExpression(e.expression,t,e.guide);e.transformation=e.transformation||[],e.frames=r.exec().map(n=>{var a=(r.inherit?t:[]).concat([{type:"where",args:n}]).concat(e.transformation);return i._datify({key:n,pipe:a,source:r.source,units:e.units?e.units.map(e=>{var t=$e(e);return t.guide=e.guide,t}):[]})})}return e.frames.forEach(e=>e.units.forEach(t=>this._expandUnitsStructure(t,e.pipe))),e}_createFrameScalesFactoryMethod(e){var t=this;return(i,r,n)=>{var a=r||`${i}:default`;return t.scalesHub.createScaleInfo(t.scales[a],e).create("function"==typeof n?n(t.scales[a]):n)}}_datify(e){return new Bt(e,this.sources[e.source].data,this.transformations)}_parseExpression(e,t,i){var r=e.operator||"none",n=e.source,a=!1!==e.inherit,s=e.params,o={source:n,pipe:a?t:[]},l=()=>this._datify(o).part(),c=It[r];if(!c)throw new Error(`${r} operator is not supported`);return{source:n,inherit:a,func:c,args:s,exec:()=>c(l,...s||[],i)}}}var qt=i(10);qt.Tooltip.defaults.baseClass=N+"tooltip";const Xt=["top","bottom"];class Yt extends qt.Tooltip{_pickPlace(e){if(!this.options.auto)return this.options.place;const t=0|this.options.winBound,i=(r=t,{top:(n=function(){const e=window,t=document.documentElement,i=(e.pageYOffset||t.scrollTop)-t.clientTop,r=(e.pageXOffset||t.scrollLeft)-t.clientTop,n=e.innerWidth||t.clientWidth,a=e.innerHeight||t.clientHeight;return{top:i,right:r+n,bottom:i+a,left:r,width:n,height:a}}()).top+r,right:n.right-r,bottom:n.bottom-r,left:n.left+r,width:n.width-2*r,height:n.height-2*r});var r,n,a=this.options.place.split("-"),s=this.spacing;if(-1!==Xt.indexOf(a[0]))switch(e.top-this.height-s<=i.top?a[0]="bottom":e.bottom+this.height+s>=i.bottom&&(a[0]="top"),a[1]){case"left":e.right-this.width<=i.left&&(a[1]="right");break;case"right":e.left+this.width>=i.right&&(a[1]="left");break;default:e.left+e.width/2+this.width/2>=i.right?a[1]="left":e.right-e.width/2-this.width/2<=i.left&&(a[1]="right")}else switch(e.left-this.width-s<=i.left?a[0]="right":e.right+this.width+s>=i.right&&(a[0]="left"),a[1]){case"top":e.bottom-this.height<=i.top&&(a[1]="bottom");break;case"bottom":e.top+this.height>=i.bottom&&(a[1]="top");break;default:e.top+e.height/2+this.height/2>=i.bottom?a[1]="top":e.bottom-e.height/2-this.height/2<=i.top&&(a[1]="bottom")}return a.join("-")}}class Vt{constructor(e,t){this.chart=t,this.handlers=new Map,this.plugins=e.map(this.initPlugin,this)}initPlugin(e){e.init&&e.init(this.chart);const t=[];this.handlers.set(e,t);const i=(i,r)=>{t.push(this.chart.on(i,r,e))};return e.destroy&&i("destroy",e.destroy.bind(e)),Object.keys(e).forEach(t=>{if(0===t.indexOf("on")){const r=t.substr(2).toLowerCase();i(r,e[t].bind(e))}}),e}destroyPlugin(e){e.destroy&&e.destroy(),this.handlers.get(e).forEach(t=>{this.chart.removeHandler(t,e)})}destroy(){this.plugins.forEach(e=>this.destroyPlugin(e))}}var Jt={},Kt={},Zt={reg(e,t,i){return i?(Kt[e]=i,Jt[e]=function(e,t){this.___tauchartsseed___=new t(this.init(e))},Jt[e].prototype=Object.assign({init:e=>e,defineGrammarModel(e){return this.node().defineGrammarModel(e)},getGrammarRules(e){return this.node().getGrammarRules(e)},getAdjustScalesRules(e){return this.node().getAdjustScalesRules(e)},createScreenModel(e){return this.node().createScreenModel(e)},addInteraction(){this.node().addInteraction()},node(){return this.___tauchartsseed___},draw(){this.node().draw()}},t)):Jt[e]=t,this},get(e){if(!Jt.hasOwnProperty(e))throw new x("Unknown unit type: "+e,b.UNKNOWN_UNIT_TYPE);return Jt[e]},create(e,t){var i,r=this.get(e);Kt[e]?i=new r(t,this.get(Kt[e])):i=new r(t);return i}},Qt={},ei={};const ti={reg:(e,t,i=(e=>e))=>(Qt[e]=t,ei[e]=i,ti),get:e=>Qt[e],instance:(e={})=>({create:function(t,i,r){return new(ti.get(t))(i,(0,ei[t])(r,e))}})};class ii{constructor(e,t,i){this.registry=e,this.sources=t,this.scales=i}createScaleInfo(e,t=null){var i=e.dim,r=e.source,n=(this.sources[r].dims[i]||{}).type,a=this.sources[r].data,s=t||new Bt({source:r},a);return e.dimType=n,this.registry.create(e.type,s,e)}createScaleInfoByName(e,t=null){return this.createScaleInfo(this.scales[e],t)}}var ri={isYFunctionOfX:(e,t,i)=>{var r=!0,n=null;try{e.reduce((e,r)=>{var a=(e,t)=>{var i=r[t],n=Pe(i)?JSON.stringify(i):i;return e.push(n),e},s=t.reduce(a,[]).join("/"),o=i.reduce(a,[]).join("/");if(e.hasOwnProperty(s)){var l=e[s];if(l!==o)throw n={type:"RelationIsNotAFunction",keyX:t.join("/"),keyY:i.join("/"),valX:s,errY:[l,o]},new Error("RelationIsNotAFunction")}else e[s]=o;return e},{})}catch(e){if("RelationIsNotAFunction"!==e.message)throw e;r=!1}return{result:r,error:n}},excludeNullValues:(e,t)=>{var i=Object.keys(e).reduce((t,i)=>{var r=e[i];return r.hasOwnProperty("hasNull")&&!r.hasNull||"measure"!==r.type&&"period"!==r.scale||t.push(i),t},[]);return e=>{var r=!i.some(t=>!e.hasOwnProperty(t)||null===e[t]);return r||t(e),r}},autoAssignScales:function(e){var t={category:"ordinal",order:"ordinal",measure:"linear"},i={};return Object.keys(e).forEach(r=>{var n=e[r],a=(n.type||"category").toLowerCase();i[r]=Object.assign({},n,{type:a,scale:n.scale||t[a],value:n.value})}),i},autoDetectDimTypes:function(e){var t={type:"category",scale:"ordinal"};return e.reduce((e,i)=>(Object.keys(i).forEach(r=>{var n=i.hasOwnProperty(r)?i[r]:null;if(e[r]=e[r]||{type:null,hasNull:!1},null===n)e[r].hasNull=!0;else{var a=((e,t)=>{var i=t;return De(e)?(i.type="measure",i.scale="time"):Pe(e)?(i.type="order",i.scale="ordinal"):Number.isFinite(e)&&(i.type="measure",i.scale="linear"),i})(n,$e(t)),s=a.type,o=a.scale,l=null!==e[r].type&&e[r].type!==s;e[r].type=l?t.type:s,e[r].scale=l?t.scale:o}}),e),{})},sortByDim:function(e,t,i){var r=e,n=["period","time"].indexOf(i.scale)>=0?e=>new Date(e):e=>e;const a=e.reduce((e,t,i)=>(e.set(t,i),e),new Map);if("measure"===i.type||"period"===i.scale)r=e.slice().sort(ct((e,i)=>n(e[t])-n(i[t]),(e,t)=>a.get(e)-a.get(t)));else if(i.order){var s=i.order.reduce((e,t,i)=>(e[t]=i,e),{}),o=i.order.length,l=`(___${t}___)`;r=e.map(e=>{var i=s[e[t]];return i=i>=0?i:o,e[l]=i,e}).sort(ct((e,t)=>e[l]-t[l],(e,t)=>a.get(e)-a.get(t))).map(e=>(delete e[l],e))}return r}},ni=function(e,t){var i=document.createElement("div");return i.classList.add(N+e),t&&t.appendChild(i),i},ai=function(){var e=ni("layout"),t=ni("layout__header",e),i=ni("layout__container",e),r=ni("layout__sidebar",i),n=ni("layout__content",i),a=ni("layout__content__wrap",n),s=ni("layout__sidebar-right",i);return{layout:e,header:t,content:a,contentContainer:n,leftSidebar:r,rightSidebar:ni("layout__sidebar-right__wrap",s),rightSidebarContainer:s,footer:ni("layout__footer",e)}};class si{constructor(e){this.spec=e,this.dist={sources:{"?":{dims:{},data:[{}]},"/":{dims:{},data:[]}},scales:{x_null:{type:"ordinal",source:"?"},y_null:{type:"ordinal",source:"?"},size_null:{type:"size",source:"?"},color_null:{type:"color",source:"?"},split_null:{type:"value",source:"?"},"pos:default":{type:"ordinal",source:"?"},"size:default":{type:"size",source:"?"},"label:default":{type:"value",source:"?"},"color:default":{type:"color",source:"?"},"split:default":{type:"value",source:"?"}},settings:e.settings}}convert(){var e=this.spec,t=this.dist;return this.ruleAssignSourceDims(e,t),this.ruleAssignStructure(e,t),this.ruleAssignSourceData(e,t),this.ruleApplyDefaults(t),t}ruleApplyDefaults(e){var t=e.settings||{},i=(e,t,r)=>{t(e,r),(e.units||[]).map(r=>i(r,t,e))};i(e.unit,(e,i)=>{if(e.namespace="chart",e.guide=st(e.guide||{},{animationSpeed:t.animationSpeed||0,utcTime:t.utcTime||!1}),i&&!e.hasOwnProperty("units")){e=st(e,{x:i.x,y:i.y});var r=$e(i.guide)||{};e.guide.x=st(e.guide.x||{},r.x),e.guide.y=st(e.guide.y||{},r.y),e.expression.inherit=i.expression.inherit}return!i||e.guide&&e.guide.hasOwnProperty("obsoleteVerticalStackOrder")||(e.guide=Object.assign(e.guide||{},{obsoleteVerticalStackOrder:(i.guide||{}).obsoleteVerticalStackOrder})),e},null)}ruleAssignSourceData(e,t){var i=e.spec.dimensions||{},r=t.sources["/"].dims,n=(e,t)=>{let i=e[t];return Pe(i)&&!De(i)&&Object.keys(i).forEach(r=>e[t+"."+r]=i[r]),e};t.sources["/"].data=e.data.map(e=>{var t=Object.keys(e).reduce(n,e);return Object.keys(r).reduce((e,t)=>(e.hasOwnProperty(t)||(e[t]=null),null!==e[t]&&i[t]&&["period","time"].indexOf(i[t].scale)>=0&&(e[t]=new Date(e[t])),e),t)})}ruleAssignSourceDims(e,t){var i=e.spec.dimensions;t.sources["/"].dims=Object.keys(i).reduce((e,t)=>(e[t]={type:i[t].type},e),{})}ruleAssignStructure(e,t){var i=e=>{var r=$e(ot(e,"unit"));return this.ruleCreateScales(e,r,t.settings),r.expression=this.ruleInferExpression(e),e.unit&&(r.units=e.unit.map(i)),r},r=i(e.spec.unit);r.expression.inherit=!1,t.unit=r}ruleCreateScales(e,t,i){var r=e.guide||{};["identity","color","size","label","x","y","split"].forEach(n=>{e.hasOwnProperty(n)&&(t[n]=this.scalesPool(n,e[n],r[n]||{},i))})}ruleInferDim(e,t){var i=e,r=this.spec.spec.dimensions;if(!r.hasOwnProperty(i))return i;t.hasOwnProperty("tickLabel")?i=`${e}.${t.tickLabel}`:r[e].value&&(i=`${e}.${r[e].value}`);var n=this.dist.sources["/"].dims;return n.hasOwnProperty(i)||(n[i]={type:n[e].type},delete n[e]),i}scalesPool(e,t,i,r){var n=`${e}_${t}`;if(this.dist.scales.hasOwnProperty(n))return n;var a=this.spec.spec.dimensions,s={};if("color"===e&&null!==t&&(s={type:"color",source:"/",dim:this.ruleInferDim(t,i)},i.hasOwnProperty("brewer")&&(s.brewer=i.brewer),a[t]&&a[t].hasOwnProperty("order")&&(s.order=a[t].order),i.hasOwnProperty("min")&&(s.min=i.min),i.hasOwnProperty("max")&&(s.max=i.max),i.hasOwnProperty("nice")&&(s.nice=i.nice)),"size"===e&&null!==t&&(s={type:"size",source:"/",dim:this.ruleInferDim(t,i)},i.hasOwnProperty("func")&&(s.func=i.func),i.hasOwnProperty("min")&&(s.min=i.min),i.hasOwnProperty("max")&&(s.max=i.max),i.hasOwnProperty("minSize")&&(s.minSize=i.minSize),i.hasOwnProperty("maxSize")&&(s.maxSize=i.maxSize)),"label"===e&&null!==t&&(s={type:"value",source:"/",dim:this.ruleInferDim(t,i)}),"split"===e&&null!==t&&(s={type:"value",source:"/",dim:this.ruleInferDim(t,i)}),"identity"===e&&null!==t&&(s={type:"identity",source:"/",dim:this.ruleInferDim(t,i)}),a.hasOwnProperty(t)&&("x"===e||"y"===e)){if(s={type:a[t].scale,source:"/",dim:this.ruleInferDim(t,i)},a[t].hasOwnProperty("order")&&(s.order=a[t].order),i.hasOwnProperty("min")&&(s.min=i.min),i.hasOwnProperty("max")&&(s.max=i.max),i.hasOwnProperty("autoScale")?s.autoScale=i.autoScale:s.autoScale=!0,i.hasOwnProperty("nice")?s.nice=i.nice:s.nice=s.autoScale,i.hasOwnProperty("niceInterval")?s.niceInterval=i.niceInterval:s.niceInterval=null,i.hasOwnProperty("tickPeriod")&&(s.period=i.tickPeriod,s.type="period"),i.hasOwnProperty("tickPeriod")&&i.hasOwnProperty("timeInterval"))throw new Error('Use "tickPeriod" for period scale, "timeInterval" for time scale, but not both');if(i.hasOwnProperty("timeInterval")){s.period=i.timeInterval,s.type="time";let e=y.get(s.period,{utc:r.utcTime});i.hasOwnProperty("min")&&(s.min=e.cast(new Date(i.min))),i.hasOwnProperty("max")&&(s.max=e.cast(new Date(i.max)))}s.fitToFrameByDims=i.fitToFrameByDims,s.ratio=i.ratio}return this.dist.scales[n]=s,n}getScaleConfig(e,t){var i=`${e}_${t}`;return this.dist.scales[i]}ruleInferExpression(e){var t={operator:"none",params:[]},i=e.guide||{},r=i.x||{},n=i.y||{},a=this.getScaleConfig("x",e.x),s=this.getScaleConfig("y",e.y);return 0===e.type.indexOf("ELEMENT.")?e.color&&(t={operator:"groupBy",params:[this.ruleInferDim(e.color,i.color||{})]}):"COORDS.RECT"===e.type&&1===e.unit.length&&"COORDS.RECT"===e.unit[0].type&&(t=a.period||s.period?{operator:"cross_period",params:[this.ruleInferDim(e.x,r),this.ruleInferDim(e.y,n),a.period,s.period]}:{operator:"cross",params:[this.ruleInferDim(e.x,r),this.ruleInferDim(e.y,n)]}),Object.assign({inherit:!0,source:"/"},t)}}const oi={...i(6),...i(7)},li=oi.format(".4s"),ci=oi.format(".2r"),ui=oi.format(".1e"),di=(()=>{const e=/\.0+([^\d].*)?$/,t=/(\.\d+?)0+([^\d].*)?$/;return i=>i.replace(e,"$1").replace(t,"$1$2")})();var hi={_identity:(e,t)=>String(null==e?t:e),"x-num-auto":function(e){if(isNaN(e))return"NaN";var t=Math.abs(e);return di(t<1?0===t?"0":t<1e-6?ui(e):ci(e):li(e))},percent:function(e){return parseFloat((100*e).toFixed(2)).toString()+"%"},day:oi.timeFormat("%d-%b-%Y"),"day-utc":oi.utcFormat("%d-%b-%Y"),"day-short":oi.timeFormat("%d-%b"),"day-short-utc":oi.utcFormat("%d-%b"),week:oi.timeFormat("%d-%b-%Y"),"week-utc":oi.utcFormat("%d-%b-%Y"),"week-short":oi.timeFormat("%d-%b"),"week-short-utc":oi.utcFormat("%d-%b"),month:e=>{var t=0===new Date(e).getMonth()?"%B, %Y":"%B";return oi.timeFormat(t)(e)},"month-utc":e=>{var t=0===new Date(e).getUTCMonth()?"%B, %Y":"%B";return oi.utcFormat(t)(e)},"month-short":e=>{var t=0===new Date(e).getMonth()?"%b '%y":"%b";return oi.timeFormat(t)(e)},"month-short-utc":e=>{var t=0===new Date(e).getUTCMonth()?"%b '%y":"%b";return oi.utcFormat(t)(e)},"month-year":oi.timeFormat("%B, %Y"),"month-year-utc":oi.utcFormat("%B, %Y"),quarter:e=>{var t=new Date(e),i=t.getMonth();return"Q"+((i-i%3)/3+1)+" "+t.getFullYear()},"quarter-utc":e=>{var t=new Date(e),i=t.getUTCMonth();return"Q"+((i-i%3)/3+1)+" "+t.getUTCFullYear()},year:oi.timeFormat("%Y"),"year-utc":oi.utcFormat("%Y"),"x-time-auto":null},gi={get:(e,t)=>{var i=hi._identity,r=hi.hasOwnProperty(e),n=r?hi[e]:i;return r&&(n=hi[e]),!r&&e&&(n=(t=>{return(De(t)?oi.timeFormat(e):oi.format(e))(t)})),r||e||(n=i),null!==n?e=>n(e,t||""):null},add:(e,t)=>{hi[e]=t}},pi=e=>e.reduce((e,t)=>e+t,0);var fi=(e,t)=>{var i=t.guide||{},r={x:["label"],y:["label"],size:["label"],color:["label"],padding:[]};return Object.keys(r).forEach(t=>{let n=r[t];!function(e,t,i,r){var n=e.hasOwnProperty(i)?e[i]:{};n=n||{},r.forEach(e=>{Object.assign(t.guide[i][e],n[e])})}(i,e,t,n)}),Object.assign(e.guide,Object.keys(i).reduce((e,t)=>(r.hasOwnProperty(t)||(e[t]=i[t]),e),{})),e},mi=function(e,t,i){return e[t]=st(e[t]||{},{label:""}),e[t].label=Pe(e[t].label)?e[t].label:{text:e[t].label},e[t].label=st(e[t].label,i||{},{padding:32,rotate:0,textAnchor:"middle",cssClass:"label",dock:null}),e[t]},yi=function(e,t,i){return e[t]=st(e[t],i||{},{padding:0,density:30,rotate:0,tickPeriod:null,tickFormat:null,autoScale:!0}),e[t].tickFormat=e[t].tickFormat||e[t].tickPeriod,e[t].nice=e[t].hasOwnProperty("nice")?e[t].nice:e[t].autoScale,e[t]},xi=e=>{var t=e.units||[],i=!e.hasOwnProperty("units"),r=!t.some(e=>e.hasOwnProperty("units"));return{type:e.type,isLeaf:i,isLeafParent:!i&&r}},bi=function(e,t,i,r){if(0===e.length)return{width:0,height:0};if(null===t){var n=i("TauChart Library");return n.width=.625*r,n}e.every(e=>"number"==typeof e)&&(e=l.scaleLinear().domain(e).ticks());var a=e.reduce((e,i)=>{let r=t(i).toString().length;return!e.computed||r>e.computed?{value:i,computed:r}:e},{}).value;return i(t(a))},vi=(e,t)=>{var i=e.dimType,r=e.scaleType,n=[i,r,"*"].join(":"),a=[i,r].join(":");return t[n]||t[a]||t[i]||null},wi=(e,t,i)=>e.hasOwnProperty(`${t}:${i}`)?e[`${t}:${i}`]:e[`${t}`],_i=(e,t)=>{return["day","week","month"].indexOf(e)>=0&&(e+=`-short${t?"-utc":""}`),e},Si=({width:e,height:t},i)=>{var r=Math.abs(Je(i));return{width:Math.max(Math.cos(r)*e,t),height:Math.max(Math.sin(r)*e,t)}},Mi=(e,t="x")=>{var i=Ke(e),r="x"===t?[[0,45,"middle"],[45,135,"start"],[135,225,"middle"],[225,315,"end"],[315,360,"middle"]]:[[0,90,"end"],[90,135,"middle"],[135,225,"start"],[225,315,"middle"],[315,360,"end"]],n=r.findIndex(e=>i>=e[0]&&i<e[1]);return r[n][2]},ki=(e,t,i)=>{let r=Math.ceil(e.width/t);return{height:Math.min(r,i)*e.height,width:t}};function Ei(e,t,i,r,n,a){var s=i.values,o=r.values,l=i.isEmpty||e.x.hideTicks,c=r.isEmpty||e.y.hideTicks,u=bi(s,gi.get(e.x.tickFormat,e.x.tickFormatNullAlias),t.getAxisTickLabelSize,t.xAxisTickLabelLimit),d=bi(o,gi.get(e.y.tickFormat,e.y.tickFormatNullAlias),t.getAxisTickLabelSize,t.yAxisTickLabelLimit),h=u,g=d;u.width>t.xAxisTickLabelLimit&&(e.x.tickFormatWordWrap=!0,e.x.tickFormatWordWrapLines=t.xTickWordWrapLinesLimit,h=ki(u,t.xAxisTickLabelLimit,t.xTickWordWrapLinesLimit)),d.width>t.yAxisTickLabelLimit&&(e.y.tickFormatWordWrap=!0,e.y.tickFormatWordWrapLines=t.yTickWordWrapLinesLimit,g=ki(d,t.yAxisTickLabelLimit,t.yTickWordWrapLinesLimit)),a&&(e.y.tickFormatWordWrap=!1,e.y.tickFormatWordWrapLines=1,(g=ki(d,2*t.yAxisTickLabelLimit,1)).width=20);var p=l?0:1,f=c?0:1,m=e.x.label,y=e.y.label,x=m.text&&!m.hide?1:0,b=y.text&&!y.hide?1:0,v=Si(h,e.x.rotate),w=Si(g,e.y.rotate);n?(m.padding=(-t.xAxisPadding-t.xFontLabelHeight)/2+t.xFontLabelHeight,m.paddingNoTicks=m.padding,y.padding=(-t.yAxisPadding-t.yFontLabelHeight)/2,y.paddingNoTicks=y.padding,x=0,b=0):(m.padding=pi([p*(t.xTickWidth+v.height),x*(t.distToXAxisLabel+t.xFontLabelHeight)]),m.paddingNoTicks=x*(t.distToXAxisLabel+t.xFontLabelHeight),y.padding=pi([f*(t.yTickWidth+w.width),b*t.distToYAxisLabel]),y.paddingNoTicks=b*t.distToYAxisLabel),a&&(y.padding=0,y.paddingNoTicks=0);const _=t.xFontLabelDescenderLineHeight;return e.padding=Object.assign(e.padding,{b:e.x.hide?0:pi([e.x.padding,p*(t.xTickWidth+v.height),x*(t.distToXAxisLabel+t.xFontLabelHeight+_)]),l:e.y.hide?0:pi([e.y.padding,a?0:f*(t.yTickWidth+w.width),b*(t.distToYAxisLabel+t.yFontLabelHeight)])}),e.paddingNoTicks=Object.assign({},e.paddingNoTicks,{b:e.x.hide?0:pi([e.x.padding,x*(t.distToXAxisLabel+t.xFontLabelHeight+_)]),l:e.y.hide?0:pi([e.y.padding,b*(t.distToYAxisLabel+t.yFontLabelHeight)])}),e.x=Object.assign(e.x,{density:v.width+2*wi(t,"xDensityPadding",i.dimType),tickFontHeight:u.height,$minimalDomain:s.length,$maxTickTextW:h.width,$maxTickTextH:h.height,tickFormatWordWrapLimit:t.xAxisTickLabelLimit}),e.y=Object.assign(e.y,{density:w.height+2*wi(t,"yDensityPadding",r.dimType),tickFontHeight:d.height,$minimalDomain:o.length,$maxTickTextW:g.width,$maxTickTextH:g.height,tickFormatWordWrapLimit:t.yAxisTickLabelLimit}),e}var Ai=function({unit:e,meta:t,settings:i,allowXVertical:r,allowYVertical:n,inlineLabels:a}){var s=t.dimension(e.x),o=t.dimension(e.y),l=t.scaleMeta(e.x,e.guide.x),c=t.scaleMeta(e.y,e.guide.y),u=l.isEmpty,d=c.isEmpty;e.guide.x.tickFormat=_i(e.guide.x.tickFormat||vi(s,i.defaultFormats),i.utcTime),e.guide.y.tickFormat=_i(e.guide.y.tickFormat||vi(o,i.defaultFormats),i.utcTime);var h=!!r&&!("measure"===s.dimType),g=!!n&&!("measure"===o.dimType);if(e.guide.x.padding=u?0:i.xAxisPadding,e.guide.x.paddingNoTicks=e.guide.x.padding,e.guide.y.padding=d?0:i.yAxisPadding,e.guide.y.paddingNoTicks=e.guide.y.padding,e.guide.x.rotate=h?-90:0,e.guide.x.textAnchor=Mi(e.guide.x.rotate,"x"),e.guide.y.rotate=g?-90:0,e.guide.y.textAnchor=Mi(e.guide.y.rotate,"y"),e.guide=Ei(e.guide,i,l,c,a,wt(e)),a){let t=e.guide.x.label,i=e.guide.y.label;t.cssClass+=" inline",t.dock="right",t.textAnchor="end",i.cssClass+=" inline",i.dock="right",i.textAnchor="end"}return e},Ti={NONE:(e,t,i)=>{var r=$e(e);return Oi($e(r.unit),r.unit,(e,t)=>(t.guide.x.tickFontHeight=i.getAxisTickLabelSize("X").height,t.guide.y.tickFontHeight=i.getAxisTickLabelSize("Y").height,t.guide.x.tickFormatWordWrapLimit=i.xAxisTickLabelLimit,t.guide.y.tickFormatWordWrapLimit=i.yAxisTickLabelLimit,t)),r},"BUILD-LABELS":(e,t)=>{var i=$e(e),r=[],n=[],a=null,s=null;Me(i.unit,"units",xi,(e,i)=>{if(e.isLeaf)return i;!a&&i.x&&(a=i),!s&&i.y&&(s=i),i.guide=i.guide||{},i.guide.x=i.guide.x||{label:{text:""}},i.guide.y=i.guide.y||{label:{text:""}},i.guide.x.label=Pe(i.guide.x.label)?i.guide.x.label:{text:i.guide.x.label&&i.guide.x.label.text?i.guide.x.label.text:""},i.guide.y.label=Pe(i.guide.y.label)?i.guide.y.label:{text:i.guide.y.label&&i.guide.y.label.text?i.guide.y.label.text:""},i.x&&(i.guide.x.label.text=i.guide.x.label.text||t.dimension(i.x).dimName),i.y&&(i.guide.y.label.text=i.guide.y.label.text||t.dimension(i.y).dimName);var o=i.guide.x.label.text;o&&(r.push(o),i.guide.x.tickFormatNullAlias=i.guide.x.hasOwnProperty("tickFormatNullAlias")?i.guide.x.tickFormatNullAlias:"No "+o,i.guide.x.label.text="",i.guide.x.label._original_text=o);var l=i.guide.y.label.text;return l&&(n.push(l),i.guide.y.tickFormatNullAlias=i.guide.y.hasOwnProperty("tickFormatNullAlias")?i.guide.y.tickFormatNullAlias:"No "+l,i.guide.y.label.text="",i.guide.y.label._original_text=l),i});return a&&(a.guide.x.label.text=a.guide.x.label.hide?"":r.join(" → ")),s&&(s.guide.y.label.text=s.guide.y.label.hide?"":n.join(" → ")),i},"BUILD-GUIDE":(e,t,i)=>{var r=$e(e);return Oi($e(r.unit),r.unit,(e,r)=>{if(e.isLeaf)return r;var n=!e.isLeaf&&!e.isLeafParent,a=t.scaleMeta(r.x,r.guide.x),s=t.scaleMeta(r.y,r.guide.y),o=!n&&Boolean(a.dimType)&&"measure"!==a.dimType;return r.guide.x.rotate=r.guide.x.rotate||(o?-90:0),r.guide.x.textAnchor=Mi(r.guide.x.rotate),r.guide.x.tickFormat=r.guide.x.tickFormat||vi(a,i.defaultFormats),r.guide.y.tickFormat=r.guide.y.tickFormat||vi(s,i.defaultFormats),r.guide.x.padding=n?0:i.xAxisPadding,r.guide.x.paddingNoTicks=r.guide.x.padding,r.guide.y.padding=n?0:i.yAxisPadding,r.guide.y.paddingNoTicks=r.guide.y.padding,r.guide=Ei(r.guide,st({distToXAxisLabel:a.isEmpty?i.xTickWidth:i.distToXAxisLabel,distToYAxisLabel:s.isEmpty?i.yTickWidth:i.distToYAxisLabel},i),a,s,null,wt(r)),r.guide.x=Object.assign(r.guide.x,{cssClass:n?r.guide.x.cssClass+" facet-axis":r.guide.x.cssClass,avoidCollisions:!!n||r.guide.x.avoidCollisions}),r.guide.y=Object.assign(r.guide.y,{cssClass:n?r.guide.y.cssClass+" facet-axis":r.guide.y.cssClass,avoidCollisions:!n&&r.guide.y.avoidCollisions}),r.guide=Object.assign(r.guide,{showGridLines:r.guide.hasOwnProperty("showGridLines")?r.guide.showGridLines:e.isLeafParent?"xy":""}),r}),r},"BUILD-COMPACT":(e,t,i)=>{var r=$e(e);return Oi($e(r.unit),r.unit,(e,r)=>e.isLeaf?r:(r.guide.hasOwnProperty("showGridLines")||(r.guide.showGridLines=e.isLeafParent?"xy":""),e.isLeafParent?Ai({unit:r,meta:t,settings:st({xTickWordWrapLinesLimit:1,yTickWordWrapLinesLimit:1},i),allowXVertical:!0,allowYVertical:!1,inlineLabels:!0}):(r.guide.x.cssClass+=" facet-axis compact",r.guide.x.avoidCollisions=!0,r.guide.y.cssClass+=" facet-axis compact",r.guide.y.avoidCollisions=!0,Ai({unit:r,meta:t,settings:st({xAxisPadding:0,yAxisPadding:0,distToXAxisLabel:0,distToYAxisLabel:0,xTickWordWrapLinesLimit:1,yTickWordWrapLinesLimit:1},i),allowXVertical:!1,allowYVertical:!0,inlineLabels:!1})))),r},AUTO:(e,t,i)=>["BUILD-LABELS","BUILD-GUIDE"].reduce((e,r)=>Ti[r](e,t,i),e),COMPACT:(e,t,i)=>["BUILD-LABELS","BUILD-COMPACT"].reduce((e,r)=>Ti[r](e,t,i),e)},Oi=(e,t,i)=>{var r=(e=>(e.options=e.options||{},e.guide=e.guide||{},e.guide.padding=st(e.guide.padding||{},{l:0,b:0,r:0,t:0}),e.guide.x=mi(e.guide,"x"),e.guide.x=yi(e.guide,"x",{cssClass:"x axis",scaleOrient:"bottom",textAnchor:"middle"}),e.guide.y=mi(e.guide,"y",{rotate:-90}),e.guide.y=yi(e.guide,"y",{cssClass:"y axis",scaleOrient:"left",textAnchor:"end"}),e.guide.size=mi(e.guide,"size"),e.guide.color=mi(e.guide,"color"),e))(t);r=i(xi(r),r);var n=ot(r=fi(r,e),"units");return(r.units||[]).forEach(e=>Oi($e(e),((e,t)=>(e.guide=e.guide||{},e.guide.padding=e.guide.padding||{l:0,t:0,r:0,b:0},e.hasOwnProperty("units")||((e=st(e,t)).guide=st(e.guide,$e(t.guide)),e.guide.x=st(e.guide.x,$e(t.guide.x)),e.guide.y=st(e.guide.y,$e(t.guide.y))),e))(e,n),i)),r},Ci={get:(e,t,i,r)=>{var n={dimension:e=>{var t=i.scales[e],r=i.sources[t.source].dims[t.dim]||{};return{dimName:t.dim,dimType:r.type,scaleType:t.type}},scaleMeta:e=>{var t=r("pos",e).domain(),n=i.scales[e],a=i.sources[n.source].dims[n.dim]||{};return{dimName:n.dim,dimType:a.type,scaleType:n.type,values:t,isEmpty:null==a.type}}},a=(Ti[e]||Ti.NONE)({unit:$e(i.unit)},n,t);return i.unit=a.unit,i}};class Ni{constructor(e){this.spec=e,this.isApplicable=Ge(e.unit)}transform(e){var t=this.spec;if(!this.isApplicable)return t;var i=t.settings.size,r=t.settings.specEngine.find(e=>i.width<=e.width||i.height<=e.height);return Ci.get(r.name,t.settings,t,(t,i)=>e.getScaleInfo(i||`${t}:default`))}}class Li{static optimizeXAxisLabel(e,t){const{xAxisTickLabelLimit:i}=t,r=e=>{if(!e.guide.x.hide&&!e.guide.x.hideTicks&&0!==e.guide.x.rotate){e.guide.x.rotate=0,e.guide.x.textAnchor="middle";var t=0-Math.min(i,e.guide.x.$maxTickTextW)+e.guide.x.$maxTickTextH;n(e,t)}(e.units||[]).filter(e=>"COORDS.RECT"===e.type).forEach(e=>r(e))},n=(t,i)=>{e!==t&&"extract-axes"===t.guide.autoLayout?(e.guide.x.padding+=i,e.guide.padding.b+=i):(t.guide.x.label.padding+=t.guide.x.label.padding>0?i:0,t.guide.padding.b+=t.guide.padding.b>0?i:0)};r(e)}static hideAxisTicks(e,t,i){const r=e=>{const t="x"===i?"b":"l",n=e.guide;if(!n[i].hide&&!n[i].hideTicks){wt(e)&&"y"===i||(n[i].hideTicks=!0);var a=n[i].label.text&&!n[i].label.hide;n.padding[t]=n.paddingNoTicks?n.paddingNoTicks[t]:0,n[i].padding=n[i].paddingNoTicks||0,n[i].label.padding=a?n[i].label.paddingNoTicks:0}(e.units||[]).filter(e=>"COORDS.RECT"===e.type).forEach(e=>r(e))};r(e)}static facetsLabelsAtTop(e,t){const i=e=>{const t=e.units||[];if(wt(e)){const i=e.guide;i.y.facetAxis=!0,i.y.rotate=0,i.y.textAnchor="start",t.forEach(e=>{e.guide.padding.t=20})}t.filter(e=>"COORDS.RECT"===e.type).forEach(e=>i(e))};i(e)}}var Fi=e=>e.$maxTickTextW,zi=e=>0==e.rotate?e.$maxTickTextW:e.$maxTickTextH,Ri=e=>e.density,$i=e=>{var t=[],i=[],r=e=>{if("COORDS.RECT"===e.type&&e.units&&e.units[0]&&"COORDS.RECT"===e.units[0].type){var n=e.x.replace(/^x_/,""),a=e.y.replace(/^y_/,"");"null"!==n&&t.push(n),"null"!==a&&i.push(a),e.units.forEach(r)}};r(e.unit);var n={},a={},s=e=>{"COORDS.RECT"===e.type&&e.frames.forEach(e=>{e.key&&(Object.keys(e.key).forEach(r=>{t.indexOf(r)>=0&&(n.hasOwnProperty(r)||(n[r]=[]),n[r].indexOf(e.key[r])<0&&n[r].push(e.key[r])),i.indexOf(r)>=0&&(a.hasOwnProperty(r)||(a[r]=[]),a[r].indexOf(e.key[r])<0&&a[r].push(e.key[r]))}),e.units&&e.units.forEach(s))})};return s(e.unit),{xFacetCount:Object.keys(n).reduce((e,t)=>e*n[t].length,1),yFacetCount:Object.keys(a).reduce((e,t)=>e*a[t].length,1)}},Di={"entire-view"(e,t,i,r){var n=i.unit.guide,{xFacetCount:a,yFacetCount:s}=$i(i);s>0&&Li.facetsLabelsAtTop(i.unit,i.settings);var o=n.paddingNoTicks?n.padding.l-n.paddingNoTicks.l:0,l=n.paddingNoTicks?n.padding.b-n.paddingNoTicks.b:0,c=n.paddingNoTicks&&e.height-l<i.settings.minChartHeight||s*i.settings.minFacetHeight+l>e.height||a*i.settings.minFacetWidth+o>e.width,u=n.paddingNoTicks&&e.width-o<i.settings.minChartWidth||s*i.settings.minFacetHeight+l>e.height||a*i.settings.minFacetWidth+o>e.width;c&&Li.hideAxisTicks(i.unit,i.settings,"x"),u&&Li.hideAxisTicks(i.unit,i.settings,"y");var d=e.width;if(t("x",i.unit,Fi)<=e.width)r(i.unit,i.settings);else{var h=t("x",i.unit,zi);if(h>e.width){var g=Math.max(e.width,t("x",i.unit,Ri));d=Math.min(h,g)}}var p=Math.max(e.height,t("y",i.unit,Ri));return!c&&d>e.width&&Li.hideAxisTicks(i.unit,i.settings,"x"),!u&&p>e.height&&Li.hideAxisTicks(i.unit,i.settings,"y"),{newW:e.width,newH:e.height}},minimal:(e,t,i)=>({newW:t("x",i.unit,Ri),newH:t("y",i.unit,Ri)}),normal(e,t,i,r){const{yFacetCount:n}=$i(i);n>0&&Li.facetsLabelsAtTop(i.unit,i.settings);var a=i.unit.guide;a.paddingNoTicks&&(e.width-a.padding.l+a.paddingNoTicks.l<i.settings.minChartWidth&&Li.hideAxisTicks(i.unit,i.settings,"y"),e.height-a.padding.b+a.paddingNoTicks.b<i.settings.minChartHeight&&Li.hideAxisTicks(i.unit,i.settings,"x"));var s=e.width;if(t("x",i.unit,Fi)<=e.width)r(i.unit,i.settings);else{var o=t("x",i.unit,zi);if(o>e.width){var l=Math.max(e.width,t("x",i.unit,Ri));s=Math.min(o,l)}}return{newW:s,newH:Math.max(e.height,t("y",i.unit,Ri))}},"fit-width"(e,t,i,r){var n=i.unit.guide,a=n.paddingNoTicks?n.padding.l-n.paddingNoTicks.l:0;return(n.paddingNoTicks&&e.width-a<i.settings.minChartWidth||$i(i).xFacetCount*i.settings.minFacetWidth+a>e.width)&&Li.hideAxisTicks(i.unit,i.settings,"y"),t("x",i.unit,Fi)<=e.width&&r(i.unit,i.settings),{newW:e.width,newH:t("y",i.unit,Ri)}},"fit-height"(e,t,i){var r=i.unit.guide,n=r.paddingNoTicks?r.padding.b-r.paddingNoTicks.b:0;return(r.paddingNoTicks&&e.height-n<i.settings.minChartHeight||$i(i).yFacetCount*i.settings.minFacetHeight+n>e.height)&&Li.hideAxisTicks(i.unit,i.settings,"x"),{newW:t("x",i.unit,Ri),newH:e.height}}};class Pi{constructor(e){this.spec=e,this.isApplicable=Ge(e.unit)}transform(e){var t=this.spec;if(!this.isApplicable)return t;var i=t.settings.fitModel;if(!i)return t;var r=t.scales,n=(e,t)=>{return e.discrete?t*e.domain().length:4*t},a=(t,i,s,o=null)=>{var l="x"===t?i.x:i.y,c="x"===t?i.y:i.x,u=i.guide,d=s("x"===t?u.x:u.y);const h=i.units[0];var g="x"===t?u.padding.l+u.padding.r:u.padding.b+u.padding.t;if("ELEMENT.INTERVAL"===h.type&&"y"===t===Boolean(h.flip)&&h.label&&!e.getScaleInfo(h.label,o).isEmpty()){const t=2*(u.label&&u.label.fontSize?u.label.fontSize:10),r=e.getScaleInfo(l,o);let a;if(r.discrete&&(null==h.guide.enableColorToBarPosition?!h.stack:h.guide.enableColorToBarPosition)){const t=h.color;if(t){const i=e.getScaleInfo(t,o);if(i.discrete){i.domain();a=i}}}const s=e=>{const i=e.part(),n=it(i.map(e=>e[r.dim])).length;let s=1;if(a){const e=i.reduce((e,t)=>{const i=t[r.dim],n=t[a.dim];return e[i]=e[i]||{},e[i][n]||(e[i][n]=!0),e},{}),t=Object.keys(e).map(t=>Object.keys(e[t]).length);s=Math.max(...t)}return n*s*t},c=i.frames.reduce((e,t)=>e+s(t),0),p=n(r,d);return g+Math.max(c,p)}if("COORDS.RECT"!==h.type){var p=e.getScaleInfo(l,o);return g+n(p,d)}var f=((e,t)=>e.reduce((e,i)=>{var r=(i.key||{})[t];return e[r]=e[r]||[],e[r].push(i),e},{}))(i.frames,r[c].dim),m=Object.keys(f).map(e=>f[e].map(e=>a(t,e.units[0],s,e)).reduce((e,t)=>e+t,0));return g+Math.max(...m)},s=t.settings.size,o=s.width,l=s.height,c=Di[i];if(c){let e=c(s,a,t,Li.optimizeXAxisLabel);o=e.newW,l=e.newH}return t.settings.size=((i,r,n)=>{var a=t.settings.getScrollbarSize(e.getLayout().contentContainer),s=r.width>i.width&&r.width<=i.width*n?i.width:r.width,o=r.height>i.height&&r.height<=i.height*n?i.height:r.height,l=i.width-s,c=i.height-o>=0?0:a.width;return{height:o-(l>=0?0:a.height),width:s-c}})(s,{width:o,height:l},t.settings.avoidScrollAtRatio),t}}class ji{constructor(e){this.spec=e,this.isApplicable=e.settings.autoRatio&&Ge(e.unit)}transform(e){var t=this.spec;if(!this.isApplicable)return t;try{this.ruleApplyRatio(t,e)}catch(e){if("Not applicable"!==e.message)throw e}return t}ruleApplyRatio(e,t){var i=e=>"COORDS.RECT"===e.type||"RECT"===e.type,r=(e,t,i,n=0)=>{t(e,n)&&(e.units||[]).map(e=>r(e,t,i,n+1)),i(e,n)},n=[],a=[];r(e.unit,(e,t)=>{if(t>1||!i(e))throw new Error("Not applicable");return n.push(e.x),a.push(e.y),1===(e.units||[]).map(e=>{if(!i(e)&&!(e=>0===e.type.indexOf("ELEMENT."))(e))throw new Error("Not applicable");return e}).filter(i).length},()=>0);var s=t=>e.scales[t],o=e=>"/"===e.source&&!e.ratio&&!e.fitToFrameByDims,l=e=>"ordinal"===e.type||"period"===e.type&&!e.period,c=n.map(s).filter(o),u=a.map(s).filter(o);if([c.length,u.length].some(e=>2===e)){let e=e=>e.dim,i=(t,i,r)=>{t.fitToFrameByDims=r.slice(0,i).map(e)},r=(r,n)=>{2===n.filter(l).length&&(n.forEach(i),n[0].ratio=Ue(r,n.map(e),t))};r("x",c),r("y",u)}}}class Ii{constructor(e){this.spec=e,this.isApplicable="EXTRACT"===e.settings.layoutEngine&&Ge(e.unit)}transform(){var e=this.spec;if(!this.isApplicable)return e;try{this.ruleExtractAxes(e)}catch(e){if("Not applicable"!==e.message)throw e;console.log("[TauCharts]: can't extract axes for the given chart specification")}return e}ruleExtractAxes(e){var t=e=>"COORDS.RECT"===e.type||"RECT"===e.type,i=e=>e?10:0,r={l:0,r:10,t:10,b:0},n={l:0,b:0},a=[],s=[];ke(e.unit,(e,i)=>{if(i>1||!t(e))throw new Error("Not applicable");e.guide=e.guide||{};var o=e.guide,l=o.padding||{l:0,r:0,t:0,b:0},c=o.paddingNoTicks||{l:0,b:0};return r.l+=l.l,r.r+=l.r,r.t+=l.t,r.b+=l.b,n.l+=c.l,n.b+=c.b,a.push(Object.assign({},r)),s.push(Object.assign({},n)),1===(e.units||[]).map(e=>{if(!t(e)&&!(e=>0===e.type.indexOf("ELEMENT."))(e))throw new Error("Not applicable");return e}).filter(t).length},e=>{var t=a.pop(),o=s.pop(),l=e.guide||{};l.x=l.x||{},l.x.padding=l.x.padding||0,l.x.paddingNoTicks=l.x.paddingNoTicks||0,l.y=l.y||{},l.y.padding=l.y.padding||0,l.y.paddingNoTicks=l.y.paddingNoTicks||0,l.padding={l:i(e.y),r:i(1),t:i(1),b:i(e.x)},l.paddingNoTicks={l:0,b:0},l.autoLayout="extract-axes",l.x.padding+=r.b-t.b,l.y.padding+=r.l-t.l,l.x.paddingNoTicks+=n.b-o.b,l.y.paddingNoTicks+=n.l-o.l}),e.unit.guide.padding=r,e.unit.guide.paddingNoTicks=n}}class Bi{constructor({src:e=null,timeout:t=Number.MAX_SAFE_INTEGER,syncInterval:i=Number.MAX_SAFE_INTEGER,callbacks:r={}}={}){this.setTimeoutDuration(t),this.setSyncInterval(i),this.setCallbacks(r),this._running=!1,this._queue=[],this._result=e,this._syncDuration=0,this._asyncDuration=0,this._requestedFrameId=null,this._visibilityChangeHandler=(()=>{if(!this._running||!this._requestedFrameId)return;const e=this._getCancelFrameFunction(),t=this._getRequestFrameFunction();e(this._requestedFrameId),this._requestedFrameId=t(this._requestedFrameCallback)}),this._tasksCount=0,this._finishedTasksCount=0}setTimeoutDuration(e){Bi.checkType(e,"number","timeout"),this._timeout=e}setSyncInterval(e){Bi.checkType(e,"number","syncInterval"),this._syncInterval=e}setCallbacks(e){Bi.checkType(e,"object","callbacks"),this._callbacks=Object.assign(this._callbacks||{},e)}addTask(e){return this._queue.push(e),this._tasksCount++,this}run(){if(this._running)throw new Error("Task Runner is already running");this._running=!0,Bi.runnersInProgress++,document.addEventListener("visibilitychange",this._visibilityChangeHandler),this._loopTasks()}isRunning(){return this._running}_loopTasks(){for(var e,t,i,r,n=0,a=this._syncInterval/Bi.runnersInProgress;this._running&&!(i=this._asyncDuration>this._timeout)&&!(r=n>a)&&(e=this._queue.shift());){if(null===(t=this._runTask(e)))return;this._syncDuration+=t,this._asyncDuration+=t,n+=t}i&&this._queue.length>0&&(this.stop(),this._callbacks.timeout&&this._callbacks.timeout.call(null,this._asyncDuration,this)),!i&&r&&this._queue.length>0&&this._requestFrame(),0===this._queue.length&&(this.stop(),this._callbacks.done&&this._callbacks.done.call(null,this._result,this))}_runTask(e){var t=performance.now();if(this._callbacks.error)try{this._result=e.call(null,this._result,this)}catch(e){return this.stop(),this._callbacks.error.call(null,e,this),null}else this._result=e.call(null,this._result,this);var i=performance.now()-t;return this._finishedTasksCount++,this._callbacks.progress&&this._callbacks.progress.call(null,this._finishedTasksCount/this._tasksCount,this),i}_requestFrame(){const e=performance.now(),t=()=>{this._requestedFrameId=null;const t=performance.now();this._asyncDuration+=t-e,this._loopTasks()},i=this._getRequestFrameFunction();this._requestedFrameCallback=t,this._requestedFrameId=i(t)}_getRequestFrameFunction(){return document.hidden?e=>(this._requestedFrameType="idle",window.requestIdleCallback(e,{timeout:17})):e=>(this._requestedFrameType="animation",requestAnimationFrame(e))}_getCancelFrameFunction(){switch(this._requestedFrameType){case"animation":return e=>cancelAnimationFrame(e);case"idle":return e=>window.cancelIdleCallback(e)}}stop(){if(!this._running)throw new Error("Task Runner is already stopped");if(this._running=!1,Bi.runnersInProgress--,document.removeEventListener("visibilitychange",this._visibilityChangeHandler),this._requestedFrameId){this._getCancelFrameFunction()(this._requestedFrameId),this._requestedFrameId=null}}static checkType(e,t,i){if(typeof e!==t)throw new Error(`Task Runner "${i}" property is not "${t}"`)}}Bi.runnersInProgress=0;var Wi=Bi;const Hi={...s};var Ui=Ft,Gi=zt;class qi extends h{on(e,t,i){return super.on(e,t,i)}constructor(e){super(),this._nodes=[],this._svg=null,this._filtersStore={filters:{},tick:0},this._layout=ai(),this.transformers=[ji,Ni],this.onUnitsStructureExpandedTransformers=[Ii,Pi],this._chartDataModel=(e=>e),this._reportProgress=null,this._taskRunner=null,this._renderingPhase=null,this.applyConfig(e)}updateConfig(e){this.applyConfig(e),this.refresh()}applyConfig(e){this._filtersStore.filters={},e=this.setupConfigSettings(e),this.configGPL=this.createGPLConfig(e),this._originData=Object.assign({},this.configGPL.sources),this._liveSpec=this.configGPL,this._emptyContainer=e.emptyContainer||"",this.setupPlugins(e)}createGPLConfig(e){let t;return this.isGPLConfig(e)?t=e:(e=this.setupConfig(e),t=new si(e).convert()),t=qi.setupPeriodData(t)}isGPLConfig(e){return 2===["sources","scales"].filter(t=>e.hasOwnProperty(t)).length}setupPlugins(e){const t=e.plugins||[];this._plugins&&this._plugins.destroy(),this._plugins=new Vt(t,this)}setupConfigSettings(e){return this._dataRefs=this._dataRefs||(()=>{let e=0;return{references:new WeakMap,refCounter:()=>++e}})(),e.settings=qi.setupSettings(st(e.settings||{},this._dataRefs)),e}destroy(){this.destroyNodes(),Hi.select(this._svg).remove(),Hi.select(this._layout.layout).remove(),this._cancelRendering(),super.destroy()}setupChartSourceModel(e){this._chartDataModel=e}setupConfig(e){if(!e.spec||!e.spec.unit)throw new Error("Provide spec for plot");var t=st(e,{spec:{},data:[],plugins:[],settings:{}});t.spec.dimensions=qi.setupMetaInfo(t.spec.dimensions,t.data);var i=t.settings.log;return t.settings.excludeNull&&this.addFilter({tag:"default",src:"/",predicate:ri.excludeNullValues(t.spec.dimensions,e=>i([e,"point was excluded, because it has undefined values."],"WARN"))}),t}static setupPeriodData(e){var t=qi.__api__.tickPeriod,i=e.settings.log;return Object.keys(e.scales).map(t=>e.scales[t]).filter(e=>"period"===e.type).forEach(r=>{t.get(r.period,{utc:e.settings.utcTime})||(i([`Unknown period "${r.period}".`,"Docs: https://api.taucharts.com/plugins/customticks.html#how-to-add-custom-tick-period"],"WARN"),r.period=null)}),e}static setupMetaInfo(e,t){var i=e||ri.autoDetectDimTypes(t);return ri.autoAssignScales(i)}static setupSettings(e){var t=qi.globalSettings,i=st(e||{},Object.keys(t).reduce((e,i)=>(e[i]="function"==typeof t[i]?t[i]:$e(t[i]),e),{}));return Array.isArray(i.specEngine)||(i.specEngine=[{width:Number.MAX_VALUE,name:i.specEngine}]),i}insertToLeftSidebar(e){return Mt(e,this._layout.leftSidebar)}insertToRightSidebar(e){return Mt(e,this._layout.rightSidebar)}insertToFooter(e){return Mt(e,this._layout.footer)}insertToHeader(e){return Mt(e,this._layout.header)}addBalloon(e){return new Yt("",e||{})}destroyNodes(){this._nodes.forEach(e=>e.destroy()),this._nodes=[],this._renderedItems=[]}onUnitDraw(e){this._nodes.push(e),this.fire("unitdraw",e),["click","mouseover","mouseout"].forEach(t=>e.on(t,(e,i)=>{this.fire(`element${t}`,{element:e,data:i.data,event:i.event})}))}onUnitsStructureExpanded(e){this.onUnitsStructureExpandedTransformers.forEach(t=>new t(e).transform(this)),this.fire("unitsstructureexpanded",e)}_getClosestElementPerUnit(e,t){return this._renderedItems.filter(e=>e.getClosestElement).map(i=>{var r=i.getClosestElement(e,t);return{unit:i.node(),closest:r}})}disablePointerEvents(){this._layout.layout.style.pointerEvents="none"}enablePointerEvents(){this._layout.layout.style.pointerEvents=""}_handlePointerEvent(e){const t=this._svg.getBoundingClientRect(),i=e.clientX-t.left,r=e.clientY-t.top,n="click"===e.type?"data-click":"data-hover";var a=null,s=null,o=null;const l=this._getClosestElementPerUnit(i,r),c=l.filter(e=>e.closest).sort((e,t)=>e.closest.distance===t.closest.distance?e.closest.secondaryDistance-t.closest.secondaryDistance:e.closest.distance-t.closest.distance);if(c.length>0){const e=c.findIndex(e=>e.closest.distance!==c[0].closest.distance||e.closest.secondaryDistance!==c[0].closest.secondaryDistance),t=e<0?c:c.slice(0,e);if(1===t.length)a=t[0].closest.data,s=t[0].closest.node,o=t[0].unit;else{const e=t.reduce((e,t)=>e+t.closest.x,0)/t.length,n=t.reduce((e,t)=>e+t.closest.y,0)/t.length,l=Math.atan2(n-r,e-i)+Math.PI,c=Math.round((t.length-1)*l/2/Math.PI),{closest:u}=t[c];a=u.data,s=u.node,o=t[c].unit}}l.forEach(t=>t.unit.fire(n,{event:e,data:a,node:s,unit:o}))}_initPointerEvents(){this._liveSpec.settings.syncPointerEvents||(this._pointerAnimationFrameId=null);const e=Hi.select(this._svg),t=this._liveSpec.settings.syncPointerEvents?e=>()=>e(s.event):e=>()=>{var t=s.event;this._pointerAnimationFrameId&&"mousemove"!==t.type&&this._cancelPointerAnimationFrame(),this._pointerAnimationFrameId||(this._pointerAnimationFrameId=requestAnimationFrame(()=>{this._pointerAnimationFrameId=null,e(t)}))},i=e=>this._handlePointerEvent(e);e.on("mousemove",t(i)),e.on("click",t(i)),e.on("mouseleave",t(e=>{"none"!==window.getComputedStyle(this._svg).pointerEvents&&this.select(()=>!0).forEach(t=>t.fire("data-hover",{event:e,data:null,node:null,unit:null}))}))}_cancelPointerAnimationFrame(){cancelAnimationFrame(this._pointerAnimationFrameId),this._pointerAnimationFrameId=null}_setupTaskRunner(e){return this._resetTaskRunner(),this._taskRunner=new Wi({timeout:e.settings.renderingTimeout||Number.MAX_SAFE_INTEGER,syncInterval:e.settings.asyncRendering?e.settings.syncRenderingInterval:Number.MAX_SAFE_INTEGER,callbacks:{done:()=>{this._completeRendering(),this._renderingPhase=null},timeout:(e,t)=>{this._displayTimeoutWarning({timeout:e,proceed:()=>{this.disablePointerEvents(),t.setTimeoutDuration(Number.MAX_SAFE_INTEGER),t.run()},cancel:()=>{this._cancelRendering()}}),this.enablePointerEvents(),this.fire("renderingtimeout",e)},progress:e=>{var t={spec:0,draw:1}[this._renderingPhase]/2+e/2;this._reportProgress(t)},error:e.settings.handleRenderingErrors?t=>{this._cancelRendering(),this._displayRenderingError(t),this.fire("renderingerror",t),e.settings.log(["An error occured during chart rendering.",'Set "handleRenderingErrors: false" in chart settings to debug.',`Error message: ${t.message}`].join(" "),"ERROR")}:null}}),this._taskRunner}_resetTaskRunner(){this._taskRunner&&this._taskRunner.isRunning()&&(this._taskRunner.stop(),this._taskRunner=null)}renderTo(e,t){this._resetProgressLayout(),this.disablePointerEvents(),this._insertLayout(e,t);const i=this._createLiveSpec();if(!i)return this._svg=null,this._layout.content.innerHTML=this._emptyContainer,void this.enablePointerEvents();var r=this._createGPL(i),n=this._setupTaskRunner(i);this._scheduleDrawScenario(n,r),this._scheduleDrawing(n,r),n.run()}_insertLayout(e,t){this._target=e,this._defaultSize=Object.assign({},t);var i=Hi.select(e).node();if(null===i)throw new Error("Target element not found");this._layout.layout.parentNode!==i&&i.appendChild(this._layout.layout);var r=this._layout.content,n=kt(this._layout.contentContainer);this._layout.contentContainer.style.padding=`0 ${n.width}px ${n.height}px 0`,Et(this._layout.rightSidebarContainer,"vertical");var a=Object.assign({},t)||{};if(!a.width||!a.height){let{scrollLeft:e,scrollTop:t}=r.parentElement;r.style.display="none",a=st(a,Ot(r.parentNode)),r.style.display="",r.parentElement.scrollLeft=e,r.parentElement.scrollTop=t,a.height||(a.height=Ot(this._layout.layout).height)}this.configGPL.settings.size=a}_createLiveSpec(){return this._liveSpec=$e(ot(this.configGPL,"plugins")),this._liveSpec.sources=this.getDataSources(),this._liveSpec.settings=this.configGPL.settings,this._experimentalSetupAnimationSpeed(this._liveSpec),this.isEmptySources(this._liveSpec.sources)?null:(this._liveSpec=this.transformers.reduce((e,t)=>new t(e).transform(this),this._liveSpec),this.destroyNodes(),this.fire("specready",this._liveSpec),this._liveSpec)}_experimentalSetupAnimationSpeed(e){e.settings.initialAnimationSpeed=e.settings.initialAnimationSpeed||e.settings.animationSpeed;const t=e.settings.experimentalShouldAnimate(e)?e.settings.initialAnimationSpeed:0;e.settings.animationSpeed=t;const i=e=>{e.guide=e.guide||{},e.guide.animationSpeed=t,e.units&&e.units.forEach(i)};i(e.unit)}_createGPL(e){var t=new Gt(e,this.getScaleFactory(),Zt,w),i=t.unfoldStructure();return this.onUnitsStructureExpanded(i),t}_scheduleDrawScenario(e,t){const i=Hi.select(this._layout.content),r=t.config.settings.size;e.addTask(()=>this._renderingPhase="spec"),t.getDrawScenarioQueue({allocateRect:()=>({slot:e=>i.selectAll(`.uid_${e}`),frameId:"root",left:0,top:0,width:r.width,containerWidth:r.width,height:r.height,containerHeight:r.height})}).forEach(t=>e.addTask(t))}_scheduleDrawing(e,t){const i=t.config.settings.size;e.addTask(e=>{this._renderingPhase="draw",this._renderRoot({scenario:e,newSize:i}),this._cancelPointerAnimationFrame(),this._scheduleRenderScenario(e)})}_resetProgressLayout(){this._createProgressBar(),this._clearRenderingError(),this._clearTimeoutWarning()}_renderRoot({scenario:e,newSize:t}){const i=Hi.select(this._layout.content);var r=e[0].config.uid,n=Ui(i,"svg").attr("width",Math.floor(t.width)).attr("height",Math.floor(t.height));n.attr("class")||n.attr("class",`${N}svg`),this._svg=n.node(),this._initPointerEvents(),this.fire("beforerender",this._svg);var a=n.selectAll("g.frame-root").data([r],e=>e);a.enter().append("g").classed(`${N}cell cell frame-root uid_${r}`,!0).merge(a).call(e=>{e.classed("tau-active",!0),he(e,this.configGPL.settings.animationSpeed,"frameRootToggle").attr("opacity",1)}),a.exit().call(e=>{e.classed("tau-active",!1),he(e,this.configGPL.settings.animationSpeed,"frameRootToggle").attr("opacity",1e-6).remove()})}_scheduleRenderScenario(e){e.forEach(e=>{this._taskRunner.addTask(()=>{e.draw(),this.onUnitDraw(e.node()),this._renderedItems.push(e)})})}_completeRendering(){Et(this._layout.contentContainer),this._layout.rightSidebar.style.maxHeight=`${this._liveSpec.settings.size.height}px`,this.enablePointerEvents(),this._svg&&this.fire("render",this._svg),Et(this._layout.rightSidebarContainer,"vertical")}_cancelRendering(){this.enablePointerEvents(),this._resetTaskRunner(),this._cancelPointerAnimationFrame()}_createProgressBar(){var e=Hi.select(this._layout.header),t=Ui(e,`div.${N}progress`);t.select(`div.${N}progress__value`).remove();var i=t.append("div").classed(`${N}progress__value`,!0).style("width",0);this._reportProgress=function(e){requestAnimationFrame(()=>{t.classed(`${N}progress_active`,e<1),i.style("width",`${100*e}%`)})}}_displayRenderingError(e){this._layout.layout.classList.add(`${N}layout_rendering-error`)}_clearRenderingError(){this._layout.layout.classList.remove(`${N}layout_rendering-error`)}getScaleFactory(e=null){return new ii(ti.instance(this._liveSpec.settings),e||this._liveSpec.sources,this._liveSpec.scales)}getScaleInfo(e,t=null){return this.getScaleFactory().createScaleInfoByName(e,t)}getSourceFiltersIterator(e){var t=tt(Object.keys(this._filtersStore.filters).map(e=>this._filtersStore.filters[e])).filter(t=>!e(t)).map(e=>e.predicate);return e=>t.reduce((t,i)=>t&&i(e),!0)}getDataSources(e={}){var t=this._chartDataModel(this._originData);return Object.keys(t).filter(e=>"?"!==e).reduce((i,r)=>{var n=t[r],a=this.getSourceFiltersIterator((t=>i=>e.excludeFilter&&-1!==e.excludeFilter.indexOf(i.tag)||i.src!==t)(r));return i[r]={dims:n.dims,data:n.data.filter(a)},i},{"?":t["?"]})}isEmptySources(e){return!Object.keys(e).filter(e=>"?"!==e).filter(t=>e[t].data.length>0).length}getChartModelData(e={},t="/"){return this.getDataSources(e)[t].data}getDataDims(e="/"){return this._originData[e].dims}getData(e="/"){return this._originData[e].data}setData(e,t="/"){this._originData[t].data=e,this.refresh()}getSVG(){return this._svg}addFilter(e){e.src=e.src||"/";var t=e.tag,i=this._filtersStore.filters[t]=this._filtersStore.filters[t]||[],r=this._filtersStore.tick++;return e.id=r,i.push(e),r}removeFilter(e){return Object.keys(this._filtersStore.filters).map(t=>{this._filtersStore.filters[t]=this._filtersStore.filters[t].filter(t=>t.id!==e)}),this}refresh(){this._target&&this.renderTo(this._target,this._defaultSize)}resize(e={}){this.renderTo(this._target,e)}select(e){return this._nodes.filter(e)}traverseSpec(e,t){var i=(e,t,r,n)=>{t(e,r,n),e.frames?e.frames.forEach(r=>{(r.units||[]).map(n=>i(n,t,e,r))}):(e.units||[]).map(r=>i(r,t,e,null))};i(e.unit,t,null,null)}getSpec(){return this._liveSpec}getLayout(){return this._layout}_displayTimeoutWarning({proceed:e,cancel:t,timeout:i}){var r=Math.round(100/3/1.5),n=function(e){return Math.round(100/3/1.5*e)};this._layout.content.style.height="100%",this._layout.content.insertAdjacentHTML("beforeend",`\n            <div class="${N}rendering-timeout-warning">\n            <svg\n                viewBox="0 0 200 100">\n                <text\n                    text-anchor="middle"\n                    font-size="${r}">\n                    <tspan x="100" y="${n(1)}">Rendering took more than ${Math.round(i)/1e3}s</tspan>\n                    <tspan x="100" y="${n(2)}">Would you like to continue?</tspan>\n                </text>\n                <text\n                    class="${N}rendering-timeout-continue-btn"\n                    text-anchor="end"\n                    font-size="${r}"\n                    cursor="pointer"\n                    text-decoration="underline"\n                    x="${100-r/3}"\n                    y="${n(3)}">\n                    Continue\n                </text>\n                <text\n                    class="${N}rendering-timeout-cancel-btn"\n                    text-anchor="start"\n                    font-size="${r}"\n                    cursor="pointer"\n                    text-decoration="underline"\n                    x="${100+r/3}"\n                    y="${n(3)}">\n                    Cancel\n                </text>\n            </svg>\n            </div>\n        `),this._layout.content.querySelector(`.${N}rendering-timeout-continue-btn`).addEventListener("click",()=>{this._clearTimeoutWarning(),e.call(this)}),this._layout.content.querySelector(`.${N}rendering-timeout-cancel-btn`).addEventListener("click",()=>{this._clearTimeoutWarning(),t.call(this)})}_clearTimeoutWarning(){var e=Gi(this._layout.content,`.${N}rendering-timeout-warning`);e&&(this._layout.content.removeChild(e),this._layout.content.style.height="")}}var Xi={},Yi={},Vi=e=>{let t=`Chart type ${e} is not supported.`;throw console.log(t),console.log(`Use one of ${Object.keys(Xi).join(", ")}.`),new x(t,b.NOT_SUPPORTED_TYPE_CHART)},Ji={validate:(e,t)=>(Yi.hasOwnProperty(e)||Vi(e),Yi[e].reduce((e,i)=>e.concat(i(t)||[]),[])),get(e){var t=Xi[e];return"function"!=typeof t&&Vi(e),t},add:(e,t,i=[])=>(Xi[e]=t,Yi[e]=i,Ji),getAllRegisteredTypes:()=>Xi};class Ki extends qi{constructor(e){super(e),e.autoResize&&Ki.winAware.push(this)}applyConfig(e){var t=Ji.validate(e.type,e);if(t.length>0)throw new Error(t[0]);var i=Ji.get(e.type);(e=st(e,{autoResize:!0})).settings=qi.setupSettings(e.settings),e.dimensions=qi.setupMetaInfo(e.dimensions,e.data),super.applyConfig(i(e))}destroy(){var e=Ki.winAware.indexOf(this);-1!==e&&Ki.winAware.splice(e,1),super.destroy()}}Ki.winAware=[],Ki.resizeOnWindowEvent=function(){let e;function t(){e=0;for(let e=0,t=Ki.winAware.length;e<t;e++)Ki.winAware[e].resize()}return function(){!e&&Ki.winAware.length&&(e=window.requestAnimationFrame(t))}}(),window.addEventListener("resize",Ki.resizeOnWindowEvent);var Zi=Ft;const Qi=e=>{const t=e<=20?1:.75;return Math.max(2,Math.round(e*t))};const er={...i(11),...i(8),...s};var tr=i(12);var ir=i(4),rr=function(){var e,t=[],i=[],r=1,n=1,a={},s=!1,o=function(e){var r=t.length,n=0,a=t[e].x-i[e].x,s=i[e].y-t[e].y,o=Math.sqrt(a*a+s*s);o>0&&(n+=.2*o),s/=o,n+=(a/=o)>0&&s>0?0:a<0&&s>0?3:a<0&&s<0?6:9;for(var l,c,d,h,g=t[e].x,p=t[e].y-t[e].height+2,f=t[e].x+t[e].width,m=t[e].y+2,y=0;y<r;y++)y!=e&&(u(i[e].x,t[e].x,i[y].x,t[y].x,i[e].y,t[e].y,i[y].y,t[y].y)&&(n+=1),l=t[y].x,d=t[y].y-t[y].height+2,c=t[y].x+t[y].width,h=t[y].y+2,n+=30*(Math.max(0,Math.min(c,f)-Math.max(l,g))*Math.max(0,Math.min(h,m)-Math.max(d,p)))),l=i[y].x-i[y].r,d=i[y].y-i[y].r,c=i[y].x+i[y].r,h=i[y].y+i[y].r,n+=30*(Math.max(0,Math.min(c,f)-Math.max(l,g))*Math.max(0,Math.min(h,m)-Math.max(d,p)));return n},l=function(a){var l,c=Math.floor(Math.random()*t.length),u=t[c].x,d=t[c].y;l=s?e(c,t,i):o(c),t[c].x+=5*(Math.random()-.5),t[c].y+=5*(Math.random()-.5),t[c].x>r&&(t[c].x=u),t[c].x<0&&(t[c].x=u),t[c].y>n&&(t[c].y=d),t[c].y<0&&(t[c].y=d);var h=(s?e(c,t,i):o(c))-l;Math.random()<Math.exp(-h/a)?1:(t[c].x=u,t[c].y=d,1)},c=function(a){var l,c=Math.floor(Math.random()*t.length),u=t[c].x,d=t[c].y;l=s?e(c,t,i):o(c);var h=.5*(Math.random()-.5),g=Math.sin(h),p=Math.cos(h);t[c].x-=i[c].x,t[c].y-=i[c].y;var f=t[c].x*p-t[c].y*g,m=t[c].x*g+t[c].y*p;t[c].x=f+i[c].x,t[c].y=m+i[c].y,t[c].x>r&&(t[c].x=u),t[c].x<0&&(t[c].x=u),t[c].y>n&&(t[c].y=d),t[c].y<0&&(t[c].y=d);var y=(s?e(c,t,i):o(c))-l;Math.random()<Math.exp(-y/a)?1:(t[c].x=u,t[c].y=d,1)},u=function(e,t,i,r,n,a,s,o){var l,c,u;return c=((t-e)*(n-s)-(a-n)*(e-i))/(u=(o-s)*(t-e)-(r-i)*(a-n)),!((l=((r-i)*(n-s)-(o-s)*(e-i))/u)<0||l>1||c<0||c>1)},d=function(e,t,i){return e-t/i};return a.start=function(e){for(var i=t.length,r=1,n=0;n<e;n++){for(var a=0;a<i;a++)Math.random()<.5?l(r):c(r);r=d(r,1,e)}},a.width=function(e){return arguments.length?(r=e,a):r},a.height=function(e){return arguments.length?(n=e,a):n},a.label=function(e){return arguments.length?(t=e,a):t},a.anchor=function(e){return arguments.length?(i=e,a):i},a.alt_energy=function(t){return arguments.length?(e=t,s=!0,a):o},a.alt_schedule=function(){return arguments.length?a:d},a};const nr={...o,...tr,...s},ar=5.5,sr=10,or=.5;var lr=["land","continents","georegions","countries","regions","subunits","states","counties"];var cr=e=>()=>e;class ur{constructor(e){this.model=e.model,this.x=e.x||cr(0),this.y=e.y||cr(0),this.dx=e.dx||cr(0),this.dy=e.dy||cr(0),this.w=e.w||cr(0),this.h=e.h||cr(0),this.hide=e.hide||cr(!1),this.label=e.label||cr(""),this.color=e.color||cr(""),this.angle=e.angle||cr(0),this.labelLinesAndSeparator=e.labelLinesAndSeparator||cr({lines:[],linesWidths:[],separator:""})}static seed(e,{fontColor:t,flip:i,formatter:r,labelRectSize:n,paddingKoeff:a=.5,lineBreakAvailable:s,lineBreakSeparator:o}){var l=i?e.yi:e.xi,c=i?e.xi:e.yi,u=t=>r(e.label(t)),d=e=>{const t=s?u(e).split(o):[u(e)];return{lines:t,linesWidths:t.map(e=>n([e]).width),separator:o}};return new ur({model:e,x:e=>l(e),y:e=>c(e),dy:e=>n(d(e).lines).height*a,w:e=>n(d(e).lines).width,h:e=>n(d(e).lines).height,label:u,labelLinesAndSeparator:d,color:()=>t,angle:()=>0})}static compose(e,t={}){return Object.keys(t).reduce((e,i)=>(e[i]=t[i],e),new ur(e))}}var dr={};class hr{static regRule(e,t){return dr[e]=t,this}static getRule(e){return dr[e]}}const gr=({lines:e,linesWidths:t,separator:i},r)=>e.map(function(e,i){const n=((e,t,i)=>i<t?Math.max(1,Math.floor(i*e.length/t))-1:e.length)(e,t[i],r);return n<e.length?((e,t)=>0===t?"":e.slice(0,t).replace(/\.+$/g,"")+"…")(e,n):e}).join(i);var pr=(e,t)=>{var i=5-(e.labelLinesAndSeparator(t).lines.length-1);return i<1?1:i},fr=(e,t)=>e.discrete||!e.discrete&&t[e.dim]>=0,mr=(e,t)=>!e.discrete&&t[e.dim]<0,yr=(e,t)=>e.w(t)/2+Math.floor(e.model.size(t)/pr(e,t)),xr=(e,t)=>e.h(t)/2+Math.floor(e.model.size(t)/pr(e,t)),br=e=>t=>({dx:i=>{var r=t.model.scaleY;if("+"===e[2]&&!fr(r,i))return t.dx(i);if("-"===e[2]&&!mr(r,i))return t.dx(i);var n=e[1],a=e[0]===e[0].toUpperCase()?1:0;return t.dx(i)+n*a*t.model.size(i)/2+n*yr(t,i)}}),vr=e=>t=>({dy:i=>{var r=t.model.scaleY;if("+"===e[2]&&!fr(r,i))return t.dy(i);if("-"===e[2]&&!mr(r,i))return t.dy(i);var n=e[1],a=e[0]===e[0].toUpperCase()?1:0;return t.dy(i)+n*a*t.model.size(i)/2+n*xr(t,i)}});hr.regRule("l",br(["l",-1,null])).regRule("L",br(["L",-1,null])).regRule("l+",br(["l",-1,"+"])).regRule("l-",br(["l",-1,"-"])).regRule("L+",br(["L",-1,"+"])).regRule("L-",br(["L",-1,"-"])).regRule("r",br(["r",1,null])).regRule("R",br(["R",1,null])).regRule("r+",br(["r",1,"+"])).regRule("r-",br(["r",1,"-"])).regRule("R+",br(["R",1,"+"])).regRule("R-",br(["R",1,"-"])).regRule("t",vr(["t",-1,null])).regRule("T",vr(["T",-1,null])).regRule("t+",vr(["t",-1,"+"])).regRule("t-",vr(["t",-1,"-"])).regRule("T+",vr(["T",-1,"+"])).regRule("T-",vr(["T",-1,"-"])).regRule("b",vr(["b",1,null])).regRule("B",vr(["B",1,null])).regRule("b+",vr(["b",1,"+"])).regRule("b-",vr(["b",1,"-"])).regRule("B+",vr(["B",1,"+"])).regRule("B-",vr(["B",1,"-"])).regRule("rotate-on-size-overflow",(e,{data:t,lineBreakAvailable:i})=>{var r={};if(t.reduce((t,i)=>t+((t=>e.model.size(t)<e.w(t))(i)?1:0),0)/t.length>.5){var n=i?-.5:.5;r={angle:()=>-90,w:t=>e.h(t),h:t=>e.w(t),dx:t=>e.h(t)*n-2,dy:()=>0}}return r}).regRule("hide-by-label-height-vertical",e=>({hide:t=>{let i,r;return 0===e.angle(t)?(r=e.h(t),i=Math.abs(e.model.y0(t)-e.model.yi(t))):(r=e.w(t),i=e.model.size(t)),r>i||e.hide(t)}})).regRule("cut-label-vertical",e=>({h:t=>{const i=e.h(t);if(Math.abs(e.angle(t))>0){const r=Math.abs(e.model.y0(t)-e.model.yi(t));return r<i?r:i}return i},w:t=>{const i=e.w(t);if(0===e.angle(t)){const r=e.model.size(t);return r<i?r:i}return i},label:t=>{let i;return i=0===e.angle(t)?e.model.size(t):Math.abs(e.model.y0(t)-e.model.yi(t)),gr(e.labelLinesAndSeparator(t),i)},dy:t=>{const i=e.dy(t);if(0!==e.angle(t)){const r=e.h(t),n=Math.abs(e.model.y0(t)-e.model.yi(t));return n<r?n*i/r:i}return i}})).regRule("cut-outer-label-vertical",e=>({h:(t,i)=>{const r=e.h(t);if(Math.abs(e.angle(t))>0){const n=e.model.y0(t)<e.model.yi(t)?i.maxHeight-e.model.yi(t):e.model.yi(t);return n<r?n:r}return r},w:t=>{const i=e.w(t);if(0===e.angle(t)){const r=e.model.size(t);return r<i?r:i}return i},label:(t,i)=>{let r;return r=0===e.angle(t)?e.model.size(t):e.model.y0(t)<e.model.yi(t)?i.maxHeight-e.model.yi(t):e.model.yi(t),gr(e.labelLinesAndSeparator(t),r)},dy:(t,i)=>{const r=e.dy(t);if(0!==e.angle(t)){const n=e.h(t),a=e.model.y0(t)<e.model.yi(t)?i.maxHeight-e.model.yi(t):e.model.yi(t);return a<n?a*r/n:r}return r}})).regRule("from-beginning",e=>{var t=t=>e.model.y0(t);return e.model.flip?{x:t}:{y:t}}).regRule("to-end",e=>{var t=t=>e.model.yi(t);return e.model.flip?{x:t}:{y:t}}).regRule("towards",e=>{var t=e.model.flip?yr:xr,i=i=>((e,t)=>e.model.yi(t)-e.model.y0(t)>=0?1:-1)(e,i)*t(e,i);return e.model.flip?{dx:i}:{dy:i}}).regRule("inside-start-then-outside-end-horizontal",(e,t)=>{var i=[hr.getRule("from-beginning"),hr.getRule("towards"),hr.getRule("cut-label-horizontal")].reduce((e,i)=>ur.compose(e,i(e,t)),e),r=[hr.getRule("to-end"),hr.getRule("towards"),hr.getRule("cut-outer-label-horizontal")].reduce((e,i)=>ur.compose(e,i(e,t)),e);return Object.assign({},i,["x","dx","hide","label"].reduce((e,t)=>(e[t]=(e=>((e=>i.label(e).length>=r.label(e).length)(e)?i:r)[t](e)),e),{}))}).regRule("inside-start-then-outside-end-vertical",(e,t)=>{var i=[hr.getRule("from-beginning"),hr.getRule("towards"),hr.getRule("cut-label-vertical")].reduce((e,i)=>ur.compose(e,i(e,t)),e),r=[hr.getRule("to-end"),hr.getRule("towards"),hr.getRule("cut-outer-label-vertical")].reduce((e,i)=>ur.compose(e,i(e,t)),e);return Object.assign({},i,["y","dy","hide","label"].reduce((e,t)=>(e[t]=(e=>((e=>i.label(e).length>=r.label(e).length)(e)?i:r)[t](e)),e),{}))}).regRule("outside-then-inside-horizontal",(e,t)=>{var i=["r+","l-","cut-outer-label-horizontal"].map(hr.getRule).reduce((e,i)=>ur.compose(e,i(e,t)),e),r=["r-","l+","hide-by-label-height-horizontal","cut-label-horizontal"].map(hr.getRule).reduce((e,i)=>ur.compose(e,i(e,t)),e);return Object.assign({},i,["x","dx","hide","label"].reduce((e,t)=>(e[t]=(e=>((e=>r.label(e).length>i.label(e).length)(e)?r:i)[t](e)),e),{}))}).regRule("outside-then-inside-vertical",(e,t)=>{var i=["t+","b-","cut-outer-label-vertical"].map(hr.getRule).reduce((e,i)=>ur.compose(e,i(e,t)),e),r=["t-","b+","hide-by-label-height-vertical","cut-label-vertical"].map(hr.getRule).reduce((e,i)=>ur.compose(e,i(e,t)),e);return Object.assign({},i,["y","dy","hide","label"].reduce((e,n)=>(e[n]=(e=>((e=>{var r=i.y(e,t)+i.dy(e,t);return r<=0||r>=t.maxHeight})(e)?r:i)[n](e,t)),e),{}))}).regRule("hide-by-label-height-horizontal",e=>({hide:t=>e.model.size(t)<e.h(t)||e.hide(t)})).regRule("cut-label-horizontal",e=>({dx:t=>{const i=e.w(t),r=Math.abs(e.model.y0(t)-e.model.yi(t)),n=e.dx(t);return r<i?r*n/i:n},w:t=>{const i=e.w(t),r=Math.abs(e.model.y0(t)-e.model.yi(t));return r<i?r:i},label:t=>{const i=Math.abs(e.model.y0(t)-e.model.yi(t));return gr(e.labelLinesAndSeparator(t),i)}})).regRule("cut-outer-label-horizontal",(e,t)=>({dx:i=>{const r=e.w(i),n=e.model.y0(i)<e.model.yi(i)?t.maxWidth-e.model.yi(i):e.model.yi(i),a=e.dx(i);return n<r?n*a/r:a},w:i=>{const r=e.w(i),n=e.model.y0(i)<e.model.yi(i)?t.maxWidth-e.model.yi(i):e.model.yi(i);return n<r?n:r},label:i=>{const r=e.model.y0(i)<e.model.yi(i)?t.maxWidth-e.model.yi(i):e.model.yi(i);return gr(e.labelLinesAndSeparator(i),r)}})).regRule("keep-within-diameter-or-top",e=>({dy:t=>e.model.size(t)/e.w(t)<1?e.dy(t)-e.h(t)/2-e.model.size(t)/2:e.dy(t)})).regRule("keep-in-box",(e,{maxWidth:t,maxHeight:i})=>({dx:i=>{var r=e.dx(i),n=e.x(i)+r,a=e.w(i),s=0-(n-a/2);if(s>0)return r+s;var o=n+a/2-t;return o>0?r-o:r},dy:t=>{var r=e.dy(t),n=e.y(t)+r,a=e.h(t);if(0-(n-a/2)>0)return 0;var s=n+a/2-i;return s>0?r-s:r}})).regRule("multiline-label-left-align",e=>({dy:t=>{const i=e.dy(t);return-90===e.angle(t)?i+e.h(t)/2:i}})).regRule("multiline-label-vertical-center-align",e=>({dy:t=>e.dy(t)-e.h(t)/2})).regRule("multiline-hide-on-container-overflow",(e,{maxWidth:t,maxHeight:i})=>({hide:r=>{var n=e.angle(r),a=e.x(r)+e.dx(r),s=e.y(r)+e.dy(r);return!(!Qe(a,e.w(r),n,t)&&!et(s,e.h(r),n,i))||e.hide(r)}}));class wr{constructor(e){this.minError=Number.MAX_VALUE,this.items=e.items,this.revision=this.items.map(e=>({i:e.i,x:e.x,y:e.y})),this.penalties=e.penalties,this.transactor=e.transactor,this.cooling_schedule=e.cooling_schedule||((e,t,i)=>e-t/i)}energy(e){return this.penalties.reduce((t,i)=>t+i(e),0)}move(e){const t=Math.floor(Math.random()*this.items.length),i=this.transactor(this.items[t]),r=this.energy(t);this.items[t]=i.modify();const n=this.energy(t),a=n-r,s=a<0?1:Math.exp(-a/e);Math.random()>=s?this.items[t]=i.revert():n<this.minError&&(this.minError=n,this.revision=this.items.map(e=>({i:e.i,x:e.x,y:e.y})))}start(e){var t=1;const i=this.items.length;e:for(let r=0;r<e;r++){for(let e=0;e<i;e++)if(this.move(t),this.minError<=10)break e;t=this.cooling_schedule(t,1,e)}return this.revision}}var _r=(e,t,i,r,n,a,s,o)=>A(e,n,t,a,i,s,r,o);const Sr={};class Mr{static reg(e,t){return Sr[e]=t,this}static get(e){return Sr[e]}}Mr.reg("auto:avoid-label-label-overlap",(e,t,i=1)=>t=>{var r=e[t].x,n=e[t].y-e[t].h+2,a=e[t].x+e[t].w,s=e[t].y+2;return e.reduce((e,o,l)=>{var c=Number(l!==t),u=o.x,d=o.y-o.h+2,h=o.x+o.w,g=o.y+2;return e+c*(Math.max(0,Math.min(h,a)-Math.max(u,r))*Math.max(0,Math.min(g,s)-Math.max(d,n))*i)},0)}).reg("auto:avoid-label-anchor-overlap",(e,t,i=1)=>t=>{var r=e[t],n=r.x-r.w/2,a=r.x+r.w/2,s=r.y-r.h/2+2,o=r.y+r.h/2+2;return e.reduce((e,t)=>{var r=t.x0-t.size/2,l=t.x0+t.size/2,c=t.y0-t.size/2,u=t.y0+t.size/2;return e+Math.max(0,Math.min(l,a)-Math.max(r,n))*Math.max(0,Math.min(u,o)-Math.max(c,s))*i},0)}).reg("auto:avoid-label-edges-overlap",(e,t,i=1)=>r=>{var n=e[r],a=n.x-n.w/2,s=n.x+n.w/2,o=n.y-n.h/2,l=n.y+n.h/2;return t.reduce((e,t)=>{var r=_r(a,s,t.x0,t.x1,o,l,t.y0,t.y1),n=_r(a,s,t.x0,t.x1,l,o,t.y0,t.y1);return e+(Number(r)+Number(n))*i},0)});var kr=(e,t,i,r,n,a,s,o)=>A(e,n,t,a,i,s,r,o);class Er{constructor(e,t,i,{width:r,height:n,container:a}){this.container=a,this.model=e,this.flip=t,this.w=r,this.h=n,this.guide=st(i||{},{fontFamily:"Helvetica Neue, Segoe UI, Open Sans, Ubuntu, sans-serif",fontWeight:"normal",fontSize:10,fontColor:"#000",hideEqualLabels:!1,lineBreak:!1,lineBreakSeparator:"",position:[],tickFormat:null,tickFormatNullAlias:""})}draw(e){var t=this,i=this.model,r=this.guide,n=r.lineBreak,a=r.lineBreakSeparator,o=ur.seed(i,{fontColor:r.fontColor,flip:t.flip,formatter:gi.get(r.tickFormat,r.tickFormatNullAlias),labelRectSize:e=>Nt(e,r),lineBreakAvailable:n,lineBreakSeparator:a,paddingKoeff:n?0:.5}),l={lineBreakAvailable:n,maxWidth:t.w,maxHeight:t.h,data:e.reduce((e,t)=>e.concat(t),[])},c=this.applyFixedPositionRules(r,l,o,n,this.flip),u=e.reduce((e,t)=>{var i=t.map(e=>({data:e,x:c.x(e)+c.dx(e),y:c.y(e)+c.dy(e),w:c.w(e),h:c.h(e,l),hide:c.hide(e),extr:null,size:c.model.size(e),angle:c.angle(e),label:c.label(e),labelLinesAndSeparator:c.labelLinesAndSeparator(e),color:c.color(e)}));return e.text=e.text.concat(i),e.edges=e.edges.concat(((e,t)=>{for(var i=e.length-1,r=[],n=0;n<=i;n++){var a=0===n?n:n-1,s=n,o=n===i?n:n+1;r.push(t(e[a],e[s],e[o]))}return r})(i,(e,t,i)=>(t.y===Math.max(t.y,e.y,i.y)?t.extr="min":t.y===Math.min(t.y,e.y,i.y)?t.extr="max":t.extr="norm",{x0:e.x,x1:t.x,y0:e.y,y1:t.y}))),e},{text:[],edges:[]});u.text=u.text.filter(e=>e.label).map((e,t)=>Object.assign(e,{i:t}));var d=n?["auto:hide-on-label-label-overlap","auto:adjust-on-multiline-label-overflow"]:this.guide.position,h=d.filter(e=>0===e.indexOf("auto:avoid"));u=u.text.length>0&&h.length>0?this.autoPosition(u,h):u;var g=d.reduce((e,t)=>Object.assign(e,{[t]:!0}),{});u.text=u.text=g["auto:adjust-on-label-overflow"]?this.adjustOnOverflow(u.text,l):u.text,u.text=u.text=g["auto:adjust-on-multiline-label-overflow"]?this.adjustOnMultilineOverflow(u.text,l):u.text,u.text=g["auto:hide-on-label-edges-overlap"]?this.hideOnLabelEdgesOverlap(u.text,u.edges):u.text,u.text=g["auto:hide-on-label-label-overlap"]?this.hideOnLabelLabelOverlap(u.text):u.text,u.text=g["auto:hide-on-label-anchor-overlap"]?this.hideOnLabelAnchorOverlap(u.text):u.text;var p=u.text,f=e=>(t,i)=>p[i][e],m=f("x"),y=f("y"),x=f("angle"),b=f("color"),v=f("label"),w=function(e){if(e.style("fill",b).style("font-size",`${t.guide.fontSize}px`).style("display",(e,t)=>p[t].hide?"none":null).attr("class","i-role-label").attr("text-anchor","middle").attr("transform",(e,t)=>`translate(${m(e,t)},${y(e,t)}) rotate(${x(e,t)})`),n){e.each(function(e,t){var i=s.select(this),r=x(e,t);i.text(null),v(e,t).split(a).forEach(function(e,t){i.append("tspan").attr("text-anchor",0!==r?"start":"middle").attr("x",0).attr("y",0).attr("dy",1.2*(t+1)+"em").text(e)})})}else e.text(v)};r.hideEqualLabels&&p.filter(e=>!e.hide).filter((e,t,i)=>t<i.length-1&&e.label===i[t+1].label).forEach(e=>e.hide=!0);var _=this.container.selectAll(".i-role-label").data(p.map(e=>e.data));return _.exit().remove(),_.call(w),_.enter().append("text").call(w),_}applyFixedPositionRules(e,t,i,r,n){var a=e.position.filter(e=>-1===e.indexOf("auto:"));return r&&(n&&a.push("multiline-label-vertical-center-align"),a.push("multiline-label-left-align","multiline-hide-on-container-overflow")),a.map(hr.getRule).reduce((e,i)=>ur.compose(e,i(e,t)),i)}autoPosition(e,t){const i=(e,t)=>{const i=4+(e.size+e.w)/2,r=2+(e.size+e.h)/2;return{x:i*Math.cos(t),y:r*Math.sin(t)}};var r=e.edges,n=e.text.map(e=>{const t={max:-Math.PI/2,min:Math.PI/2,norm:Math.random()*Math.PI*2},r=i(e,t[e.extr]);return{i:e.i,x0:e.x,y0:e.y,x:e.x+r.x,y:e.y+r.y,w:e.w,h:e.h,size:e.size,hide:e.hide,extr:e.extr}}).filter(e=>!e.hide);const a=new wr({items:n,transactor:e=>{const t=e.x,r=e.y;return{modify:()=>{const t={max:-Math.PI,min:Math.PI,norm:2*Math.PI}[e.extr],r=t/4+Math.random()*(2*t)/4,n=i(e,r);return e.x=e.x0+n.x,e.y=e.y0+n.y,e},revert:()=>(e.x=t,e.y=r,e)}},penalties:t.map(e=>Mr.get(e)).filter(e=>e).map(e=>e(n,r))}).start(5);return e.text=a.reduce((e,t)=>{var i=e[t.i];return i.x=t.x,i.y=t.y,e},e.text),e}hideOnLabelEdgesOverlap(e,t){const i=(e,t)=>{const i=this.getLabelRect(e);return t.reduce((e,t)=>{var r=kr(i.x0,i.x1,t.x0,t.x1,i.y0,i.y1,t.y0,t.y1),n=kr(i.x0,i.x1,t.x0,t.x1,i.y1,i.y0,t.y0,t.y1);return e+2*(Number(r)+Number(n))},0)};return e.filter(e=>!e.hide).forEach(e=>{i(e,t)>0&&(e.hide=!0)}),e}hideOnLabelLabelOverlap(e){var t={min:0,max:1,norm:2},i={"min/min":(e,t)=>t.y-e.y,"max/max":(e,t)=>e.y-t.y,"min/max":()=>-1,"min/norm":()=>-1,"max/norm":()=>-1,"norm/norm":(e,t)=>e.y-t.y},r=(e,r)=>{var n=this.getLabelRect(e),a=this.getLabelRect(r),s=Number(!e.hide&&!r.hide);if(s*Math.max(0,Math.min(a.x1,n.x1)-Math.max(n.x0,a.x0))*(s*Math.max(0,Math.min(a.y1,n.y1)-Math.max(n.y0,a.y0)))>0){let n=[e,r];n.sort((e,i)=>t[e.extr]-t[i.extr]),(i[`${n[0].extr}/${n[1].extr}`](n[0],n[1])<0?n[0]:n[1]).hide=!0}};return e.filter(e=>!e.hide).sort((e,i)=>t[e.extr]-t[i.extr]).forEach(t=>{e.forEach(e=>{t.i!==e.i&&r(t,e)})}),e}getLabelRect(e,t=0){return{x0:e.x-e.w/2-t,x1:e.x+e.w/2+t,y0:e.y-e.h/2-t,y1:e.y+e.h/2+t}}getPointRect(e,t=0){return{x0:e.x-e.size/2-t,x1:e.x+e.size/2+t,y0:e.y-e.size/2-t,y1:e.y+e.size/2+t}}hideOnLabelAnchorOverlap(e){var t=(e,t)=>{const i=this.getLabelRect(e,2),r=this.getPointRect(t,2);return Math.max(0,Math.min(r.x1,i.x1)-Math.max(r.x0,i.x0))*Math.max(0,Math.min(r.y1,i.y1)-Math.max(r.y0,i.y0))>.001};return e.filter(e=>!e.hide).forEach(i=>{const r=e.length;for(let n=0;n<r;n++){const r=e[n];if(i.i!==r.i&&t(i,r)){i.hide=!0;break}}}),e}adjustOnOverflow(e,{maxWidth:t,maxHeight:i}){return e.map(e=>(e.hide||(e.x=Math.min(Math.max(e.x,e.w/2),t-e.w/2),e.y=Math.max(Math.min(e.y,i-e.h/2),e.h/2)),e))}adjustOnMultilineOverflow(e,{maxWidth:t}){return e.map(e=>(e.hide||0!==e.angle||(e.x=Math.min(Math.max(e.x,e.w/2),t-e.w/2)),e))}}const Ar={...i(13),...s},Tr={init(e){const t=Object.assign({},e);t.guide=st(t.guide||{},{animationSpeed:0,avoidScalesOverflow:!0,enableColorToBarPosition:!1,maxHighlightDistance:32}),t.guide.size=t.guide.size||{},t.guide.label=st(t.guide.label||{},{position:["auto:avoid-label-label-overlap","auto:avoid-label-anchor-overlap","auto:adjust-on-label-overflow","auto:hide-on-label-label-overlap","auto:hide-on-label-anchor-overlap"]});const i=t.guide.avoidScalesOverflow,r=t.guide.enableColorToBarPosition;return t.transformRules=[e=>{const t=[e.scaleX,e.scaleY].sort((e,t)=>{var i=e.discrete?1:0;return(t.discrete?1:0)*t.domain().length-i*e.domain().length})[0];return e.scaleY===t?w.get("flip")(e):w.get("identity")(e)},t.stack&&w.get("stack"),r&&w.get("positioningByColor")].filter(e=>e),t.adjustRules=[t.stack&&w.get("adjustYScale"),(e,i)=>{const r=e.scaleSize.isEmptyScale(),n=st(t.guide.size,{defMinSize:10,defMaxSize:r?10:40,enableDistributeEvenly:!r}),a=Object.assign({},i,{defMin:n.defMinSize,defMax:n.defMaxSize,minLimit:n.minSize,maxLimit:n.maxSize});return(n.enableDistributeEvenly?w.get("adjustSigmaSizeScale"):w.get("adjustStaticSizeScale"))(e,a)},i&&((e,t)=>{const i=Object.assign({},t,{sizeDirection:"xy"});return w.get("avoidScalesOverflow")(e,i)})].filter(e=>e),t},addInteraction(){const e=this.node();e.on("highlight",(e,t)=>this.highlight(t)),e.on("data-hover",(e,t)=>this.highlight(((e,t)=>i=>i===e||t)(t.data,null)))},draw(){const e=this.node(),t=e.config,i=t.options;i.container=i.slot(t.uid);const r=e=>he(e,t.guide.animationSpeed),n=`${N}dot dot i-role-element i-role-datum`,a=e.screenModel,s={fill:e=>a.color(e),class:e=>`${n} ${a.class(e)}`},o={r:e=>Math.round(1e4*a.size(e)/2)/1e4,cx:e=>a.x(e),cy:e=>a.y(e)},l=[],c=a.toFibers();var u;this._getGroupOrder=(u=c.reduce((e,t,i)=>(e.set(t,i),e),new Map),e=>u.get(e));const d=i.container.selectAll(".frame").data(c,e=>a.group(e[0]));d.enter().append("g").attr("opacity",0).merge(d).call(function(t){t.attr("class","frame").call(function(t){var i=t.selectAll("circle").data(e=>e,a.id),n=i.enter().append("circle").call(ve(o)).merge(i).call(ve(s));r(n).call(ve(o)),r(i.exit()).attr("r",0).remove(),l.push(...n.nodes()),e.subscribe(n)}),r(t).attr("opacity",1)});this._boundsInfo=this._getBoundsInfo(l),r(d.exit()).attr("opacity",0).remove().selectAll("circle").attr("r",0),e.subscribe(new Er(a.model,a.flip,t.guide.label,i).draw(c))},_getBoundsInfo(e){if(0===e.length)return null;const t=this.node().screenModel,i=e.map(e=>{const i=Ar.select(e).data()[0];return{node:e,data:i,x:t.x(i),y:t.y(i),r:t.size(i)/2}}).filter(e=>!isNaN(e.x)&&!isNaN(e.y)),r=i.reduce((e,{x:t,y:i})=>(e.left=Math.min(t,e.left),e.right=Math.max(t,e.right),e.top=Math.min(i,e.top),e.bottom=Math.max(i,e.bottom),e),{left:Number.MAX_VALUE,right:Number.MIN_VALUE,top:Number.MAX_VALUE,bottom:Number.MIN_VALUE}),n=i.reduce((e,t)=>{const i=`${t.x},${t.y}`;return e[i]||(e[i]=[]),e[i].push(t),e},{});return{bounds:r,tree:Ar.quadtree().x(e=>e[0].x).y(e=>e[0].y).addAll(Object.keys(n).map(e=>n[e]))}},getClosestElement(e,t){if(!this._boundsInfo)return null;const{bounds:i,tree:r}=this._boundsInfo,n=T(this.node().config.options.container.node()),a=e-n.x,s=t-n.y,{maxHighlightDistance:o}=this.node().config.guide;if(a<i.left-o||a>i.right+o||s<i.top-o||s>i.bottom+o)return null;const l=(r.find(a,s)||[]).map(e=>{const t=Math.sqrt(Math.pow(a-e.x,2)+Math.pow(s-e.y,2));if(t>o)return null;const i=t<e.r?e.r-t:t;return{node:e.node,data:e.data,x:e.x,y:e.y,distance:t,secondaryDistance:i}}).filter(e=>e).sort((e,t)=>e.secondaryDistance-t.secondaryDistance),c=l.findIndex(e=>e.distance!==l[0].distance||e.secondaryDistance!==l[0].secondaryDistance),u=c<0?l:l.slice(0,c);if(1===u.length)return u[0];const d=u.reduce((e,t)=>e+t.x,0)/u.length,h=u.reduce((e,t)=>e+t.y,0)/u.length,g=Math.atan2(h-s,d-a)+Math.PI;return u[Math.round((u.length-1)*g/2/Math.PI)]},highlight(e){const t=this.node().config.options.container,i={"tau-chart__highlighted":t=>!0===e(t),"tau-chart__dimmed":t=>!1===e(t)};t.selectAll(".dot").call(we(i)),t.selectAll(".i-role-label").call(we(i)),this._sortElements(e)},_sortElements(e){const t=this.node().config.options.container,i=new Map,r=new Map;t.selectAll(".frame").each(function(t){i.set(this,t.some(e)),r.set(this,t)});const n=ct((e,t)=>i.get(e)-i.get(t),(e,t)=>this._getGroupOrder(r.get(e))-this._getGroupOrder(r.get(t)));$t(t.node(),(e,t)=>"g"===e.tagName&&"g"===t.tagName?n(e,t):e.tagName.localeCompare(t.tagName)),O(t,".dot",e)}};var Or=i(9);const Cr="taucharts_synthetic_record";function Nr(e){return!0!==e[Cr]}function Lr(e){return t=>{const i=e.stack,r=t.scaleX.period,n="linear"===t.scaleY.scaleType,a=!e.guide.x||null==e.guide.x.fillGaps;return!a&&e.guide.x.fillGaps||a&&(i||r&&n)?w.get("fillGaps")(t,{isStack:i,xPeriod:r,utc:e.guide.utcTime}):{}}}function Fr(e){if(0===e.length)return"";if(1===e.length)return Rr(e[0]);for(var t=[],i=1;i<e.length;i++)t.push($r(e[i-1],e[i]));return t.join(" ")}function zr(e){if(0===e.length)return"";if(1===e.length)return Rr(e[0]);for(var t=[],i=3;i<e.length;i+=3)t.push(Dr(e[i-3],e[i-2],e[i-1],e[i]));return t.join(" ")}function Rr(e){var t=e.size/2;return[`M${e.x},${e.y-t}`,`A${t},${t} 0 0 1`,`${e.x},${e.y+t}`,`A${t},${t} 0 0 1`,`${e.x},${e.y-t}`,"Z"].join(" ")}function $r(e,t){var i=Ur(e,t);return i?[`M${i.left[0].x},${i.left[0].y}`,`L${i.left[1].x},${i.left[1].y}`,`A${t.size/2},${t.size/2} 0 ${Number(e.size<t.size)} 1`,`${i.right[1].x},${i.right[1].y}`,`L${i.right[0].x},${i.right[0].y}`,`A${e.size/2},${e.size/2} 0 ${Number(e.size>t.size)} 1`,`${i.left[0].x},${i.left[0].y}`,"Z"].join(" "):Rr(e.size>t.size?e:t)}function Dr(e,t,i,r){var n=function(e,t,i,r){var n=Ir(e,r);if(0===n||n+e.size/2<=r.size/2||n+r.size/2<=e.size/2)return null;var a=n=>{var a=n?[r,i,t,e]:[e,t,i,r],s=Wr(1/12*2,...a),o=Wr(.5,...s.slice(0,4)),l=o[3],c=o[6],u=Ur(a[0],l),d=Ur(l,c),h=[u.left[0],I(.5,u.left[1],d.left[0]),d.left[1]],g=[u.right[0],I(.5,u.right[1],d.right[0]),d.right[1]],p=Hr(...h)[1],f=Hr(...g)[1],m=I(4,u.left[0],p),y=I(4,u.right[0],f);return{left:n?[y,g[0]]:[h[0],m],right:n?[m,h[0]]:[g[0],y]}},s=a(!1),o=a(!0);return{left:[...s.left,...o.left],right:[...s.right,...o.right]}}(e,t,i,r);if(!n)return $r(e,r);var a=jr(Pr(e,n.right[0]),Pr(e,n.left[0])),s=jr(Pr(r,n.right[1]),Pr(r,n.left[1]));return[`M${n.left[0].x},${n.left[0].y}`,`C${n.left[1].x},${n.left[1].y}`,`${n.left[2].x},${n.left[2].y}`,`${n.left[3].x},${n.left[3].y}`,`A${r.size/2},${r.size/2} 0 ${Number(a>Math.PI)} 1`,`${n.right[3].x},${n.right[3].y}`,`C${n.right[2].x},${n.right[2].y}`,`${n.right[1].x},${n.right[1].y}`,`${n.right[0].x},${n.right[0].y}`,`A${e.size/2},${e.size/2} 0 ${Number(s>Math.PI)} 1`,`${n.left[0].x},${n.left[0].y}`,"Z"].join(" ")}function Pr(e,t){return Math.atan2(t.y-e.y,t.x-e.x)}function jr(e,t){return t<e&&(t+=2*Math.PI),t-e}function Ir(...e){for(var t=0,i=1;i<e.length;i++)t+=Math.sqrt((e[i].x-e[i-1].x)*(e[i].x-e[i-1].x)+(e[i].y-e[i-1].y)*(e[i].y-e[i-1].y));return t}function Br(e,t,i){return{x:e.x+t*Math.cos(i),y:e.y+t*Math.sin(i)}}function Wr(e,t,i,r,n){var a=B(e,t,i,r,n),s=1/(1+Ir(a[3],a[4],a[5],a[6],a[3])/Ir(a[0],a[1],a[2],a[3],a[0]));return a[3].size=t.size*(1-s)+n.size*s,a}function Hr(e,t,i){var r=I(Ir(e,t)/Ir(e,t,i),e,i);return[e,I(2,r,t),i]}function Ur(e,t){var i=Ir(e,t);if(0===i||i+e.size/2<=t.size/2||i+t.size/2<=e.size/2)return null;var r=Pr(e,t),n=Math.asin((e.size-t.size)/i/2),a=r-Math.PI/2+n,s=r+Math.PI/2-n;return{left:[Br(e,e.size/2,a),Br(t,t.size/2,a)],right:[Br(e,e.size/2,s),Br(t,t.size/2,s)]}}const Gr={circle:{element:"circle",getInitialAttrs:function(e,t){const i=e.config.guide,r=e.screenModel;return{r:"hover"===i.showAnchors?0:e=>r.size(e)/2,cx:e=>t.x(e),cy:e=>t.y(e)}},getHighlightAttrs:function(e,t,i){e.config.guide;const r=e.screenModel,n="hover"===e.config.guide.showAnchors;return{r:n?e=>i(e)?Math.max(4,r.size(e)/2):0:e=>{var t=r.size(e)/2;return i(e)&&(t=Math.max(4,Math.ceil(1.25*t))),t}}}},"vertical-stick":{element:"path",getInitialAttrs:function(e,t){const i=e.config.guide,r=e.screenModel;return{"shape-rendering":"crispEdges",d:e=>{const n=t.x(e),a=t.y(e),s=t.x0(e),o=t.y0(e),l="hover"===i.showAnchors?0:r.size(e)/2;return Fr([{x:n,y:a,size:l},{x:s,y:o,size:l}])}}},getHighlightAttrs:function(e,t,i){e.config.guide;const r=e.screenModel,n="hover"===e.config.guide.showAnchors;return{d:e=>{const a=t.x(e),s=t.y(e),o=t.x0(e),l=t.y0(e),c=n?i(e)?Math.max(4,r.size(e)/2):0:i(e)?Math.max(4,Math.ceil(r.size(e)/2*1.25)):r.size(e)/2;return Fr([{x:a,y:s,size:c},{x:o,y:l,size:c}])}}}}};function qr(e,t,i){const r=i.sort((e,t)=>e.distance===t.distance?e.secondaryDistance-t.secondaryDistance:e.distance-t.distance),n=r.findIndex(e=>e.distance!==r[0].distance||e.secondaryDistance!==r[0].secondaryDistance),a=n<0?r:r.slice(0,n);if(1===a.length)return a[0];const s=a.reduce((e,t)=>e+t.x,0)/a.length,o=a.reduce((e,t)=>e+t.y,0)/a.length,l=Math.atan2(o-t,s-e)+Math.PI;return a[Math.round((a.length-1)*l/2/Math.PI)]}const Xr=`${N}dot-line dot-line i-role-dot i-role-datum ${N}dot`,Yr={init(e){const t=e;return t.guide=st(t.guide||{},{animationSpeed:0,cssClass:"",maxHighlightDistance:32,widthCssClass:"",color:{},label:{}}),t.guide.label=st(t.guide.label,{fontSize:11,hideEqualLabels:!0,position:["auto:avoid-label-label-overlap","auto:avoid-label-anchor-overlap","auto:avoid-label-edges-overlap","auto:adjust-on-label-overflow","auto:hide-on-label-label-overlap","auto:hide-on-label-edges-overlap"]}),t.guide.color=st(t.guide.color||{},{fill:null}),["never","hover","always"].indexOf(t.guide.showAnchors)<0&&(t.guide.showAnchors="hover"),t.transformRules=[],t.adjustRules=[],t},baseModel(e){var t={gog:e.model,x:e.x,y:e.y,x0:e.x0,y0:e.y0,size:e.size,group:e.group,order:e.order,color:e.color,class:e.class,groupAttributes:{},pathAttributesUpdateInit:{},pathAttributesUpdateDone:{},pathAttributesEnterInit:{},pathAttributesEnterDone:{},pathElement:null,dotAttributes:{r:e=>Math.round(1e4*t.size(e)/2)/1e4,cx:e=>t.x(e),cy:e=>t.y(e),fill:e=>t.color(e),class:e=>`${Xr} ${t.class(e)}`},dotAttributesDefault:{r:0,cy:e=>t.y0(e)}};return t},addInteraction(){const e=this.node(),t=this.node().config;e.on("highlight",(e,t)=>this.highlight(t)),e.on("highlight-data-points",(e,t)=>this.highlightDataPoints(t)),"never"!==t.guide.showAnchors&&e.on("data-hover",(e,t)=>this.highlightDataPoints(((e,t)=>i=>i===e||t)(t.data,null)))},draw(){const e=this.node(),t=e.config,i=t.guide,r=t.options;r.container=r.slot(t.uid);const n=e.screenModel,a=this.buildModel(n);this.domElementModel=a;const o=ye,l=function(r){r.call(ve(a.groupAttributes));const l=r.selectAll((e=>e.split(/\s+/g).map(e=>`.${e}`).join(""))(Xr)).data(e=>e.length<=1?e:[],n.id);l.exit().call(o(i.animationSpeed,null,{r:0},e=>s.select(e).remove())),l.call(o(i.animationSpeed,null,a.dotAttributes));const c=l.enter().append("circle").call(o(i.animationSpeed,a.dotAttributesDefault,a.dotAttributes)).merge(l);e.subscribe(c);const u=r.selectAll(`${a.pathElement}:not(.i-data-anchor)`).data(e=>e.length>1?[e]:[],h);u.exit().remove(),u.call(o(i.animationSpeed,a.pathAttributesUpdateInit,a.pathAttributesUpdateDone,a.afterPathUpdate));u.enter().append(a.pathElement).call(o(i.animationSpeed,a.pathAttributesEnterInit,a.pathAttributesEnterDone,a.afterPathUpdate)).merge(u).call(e=>{t.guide.animationSpeed>0&&!document.hidden?(e.attr(a.pathTween.attr,function(e){return a.pathTween.fn.call(this,e)(0)}),he(e,t.guide.animationSpeed,"pathTransition").attrTween(a.pathTween.attr,a.pathTween.fn)):e.attr(a.pathTween.attr,function(e){return a.pathTween.fn.call(this,e)(1)})});if(e.subscribe(c),"never"!==i.showAnchors){const t=function(e,t,i){const r=t.anchorShape,n=e.config.guide,a=e.screenModel,s={...Gr[r].getInitialAttrs(e,t),opacity:"hover"===n.showAnchors?0:1,fill:e=>a.color(e),class:"i-data-anchor"},o=i.selectAll(".i-data-anchor").data(e=>e.filter(Nr),a.id);return o.exit().remove(),o.call(ye(n.animationSpeed,null,s)),o.enter().append(Gr[t.anchorShape].element).call(ye(n.animationSpeed,{r:0},s)).merge(o)}(e,a,r);e.subscribe(t)}},c=n.toFibers(),u=c.map(e=>e.filter(Nr)),d=r.container.selectAll(".frame"),h=(()=>{const e=d.empty()?[]:d.data(),t=new Map;d.each(function(e){t.set(e,Number(this.getAttribute("data-id")))});const i=e.reduce((e,t)=>(e.set(t,t.map(n.id)),e),new Map),r=new Map;var a=Math.max(0,...Array.from(t.values()));return e=>{if(r.has(e))return r.get(e);const s=e.map(e=>n.id(e)),o=(Array.from(i.entries()).find(([,e])=>s.some(t=>e.some(e=>e===t)))||[null])[0];var l;return l=o?t.get(o):++a,r.set(e,l),l}})();this._getDataSetId=h;const g=d.data(c,h);g.exit().remove(),g.call(l),g.enter().append("g").attr("data-id",h).call(l),g.order(),this._boundsInfo=this._getBoundsInfo(r.container.selectAll(".i-data-anchor").nodes()),e.subscribe(new Er(n.model,t.flip,t.guide.label,r).draw(u))},_getBoundsInfo(e){if(0===e.length)return null;const t=this.node().screenModel,{flip:i}=this.node().config,r=e.map(e=>{const i=s.select(e).data()[0];return{node:e,data:i,x:t.x(i),y:t.y(i)}}).filter(e=>!isNaN(e.x)&&!isNaN(e.y)),n=r.reduce((e,{x:t,y:i})=>(e.left=Math.min(t,e.left),e.right=Math.max(t,e.right),e.top=Math.min(i,e.top),e.bottom=Math.max(i,e.bottom),e),{left:Number.MAX_VALUE,right:Number.MIN_VALUE,top:Number.MAX_VALUE,bottom:Number.MIN_VALUE}),a=it(r.map(i?e=>e.y:e=>e.x)).sort((e,t)=>e-t),o=a.reduce((e,t)=>(e[t]=[],e),{});r.forEach(e=>{const t=a.find(i?t=>e.y===t:t=>e.x===t);o[t].push(e)});const l=e=>{if(1===e.length)return o[e[0]];const t=Math.ceil(e.length/2);return{middle:(e[t-1]+e[t])/2,lower:l(e.slice(0,t)),greater:l(e.slice(t))}};return{bounds:n,tree:l(a)}},getClosestElement(e,t){if(!this._boundsInfo)return null;const{bounds:i,tree:r}=this._boundsInfo,n=this.node().config.options.container,{flip:a}=this.node().config,s=T(n.node()),{maxHighlightDistance:o}=this.node().config.guide;if(e<i.left+s.x-o||e>i.right+s.x+o||t<i.top+s.y-o||t>i.bottom+s.y+o)return null;const l=a?t-s.y:e-s.x,c=function e(t){return Array.isArray(t)?t:e(l>t.middle?t.greater:t.lower)}(r).map(i=>{const r=i.x+s.x,n=i.y+s.y,o=Math.abs(a?t-n:e-r),l=Math.abs(a?e-r:t-n);return{node:i.node,data:i.data,distance:o,secondaryDistance:l,x:r,y:n}});return qr(e,t,c)},highlight(e){const t=this.node().config.options.container,i="tau-chart__highlighted",r="tau-chart__dimmed",n=t.selectAll(".i-role-path"),a=n.data().filter(t=>t.filter(Nr).some(e)),s=a.length>0;n.call(we({[i]:e=>s&&a.indexOf(e)>=0,[r]:e=>s&&a.indexOf(e)<0}));const o={[i]:t=>!0===e(t),[r]:t=>!1===e(t)};t.selectAll(".i-role-dot").call(we(o)),t.selectAll(".i-role-label").call(we(o)),this._sortElements(e)},highlightDataPoints(e){const t=this.node(),i=function(e,t,i){const r=t.anchorShape,n=e.screenModel,a="hover"===e.config.guide.showAnchors;return e.config.options.container.selectAll(".i-data-anchor").call(ve(Gr[r].getHighlightAttrs(e,t,i))).attr("opacity",a?e=>i(e)?1:0:()=>1).attr("fill",e=>n.color(e)).attr("class",e=>Dt("i-data-anchor",n.class(e))).classed(`${N}highlighted`,i)}(t,this.domElementModel,e),r=t.config.options.container,n=t.config.flip,a=i.filter(e);var s=r.select(".cursor-line");if(a.empty())s.remove();else{s.empty()&&(s=r.append("line"));const e=t.screenModel.model,i=e.xi(a.data()[0]),o=e.xi(a.data()[0]),l=e.scaleY.domain(),c=e.scaleY(l[0]),u=e.scaleY(l[1]);s.attr("class","cursor-line").attr("x1",n?c:i).attr("y1",n?i:c).attr("x2",n?u:o).attr("y2",n?o:u)}this._sortElements(e)},_sortElements(e){const t=this.node().config.options.container,i=new Map,r=new Map,n=this._getDataSetId;t.selectAll(".i-role-path").each(function(t){i.set(this,n(t)),r.set(this,t.filter(Nr).some(e))});const a=ct((e,t)=>r.get(e)-r.get(t),(e,t)=>i.get(e)-i.get(t)),s={line:0,g:1,text:2};$t(t.node(),(e,t)=>"g"===e.tagName&&"g"===t.tagName?a(e,t):s[e.tagName]-s[t.tagName])}};var Vr=[1,2,3,4,5],Jr=Vr.map(e=>N+"line-opacity-"+e),Kr=Vr.map(e=>N+"line-width-"+e);function Zr(e){return Jr[e-1]||Jr[4]}function Qr(e,t){if(e.length<2)return"";return String.prototype.concat.apply("",e.concat(t.slice().reverse()).map((e,t)=>`${0===t?"":" "}${e.x},${e.y}`))}function en(e,t){if(e.length<2)return"";const i=e=>{const t=e.map((e,t)=>{return`${(t-1)%3==0?"C":""}${e.x},${e.y} `});return String.prototype.concat.apply("",t)};return`M${i(e)}L${i(t.slice().reverse())}Z`}const tn={...Or,...s},rn={draw:Yr.draw,highlight:Yr.highlight,highlightDataPoints:Yr.highlightDataPoints,addInteraction:Yr.addInteraction,_sortElements:Yr._sortElements,init(e){const t=Yr.init(e),i=t.stack;return t.transformRules=[t.flip&&w.get("flip"),t.guide.obsoleteVerticalStackOrder&&w.get("obsoleteVerticalStackOrder"),!i&&w.get("groupOrderByAvg"),Lr(t),i&&w.get("stack")],t.adjustRules=[(e,i)=>{const r=e.scaleSize.isEmptyScale(),n=st(t.guide.size||{},{defMinSize:2,defMaxSize:r?6:40}),a=Object.assign({},i,{defMin:n.defMinSize,defMax:n.defMaxSize,minLimit:n.minSize,maxLimit:n.maxSize});return w.get("adjustStaticSizeScale")(e,a)}],t},buildModel(e){const t=Yr.baseModel(e),i=this.node().config.guide,r=Zr(e.model.scaleColor.domain().length),n=`${N}area area i-role-path ${r} ${i.cssClass} `;t.groupAttributes={class:e=>`${n} ${t.class(e[0])} frame`};const a={fill:e=>t.color(e[0]),stroke:e=>{var i=t.color(e[0]);return i.length>0&&(i=tn.rgb(i).darker(1)),i}};t.pathAttributesEnterInit=a,t.pathAttributesUpdateDone=a;const s="polyline"===oe(i.interpolate);return t.pathElement=s?"polygon":"path",t.anchorShape="vertical-stick",t.pathTween={attr:s?"points":"d",fn:be(0,s?Qr:en,[i=>({id:e.id(i),x:t.x(i),y:t.y(i)}),i=>({id:e.id(i),x:t.x0(i),y:t.y0(i)})],e.id,i.interpolate)},t},_getBoundsInfo(e){if(0===e.length)return null;const t=this.node().screenModel,{flip:i}=this.node().config,r=e.map(e=>{const i=tn.select(e).data()[0];return{node:e,data:i,x:t.x(i),y:t.y(i),y0:t.y0(i),group:t.group(i)}}),n=r.reduce((e,{x:t,y:i,y0:r})=>(e.left=Math.min(t,e.left),e.right=Math.max(t,e.right),e.top=Math.min(i,r,e.top),e.bottom=Math.max(i,r,e.bottom),e),{left:Number.MAX_VALUE,right:Number.MIN_VALUE,top:Number.MAX_VALUE,bottom:Number.MIN_VALUE}),a=it(r.map(i?e=>e.y:e=>e.x)).sort((e,t)=>e-t),s=a.reduce((e,t)=>(e[t]=[],e),{});if(r.forEach(e=>{const t=a.find(i?t=>e.y===t:t=>e.x===t);s[t].push(e)}),(()=>{const e=Object.keys(r.reduce((e,t)=>(e[t.group]=!0,e),{})),t=e.reduce((e,t,i)=>(e[t]=i,e),{});a.forEach(i=>{const r=s[i];if(r.sort((e,i)=>t[e.group]-t[i.group]),r.length<e.length)for(var n=0;n<e.length;n++){let t,a,s=!1;if(n===r.length?(t=a=0===n?0:r[n-1].y,s=!0):r[n].group!==e[n]&&(t=a=r[n].y0,s=!0),s){let s={x:i,y:t,y0:a,data:null,node:null,group:e[n]};r.splice(n,0,s)}}})})(),1===a.length){return{bounds:n,tree:{start:a[0],end:a[0],isLeaf:!0,items:{start:s[a[0]],end:s[a[0]]}}}}const o=e=>{if(2===e.length){let[t,i]=e;return{start:t,end:i,isLeaf:!0,items:{start:s[t],end:s[i]}}}const t=e.length%2==0?e.length/2:(e.length-1)/2;e[t];return{start:e[0],end:e[e.length-1],isLeaf:!1,left:o(e.slice(0,t+1)),right:o(e.slice(t))}};return{bounds:n,tree:o(a)}},getClosestElement(e,t){if(!this._boundsInfo)return null;const{bounds:i,tree:r}=this._boundsInfo,n=this.node().config.options.container,{flip:a}=this.node().config,s=T(n.node()),{maxHighlightDistance:o}=this.node().config.guide;if(e<i.left+s.x-o||e>i.right+s.x+o||t<i.top+s.y-o||t>i.bottom+s.y+o)return null;const l=a?t-s.y:e-s.x,c=function e(t){if(t.isLeaf)return t;const i=t.left.end;return e(l<i?t.left:t.right)}(r);var u=c.end===c.start?0:(l-c.start)/(c.end-c.start);u<0&&(u=0),u>1&&(u=1);const d=(()=>{const e=c.items.start.reduce((e,t)=>(e[t.group]={start:t,end:null,y:null,y0:null},e),{});return c.items.end.forEach(t=>{void 0!==e[t.group]?e[t.group].end=t:delete e[t.group]}),Object.keys(e).forEach(t=>{const i=e[t];i.end?(i.y=i.start.y+u*(i.end.y-i.start.y),i.y0=i.start.y0+u*(i.end.y0-i.start.y0)):delete e[t]}),Object.keys(e).map(t=>e[t]).map(e=>({y:e.y,y0:e.y0,el:u<.5?e.start:e.end})).filter(e=>null!=e.el.data)})(),h=t-s.y,g=d.filter(e=>h>=e.y&&h<=e.y0),p=(g.length>0?g:d).map(e=>e.el).map(i=>{const r=i.x+s.x,n=i.y+s.y,o=Math.abs(a?t-n:e-r),l=Math.abs(a?e-r:t-n);return{node:i.node,data:i.data,distance:o,secondaryDistance:l,x:r,y:n}});return qr(e,t,p)}},nn={draw:Yr.draw,getClosestElement:Yr.getClosestElement,highlight:Yr.highlight,highlightDataPoints:Yr.highlightDataPoints,addInteraction:Yr.addInteraction,_getBoundsInfo:Yr._getBoundsInfo,_sortElements:Yr._sortElements,init(e){const t=Yr.init(e);return t.transformRules=[t.flip&&w.get("flip")],t.adjustRules=[(e,i)=>{const r=e.scaleSize.isEmptyScale(),n=st(t.guide.size||{},{defMinSize:2,defMaxSize:r?6:40}),a=Object.assign({},i,{defMin:n.defMinSize,defMax:n.defMaxSize,minLimit:n.minSize,maxLimit:n.maxSize});return w.get("adjustStaticSizeScale")(e,a)}],t},buildModel(e){const t=Yr.baseModel(e),i=this.node().config.guide,r=Zr(e.model.scaleColor.domain().length),n=`${N}area area i-role-path ${r} ${i.cssClass} `;t.groupAttributes={class:e=>`${n} ${t.class(e[0])} frame`};const a={fill:e=>t.color(e[0]),stroke:e=>t.color(e[0])};return t.pathAttributesEnterInit=a,t.pathAttributesUpdateDone=a,t.pathElement="polygon",t.anchorShape="circle",t.pathTween={attr:"points",fn:be(0,((e,t)=>i=>i.map(i=>[e(i),t(i)].join(",")).join(" "))(e=>e.x,e=>e.y),[i=>({id:e.id(i),x:t.x(i),y:t.y(i)})],e.id)},t}};function an(e){if(e.length<2)return"";for(var t="",i=0;i<e.length;i++)t+=`${0===i?"M":" L"}${e[i].x},${e[i].y}`;return t}function sn(e){if(e.length<4)return"";for(var t=`M${e[0].x},${e[0].y}`,i=3;i<e.length;i+=3)t+=` C${e[i-2].x},${e[i-2].y} ${e[i-1].x},${e[i-1].y} ${e[i].x},${e[i].y}`;return t}const on={draw:Yr.draw,getClosestElement:Yr.getClosestElement,highlight:Yr.highlight,highlightDataPoints:Yr.highlightDataPoints,addInteraction:Yr.addInteraction,_getBoundsInfo:Yr._getBoundsInfo,_sortElements:Yr._sortElements,init(e){const t=Yr.init(e),i=t.stack;t.guide=st(t.guide||{},{avoidScalesOverflow:!0,interpolate:"linear"}),t.transformRules=[t.flip&&w.get("flip"),!i&&w.get("groupOrderByAvg"),Lr(t),i&&w.get("stack")];const r=t.guide.avoidScalesOverflow,n=e=>e.scaleSize.isEmptyScale();return t.adjustRules=[(e,i)=>{const r=st(t.guide.size||{},{defMinSize:2,defMaxSize:n(e)?6:40}),a=Object.assign({},i,{defMin:r.defMinSize,defMax:r.defMaxSize,minLimit:r.minSize,maxLimit:r.maxSize});return w.get("adjustStaticSizeScale")(e,a)},r&&((e,t)=>{if(n(e))return()=>({});const i=Object.assign({},t,{sizeDirection:"xy"});return w.get("avoidScalesOverflow")(e,i)})].filter(e=>e),t},buildModel(e){const t=this.node().config,i=t.guide,r=t.options,n=!e.model.scaleSize.dim,a=n?i.widthCssClass||(s=r.width,o=0,s>=160&&s<320?o=1:s>=320&&s<480?o=2:s>=480&&s<640?o=3:s>=640&&(o=4),Kr[o]):"";var s,o;const l=Zr(e.model.scaleColor.domain().length),c=n?"line":"area",u=`${N}${c} ${c} i-role-path ${a} ${l} ${i.cssClass} `,d=n?{stroke:e=>g.color(e[0]),class:"i-role-datum"}:{fill:e=>g.color(e[0])},h="cubic"===oe(i.interpolate)?n?sn:zr:n?an:Fr,g=Yr.baseModel(e),p=n?t=>({id:e.id(t),x:g.x(t),y:g.y(t)}):t=>({id:e.id(t),x:g.x(t),y:g.y(t),size:g.size(t)});return g.groupAttributes={class:e=>`${u} ${g.class(e[0])} frame`},g.pathElement="path",g.anchorShape="circle",g.pathAttributesEnterInit=d,g.pathAttributesUpdateDone=d,g.pathTween={attr:"d",fn:be(0,h,[p],e.id,i.interpolate)},g}},ln=e=>s.select(e).data()[0],cn={init(e){const t=Object.assign({},e);t.guide=t.guide||{},t.guide=st(t.guide,{animationSpeed:0,avoidScalesOverflow:!0,maxHighlightDistance:32,prettify:!0,sortByBarHeight:!0,enableColorToBarPosition:null!=t.guide.enableColorToBarPosition?t.guide.enableColorToBarPosition:!t.stack}),t.guide.size=st(t.guide.size||{},{enableDistributeEvenly:!0}),t.guide.label=st(t.guide.label||{},{position:t.flip?t.stack?["r-","l+","hide-by-label-height-horizontal","cut-label-horizontal"]:["outside-then-inside-horizontal","auto:hide-on-label-label-overlap"]:t.stack?["rotate-on-size-overflow","t-","b+","hide-by-label-height-vertical","cut-label-vertical","auto:hide-on-label-label-overlap"]:["rotate-on-size-overflow","outside-then-inside-vertical","auto:hide-on-label-label-overlap"]});const i=t.guide.avoidScalesOverflow,r=t.guide.enableColorToBarPosition,n=t.guide.size.enableDistributeEvenly;return t.transformRules=[t.flip&&w.get("flip"),t.guide.obsoleteVerticalStackOrder&&w.get("obsoleteVerticalStackOrder"),t.stack&&w.get("stack"),r&&w.get("positioningByColor")].filter(e=>e),t.adjustRules=[n&&((e,i)=>{const r=st(t.guide.size||{},{defMinSize:t.guide.prettify?3:0,defMaxSize:t.guide.prettify?40:Number.MAX_VALUE}),n=Object.assign({},i,{defMin:r.defMinSize,defMax:r.defMaxSize,minLimit:r.minSize,maxLimit:r.maxSize});return w.get("size_distribute_evenly")(e,n)}),i&&n&&((e,t)=>{const i=Object.assign({},t,{sizeDirection:"x"});return w.get("avoidScalesOverflow")(e,i)}),t.stack&&w.get("adjustYScale")].filter(e=>e),t},addInteraction(){const e=this.node();e.on("highlight",(e,t)=>this.highlight(t)),e.on("data-hover",(e,t)=>this.highlight(((e,t)=>i=>i===e||t)(t.data,null)))},draw(){const e=this.node(),t=e.config,i=t.options;i.container=i.slot(t.uid);const r=t.guide.prettify,n=`i-role-element i-role-datum bar ${N}bar`,a=e.screenModel,o=this.buildModel(a,{prettify:r,minBarH:1,minBarW:1,baseCssClass:n}),l=ye,c=t.flip?"y":"x",u=t.flip?"x":"y",d=t.flip?"width":"height",h=t.flip?"height":"width",g=a.toFibers(),p=g.reduce((e,t)=>e.concat(t),[]),f=o.class,m=ot(o,"class"),y=i.container.selectAll(".bar").data(p,a.id);y.exit().classed("tau-removing",!0).call(l(t.guide.animationSpeed,null,{[c]:function(){var e=s.select(this);return e.attr(c)-0+(e.attr(h)-0)/2},[u]:function(){return this.getAttribute("data-zero")},[h]:0,[d]:0},e=>{var t=s.select(e);t.classed("tau-removing")&&t.remove()})),y.call(l(t.guide.animationSpeed,null,m));const x=y.enter().append("rect").call(l(t.guide.animationSpeed,{[u]:a[`${u}0`],[d]:0},m)).merge(y).attr("class",f).attr("data-zero",a[`${u}0`]);e.subscribe(new Er(a.model,a.model.flip,t.guide.label,i).draw(g));const b=(()=>{const e=p.reduce((e,t,i)=>(e.set(t,i+1),e),new Map);return(t,i)=>{return(e.get(ln(t))||-1)-(e.get(ln(i))||-1)}})();this._barsSorter=t.guide.sortByBarHeight?t.flip?(e,t)=>{const i=ln(e),r=ln(t),n=o.width(i),a=o.width(r);if(n===a){const n=o.y(i),a=o.y(r);return n===a?b(e,t):n-a}return a-n}:(e,t)=>{const i=ln(e),r=ln(t),n=o.height(i),a=o.height(r);if(n===a){const n=o.x(i),a=o.x(r);return n===a?b(e,t):n-a}return a-n}:b;const v={rect:0,text:1};this._typeSorter=((e,t)=>v[e.tagName]-v[t.tagName]),this._sortElements(this._typeSorter,this._barsSorter),e.subscribe(x),this._boundsInfo=this._getBoundsInfo(x.nodes())},buildModel(e,{prettify:t,minBarH:i,minBarW:r,baseCssClass:n}){const a=i=>{var n=e.size(i);return t&&(n=Math.max(r,n)),n};var s;const o=t=>t[e.model.scaleY.dim];if(e.flip){let r=t=>Math.abs(e.x(t)-e.x0(t));s={y:t=>e.y(t)-.5*a(t),x:n=>{const a=Math.min(e.x0(n),e.x(n));if(t){const e=r(n),t=o(n);var s=0;return 0===t&&(s=0),t>0&&(s=e),t<0&&(s=0-i),e<i?a+s:a}return a},height:e=>a(e),width:e=>{const n=r(e);return t?0===o(e)?n:Math.max(i,n):n}}}else{let r=t=>Math.abs(e.y(t)-e.y0(t));s={x:t=>e.x(t)-.5*a(t),y:n=>{var a=Math.min(e.y0(n),e.y(n));if(t){a=r(n)<i&&o(n)>0?a-i:a}return a},width:e=>a(e),height:e=>{var n=r(e);return t&&(n=0===o(e)?n:Math.max(i,n)),n}}}return Object.assign(s,{class:t=>`${n} ${e.class(t)}`,fill:t=>e.color(t)})},_sortElements(...e){$t(this.node().config.options.container.node(),ct(...e))},_getBoundsInfo(e){if(0===e.length)return null;const t=this.node().screenModel,{flip:i}=this.node().config,r=e.map(e=>{const i=s.select(e).data()[0],r=t.x(i),n=t.x0(i),a=t.y(i),o=t.y0(i),l=Math.abs(r-n),c=Math.abs(a-o),u=(r+n)/2,d=(a+o)/2;return{node:e,data:i,cx:u,cy:d,box:{top:d-c/2,right:u+l/2,bottom:d+c/2,left:u-l/2},invert:a>o}}),n=r.reduce((e,{box:t})=>(e.left=Math.min(t.left,e.left),e.right=Math.max(t.right,e.right),e.top=Math.min(t.top,e.top),e.bottom=Math.max(t.bottom,e.bottom),e),{left:Number.MAX_VALUE,right:Number.MIN_VALUE,top:Number.MAX_VALUE,bottom:Number.MIN_VALUE}),a=it(r.map(i?e=>e.cy:e=>e.cx)).sort((e,t)=>e-t),o=a.reduce((e,t)=>(e[t]=[],e),{});r.forEach(e=>{const t=a.find(i?t=>e.cy===t:t=>e.cx===t);o[t].push(e)});const l=e=>{if(1===e.length)return o[e];const t=Math.ceil(e.length/2);return{middle:(e[t-1]+e[t])/2,lower:l(e.slice(0,t)),greater:l(e.slice(t))}};return{bounds:n,tree:l(a)}},getClosestElement(e,t){if(!this._boundsInfo)return null;const{bounds:i,tree:r}=this._boundsInfo,n=this.node().config.options.container,{flip:a}=this.node().config,s=T(n.node()),o=e-s.x,l=t-s.y,{maxHighlightDistance:c}=this.node().config.guide;if(o<i.left-c||o>i.right+c||l<i.top-c||l>i.bottom+c)return null;const u=a?l:o,d=a?o:l;return function e(t){return Array.isArray(t)?t:e(u>t.middle?t.greater:t.lower)}(r).map(e=>{const t=a?e.box.left:e.box.top,i=a?e.box.right:e.box.bottom,r=((e,t,i)=>e>=t&&e<=i)(d,t,i);if(!r&&Math.abs(d-t)>c&&Math.abs(d-i)>c)return null;const n=Math.abs(d-(e.invert!==a?i:t));return Object.assign(e,{distToValue:n,cursorInside:r})}).filter(e=>e).sort((e,t)=>e.cursorInside!==t.cursorInside?t.cursorInside-e.cursorInside:Math.abs(e.distToValue)-Math.abs(t.distToValue)).map(e=>{const t=e.cx,i=e.cy,r=Math.abs(a?l-i:o-t),n=Math.abs(a?o-t:l-i);return{node:e.node,data:e.data,distance:r,secondaryDistance:n,x:t,y:i}})[0]||null},highlight(e){const t=this.node().config.options.container,i={"tau-chart__highlighted":t=>!0===e(t),"tau-chart__dimmed":t=>!1===e(t)};t.selectAll(".bar").call(we(i)),t.selectAll(".i-role-label").call(we(i)),this._sortElements((t,i)=>e(ln(t))-e(ln(i)),this._typeSorter,this._barsSorter)}};var un=i(14);var dn=e=>"date"===e?e=>new Date(e).getTime():e=>e,hn=(e,t)=>He([e,t].map(e=>JSON.stringify).join(""));class gn{constructor(e,t){var i;if(this._fields={},Array.isArray(t.fitToFrameByDims)&&t.fitToFrameByDims.length){let r=e=>{var i={};return"where"===e.type&&e.args?(i.type=e.type,i.args=t.fitToFrameByDims.reduce((t,i)=>(e.args.hasOwnProperty(i)&&(t[i]=e.args[i]),t),{})):i=e,i};i=e.part(r)}else i=e.full();var r=this.getVarSet(i,t);t.order&&(r=nt(at(t.order,r),r)),this.vars=r;const n=r.map(e=>e);this.scaleConfig=t,this.scaleConfig.nice=this.scaleConfig.hasOwnProperty("nice")?this.scaleConfig.nice:this.scaleConfig.autoScale,this.addField("dim",this.scaleConfig.dim).addField("scaleDim",this.scaleConfig.dim).addField("scaleType",this.scaleConfig.type).addField("source",this.scaleConfig.source).addField("domain",()=>this.vars).addField("isInteger",n.every(Number.isInteger)).addField("originalSeries",()=>n).addField("isContains",e=>this.isInDomain(e)).addField("isEmptyScale",()=>this.isEmpty()).addField("fixup",e=>{var t=this.scaleConfig;t.__fixup__=t.__fixup__||{},t.__fixup__=Object.assign(t.__fixup__,e(Object.assign({},t,t.__fixup__)))}).addField("commit",()=>{this.scaleConfig=Object.assign(this.scaleConfig,this.scaleConfig.__fixup__),delete this.scaleConfig.__fixup__})}isInDomain(e){return this.domain().indexOf(e)>=0}addField(e,t){return this._fields[e]=t,this[e]=t,this}getField(e){return this._fields[e]}isEmpty(){return!Boolean(this._fields.dim)}toBaseScale(e,t=null){var i=Object.keys(this._fields).reduce((e,t)=>(e[t]=this._fields[t],e),e);return i.getHash=(()=>hn(this.vars,t)),i.value=i,i}getVarSet(e,t){return it(t.hasOwnProperty("series")?t.series:e.map(e=>e[t.dim]),dn(t.dimType))}}const pn={...o,...l};let fn={sqrt:e=>Math.sqrt(e),linear:e=>e};const mn={...o,...l};var yn=i(15);const xn={...o,...l,...yn};function bn(e){return xn[`time${e[0].toUpperCase()}${e.slice(1)}`]}const vn={second:{duration:1e3,interval:xn.timeSecond,utc:xn.utcSecond},minute:{duration:6e4,interval:xn.timeMinute,utc:xn.utcMinute},hour:{duration:36e5,interval:xn.timeHour,utc:xn.utcHour},day:{duration:864e5,interval:xn.timeDay,utc:xn.utcDay},week:{duration:6048e5,interval:xn.timeWeek,utc:xn.utcWeek},month:{duration:2592e6,interval:xn.timeMonth,utc:xn.utcMonth},year:{duration:31536e6,interval:xn.timeYear,utc:xn.utcYear}},wn=(()=>{const e=(e,t)=>{return{time:e,step:t,duration:t*e.duration}};return[e(vn.second,1),e(vn.second,5),e(vn.second,15),e(vn.second,30),e(vn.minute,1),e(vn.minute,5),e(vn.minute,15),e(vn.minute,30),e(vn.hour,1),e(vn.hour,3),e(vn.hour,6),e(vn.hour,12),e(vn.day,1),e(vn.day,2),e(vn.week,1),e(vn.month,1),e(vn.month,3),e(vn.year,1)]})();const _n={...o,...l};const Sn={...o,...l};function Mn(e){return Math.log(e)/Math.LN10}function kn(e){if(e[0]*e[1]<=0)throw new x("Logarithmic scale domain cannot cross zero.",b.INVALID_LOG_DOMAIN)}const En={...o,...l};var An=e=>e||null,Tn=(e,t=null)=>Array.isArray(e)?0===e.length?[t]:e:[e],On=(e,t)=>({type:e,x:t.x,y:t.y,identity:t.identity,size:t.size,color:t.color,split:t.split,label:t.label,guide:{color:t.colorGuide,obsoleteVerticalStackOrder:t.obsoleteVerticalStackOrder,size:t.sizeGuide},flip:t.flip,stack:t.stack});const Cn={SUCCESS:"SUCCESS",WARNING:"WARNING",FAIL:"FAIL"};var Nn={[Cn.SUCCESS]:e=>e,[Cn.FAIL]:(e,t)=>{throw new Error((t.messages||[]).join("\n")||["This configuration is not supported,","See https://api.taucharts.com/basic/facet.html#easy-approach-for-creating-facet-chart"].join(" "))},[Cn.WARNING]:(e,t,i)=>{var r=t.axis,n=t.indexMeasureAxis[0],a=e[n],s=e.filter(e=>e!==a);s.push(a);var o=i[n][r]||{},l=i[i.length-1][r]||{};return i[i.length-1][r]=o,i[n][r]=l,s}};function Ln(e,t,i){return t.reduce(function(t,r,n){var a=e[r];return a?t.status!=Cn.FAIL&&("measure"===a.type&&(t.countMeasureAxis++,t.indexMeasureAxis.push(n)),"measure"!==a.type&&1===t.countMeasureAxis?t.status=Cn.WARNING:t.countMeasureAxis>1&&(t.status=Cn.FAIL,t.messages.push(`There is more than one measure dimension for "${i}" axis`))):(t.status=Cn.FAIL,r?t.messages.push(`"${r}" dimension is undefined for "${i}" axis`):t.messages.push(`"${i}" axis should be specified`)),t},{status:Cn.SUCCESS,countMeasureAxis:0,indexMeasureAxis:[],messages:[],axis:i})}function Fn(e){var t=Tn(e.x),i=Tn(e.y),r=Math.max(t.length,i.length),n=Tn(e.guide||{},{});let a=r-n.length;for(let e=0;e<a;e++)n.push({});n=n.slice(0,r);var s=Ln(e.dimensions,t,"x"),o=Ln(e.dimensions,i,"y");t=Nn[s.status](t,s,n),i=Nn[o.status](i,o,n);const l=["identity","color","size","label","split"].reduce((t,i)=>{const r=e[i],n=function(e,t,i){return null==t?t:String(t)}(e.dimensions,r);return null!=n&&(t[i]=n),t},{});return Object.assign({},e,{x:t,y:i,guide:n},l)}function zn(e,t){for(var i=t.x,r=t.y,n=t.guide,a=Math.max(i.length,r.length),s={type:"COORDS.RECT",unit:[]},o=[].concat(i),l=[].concat(r),c=[].concat(n),u=a;u>0;u--){var d=o.pop(),h=l.pop(),g=c.pop()||{};u===a?(s.x=d,s.y=h,s.unit.push(On(e,{x:An(d),y:An(h),identity:t.identity,split:t.split,color:t.color,label:t.label,size:t.size,flip:t.flip,stack:t.stack,colorGuide:g.color,obsoleteVerticalStackOrder:g.obsoleteVerticalStackOrder,sizeGuide:g.size})),s.guide=st(g,{x:{label:d},y:{label:h}})):s={type:"COORDS.RECT",x:An(d),y:An(h),unit:[s],guide:st(g,{x:{label:d},y:{label:h}})}}return t.spec={dimensions:t.dimensions,unit:s},t}const Rn=e=>{var t=Fn(e);return zn("ELEMENT.INTERVAL",t=(e=>{var t=(e.flip?e.y:e.x).indexOf(e.color)>=0,i=e.guide[e.guide.length-1];return t&&!i.hasOwnProperty("enableColorToBarPosition")&&(i.enableColorToBarPosition=!1),e})(t))},$n=e=>{var t=Fn(e),i=t.data,r=t.settings.log,n=(0,{horizontal:e=>({prop:e.x[e.x.length-1],flip:!1}),vertical:e=>({prop:e.y[e.y.length-1],flip:!0}),auto:e=>{var t,n=e.x,a=e.y,s=n[n.length-1],o=n.slice(0,n.length-1),l=a[a.length-1],c=a.slice(0,a.length-1),u=e.color,d=o.concat(c).concat([u]).filter(e=>null!==e),h=-1,g=[[[s].concat(d),l],[[l].concat(d),s]],p=null;return g.some((e,t)=>{var n=e[0],a=e[1],s=ri.isYFunctionOfX(i,n,[a]);return s.result?h=t:r(["Attempt to find a functional relation between",e[0]+" and "+e[1]+" is failed.","There are several "+s.error.keyY+" values (e.g. "+s.error.errY.join(",")+")","for ("+s.error.keyX+" = "+s.error.valX+")."].join(" ")),s.result})?(t=g[h][0][0],p=0!==h):(r("All attempts are failed. Gonna transform AREA to general PATH."),t=null),{prop:t,flip:p}}}["boolean"!=typeof t.flip?"auto":t.flip?"vertical":"horizontal"])(t);return null!==n.prop&&(t.data=ri.sortByDim(i,n.prop,t.dimensions[n.prop]),t.flip=n.flip),zn("ELEMENT.AREA",t)};class Dn{constructor(e){this.unitRef=e}value(){return this.unitRef}clone(){return JSON.parse(JSON.stringify(this.unitRef))}traverse(e){var t=(e,i,r)=>{i(e,r),(e.units||[]).map(r=>t(r,i,e))};return t(this.unitRef,e,null),this}reduce(e,t){var i=t;return this.traverse((t,r)=>i=e(i,t,r)),i}addFrame(e){return this.unitRef.frames=this.unitRef.frames||[],e.key.__layerid__=["L",(new Date).getTime(),this.unitRef.frames.length].join(""),e.source=e.hasOwnProperty("source")?e.source:this.unitRef.expression.source,e.pipe=e.pipe||[],this.unitRef.frames.push(e),this}addTransformation(e,t){return this.unitRef.transformation=this.unitRef.transformation||[],this.unitRef.transformation.push({type:e,args:t}),this}isCoordinates(){return 0===(this.unitRef.type||"").toUpperCase().indexOf("COORDS.")}isElementOf(e){if(this.isCoordinates())return!1;var t=(this.unitRef.type||"").split("/");return 1===t.length&&t.unshift("RECT"),t[0].toUpperCase()===e.toUpperCase()}}class Pn{constructor(e){this.specRef=e}value(){return this.specRef}unit(e){return e&&(this.specRef.unit=e),new Dn(this.specRef.unit)}addTransformation(e,t){return this.specRef.transformations=this.specRef.transformations||{},this.specRef.transformations[e]=t,this}getSettings(e){return this.specRef.settings[e]}setSettings(e,t){return this.specRef.settings=this.specRef.settings||{},this.specRef.settings[e]=t,this}getScale(e){return this.specRef.scales[e]}addScale(e,t){return this.specRef.scales[e]=t,this}regSource(e,t){return this.specRef.sources[e]=t,this}getSourceData(e){return(this.specRef.sources[e]||{data:[]}).data}getSourceDim(e,t){return(this.specRef.sources[e]||{dims:{}}).dims[t]||{}}}var jn={};class In{static unit(e){return new Dn(e)}static spec(e){return new Pn(e)}static cloneObject(e){return JSON.parse(JSON.stringify(e))}static depthFirstSearch(e,t){if(t(e))return e;for(var i=e.hasOwnProperty("frames")?e.frames:[{units:e.units}],r=0;r<i.length;r++)for(var n=i[r].units||[],a=0;a<n.length;a++){var s=In.depthFirstSearch(n[a],t);if(s)return s}}static traverseSpec(e,t){const i=(e,t,r)=>{t(e,r),(e.units||[]).map(r=>i(r,t,e))};i(e.unit,t,null)}static extractFieldsFormatInfo(e){var t=e.scales,i=function(e){return!t[e].dim},r=function(e,i,r){var n=i.guide||{},a=t[i[r]],s=n[r]||{};e[a.dim]=e[a.dim]||{label:[],format:[],nullAlias:[],tickLabel:[]};var o=s.label,l=s.label||{};e[a.dim].label.push("string"==typeof o?o:l._original_text||l.text);var c=s.tickFormat||s.tickPeriod;e[a.dim].format.push(c),e[a.dim].nullAlias.push(s.tickFormatNullAlias),e[a.dim].tickLabel.push(s.tickLabel)},n=[];In.traverseSpec(e,function(e){n.push(e)});var a=n.reduce(function(e,t){return"COORDS.RECT"===t.type&&t.hasOwnProperty("x")&&!i(t.x)&&r(e,t,"x"),"COORDS.RECT"===t.type&&t.hasOwnProperty("y")&&!i(t.y)&&r(e,t,"y"),t.hasOwnProperty("color")&&!i(t.color)&&r(e,t,"color"),t.hasOwnProperty("size")&&!i(t.size)&&r(e,t,"size"),t.hasOwnProperty("label")&&!i(t.label)&&r(e,t,"label"),e},{}),s=function(e,t){return e.filter(e=>e)[0]||t};return Object.keys(a).reduce(function(t,i){t[i]={},t[i].label=s(a[i].label,i);const r=s(a[i].format,null);t[i].nullAlias=s(a[i].nullAlias,`No ${t[i].label}`),t[i].tickLabel=s(a[i].tickLabel,null);const n="x-time-auto"===r?e.settings.utcTime?"day-utc":"day":r;var o=t[i].nullAlias,l=n?gi.get(n,o):e=>null==e?o:String(e);if(t[i].format=l,t[i].tickLabel){var c=i.replace("."+t[i].tickLabel,"");t[c]={label:t[i].label,nullAlias:t[i].nullAlias,tickLabel:t[i].tickLabel,format:function(e){return l(e&&e[t[c].tickLabel])},isComplexField:!0},t[i].parentField=c}return t},{})}static getFieldFormatters(e,t){const i=In.extractFieldsFormatInfo(e);Object.keys(i).forEach(e=>{i[e].parentField&&delete i[e]});return Object.keys(t).forEach(e=>{const r=(e=>{let t={};return"function"==typeof e||"string"==typeof e?t={format:e}:Pe(e)&&(t=ut(e,"label","format","nullAlias")),t})(t[e]);i[e]=Object.assign({label:e,nullAlias:"No "+e},i[e]||{},ut(r,"label","nullAlias")),r.hasOwnProperty("format")?i[e].format="function"==typeof r.format?r.format:gi.get(r.format,i[e].nullAlias):i[e].format=i[e].hasOwnProperty("format")?i[e].format:gi.get(null,i[e].nullAlias)}),Object.keys(i).reduce((e,t)=>{const r=i[t];return e[t]={label:r.label,format:r.format},e},{})}static tokens(){return{reg:function(e,t){return jn[e]=t,this},get:function(e){return jn[e]||e}}}static getParentUnit(e,t){var i=null;const r=(e,n)=>e.uid===t.uid?(i=n,!0):(e.frames?e.frames.some(t=>(t.units||[]).some(t=>r(t,e))):(e.units||[]).some(t=>r(t,e)),!1);return r(e.unit,null),i}}i(16);i.d(t,"api",function(){return Hn}),i.d(t,"version",function(){return Gn}),i.d(t,"GPL",function(){return Gt}),i.d(t,"Plot",function(){return qi}),i.d(t,"Chart",function(){return Ki});var Bn={},Wn={},Hn={errorCodes:b,unitsRegistry:Zt,scalesRegistry:ti,grammarRegistry:w,tickFormat:gi,isChartElement:vt,utils:n,svgUtils:r,domUtils:a,tickPeriod:y,colorBrewers:{add:function(e,t){Bn.hasOwnProperty(e)||(Bn[e]=t)},get:function(e){return Bn[e]}},d3_animationInterceptor:ye,pluginsSDK:In,plugins:{add:function(e,t){if(Wn.hasOwnProperty(e))throw new Error("Plugin is already registered.");Wn[e]=t},get:function(e){return Wn[e]||(t=>{throw new Error(`"${e}" plugin is not defined`)})}},chartTypesRegistry:Ji,globalSettings:{animationSpeed:750,renderingTimeout:1e4,asyncRendering:!0,syncRenderingInterval:50,syncPointerEvents:!1,handleRenderingErrors:!1,experimentalShouldAnimate:e=>{const t=(e,t)=>{var i=document.createElementNS("http://www.w3.org/2000/svg",e);return Object.keys(t).forEach(e=>i.setAttribute(e,String(t[e]))),i},i=document.createElement("div");i.style.position="absolute",i.style.visibility="hidden",document.body.appendChild(i);const r=t("svg",{width:100,height:100});i.appendChild(r);const n=performance.now();var a,s,o;for(a=0;a<10;a++)for(s=0;s<10;s++)o=t("circle",{fill:"black",r:5,cx:10*a,cy:10*s}),r.appendChild(o);const l=performance.now()-n;return document.body.removeChild(i),e.sources["/"].data.length*l<500},defaultNiceColor:!0,defaultColorBrewer:["#fde725","#fbe723","#f8e621","#f6e620","#f4e61e","#f1e51d","#efe51c","#ece51b","#eae51a","#e7e419","#e5e419","#e2e418","#dfe318","#dde318","#dae319","#d8e219","#d5e21a","#d2e21b","#d0e11c","#cde11d","#cae11f","#c8e020","#c5e021","#c2df23","#c0df25","#bddf26","#bade28","#b8de29","#b5de2b","#b2dd2d","#b0dd2f","#addc30","#aadc32","#a8db34","#a5db36","#a2da37","#a0da39","#9dd93b","#9bd93c","#98d83e","#95d840","#93d741","#90d743","#8ed645","#8bd646","#89d548","#86d549","#84d44b","#81d34d","#7fd34e","#7cd250","#7ad151","#77d153","#75d054","#73d056","#70cf57","#6ece58","#6ccd5a","#69cd5b","#67cc5c","#65cb5e","#63cb5f","#60ca60","#5ec962","#5cc863","#5ac864","#58c765","#56c667","#54c568","#52c569","#50c46a","#4ec36b","#4cc26c","#4ac16d","#48c16e","#46c06f","#44bf70","#42be71","#40bd72","#3fbc73","#3dbc74","#3bbb75","#3aba76","#38b977","#37b878","#35b779","#34b679","#32b67a","#31b57b","#2fb47c","#2eb37c","#2db27d","#2cb17e","#2ab07f","#29af7f","#28ae80","#27ad81","#26ad81","#25ac82","#25ab82","#24aa83","#23a983","#22a884","#22a785","#21a685","#21a585","#20a486","#20a386","#1fa287","#1fa187","#1fa188","#1fa088","#1f9f88","#1f9e89","#1e9d89","#1e9c89","#1e9b8a","#1f9a8a","#1f998a","#1f988b","#1f978b","#1f968b","#1f958b","#1f948c","#20938c","#20928c","#20928c","#21918c","#21908d","#218f8d","#218e8d","#228d8d","#228c8d","#228b8d","#238a8d","#23898e","#23888e","#24878e","#24868e","#25858e","#25848e","#25838e","#26828e","#26828e","#26818e","#27808e","#277f8e","#277e8e","#287d8e","#287c8e","#297b8e","#297a8e","#29798e","#2a788e","#2a778e","#2a768e","#2b758e","#2b748e","#2c738e","#2c728e","#2c718e","#2d718e","#2d708e","#2e6f8e","#2e6e8e","#2e6d8e","#2f6c8e","#2f6b8e","#306a8e","#30698e","#31688e","#31678e","#31668e","#32658e","#32648e","#33638d","#33628d","#34618d","#34608d","#355f8d","#355e8d","#365d8d","#365c8d","#375b8d","#375a8c","#38598c","#38588c","#39568c","#39558c","#3a548c","#3a538b","#3b528b","#3b518b","#3c508b","#3c4f8a","#3d4e8a","#3d4d8a","#3e4c8a","#3e4a89","#3e4989","#3f4889","#3f4788","#404688","#404588","#414487","#414287","#424186","#424086","#423f85","#433e85","#433d84","#443b84","#443a83","#443983","#453882","#453781","#453581","#463480","#46337f","#46327e","#46307e","#472f7d","#472e7c","#472d7b","#472c7a","#472a7a","#482979","#482878","#482677","#482576","#482475","#482374","#482173","#482071","#481f70","#481d6f","#481c6e","#481b6d","#481a6c","#48186a","#481769","#481668","#481467","#471365","#471164","#471063","#470e61","#470d60","#460b5e","#460a5d","#46085c","#46075a","#450559","#450457","#440256","#440154"],defaultClassBrewer:Ze(20).map(e=>"color20-"+(1+e)),log:(e,t)=>{t=t||"INFO",Array.isArray(e)||(e=[e]),console[t.toLowerCase()].apply(console,e)},facetLabelDelimiter:" → ",excludeNull:!0,minChartWidth:300,minChartHeight:200,minFacetWidth:150,minFacetHeight:100,specEngine:[{name:"COMPACT",width:600,height:400},{name:"AUTO",width:Number.MAX_VALUE,height:Number.MAX_VALUE}],fitModel:"normal",layoutEngine:"EXTRACT",autoRatio:!0,defaultSourceMap:["https://raw.githubusercontent.com","TargetProcess/tauCharts/master/src/addons","world-countries.json"].join("/"),getAxisTickLabelSize:lt(Ct,e=>String(String(e).length)),getScrollbarSize:kt,avoidScrollAtRatio:1.5,xAxisTickLabelLimit:150,yAxisTickLabelLimit:150,xTickWordWrapLinesLimit:2,yTickWordWrapLinesLimit:2,xTickWidth:9,yTickWidth:9,distToXAxisLabel:10,distToYAxisLabel:10,xAxisPadding:20,yAxisPadding:20,xFontLabelDescenderLineHeight:4,xFontLabelHeight:10,yFontLabelHeight:10,xDensityPadding:2,yDensityPadding:2,"xDensityPadding:measure":8,"yDensityPadding:measure":8,utcTime:!1,defaultFormats:{measure:"x-num-auto","measure:time":"x-time-auto"}}};qi.__api__=Hn,qi.globalSettings=Hn.globalSettings,Hn.unitsRegistry.reg("COORDS.RECT",class extends g{constructor(e){super(e),this.config=e,this.config.guide=st(this.config.guide||{},{showGridLines:"xy",padding:{l:50,r:0,t:0,b:50}}),this.config.guide.x=this.config.guide.x||{},this.config.guide.x=st(this.config.guide.x,{cssClass:"x axis",textAnchor:"middle",padding:10,hide:!1,scaleOrient:"bottom",rotate:0,density:20,label:{},tickFormatWordWrapLimit:100}),"string"==typeof this.config.guide.x.label&&(this.config.guide.x.label={text:this.config.guide.x.label}),this.config.guide.x.label=st(this.config.guide.x.label,{text:"X",rotate:0,padding:40,textAnchor:"middle"}),this.config.guide.y=this.config.guide.y||{},this.config.guide.y=st(this.config.guide.y,{cssClass:"y axis",textAnchor:"start",padding:10,hide:!1,scaleOrient:"left",rotate:0,density:20,label:{},tickFormatWordWrapLimit:100}),"string"==typeof this.config.guide.y.label&&(this.config.guide.y.label={text:this.config.guide.y.label}),this.config.guide.y.label=st(this.config.guide.y.label,{text:"Y",rotate:-90,padding:20,textAnchor:"middle"});var t=this.config,i=t.guide;if("extract-axes"===i.autoLayout){var r=t.options.containerHeight-(t.options.top+t.options.height);i.x.hide=i.x.hide||Math.floor(r)>0,i.y.hide=i.y.hide||Math.floor(t.options.left)>0}var n=this.config.options,a=this.config.guide.padding;this.L=n.left+a.l,this.T=n.top+a.t,this.W=n.width-(a.l+a.r),this.H=n.height-(a.t+a.b)}defineGrammarModel(e){const t=this.W,i=this.H;return this.xScale=e("pos",this.config.x,[0,t]),this.yScale=e("pos",this.config.y,e=>["ordinal","period"].indexOf(e.type)>=0?[0,i]:[i,0]),this.regScale("x",this.xScale).regScale("y",this.yScale),{scaleX:this.xScale,scaleY:this.yScale,xi:()=>t/2,yi:()=>i/2,sizeX:()=>t,sizeY:()=>i}}getGrammarRules(){return[e=>{var t=e.scaleX,i=e.scaleY;return{xi:i=>i?t(i[t.dim]):e.xi(i),yi:t=>t?i(t[i.dim]):e.yi(t),sizeX:i=>i?t.stepSize(i[t.dim]):e.sizeX(i),sizeY:t=>t?i.stepSize(t[i.dim]):e.sizeY(t)}}]}createScreenModel(e){return e}allocateRect(e){var t=this.screenModel;return{slot:e=>this.config.options.container.selectAll(`.uid_${e}`),left:t.xi(e)-t.sizeX(e)/2,top:t.yi(e)-t.sizeY(e)/2,width:t.sizeX(e),height:t.sizeY(e),containerWidth:this.W,containerHeight:this.H}}drawFrames(e){var t=Object.assign({},this.config),i=t.options,r=this.W,n=this.H;if(t.x=this.xScale,t.y=this.yScale,t.x.scaleObj=this.xScale,t.y.scaleObj=this.yScale,t.x.guide=t.guide.x,t.y.guide=t.guide.y,t.x.guide.label.size=r,t.y.guide.label.size=n,(i.container.attr("transform")?he(i.container,this.config.guide.animationSpeed,"cartesianContainerTransform"):i.container).attr("transform",S(this.L,this.T)),t.x.guide.hide)this._removeDimAxis(i.container,t.x);else{var a="top"===t.x.guide.scaleOrient?[0,0-t.guide.x.padding]:[0,n+t.guide.x.padding];this._drawDimAxis(i.container,t.x,a,r)}if(t.y.guide.hide)this._removeDimAxis(i.container,t.y);else{var s="right"===t.y.guide.scaleOrient?[r+t.guide.y.padding,0]:[0-t.guide.y.padding,0];this._drawDimAxis(i.container,t.y,s,n)}var o=e.reduce((e,t)=>e.concat((t.units||[]).map(e=>e.uid)),[]),l=this._drawGrid(i.container,t,r,n,i),c=xe(l,".cell").data(o,e=>e);c.enter().append("g").attr("class",e=>`${N}cell cell uid_${e}`).merge(c).classed("tau-active",!0),he(c,this.config.guide.animationSpeed).attr("opacity",1),he(c.exit().classed("tau-active",!1),this.config.guide.animationSpeed).attr("opacity",1e-6).remove()}_drawDimAxis(e,t,i,r){var n=gi.get(t.guide.tickFormat,t.guide.tickFormatNullAlias),a=D({scale:t.scaleObj,scaleGuide:t.guide,ticksCount:n?Qi(r/t.guide.density):null,tickFormat:n||null,position:i}),s=this.config.guide.animationSpeed;Zi(e,this._getAxisSelector(t)).classed("tau-active",!0).classed(t.guide.cssClass,!0).call(e=>{var t=he(e,s,"axisTransition"),r=e.attr("transform");S(...i)!==r&&(r?t:e).attr("transform",S(...i)),t.call(a),t.attr("opacity",1)})}_removeDimAxis(e,t){var i=xe(e,this._getAxisSelector(t)).classed("tau-active",!1);he(i,this.config.guide.animationSpeed,"axisTransition").attr("opacity",1e-6).remove()}_getAxisSelector(e){return`g.${"h"===k(e.guide.scaleOrient)?"x":"y"}.axis`}_drawGrid(e,t,i,r){return Zi(e,"g.grid").attr("transform",S(0,0)).call(e=>{var n=e,a=this.config.guide.animationSpeed,s=(t.guide.showGridLines||"").toLowerCase();if(s.length>0){var o=Zi(n,"g.grid-lines");if(s.indexOf("x")>-1){let e=t.x,n=gi.get(e.guide.tickFormat);var l=P({scale:e.scaleObj,scaleGuide:e.guide,tickSize:r,ticksCount:n?Qi(i/e.guide.density):null}),c=Zi(o,"g.grid-lines-x");he(c,a).call(l)}if(s.indexOf("y")>-1){let e=t.y,n=gi.get(e.guide.tickFormat);var u=P({scale:e.scaleObj,scaleGuide:e.guide,tickSize:-i,ticksCount:n?Qi(r/e.guide.density):null}),d=Zi(o,"g.grid-lines-y");he(d,a).call(u)}}})}}).reg("COORDS.MAP",class extends g{constructor(e){super(e),this.config=e,this.config.guide=st(this.config.guide||{},{defaultFill:"rgba(128,128,128,0.25)",padding:{l:0,r:0,t:0,b:0},showNames:!0}),this.contourToFill=null,this.on("highlight-area",(e,t)=>this._highlightArea(t)),this.on("highlight-point",(e,t)=>this._highlightPoint(t)),this.on("highlight",(e,t)=>this._highlightPoint(t))}defineGrammarModel(e){var t=this.config,i=t.options,r=t.guide.padding,n=i.width-(r.l+r.r),a=i.height-(r.t+r.b);return this.latScale=e("pos",t.latitude,[0,a]),this.lonScale=e("pos",t.longitude,[n,0]),this.sizeScale=e("size",t.size),this.colorScale=e("color",t.color),this.codeScale=e("value",t.code),this.fillScale=e("fill",t.fill),this.W=n,this.H=a,this.regScale("latitude",this.latScale).regScale("longitude",this.lonScale).regScale("size",this.sizeScale).regScale("color",this.colorScale).regScale("code",this.codeScale).regScale("fill",this.fillScale),{}}drawFrames(e){var t=this.config.guide;"string"==typeof t.sourcemap?function(e,t){const i=new XMLHttpRequest;i.onload=(()=>{if(i.status>=200&&i.status<300){const e=i.responseText;try{t(null,JSON.parse(e))}catch(e){t(e,null)}}else t(new Error(`${i.status}: ${i.statusText}`),null)}),i.onerror=(e=>{t(e.error,null)}),i.open("GET",e,!0),i.send(null)}(t.sourcemap,(t,i)=>{if(t)throw t;this._drawMap(e,i)}):this._drawMap(e,t.sourcemap)}_calcLabels(e,t,i){var r=this.W,n=this.H,a={};return t.forEach(t=>{var s=(ir.feature(e,e.objects[t]).features||[]).map(e=>{var n=e.properties||{},a=i.centroid(e),s=i.bounds(e),o=a[0],l=a[1],c=s[1][0]-s[0][0],u=n.name||"",d=n.abbr||u,h=c<u.length*ar?d:u,g=c<2.5*ar,p=g?r-o-3*ar:0;return{id:`${t}-${e.id}`,sx:o,sy:l,x:o+p,y:l,width:h.length*ar,height:10,name:h,r:p,isRef:g}}).filter(e=>!Number.isNaN(e.x)&&!Number.isNaN(e.y)),o=s.map(e=>({x:e.sx,y:e.sy,r:e.r}));rr().label(s).anchor(o).width(r).height(n).start(sr),s.filter(e=>!e.isRef).map(e=>(e.x=e.sx,e.y=e.sy,e)).reduce((e,t)=>(e[t.id]=t,e),a);var l=s.filter(e=>e.isRef);l.length<6&&l.reduce((e,t)=>(e[t.id]=t,e),a)}),a}_drawMap(e,t){var i,r,n=this,a=this.config.guide,o=this.config.options,l=this.config.options.container,c=this.latScale,u=this.lonScale,d=this.sizeScale,h=this.colorScale,g=this.codeScale,p=this.fillScale,f=this.W,m=this.H,y=lr.filter(e=>(t.objects||{}).hasOwnProperty(e));if(0===y.length)throw new Error("Invalid map: should contain some contours");if(p.dim){if(!g.georole)throw console.log("Specify [georole] for code scale"),new Error("[georole] is missing");if(-1===y.indexOf(g.georole))throw console.log(`There is no contour for georole "${g.georole}"`),console.log(`Available contours are: ${y.join(" | ")}`),new Error("Invalid [georole]");i=g.georole}else i=y[y.length-1];if(this.contourToFill=i,c.dim&&u.dim){var x=nr.extent(c.domain()),b=nr.extent(u.domain());r=[(b[1]+b[0])/2,(x[1]+x[0])/2]}var v=this._createProjection(t,y[0],r),w=nr.geoPath().projection(v),_=l.selectAll(".map-container").data([`${f}${m}${r}${y.join("-")}`],e=>e);_.exit().remove();const S=_.enter().append("g").call(function(e){var i=e;i.attr("class","map-container");var r={},s=y.reduceRight((e,t)=>e.concat(t),[]);if(a.showNames&&(r=n._calcLabels(t,s,w)),s.forEach((e,n)=>{var a=t=>r[`${e}-${t.id}`];i.selectAll(`.map-contour-${e}`).data(ir.feature(t,t.objects[e]).features||[]).enter().append("g").call(function(t){var i=t;i.attr("class",`map-contour-${e} map-contour-level map-contour-level-${n}`).attr("fill","none"),i.append("title").text(e=>(e.properties||{}).name),i.append("path").attr("d",w),i.append("text").attr("class",`place-label-${e}`).attr("transform",e=>{var t=a(e);return t?`translate(${[t.x,t.y]})`:""}).text(e=>{var t=a(e);return t?t.name:""}),i.append("line").attr("class",`place-label-link-${e}`).attr("stroke","gray").attr("stroke-width",.25).attr("x1",e=>{var t=a(e);return t&&t.isRef?t.sx:0}).attr("y1",e=>{var t=a(e);return t&&t.isRef?t.sy:0}).attr("x2",e=>{var t=a(e);return t&&t.isRef?t.x-.6*t.name.length*ar:0}).attr("y2",e=>{var t=a(e);return t&&t.isRef?t.y-3.5:0})})}),t.objects.hasOwnProperty("places")){var o=ir.feature(t,t.objects.places),l=o.features.map(e=>{var t=v(e.geometry.coordinates);return{x:t[0]+3.5,y:t[1]+3.5,width:e.properties.name.length*ar,height:12,name:e.properties.name}}),c=o.features.map(e=>{var t=v(e.geometry.coordinates);return{x:t[0],y:t[1],r:2.5}});rr().label(l).anchor(c).width(f).height(m).start(100),i.selectAll(".place").data(c).enter().append("circle").attr("class","place").attr("transform",e=>`translate(${e.x},${e.y})`).attr("r",e=>`${e.r}px`),i.selectAll(".place-label").data(l).enter().append("text").attr("class","place-label").attr("transform",e=>`translate(${e.x},${e.y})`).text(e=>e.name)}}).merge(_);this.groupByCode=e.reduce((e,t)=>t.part().reduce((e,t)=>(e[(t[g.dim]||"").toLowerCase()]=t,e),e),{});var M=this._resolveFeature.bind(this);if(S.selectAll(`.map-contour-${i}`).data(ir.feature(t,t.objects[i]).features).call(function(e){e.classed("map-contour",!0).attr("fill",e=>{var t=M(e);return null===t?a.defaultFill:p(t[p.dim])})}).on("mouseover",e=>this.fire("area-mouseover",{data:M(e),event:s.event})).on("mouseout",e=>this.fire("area-mouseout",{data:M(e),event:s.event})).on("click",e=>this.fire("area-click",{data:M(e),event:s.event})),!c.dim||!u.dim)return[];var k=function(e){return e.attr("r",e=>d(e[d.dim])).attr("transform",({data:e})=>`translate(${v([e[u.dim],e[c.dim]])})`).attr("class",({data:e})=>h(e[h.dim])).attr("opacity",or).on("mouseover",({data:e})=>n.fire("point-mouseover",{data:e,event:s.event})).on("mouseout",({data:e})=>n.fire("point-mouseout",{data:e,event:s.event})).on("click",({data:e})=>n.fire("point-click",{data:e,event:s.event}))},E=S.selectAll(".frame").data(e.map(e=>({tags:e.key||{},hash:e.hash(),data:e.part()})),e=>e.hash);return E.exit().remove(),E.enter().append("g").merge(E).call(function(e){e.attr("class",e=>`frame frame-${e.hash}`).call(function(e){var t=e.selectAll("circle").data(e=>e.data.map(e=>({data:e,uid:o.uid})));t.exit().remove(),t.call(k),t.enter().append("circle").call(k)})}),[]}_resolveFeature(e){var t,i=this.groupByCode,r=e.properties,n=["c1","c2","c3","abbr","name"].filter(e=>r.hasOwnProperty(e)&&r[e]&&i.hasOwnProperty(r[e].toLowerCase()));if(0===n.length)t=null;else if(n.length>0){let e=r[n[0]].toLowerCase();t=i[e]}return t}_highlightArea(e){var t=this.config.options.container,i=this.contourToFill;t.selectAll(`.map-contour-${i}`).classed("map-contour-highlighted",t=>e(this._resolveFeature(t)))}_highlightPoint(e){this.config.options.container.selectAll("circle").classed("map-point-highlighted",({data:t})=>e(t)).attr("opacity",({data:t})=>e(t)?or:.1)}_createProjection(e,t,i){var r=this.W,n=this.H,a=this.config.guide,s=100,o=[r/2,n/2],l=i||e.center,c=a.projection||e.projection||"mercator",u=this._createD3Projection(c,l,s,o),d=nr.geoPath().projection(u).bounds(ir.feature(e,e.objects[t])),h=s*r/(d[1][0]-d[0][0]),g=s*n/(d[1][1]-d[0][1]);return s=h<g?h:g,o=[r-(d[0][0]+d[1][0])/2,n-(d[0][1]+d[1][1])/2],this._createD3Projection(c,l,s,o)}_createD3Projection(e,t,i,r){var n="geo"+e.substring(0,1).toUpperCase()+e.substring(1),a=nr[n];if(!a)throw console.log(`Unknown projection "${e}"`),console.log("See available projection types here: https://github.com/mbostock/d3/wiki/Geo-Projections"),new Error(`Invalid map: unknown projection "${e}"`);var s=a();return[{method:"scale",args:i},{method:"center",args:t},{method:"translate",args:r}].filter(e=>e.args).reduce((e,t)=>(e[t.method]&&(e=e[t.method](t.args)),e),s)}}).reg("COORDS.PARALLEL",class extends g{constructor(e){super(e),this.config=e,this.config.guide=st(this.config.guide||{},{padding:{l:50,r:50,t:50,b:50},enableBrushing:!1}),this.columnsBrushes={},this.columnsSelections={},this.on("force-brush",(e,t)=>this._forceBrushing(t));var t=this.config.options,i=this.config.guide.padding;this.L=t.left+i.l,this.T=t.top+i.t,this.W=t.width-(i.l+i.r),this.H=t.height-(i.t+i.b)}defineGrammarModel(e){var t=this.config,i=this.W,r=this.H;this.columnsScalesMap=t.columns.reduce((t,i)=>(t[i]=e("pos",i,[0,r]),t),{});var n=i/(t.columns.length-1),a=t.columns.reduce((e,t,i)=>(e[t]=i*n,e),{});return this.xBase=(e=>a[e]),this.regScale("columns",this.columnsScalesMap),{}}allocateRect(){return{slot:e=>this.config.options.container.selectAll(`.uid_${e}`),left:0,top:0,width:this.W,height:this.H,containerWidth:this.W,containerHeight:this.H}}drawFrames(e){var t=Object.assign({},this.config),i=t.options,r=this._fnDrawGrid(i.container,t,i.frameId,Object.keys(this.columnsScalesMap).reduce((e,t)=>e.concat([this.columnsScalesMap[t].getHash()]),[]).join("_")),n=r.selectAll(`.parent-frame-${i.frameId}`).data(e,e=>e.hash());n.exit().remove(),n.enter().append("g").attr("class",e=>`${N}cell cell parent-frame-${i.frameId} frame-${e.hash()}`).merge(n).each(function(e){var t,r,n,a;t=i.frameId,r=er.select(this),n=e,(a=r.selectAll(`.layer_${t}`).data(n.units,e=>e.uid)).exit().remove(),a.enter().append("g").attr("class",e=>`layer_${t} uid_${e.uid}`)});var a=this._fnDrawColumns(r,t);t.guide.enableBrushing&&this._enableBrushing(a)}_fnDrawGrid(e,t,i,r){var n=e.selectAll(`.grid_${i}`).data([r],e=>e);return n.exit().remove(),n.enter().append("g").attr("class",`grid grid_${i}`).attr("transform",S(this.L,this.T)).merge(n)}_fnDrawColumns(e,t){var i=t.guide.columns||{},r=this.xBase,n=this.columnsScalesMap,a=er.axisLeft(),s=e.selectAll(".column").data(t.columns,e=>e);return s.exit().remove(),s.enter().append("g").attr("class","column").attr("transform",e=>S(r(e),0)).call(function(e){e.append("g").attr("class","y axis").each(function(e){var t=n[e].dim,r=a.scale(n[e]),s=i[t]||{},o=gi.get(s.tickFormat,s.tickFormatNullAlias);null!==o&&r.tickFormat(o),er.select(this).call(r)}).append("text").attr("class","label").attr("text-anchor","middle").attr("y",-9).text(e=>((i[e]||{}).label||{}).text||n[e].dim)}).merge(s)}_enableBrushing(e){var t=this.columnsSelections,i=this.columnsScalesMap,r=this.columnsBrushes,n=!0,a=e=>e,o=e=>e,l=()=>{var e=Object.keys(r).find(e=>r[e]===s.event.target);if(t[e]=s.event.selection,n){var a=Object.keys(r).filter(e=>t[e]).map(e=>{var r=[];if(i[e].discrete){let n=t[e];r=i[e].domain().filter(t=>{var r=i[e](t);return n[0]<=r&&n[1]>=r})}else{let n=t[e].map(i[e].invert);r=[n[0],n[1]]}return{dim:i[e].dim,func:i[e].discrete?"inset":"between",args:r}});this.fire("brush",a)}};return e.selectAll(".brush").remove(),e.append("g").attr("class","brush").each(function(e){var t=i[e].range();r[e]=er.brushY().extent([[0,t[0]],[16,t[1]]]).on("start",a).on("brush",l).on("end",o),er.select(this).classed(`brush-${He(e)}`,!0).call(r[e]),n=!1,r[e].move(er.select(this),t),n=!0}).selectAll("rect").attr("transform","translate(-8,0)").attr("width",16),e}_forceBrushing(e={}){var t=this.columnsBrushes,i=this.columnsScalesMap;this.columnsSelections,Object.keys(e).filter(r=>t[r]&&i[r]&&e[r]).forEach(r=>{var n=e[r],a=[];if(i[r].discrete){var s=n.map(i[r]).filter(e=>e>=0),o=i[r].stepSize()/2;a=[Math.min(...s)-o,Math.max(...s)+o]}else a=[n[0],n[1]];var l=He(r);t[r](er.select(`.brush-${l}`)),t[r].move(er.select(`.brush-${l}`),a.map(i[r]))})}}).reg("ELEMENT.GENERIC.CARTESIAN",_e).reg("ELEMENT.POINT",Tr,"ELEMENT.GENERIC.CARTESIAN").reg("ELEMENT.LINE",on,"ELEMENT.GENERIC.CARTESIAN").reg("ELEMENT.PATH",nn,"ELEMENT.GENERIC.CARTESIAN").reg("ELEMENT.AREA",rn,"ELEMENT.GENERIC.CARTESIAN").reg("ELEMENT.INTERVAL",cn,"ELEMENT.GENERIC.CARTESIAN").reg("ELEMENT.INTERVAL.STACKED",cn,"ELEMENT.GENERIC.CARTESIAN").reg("ELEMENT.INTERVAL.STACKED",cn,"ELEMENT.GENERIC.CARTESIAN").reg("PARALLEL/ELEMENT.LINE",class extends g{constructor(e){super(e),this.config=e,this.config.guide=st(this.config.guide||{},{}),this.on("highlight",(e,t)=>this.highlight(t))}defineGrammarModel(e){var t=this.config,i=t.options;this.color=e("color",t.color,{}),this.scalesMap=t.columns.reduce((t,r)=>(t[r]=e("pos",r,[0,i.height]),t),{});var r=i.width/(t.columns.length-1),n=t.columns.reduce((e,t,i)=>(e[t]=i*r,e),{});return this.xBase=(e=>n[e]),this.regScale("columns",this.scalesMap).regScale("color",this.color),{}}drawFrames(e){var t=this.config,i=this.config.options,r=this.scalesMap,n=this.xBase,a=this.color,s=un.line(),o=function(e){e.attr("d",e=>s(t.columns.map(t=>[n(t),r[t](e[r[t].dim])])))},l=function(e){e.attr("stroke",e=>a.toColor(a(e[a.dim]))),e.attr("class",e=>`${N}__line line ${a.toClass(a(e[a.dim]))} foreground`)},c=function(e){var t=e.selectAll(".background").data(e=>e.part());t.exit().remove(),t.call(o),t.enter().append("path").attr("class","background line").call(o);var i=e.selectAll(".foreground").data(e=>e.part());i.exit().remove(),i.call(function(e){o(e),l(e)}),i.enter().append("path").call(function(e){o(e),l(e)})},u=i.container.selectAll(".lines-frame").data(e,e=>e.hash());u.exit().remove(),u.call(c),u.enter().append("g").attr("class","lines-frame").call(c),this.subscribe(i.container.selectAll(".lines-frame .foreground"))}highlight(e){this.config.options.container.selectAll(".lines-frame .foreground").style("visibility",t=>e(t)?"":"hidden")}}),Hn.scalesRegistry.reg("identity",class extends gn{constructor(e,t){super(e,t),this._references=t.references,this._refCounter=t.refCounter,this.addField("scaleType","identity")}create(){var e=this._references,t=this._refCounter;return this.toBaseScale((i,r)=>{if(null==i){var n=e.get(r);null==n&&(n=t(),e.set(r,n))}else n=i;return n})}},(e,t)=>st(e,{references:t.references,refCounter:t.refCounter})).reg("color",class extends gn{constructor(e,t){super(e,t);var i="measure"!==t.dimType,r=this.scaleConfig.brewer||(i?Ze(20).map(e=>"color20-"+(1+e)):["#eee","#000"]),n=this.scaleConfig;if(!i){var a=pn.extent(this.vars),s=e=>Number.isFinite(e)||De(e),o=s(n.min)?n.min:a[0],l=s(n.max)?n.max:a[1],c=[o,a[0]].filter(s),u=[l,a[1]].filter(s);if(a=[c.sort((e,t)=>e-t)[0],u.sort((e,t)=>t-e)[0]],n.nice&&a[0]<0&&a[1]>0){let e=Math.max(...a.map(Math.abs));a=[-e,e]}this.vars=a}this.addField("scaleType","color").addField("discrete",i).addField("brewer",r).addField("toColor",Ye).addField("toClass",Ve)}create(){var e=this.discrete,t=this.vars,i=this.getField("brewer"),r=e?this.createDiscreteScale(t,i):this.createContinuesScale(t,i);return this.toBaseScale(r)}createDiscreteScale(e,t){var i,r=(e,t)=>{var i=e.map(e=>String(e).toString());return pn.scaleOrdinal().range(t).domain(i)},n=e=>t=>e(String(t).toString());if(Array.isArray(t))i=n(r(e,t));else if("function"==typeof t)i=(i=>t(i,n(r(e,Ze(20).map(e=>"color20-"+(1+e))))));else{if(!Pe(t))throw new Error("This brewer is not supported");i=((e,t)=>{var i=Object.keys(e),r=i.map(t=>e[t]),n=pn.scaleOrdinal().range(r).domain(i);return i=>e.hasOwnProperty(i)?n(String(i)):t(i)})(t,()=>"color-default")}return i}createContinuesScale(e,t){if(!Array.isArray(t))throw new Error("This brewer is not supported");return pn.scaleLinear().domain(Xe(e.map(e=>e-0),t.length)).range(t)}},(e,t)=>st(e,{nice:t.defaultNiceColor,brewer:"measure"===e.dimType?t.defaultColorBrewer:t.defaultClassBrewer})).reg("fill",class extends gn{constructor(e,t){super(e,t);var i=this.scaleConfig,r=En.extent(this.vars),n=Number.isFinite(i.min)?i.min:r[0],a=Number.isFinite(i.max)?i.max:r[1];r=[Math.min(n,r[0]),Math.max(a,r[1])],this.vars=i.nice?je(r):En.extent(r);var s=Ze(10).map(e=>`rgba(90,180,90,${(.2+e*(.8/9)).toFixed(2)})`),o=i.brewer||s;this.addField("scaleType","fill").addField("brewer",o)}isInDomain(e){var t=this.domain(),i=t[0],r=t[t.length-1];return!Number.isNaN(i)&&!Number.isNaN(r)&&e<=r&&e>=i}create(){var e=this.vars,t=this.getField("brewer");if(!Array.isArray(t))throw new Error("This brewer is not supported");var i=t.length,r=(e[1]-e[0])/i,n=Ze(i-1).map(e=>e+1).reduce((t,i)=>t.concat([e[0]+i*r]),[]),a=En.scaleThreshold().domain(n).range(t);return this.toBaseScale(a)}}).reg("size",class extends gn{constructor(e,t){super(e,t);var i=this.scaleConfig,r=o.extent(this.vars),n=Number.isFinite(i.min)?i.min:r[0],a=Number.isFinite(i.max)?i.max:r[1];this.vars=[Math.min(...[n,r[0]].filter(Number.isFinite)),Math.max(...[a,r[1]].filter(Number.isFinite))],this.addField("scaleType","size"),this.addField("funcType",t.func||"sqrt")}isInDomain(e){var t=this.domain().sort(),i=t[0],r=t[t.length-1];return!Number.isNaN(i)&&!Number.isNaN(r)&&e<=r&&e>=i}create(){var e,t=this.scaleConfig,i=this.vars,r=st({},t,{func:"sqrt",minSize:0,maxSize:1}),n=r.func,a=r.minSize,s=r.maxSize,o=fn[n],l=i.filter(e=>Number.isFinite(Number(e)));if(0===l.length)e=(()=>s);else{var c,u,d=Math.min(...l),h=Math.max(...l),g=o(Math.max(Math.abs(d),Math.abs(h),h-d));u=d<0?d:0,c=0===g?1:(s-a)/g,e=(e=>{var t=null!==e?parseFloat(e):0;return Number.isFinite(t)?a+o(t-u)*c:s})}return this.toBaseScale(e)}}).reg("ordinal",class extends gn{constructor(e,t){super(e,t),this.addField("scaleType","ordinal").addField("discrete",!0)}create(e){var t=this.scaleConfig,i=this.vars,r=l.scalePoint().domain(i).range(e).padding(.5),n=Math.max(...e),a=e=>"function"==typeof t.ratio?t.ratio(e,n,i):"object"==typeof t.ratio?t.ratio[e]:1/i.length,s=e=>t.ratio?n-i.slice(i.indexOf(e)+1).reduce((e,t)=>e+n*a(t),n*a(e)*.5):r(e);return Object.keys(r).forEach(e=>s[e]=r[e]),s.stepSize=(e=>a(e)*n),this.toBaseScale(s,e)}}).reg("period",class extends gn{constructor(e,t){super(e,t);var i=this.scaleConfig,r=this.vars,n=mn.extent(r),a=null===i.min||void 0===i.min?n[0]:new Date(i.min).getTime(),s=null===i.max||void 0===i.max?n[1]:new Date(i.max).getTime(),o=[new Date(Math.min(a,n[0])),new Date(Math.max(s,n[1]))],l=y.get(i.period,{utc:i.utcTime});i.fitToFrameByDims||null===l?this.vars=it(r.map(e=>new Date(e)),e=>e.getTime()).sort((e,t)=>Number(t)-Number(e)):this.vars=y.generate(o[0],o[1],i.period,{utc:i.utcTime}),this.periodGenerator=l,this.addField("scaleType","period").addField("utcTime",this.scaleConfig.utcTime).addField("period",this.scaleConfig.period).addField("discrete",!0)}isInDomain(e){const t=this.periodGenerator,i=new Date(e),r=(t?t.cast(i):i).getTime();return this.domain().map(e=>e.getTime()).indexOf(r)>=0}create(e){const t=this.periodGenerator;var i=this.vars,r=this.vars.map(e=>e.getTime()),n=this.scaleConfig,a=mn.scalePoint().domain(i).range(e).padding(.5),s=mn.scalePoint().domain(r.map(String)).range(e).padding(.5),o=Math.max(...e),l=e=>{var t=new Date(e).getTime();return"function"==typeof n.ratio?n.ratio(t,o,r):"object"==typeof n.ratio?n.ratio[t]:1/i.length},c=e=>{const i=new Date(e),a=(t?t.cast(i):i).getTime();return n.ratio?o-r.slice(r.indexOf(a)+1).reduce((e,t)=>e+o*l(t),o*l(e)*.5):s(String(a))};return Object.keys(a).forEach(e=>c[e]=a[e]),c.stepSize=(e=>l(e)*o),this.toBaseScale(c,e)}},(e,t)=>st(e,{utcTime:t.utcTime})).reg("time",class extends gn{constructor(e,t){super(e,t);var i=this.scaleConfig,r=this.vars;const n=i.period?y.get(this.scaleConfig.period,{utc:i.utcTime}):null,a=xn.extent(r).map(n?e=>n.cast(new Date(e)):e=>new Date(e)),s=null==i.min?a[0]:new Date(i.min).getTime(),o=null==i.max?a[1]:new Date(i.max).getTime();if(r=[new Date(Math.min(s,Number(a[0]))),new Date(Math.max(o,Number(a[1])))],this.niceIntervalFn=null,i.nice&&!n){var l=i.niceInterval,c=l&&bn(l)?i.utcTime?xn[`utc${(u=l)[0].toUpperCase()}${u.slice(1)}`]:bn(l):null;this.niceIntervalFn=c||null,this.vars=Ie(r,this.niceIntervalFn,{utc:i.utcTime})}else this.vars=r;var u;if(n&&Number(this.vars[0])===Number(this.vars[1])){let e=this.vars[0];this.vars[0]=n.cast(new Date(Number(e)-1)),this.vars[1]=n.next(e)}this.periodGenerator=n,this.addField("scaleType","time").addField("utcTime",this.scaleConfig.utcTime).addField("period",this.scaleConfig.period)}isInDomain(e){var t=new Date(e);this.scaleConfig.period&&(t=this.periodGenerator.cast(t));var i=this.domain(),r=i[0],n=i[i.length-1];return!Number.isNaN(r)&&!Number.isNaN(n)&&t<=n&&t>=r}create(e){var t=this.vars,i=this.scaleConfig.utcTime;const r=this.periodGenerator,n=(i?xn.scaleUtc:xn.scaleTime)().domain(t).range(e);var a=e=>{var i=t[0],r=t[1];return e>r&&(e=r),e<i&&(e=i),n(new Date(e))};if(this.scaleConfig.period){const[e,s]=t;n.ticks,n.ticks=(t=>("number"!=typeof t&&(t=10),function(e,t,i,r=10){const[n,a]=e,s=y.get(t,{utc:i}),o=Number(n),l=Number(a),c=Number(s.next(s.cast(n)))-Number(s.cast(n));return(l-o)/c<=r?y.generate(n,a,t,{utc:i}).filter(e=>e>=n&&e<=a):function(e,t,i=10){const r=Number(e[0]),n=Number(e[1]),a=Math.abs(n-r)/i;var s,o;const l=xn.bisector(e=>e.duration).right(wn,a);if(l===wn.length)s=t?xn.utcYear:xn.timeYear,o=xn.tickStep(r/vn.year.duration,n/vn.year.duration,i);else if(l){let e=a/wn[l-1].duration,i=wn[l].duration/a,r=wn[e<i?l-1:l];s=t?r.time.utc:r.time.interval,o=r.step}else s=t?xn.utcMillisecond:xn.timeMillisecond,o=xn.tickStep(r,n,i);return s.every(o).range(new Date(r),new Date(n+1))}(e,i,r)}([e,s],this.scaleConfig.period,i,t)));let o=r.cast(e);for(;o<e;)o=r.next(o);const l=r.cast(s);a=(e=>{let t=r.cast(e);return t<o&&(t=o),t>l&&(t=l),n(t)})}return Object.keys(n).forEach(e=>a[e]=n[e]),a.stepSize=(()=>0),this.toBaseScale(a,e)}},(e,t)=>st(e,{utcTime:t.utcTime})).reg("linear",class extends gn{constructor(e,t){super(e,t);var i=this.scaleConfig,r=_n.extent(this.vars),n=Number.isFinite(i.min)?i.min:r[0],a=Number.isFinite(i.max)?i.max:r[1];if(r=[Math.min(...[n,r[0]].filter(Number.isFinite)),Math.max(...[a,r[1]].filter(Number.isFinite))],this.vars=i.nice?je(r):_n.extent(r),this.vars[0]===this.vars[1]){var s=Math.pow(10,Math.floor(Math.log(this.vars[0])/Math.LN10));this.vars[0]-=s,this.vars[1]+=s||10}this.addField("scaleType","linear").addField("discrete",!1)}isInDomain(e){var t=this.domain(),i=t[0],r=t[t.length-1];return!Number.isNaN(i)&&!Number.isNaN(r)&&e<=r&&e>=i}create(e){var t=this.vars,i=this.extendScale(_n.scaleLinear());return i.domain(t).range(e).clamp(!0),this.toBaseScale(i,e)}extendScale(e){var t=e.copy,i=e.ticks;return Object.assign(e,{stepSize:()=>0,copy:()=>this.extendScale(t.call(e)),ticks:this.getField("isInteger")?t=>i.call(e,t).filter(Number.isInteger):e.ticks}),e}}).reg("logarithmic",class extends gn{constructor(e,t){super(e,t);var i=this.scaleConfig,r=Sn.extent(this.vars),n=Number.isFinite(i.min)?i.min:r[0],a=Number.isFinite(i.max)?i.max:r[1];kn(r=[Math.min(...[n,r[0]].filter(Number.isFinite)),Math.max(...[a,r[1]].filter(Number.isFinite))]),i.nice&&(r=function(e){var t=e[0]>0,i=e.map(e=>Math.abs(e)),r=Math.max(...i),n=Math.min(...i).toExponential().split("e"),a=r.toExponential().split("e"),s=parseFloat(Math.floor(Number(n[0]))+"e"+n[1]),o=parseFloat(Math.ceil(Number(a[0]))+"e"+a[1]);return t?[s,o]:[-o,-s]}(r)),this.vars=r,this.addField("scaleType","logarithmic").addField("discrete",!1)}isInDomain(e){var t=this.domain(),i=t[0],r=t[t.length-1];return!Number.isNaN(i)&&!Number.isNaN(r)&&e<=r&&e>=i}create(e){var t=this.vars;kn(t);var i=function e(t){var i=t.copy;return t.ticks=function(e){var i=[],r=Sn.extent(t.domain()),n=Math.floor(Mn(r[0])),a=Math.ceil(Mn(r[1])),s=Math.ceil(10*(a-n)/(10*Math.ceil(e/10)));for(let e=n;e<=a;e+=s)for(let t=1;t<=10;t++){let n=Math.pow(t,s)*Math.pow(10,e);(n=parseFloat(n.toExponential(0)))>=r[0]&&n<=r[1]&&i.push(n)}return i},t.copy=function(){var r=i.call(t);return e(r),r},t}(Sn.scaleLog()).domain(t).range(e);return i.stepSize=(()=>0),this.toBaseScale(i,e)}}).reg("value",class extends gn{constructor(e,t){super(e,t),this.addField("scaleType","value").addField("georole",t.georole)}create(){return this.toBaseScale(e=>e)}});var Un=[e=>e.data?[]:["[data] must be specified"]];Hn.chartTypesRegistry.add("scatterplot",e=>{return zn("ELEMENT.POINT",Fn(e))},Un).add("line",e=>{var t=Fn(e),i=t.data,r=t.settings.log,n={none:()=>null,horizontal:e=>e.x[e.x.length-1],vertical:e=>e.y[e.y.length-1],auto:e=>{var t,n=e.x,a=e.y,s=n[n.length-1],o=n.slice(0,n.length-1),l=a[a.length-1],c=a.slice(0,a.length-1),u=e.color,d=o.concat(c).concat([u]).filter(e=>null!==e),h=-1,g=[[[s].concat(d),l],[[l].concat(d),s]];return g.some((e,t)=>{var n=e[0],a=e[1],s=ri.isYFunctionOfX(i,n,[a]);return s.result?h=t:r(["Attempt to find a functional relation between",e[0]+" and "+e[1]+" is failed.","There are several "+s.error.keyY+" values (e.g. "+s.error.errY.join(",")+")","for ("+s.error.keyX+" = "+s.error.valX+")."].join(" ")),s.result})?t=g[h][0][0]:(r(["All attempts are failed.","Will orient line horizontally by default.","NOTE: the [scatterplot] chart is more convenient for that data."].join(" ")),t=s),t}},a=(t.lineOrientation||"").toLowerCase(),s=(n.hasOwnProperty(a)?n[a]:n.auto)(t);return null!==s&&(t.data=ri.sortByDim(i,s,t.dimensions[s])),zn("ELEMENT.LINE",t)},Un).add("area",$n,Un).add("stacked-area",e=>$n(st(e,{stack:!0})),Un).add("bar",e=>Rn(st(e,{flip:!1})),Un).add("horizontalBar",e=>Rn(st({flip:!0},e)),Un).add("horizontal-bar",e=>Rn(st({flip:!0},e)),Un).add("stacked-bar",e=>Rn(st({flip:!1,stack:!0},e)),Un).add("horizontal-stacked-bar",e=>Rn(st({flip:!0,stack:!0},e)),Un).add("map",e=>{let t=Object.assign({sourcemap:e.settings.defaultSourceMap},e.guide||{});t.size=st(t.size||{},{min:1,max:10}),t.code=st(t.code||{},{georole:"countries"});var i={},r=(e,t,r={})=>{var n,a,s=t;return t?(n=`${e}_${t}`,a="/"):(n=`${e}:default`,a="?"),i.hasOwnProperty(n)||(i[n]=Object.assign({type:e,source:a,dim:s},r)),n};return{sources:{"?":{dims:{},data:[{}]},"/":{dims:Object.keys(e.dimensions).reduce((t,i)=>(t[i]={type:e.dimensions[i].type},t),{}),data:e.data}},scales:i,unit:{type:"COORDS.MAP",expression:{operator:"none",source:"/"},code:r("value",e.code,t.code),fill:r("fill",e.fill,t.fill),size:r("size",e.size,t.size),color:r("color",e.color,t.color),latitude:r("linear",e.latitude,{nice:!1}),longitude:r("linear",e.longitude,{nice:!1}),guide:t},plugins:e.plugins||[]}},Un.concat([e=>{var t=e.fill&&e.code;if(e.fill&&!t)return"[code] must be specified when using [fill]"},e=>{var t=e.latitude&&e.longitude;if((e.latitude||e.longitude)&&!t)return"[latitude] and [longitude] both must be specified"}])).add("parallel",e=>{var t=Object.assign({columns:{}},e.guide||{}),i={},r=(e,t,r={})=>{var n,a,s=t;return t?(n=`${e}_${t}`,a="/"):(n=`${e}:default`,a="?"),i.hasOwnProperty(n)||(i[n]=Object.assign({type:e,source:a,dim:s},r)),n},n=e.columns.map(i=>r(e.dimensions[i].scale,i,t.columns[i]));return{sources:{"?":{dims:{},data:[{}]},"/":{dims:Object.keys(e.dimensions).reduce((t,i)=>(t[i]={type:e.dimensions[i].type},t),{}),data:e.data}},scales:i,unit:{type:"COORDS.PARALLEL",expression:{operator:"none",source:"/"},columns:n,guide:t,units:[{type:"PARALLEL/ELEMENT.LINE",color:r("color",e.color,t.color),columns:n,expression:{operator:"none",source:"/"}}]},plugins:e.plugins||[]}},Un.concat([e=>{if(!(e.columns&&e.columns.length>1))return"[columns] property must contain at least 2 dimensions"}]));const Gn="2.7.0";t.default={GPL:Gt,Plot:qi,Chart:Ki,api:Hn,version:"2.7.0"}},function(e,i){e.exports=t},function(e,t){e.exports=i},function(e,t){e.exports=r},function(e,t){e.exports=n},function(e,t){e.exports=a},function(e,t){e.exports=s},function(e,t){e.exports=o},function(e,t){e.exports=l},function(e,t,i){var r,n,a;n=[],void 0===(a="function"==typeof(r=function(){return function(e){var t={};function i(r){if(t[r])return t[r].exports;var n=t[r]={exports:{},id:r,loaded:!1};return e[r].call(n.exports,n,n.exports,i),n.loaded=!0,n.exports}return i.m=e,i.c=t,i.p="",i(0)}([function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e,t){return e.indexOf(t)},r=window,n=r.document,a=n.documentElement,s=["top","bottom"];function o(e,t){for(var i in t)e[i]=t[i];return e}function l(e){var t,i=r.pageYOffset||a.scrollTop,n=r.pageXOffset||a.scrollLeft,s={left:0,right:0,top:0,bottom:0,width:0,height:0};if((t=e)&&null!=t.setInterval)s.width=r.innerWidth||a.clientWidth,s.height=r.innerHeight||a.clientHeight;else{if(!a.contains(e)||null==e.getBoundingClientRect)return s;o(s,e.getBoundingClientRect()),s.width=s.right-s.left,s.height=s.bottom-s.top}return s.top=s.top+i-a.clientTop,s.left=s.left+n-a.clientLeft,s.right=s.left+s.width,s.bottom=s.top+s.height,s}var c=function(e,t){return r.getComputedStyle(e)[t]};function u(e){var t=String(c(e,u.propName)),i=t.match(/([0-9.]+)([ms]{1,2})/);return i&&(t=Number(i[1]),"s"===i[2]&&(t*=1e3)),0|t}u.propName=function(){for(var e=n.createElement("div"),t=["transitionDuration","webkitTransitionDuration"],i=0;i<t.length;i++)if(e.style[t[i]]="1s","1s"===e.style[t[i]])return t[i]}();var d=Object.create;function h(e,t){if(!(this instanceof h))return new h(e,t);this.hidden=1,this.options=o(d(h.defaults),t),this._createElement(),e&&this.content(e)}h.prototype._createElement=function(){var e,t;this.element=n.createElement("div"),this.classes=(e=this.element,{add:function(t){e.classList.add(t)},remove:function(t){e.classList.remove(t)}}),this.classes.add(this.options.baseClass);for(var i=0;i<h.classTypes.length;i++)t=h.classTypes[i]+"Class",this.options[t]&&this.classes.add(this.options[t])},h.prototype.type=function(e){return this.changeClassType("type",e)},h.prototype.effect=function(e){return this.changeClassType("effect",e)},h.prototype.changeClassType=function(e,t){return e+="Class",this.options[e]&&this.classes.remove(this.options[e]),this.options[e]=t,t&&this.classes.add(t),this},h.prototype.updateSize=function(){var e;return this.hidden&&(this.element.style.visibility="hidden",n.body.appendChild(this.element)),this.width=this.element.offsetWidth,this.height=this.element.offsetHeight,null==this.spacing&&(this.spacing=null!=this.options.spacing?this.options.spacing:(e=c(this.element,"top"),0|Math.round(String(e).replace(/[^\-0-9.]/g,"")))),this.hidden?(n.body.removeChild(this.element),this.element.style.visibility=""):this.position(),this},h.prototype.content=function(e){return"object"==typeof e?(this.element.innerHTML="",this.element.appendChild(e)):this.element.innerHTML=e,this.updateSize(),this},h.prototype.place=function(e){return this.options.place=e,this.hidden||this.position(),this},h.prototype.attach=function(e){return this.attachedTo=e,this.hidden||this.position(),this},h.prototype.detach=function(){return this.hide(),this.attachedTo=null,this},h.prototype._pickPlace=function(e){if(!this.options.auto)return this.options.place;var t=l(r),n=this.options.place.split("-"),a=this.spacing;if(-1!==i(s,n[0]))switch(e.top-this.height-a<=t.top?n[0]="bottom":e.bottom+this.height+a>=t.bottom&&(n[0]="top"),n[1]){case"left":e.right-this.width<=t.left&&(n[1]="right");break;case"right":e.left+this.width>=t.right&&(n[1]="left");break;default:e.left+e.width/2+this.width/2>=t.right?n[1]="left":e.right-e.width/2-this.width/2<=t.left&&(n[1]="right")}else switch(e.left-this.width-a<=t.left?n[0]="right":e.right+this.width+a>=t.right&&(n[0]="left"),n[1]){case"top":e.bottom-this.height<=t.top&&(n[1]="bottom");break;case"bottom":e.top+this.height>=t.bottom&&(n[1]="top");break;default:e.top+e.height/2+this.height/2>=t.bottom?n[1]="top":e.bottom-e.height/2-this.height/2<=t.top&&(n[1]="bottom")}return n.join("-")},h.prototype.position=function(e,t){this.attachedTo&&(e=this.attachedTo),null==e&&this._p?(e=this._p[0],t=this._p[1]):this._p=arguments;var i,r,n="number"==typeof e?{left:0|e,right:0|e,top:0|t,bottom:0|t,width:0,height:0}:l(e),a=this.spacing,s=this._pickPlace(n);switch(s!==this.curPlace&&(this.curPlace&&this.classes.remove(this.curPlace),this.classes.add(s),this.curPlace=s),this.curPlace){case"top":i=n.top-this.height-a,r=n.left+n.width/2-this.width/2;break;case"top-left":i=n.top-this.height-a,r=n.right-this.width;break;case"top-right":i=n.top-this.height-a,r=n.left;break;case"bottom":i=n.bottom+a,r=n.left+n.width/2-this.width/2;break;case"bottom-left":i=n.bottom+a,r=n.right-this.width;break;case"bottom-right":i=n.bottom+a,r=n.left;break;case"left":i=n.top+n.height/2-this.height/2,r=n.left-this.width-a;break;case"left-top":i=n.bottom-this.height,r=n.left-this.width-a;break;case"left-bottom":i=n.top,r=n.left-this.width-a;break;case"right":i=n.top+n.height/2-this.height/2,r=n.right+a;break;case"right-top":i=n.bottom-this.height,r=n.right+a;break;case"right-bottom":i=n.top,r=n.right+a}return this.element.style.top=Math.round(i)+"px",this.element.style.left=Math.round(r)+"px",this},h.prototype.show=function(e,t){return e=this.attachedTo?this.attachedTo:e,clearTimeout(this.aIndex),null!=e&&this.position(e,t),this.hidden&&(this.hidden=0,n.body.appendChild(this.element)),this.attachedTo&&this._aware(),this.options.inClass&&(this.options.effectClass&&this.element.clientHeight,this.classes.add(this.options.inClass)),this},h.prototype.getElement=function(){return this.element},h.prototype.hide=function(){if(!this.hidden){var e=this,t=0;return this.options.inClass&&(this.classes.remove(this.options.inClass),this.options.effectClass&&(t=u(this.element))),this.attachedTo&&this._unaware(),clearTimeout(this.aIndex),this.aIndex=setTimeout(function(){e.aIndex=0,n.body.removeChild(e.element),e.hidden=1},t),this}},h.prototype.toggle=function(e,t){return this[this.hidden?"show":"hide"](e,t)},h.prototype.destroy=function(){clearTimeout(this.aIndex),this._unaware(),this.hidden||n.body.removeChild(this.element),this.element=this.options=null},h.prototype._aware=function(){-1===i(h.winAware,this)&&h.winAware.push(this)},h.prototype._unaware=function(){var e=i(h.winAware,this);-1!==e&&h.winAware.splice(e,1)},h.reposition=function(){var e,t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||function(e){return setTimeout(e,17)};function i(){e=0;for(var t=0,i=h.winAware.length;t<i;t++)h.winAware[t].position()}return function(){!e&&h.winAware.length&&(e=t(i))}}(),h.winAware=[],window.addEventListener("resize",h.reposition),window.addEventListener("scroll",h.reposition),h.classTypes=["type","effect"],h.defaults={baseClass:"tooltip",typeClass:null,effectClass:null,inClass:"in",place:"top",spacing:null,auto:0},t.Tooltip=h}])})?r.apply(t,n):r)||(e.exports=a)},function(e,t){e.exports=c},function(e,t){e.exports=u},function(e,t){e.exports=d},function(e,t){e.exports=h},function(e,t){e.exports=g},function(e,t,i){"use strict";var r,n,a,s,o;if(window.requestAnimationFrame||(r=0,window.requestAnimationFrame=function(e){var t=Date.now(),i=Math.max(0,16-t+r);return r=t+i,setTimeout(function(){e.call(null,t+i)},i)},window.cancelAnimationFrame=function(e){clearTimeout(e)}),window.requestIdleCallback||(window.requestIdleCallback=function(e,t){return setTimeout(e,t&&t.timeout?t.timeout:0)},window.cancelIdleCallback=function(e){clearTimeout(e)}),Number.isFinite||Object.defineProperty(Number,"isFinite",{value:function(e){return"number"==typeof e&&isFinite(e)},configurable:!0,enumerable:!1,writable:!0}),Number.isNaN||Object.defineProperty(Number,"isNaN",{value:function(e){return"number"==typeof e&&isNaN(e)},configurable:!0,enumerable:!1,writable:!0}),Number.isInteger||Object.defineProperty(Number,"isInteger",{value:function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},configurable:!0,enumerable:!1,writable:!0}),Number.MAX_SAFE_INTEGER||Object.defineProperty(Number,"MAX_SAFE_INTEGER",{value:9007199254740991,configurable:!1,enumerable:!1,writable:!1}),Math.sign||(Math.sign=function(e){return(e>0)-(e<0)||Number(e)}),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(e){if(null==this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var t,i=Object(this),r=i.length>>>0,n=arguments[1],a=0;a<r;a++)if(t=i[a],e.call(n,t,a,i))return t},configurable:!0,enumerable:!1,writable:!0}),Array.prototype.findIndex||Object.defineProperty(Array.prototype,"findIndex",{value:function(e){if(null==this)throw new TypeError("Array.prototype.findIndex called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var t,i=Object(this),r=i.length>>>0,n=arguments[1],a=0;a<r;a++)if(t=i[a],e.call(n,t,a,i))return a;return-1},configurable:!0,enumerable:!1,writable:!0}),!Array.from){Object.defineProperty(Array,"from",{value:(n=Object.prototype.toString,a=function(e){return"function"==typeof e||"[object Function]"===n.call(e)},s=Math.pow(2,53)-1,o=function(e){var t=function(e){var t=Number(e);return isNaN(t)?0:0!==t&&isFinite(t)?(t>0?1:-1)*Math.floor(Math.abs(t)):t}(e);return Math.min(Math.max(t,0),s)},function(e){var t=Object(e);if(null==e)throw new TypeError("Array.from requires an array-like object - not null or undefined");var i,r=arguments.length>1?arguments[1]:void 0;if(void 0!==r){if(!a(r))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(i=arguments[2])}for(var n,s=o(t.length),l=a(this)?Object(new this(s)):new Array(s),c=0;c<s;)n=t[c],l[c]=r?void 0===i?r(n,c):r.call(i,n,c):n,c+=1;return l.length=s,l}),configurable:!0,enumerable:!1,writable:!0});var l=Map.prototype.set;Object.defineProperty(Map.prototype,"set",{value:function(){return l.apply(this,arguments),this},configurable:!0,enumerable:!1,writable:!0}),Object.defineProperty(Map.prototype,"values",{value:function(){var e={},t=0;return this.forEach(i=>e[String(t++)]=i),e.length=t,e},configurable:!0,enumerable:!1,writable:!0}),Object.defineProperty(Map.prototype,"entries",{value:function(){var e={},t=0;return this.forEach((i,r)=>e[String(t++)]=[r,i]),e.length=t,e},configurable:!0,enumerable:!1,writable:!0})}Object.assign||Object.defineProperty(Object,"assign",{value:function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),i=1;i<arguments.length;i++){var r=arguments[i];if(null!=r)for(var n in r)r.hasOwnProperty(n)&&(t[n]=r[n])}return t},configurable:!0,enumerable:!1,writable:!0}),Element.prototype.matches||Object.defineProperty(Element.prototype,"matches",{value:Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,configurable:!0,enumerable:!0,writable:!0})},,,,function(e,t,i){e.exports=i(1)}])});